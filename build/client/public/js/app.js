!function(){"use strict";var e="undefined"==typeof window?global:window;if("function"!=typeof e.require){var t={},n={},r={}.hasOwnProperty,o={},i=function(e,t){var n=0;t&&(t.indexOf(!1)&&(n="components/".length),t.indexOf("/",n)>0&&(t=t.substring(n,t.indexOf("/",n))));var r=o[e+"/index.js"]||o[t+"/deps/"+e+"/index.js"];return r?"components/"+r.substring(0,r.length-".js".length):e},s=function(){var e=/^\.\.?(\/|$)/;return function(t,n){var r,o,i=[];r=(e.test(n)?t+"/"+n:n).split("/");for(var s=0,a=r.length;a>s;s++)o=r[s],".."===o?i.pop():"."!==o&&""!==o&&i.push(o);return i.join("/")}}(),a=function(e){return e.split("/").slice(0,-1).join("/")},l=function(t){return function(n){var r=s(a(t),n);return e.require(r,t)}},c=function(e,t){var r={id:e,exports:{}};return n[e]=r,t(r.exports,l(e),r),r.exports},u=function(e,o){var a=s(e,".");if(null==o&&(o="/"),a=i(e,o),r.call(n,a))return n[a].exports;if(r.call(t,a))return c(a,t[a]);var l=s(a,"./index");if(r.call(n,l))return n[l].exports;if(r.call(t,l))return c(l,t[l]);throw new Error('Cannot find module "'+e+'" from "'+o+'"')};u.alias=function(e,t){o[t]=e},u.register=u.define=function(e,n){if("object"==typeof e)for(var o in e)r.call(e,o)&&(t[o]=e[o]);else t[e]=n},u.list=function(){var e=[];for(var n in t)r.call(t,n)&&e.push(n);return e},u.brunch=!0,e.require=u}}(),require.register("actions/account_action_creator",function(e,n,r){var o,i,s,a,l,c,u,p;u=n("../utils/xhr_utils"),a=n("../app_dispatcher"),s=n("../constants/app_constants").ActionTypes,i=n("../stores/account_store"),l=null,c=n("./message_action_creator"),p=function(){return null==l&&(l=n("../actions/layout_action_creator")),l},r.exports=o={create:function(e,t){return a.handleViewAction({type:s.ADD_ACCOUNT_REQUEST,value:{inputValues:e}}),u.createAccount(e,function(e,t){var n;return null!=e||null==t?a.handleViewAction({type:s.ADD_ACCOUNT_FAILURE,value:{error:e}}):null==t?a.handleViewAction({type:s.ADD_ACCOUNT_FAILURE,value:{error:"no account returned from create"}}):(a.handleViewAction({type:s.ADD_ACCOUNT_SUCCESS,value:{account:t}}),n="account/"+t.id+"/config/mailboxes",window.router.navigate(n,{trigger:!0}))})},edit:function(e,t,n){var r;return r=i.getByID(t).mergeDeep(e),a.handleViewAction({type:s.EDIT_ACCOUNT_REQUEST,value:{inputValues:e,newAccount:r}}),u.editAccount(r,function(e,t){return null!=e?a.handleViewAction({type:s.EDIT_ACCOUNT_FAILURE,value:{error:e}}):(a.handleViewAction({type:s.EDIT_ACCOUNT_SUCCESS,value:{rawAccount:t}}),"function"==typeof n?n():void 0)})},check:function(e,t,n){var r,o;return null!=t?(r=i.getByID(t),o=r.mergeDeep(e).toJS()):o=e,a.handleViewAction({type:s.CHECK_ACCOUNT_REQUEST,value:{inputValues:e,newAccount:o}}),u.checkAccount(o,function(e,t){return null!=e?a.handleViewAction({type:s.CHECK_ACCOUNT_FAILURE,value:{error:e}}):a.handleViewAction({type:s.CHECK_ACCOUNT_SUCCESS,value:{rawAccount:t}}),"function"==typeof n?n(e,t):void 0})},remove:function(e){return a.handleViewAction({type:s.REMOVE_ACCOUNT,value:e}),u.removeAccount(e,function(e){}),p().notify(t("account removed"),{autoclose:!0}),window.router.navigate("",{trigger:!0})},ensureSelected:function(e){return function(e,t){return i.selectedIsDifferentThan(e,t)?o.selectAccount(e,t):void 0}}(this),selectDefaultIfNoneSelected:function(e){return function(){var e,t;return t=i.getSelected(),e=i.getDefault(),null==t&&e?o.selectAccount(e.get("id")):void 0}}(this),selectAccount:function(e,t){var n,r,o;return n=i.selectedIsDifferentThan(e,t),a.handleViewAction({type:s.SELECT_ACCOUNT,value:{accountID:e,mailboxID:t}}),r=i.getSelected(),o=null!=r?r.get("supportRFC4551"):void 0,null!=t&&n&&o?c.refreshMailbox(t):void 0},selectAccountForMessage:function(e){return function(e){var t;return t=i.getSelected(),null==t&&(null!=e?e.accountID:void 0)?o.selectAccount(e.accountID):void 0}}(this),discover:function(e,t){return u.accountDiscover(e,t)},mailboxCreate:function(e,n){return u.mailboxCreate(e,function(e,r){var o;return null==e?(a.handleViewAction({type:s.MAILBOX_CREATE,value:r}),p().alertSuccess(t("mailbox create ok"))):(o=""+t("mailbox create ko")+" "+(e.message||e),p().alertError(o)),"function"==typeof n?n(e):void 0})},mailboxUpdate:function(e,n){return u.mailboxUpdate(e,function(e,r){var o;return null==e?(a.handleViewAction({type:s.MAILBOX_UPDATE,value:r}),p().alertSuccess(t("mailbox update ok"))):(o=""+t("mailbox update ko")+" "+(e.message||e),p().alertError(o({autoclose:!0}))),"function"==typeof n?n(e):void 0})},mailboxDelete:function(e,t){return u.mailboxDelete(e,function(e,n){return null==e&&a.handleViewAction({type:s.MAILBOX_DELETE,value:n}),null!=t?t(e):void 0})},mailboxExpunge:function(e){var n,r;return n=e.accountID,r=e.mailboxID,a.handleViewAction({type:s.MAILBOX_EXPUNGE,value:r}),u.mailboxExpunge(e,function(e,o){var s;return null==e?p().notify(t("mailbox expunge ok"),{autoclose:!0}):(p().alertError(""+t("mailbox expunge ko")+" "+(e.message||e)),i.selectedIsDifferentThan(n,r)?void 0:(s=MessageStore.getQueryParams(),s.accountID=n,s.mailboxID=r,p().showMessageList({parameters:s})))})}}}),require.register("actions/contact_action_creator",function(e,n,r){var o,i,s,a,l;s=n("../app_dispatcher"),o=n("../constants/app_constants").ActionTypes,i=n("../utils/activity_utils"),l=n("../actions/layout_action_creator"),r.exports=a={searchContact:function(e){var t,n;return n={name:"search",data:{type:"contact",query:e}},t=new i(n),t.onsuccess=function(){return s.handleViewAction({type:o.RECEIVE_RAW_CONTACT_RESULTS,value:this.result})},t.onerror=function(){return console.log("KO",this.error,this.name)}},searchContactLocal:function(e){return s.handleViewAction({type:o.CONTACT_LOCAL_SEARCH,value:e})},createContact:function(e,n){var r,a;return a={name:"create",data:{type:"contact",contact:e}},r=new i(a),r.onsuccess=function(r,i){var a;return s.handleViewAction({type:o.RECEIVE_RAW_CONTACT_RESULTS,value:this.result}),a=t("contact create success",{contact:e.name||e.address}),l.notify(a,{autoclose:!0}),"function"==typeof n?n():void 0},r.onerror=function(){var e;return console.log(this.name),e=t("contact create error",{error:this.name}),l.alertError(e,{autoclose:!0}),"function"==typeof n?n():void 0}}}}),require.register("actions/layout_action_creator",function(e,t,n){var r,o,i,s,a,l,c,u,p,d,h,f,m,g;f=t("../utils/xhr_utils"),h=t("../utils/socketio_utils"),c=t("../stores/layout_store"),o=t("../stores/account_store"),d=t("../stores/message_store"),a=t("../app_dispatcher"),g=t("../constants/app_constants"),i=g.ActionTypes,s=g.AlertLevel,p=g.MessageFlags,r=t("./account_action_creator"),u=t("./message_action_creator"),m=0,n.exports=l={setDisposition:function(e){return a.handleViewAction({type:i.SET_DISPOSITION,value:e})},toggleListMode:function(){return a.handleViewAction({type:i.TOGGLE_LIST_MODE})},increasePreviewPanel:function(e){return null==e&&(e=1),a.handleViewAction({type:i.RESIZE_PREVIEW_PANE,value:Math.abs(e)})},decreasePreviewPanel:function(e){return null==e&&(e=1),a.handleViewAction({type:i.RESIZE_PREVIEW_PANE,value:-1*Math.abs(e)})},resetPreviewPanel:function(){return a.handleViewAction({type:i.RESIZE_PREVIEW_PANE,value:null})},toggleFullscreen:function(){var e;return e=c.isPreviewFullscreen()?i.MINIMIZE_PREVIEW_PANE:i.MAXIMIZE_PREVIEW_PANE,a.handleViewAction({type:e})},minimizePreview:function(){return a.handleViewAction({type:i.MINIMIZE_PREVIEW_PANE})},refresh:function(){return a.handleViewAction({type:i.REFRESH,value:null})},alert:function(e){return l.notify(e,{level:s.INFO,autoclose:!0})},alertSuccess:function(e){return l.notify(e,{level:s.SUCCESS,autoclose:!0})},alertWarning:function(e){return l.notify(e,{level:s.WARNING,autoclose:!0})},alertError:function(e){return l.notify(e,{level:s.ERROR,autoclose:!0})},notify:function(e,t){var n;if(null==e||""===e.toString().trim())throw new Error("Empty notification");return n={id:"taskid-"+m++,finished:!0,message:e.toString()},null!=t&&(n.autoclose=t.autoclose,n.errors=t.errors,n.finished=t.finished,n.actions=t.actions,n.level=t.level),a.handleViewAction({type:i.RECEIVE_TASK_UPDATE,value:n})},clearToasts:function(){return a.handleViewAction({type:i.CLEAR_TOASTS,value:null})},getDefaultRoute:function(){return 0===o.getAll().length?"account.new":"account.mailbox.messages"},showMessageList:function(e){var t,n,o,s,l,c,p;return c=e.parameters,t=c.accountID,l=c.mailboxID,s=c.filter,p=c.sort,o=c.before,n=c.after,r.ensureSelected(t,l),a.handleViewAction({type:i.QUERY_PARAMETER_CHANGED,value:c}),u.fetchMoreOfCurrentQuery()},showSearchResult:function(e){var t,n,o;return o=e.parameters,t=o.accountID,n=o.search,"all"!==t?r.ensureSelected(t):r.selectAccount(null),a.handleViewAction({type:i.SEARCH_PARAMETER_CHANGED,value:{accountID:t,search:n}}),"-"!==n?u.fetchSearchResults(t,n):void 0},showMessage:function(e,t){var n;return n=d.getByID(e.parameters.messageID),null!=n?r.selectAccountForMessage(n):f.fetchMessage(messageID,function(e,t){return null!=e?l.alertError(e):(u.receiveRawMessage(t),r.selectAccountForMessage(t))})},showConversation:function(e,t){var n,o,i,s;return s=e.parameters.messageID,n=e.parameters.conversationID,i=d.getByID(s),null!=i&&r.selectAccountForMessage(i),o=d.getConversationsLength().get(n),null==o||o>1?u.fetchConversation(n):void 0},showComposeNewMessage:function(e,t){return r.selectDefaultIfNoneSelected()},showComposeMessage:function(e,t){var n,o;return r.selectDefaultIfNoneSelected(),o=e.parameters.messageID,n=d.getByID(o),null==n?f.fetchMessage(o,function(e,t){return null!=e?l.alertError(e):(u.receiveRawMessage(t),r.selectAccountForMessage(t))}):void 0},showCreateAccount:function(e,t){return r.selectAccount(null)},showConfigAccount:function(e,t){return r.selectAccount(e.parameters.accountID)},showSettings:function(e,t){},toastsShow:function(){return a.handleViewAction({type:i.TOASTS_SHOW})},toastsHide:function(){return a.handleViewAction({type:i.TOASTS_HIDE})},intentAvailability:function(e){return a.handleViewAction({type:i.INTENT_AVAILABLE,value:e})},drawerShow:function(){return a.handleViewAction({type:i.DRAWER_SHOW})},drawerHide:function(){return a.handleViewAction({type:i.DRAWER_HIDE})},drawerToggle:function(){return a.handleViewAction({type:i.DRAWER_TOGGLE})},displayModal:function(e){return null==e.closeModal&&(e.closeModal=function(){return l.hideModal()}),a.handleViewAction({type:i.DISPLAY_MODAL,value:e})},hideModal:function(){return a.handleViewAction({type:i.HIDE_MODAL})}}}),require.register("actions/message_action_creator",function(e,t,n){var r,o,i,s,a,l,c,u,p,d,h,f;i=t("../app_dispatcher"),s=t("../constants/app_constants"),o=s.ActionTypes,c=s.MessageFlags,a=s.FlagsConstants,d=t("../utils/xhr_utils"),r=t("../stores/account_store"),u=t("../stores/message_store"),p=t("../stores/search_store"),h=1,n.exports=l={receiveRawMessages:function(e){return i.handleViewAction({type:o.RECEIVE_RAW_MESSAGES,value:e})},receiveRawMessage:function(e){return i.handleViewAction({type:o.RECEIVE_RAW_MESSAGE,value:e})},send:function(e,t){return d.messageSend(e,function(e,n){return null==e&&null!=n&&i.handleViewAction({type:o.MESSAGE_SEND,value:n}),"function"==typeof t?t(e,n):void 0})},setCurrent:function(e,t){return null!=e&&"string"!=typeof e&&(e=e.get("id")),i.handleViewAction({type:o.MESSAGE_CURRENT,value:{messageID:e,conv:t}})},fetchMoreOfCurrentQuery:function(){var e,t,n;return(n=u.getNextUrl())?(e=r.getSelectedMailbox().get("id"),i.handleViewAction({type:o.MESSAGE_FETCH_REQUEST,value:{mailboxID:e}}),t=Date.now(),d.fetchMessagesByFolder(n,function(n,r){return null!=n?i.handleViewAction({type:o.MESSAGE_FETCH_FAILURE,value:{mailboxID:e}}):(r.messages.forEach(function(e){return e.updated=t}),i.handleViewAction({type:o.MESSAGE_FETCH_SUCCESS,value:{mailboxID:e,fetchResult:r}}))})):void 0},fetchSearchResults:function(e,t){var n;return"-"===t?null:(n=p.getNextSearchUrl())?(i.handleViewAction({type:o.SEARCH_REQUEST,value:{search:t}}),d.search(n,function(e,t){return null!=e?i.handleViewAction({type:o.SEARCH_FAILURE,value:{error:e}}):i.handleViewAction({type:o.SEARCH_SUCCESS,value:{searchResults:t}})})):void 0},fetchConversation:function(e){return i.handleViewAction({type:o.CONVERSATION_FETCH_REQUEST,value:{conversationID:e}}),d.fetchConversation(e,function(e,t){return e?i.handleViewAction({type:o.CONVERSATION_FETCH_FAILURE,value:{error:e}}):i.handleViewAction({type:o.CONVERSATION_FETCH_SUCCESS,value:{updated:t}})})},recover:function(e,t){return i.handleViewAction({type:o.MESSAGE_RECOVER_REQUEST,value:{ref:t}}),d.batchFetch(e,function(e,n){return e?i.handleViewAction({type:o.MESSAGE_RECOVER_FAILURE,value:{ref:t}}):i.handleViewAction({type:o.MESSAGE_RECOVER_SUCCESS,value:{ref:t}})})},refreshMailbox:function(e){return r.isMailboxRefreshing(e)?void 0:(i.handleViewAction({type:o.REFRESH_REQUEST,value:{mailboxID:e}}),d.refreshMailbox(e,function(t,n){return null!=t?i.handleViewAction({type:o.REFRESH_FAILURE,value:{mailboxID:e,error:t}}):i.handleViewAction({type:o.REFRESH_SUCCESS,value:{mailboxID:e,updated:n}})}))},"delete":function(e,t){var n,r;return n=h++,i.handleViewAction({type:o.MESSAGE_TRASH_REQUEST,value:{target:e,ref:n}}),r=Date.now(),d.batchDelete(e,function(t){return function(s,a){var l,c,u;if(s)return i.handleViewAction({type:o.MESSAGE_TRASH_FAILURE,value:{target:e,ref:n,error:s}}),t.recover(e,n);for(c=0,u=a.length;u>c;c++)l=a[c],l.updated=r;return i.handleViewAction({type:o.MESSAGE_TRASH_SUCCESS,value:{target:e,ref:n,updated:a}})}}(this))},move:function(e,t,n,r){var s,a;return s=h++,i.handleViewAction({type:o.MESSAGE_MOVE_REQUEST,value:{target:e,ref:s,from:t,to:n}}),a=Date.now(),d.batchMove(e,t,n,function(t){return function(n,l){var c,u,p;if(n)i.handleViewAction({type:o.MESSAGE_MOVE_FAILURE,value:{target:e,ref:s,error:n}}),t.recover(e,s);else{for(u=0,p=l.length;p>u;u++)c=l[u],c.updated=a;i.handleViewAction({type:o.MESSAGE_MOVE_SUCCESS,value:{target:e,ref:s,updated:l}})}return"function"==typeof r?r(n,l):void 0}}(this))},mark:function(e,t,n){var r,s,l,c;switch(l=h++,t){case a.SEEN:s="batchAddFlag",r=a.SEEN;break;case a.FLAGGED:s="batchAddFlag",r=a.FLAGGED;break;case a.UNSEEN:s="batchRemoveFlag",r=a.SEEN;break;case a.NOFLAG:s="batchRemoveFlag",r=a.FLAGGED;break;default:throw new Error("Wrong usage : unrecognized FlagsConstants")}return i.handleViewAction({type:o.MESSAGE_FLAGS_REQUEST,value:{target:e,ref:l,op:s,flag:r,flagAction:t}}),c=Date.now(),d[s](e,r,function(a){return function(u,p){var d,h,f;if(u)i.handleViewAction({type:o.MESSAGE_FLAGS_FAILURE,value:{target:e,ref:l,error:u,op:s,flag:r,flagAction:t}}),a.recover(e,l);else{for(h=0,f=p.length;f>h;h++)d=p[h],d.updated=c;i.handleViewAction({type:o.MESSAGE_FLAGS_SUCCESS,value:{target:e,ref:l,updated:p,op:s,flag:r,flagAction:t}})}return"function"==typeof n?n(u,p):void 0}}(this))},undo:function(e){var t,n,r,s,a,c,p,d,h,m;return a=u.getUndoableRequest(e),r=a.messages,m=a.type,n=a.from,d=a.to,p=a.target,h=a.trashBoxID,c=[],s="move"===m?d:h,t={},r.forEach(function(e){var n,r,o,i;return r=function(){var t,r;t=e.get("mailboxIDs"),r=[];for(n in t)i=t[n],r.push(n);return r}(),o=r.sort().join(","),null==t[o]&&(t[o]={to:r,from:s,messageIDs:[]}),t[o].messageIDs.push(e.get("id"))}),i.handleViewAction({type:o.MESSAGE_UNDO_START,value:{ref:e}}),f(t,function(e,t,r){var o;return d=e.to,n=e.from,o=e.messageIDs,p={messageIDs:o,silent:!0},l.move(p,n,d,r)},function(t){return t?(i.handleViewAction({type:o.MESSAGE_UNDO_FAILURE,value:{ref:e}}),this.recover(p,e)):i.handleViewAction({type:o.MESSAGE_UNDO_SUCCESS,value:{ref:e}})})}},f=function(e,t,n){var r,o,i;return o=Object.keys(e),r=0,(i=function(){var s;return s=o[r],t(e[s],s,function(e){return e?n(e):++r===o.length?n(null):i()})})()}}),require.register("actions/settings_action_creator",function(e,n,r){var o,i,s,a,l,c;c=n("../utils/xhr_utils"),i=n("../app_dispatcher"),o=n("../constants/app_constants").ActionTypes,l=n("../stores/settings_store"),s=n("./layout_action_creator"),r.exports=a={edit:function(e){return c.changeSettings(e,function(e,n){return e?s.alertError(t("settings save error")+e):i.handleViewAction({type:o.SETTINGS_UPDATED,value:n})})}}}),require.register("app_dispatcher",function(e,t,n){var r,o,i,s={}.hasOwnProperty,a=function(e,t){function n(){this.constructor=e}for(var r in t)s.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};o=t("./libs/flux/dispatcher/dispatcher"),i=t("./constants/app_constants").PayloadSources,r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return a(t,e),t.prototype.handleViewAction=function(e){var t;return window.cozyMails.logAction(e),t={source:i.VIEW_ACTION,action:e},this.dispatch(t),window.cozyMails.customEvent(i.VIEW_ACTION,e)},t.prototype.handleServerAction=function(e){var t;return window.cozyMails.logAction(e),t={source:i.SERVER_ACTION,action:e},this.dispatch(t),window.cozyMails.customEvent(i.SERVER_ACTION,e)},t}(o),n.exports=new r}),require.register("components/account_config",function(e,n,r){var o,i,s,a,l,c,u,p,d,h,f,m,g,v,y,b,S,k;c=n("../stores/account_store"),o=n("../actions/account_action_creator"),p=n("../actions/layout_action_creator"),f=n("../mixins/router_mixin"),g=n("../mixins/store_watch_mixin"),m=n("../mixins/should_update_mixin"),k=n("./basic_components"),u=k.Container,b=k.Title,y=k.Tabs,l=n("./account_config_delete"),s=n("./account_config_main"),i=n("./account_config_mailboxes"),a=n("./account_config_signature"),S=React.DOM.div,h=["label","name","login","password","imapServer","imapPort","smtpServer","smtpPort","smtpMethod"],d=h,v=["account","mailboxes","signature"],r.exports=React.createClass({displayName:"AccountConfig",_lastDiscovered:"",mixins:[f,m.UnderscoreEqualitySlow,g([c])],getStateFromStores:function(){var e,t,n;return n={},n.serverErrors=c.getErrors(),n.selectedAccount=c.getSelected(),n.isWaiting=c.isWaiting(),n.isChecking=c.isChecking(),n.mailboxes=c.getSelectedMailboxes(!0),n.favoriteMailboxes=c.getSelectedFavorites(),n.submitted=null!=c.getSelected(),this.state?(this.state.selectedAccount!==n.selectedAccount&&(t=this.state.editedAccount.merge(n.selectedAccount),n.editedAccount=t),this.state.serverErrors!==n.serverErrors&&(n.errors=n.serverErrors)):(e=c.getSelected(),null==e&&(e=c.makeEmptyAccount()),n.isWaiting=!1,n.errors=Immutable.Map(),n.editedAccount=e),n},isOauth:function(){var e;return null!=(null!=(e=this.state.selectedAccount)?e.get("oauthProvider"):void 0)},isNew:function(){return null==this.state.selectedAccount},getCurrentTab:function(){var e,t;return t=this.state.editedAccount.get("mailboxes"),e=0===(null!=t?t.length:void 0)?"mailboxes":"account",this.props.tab||e},onTabChangesDoSubmit:function(e){return this.onTabChanges(e,function(e){return function(){return e.onSubmit()}}(this))},onTabChanges:function(e,t){var n,r;return null==t&&(t=function(){}),n={editedAccount:this.state.editedAccount.merge(e),errors:Immutable.Map()},this.state.submitted&&(r=this.getLocalValidationErrors(n.editedAccount),n.errors=Immutable.Map(r)),this.setState(n,t)},render:function(){var e,n;return e=this.getCurrentTab(),u({id:"mailbox-config"},b({text:t(this.isNew()?"account new":"account edit")}),this.state.editedAccount.get("id")?y({tabs:v.map(function(n){return function(r){return{"class":e===r?"active":"",text:t("account tab "+r),url:n.buildUrl({direction:"first",action:"account.config",parameters:[n.state.editedAccount.get("id"),r]})}}}(this))}):void 0,function(){switch(e){case"signature":return a({account:this.state.editedAccount,editedAccount:this.state.editedAccount,requestChange:this.onTabChanges,onSubmit:this.onSubmit,errors:this.state.errors});case"mailboxes":return i({editedAccount:this.state.editedAccount,requestChange:this.onTabChangesDoSubmit,nomailboxesError:this.state.errors,onSubmit:this.onSubmit,errors:this.state.errors});default:return s({editedAccount:this.state.editedAccount,requestChange:this.onTabChanges,isWaiting:this.state.isWaiting,checking:this.state.isChecking,onSubmit:this.onSubmit,errors:this.state.errors})}}.call(this),(null!=(n=this.state.editedAccount)?n.get("id"):void 0)?l({editedAccount:this.state.editedAccount}):void 0)},getLocalValidationErrors:function(e){var n,r,o,i,s;for(r={},o=this.isNew()?h:d,i=0,s=o.length;s>i;i++)n=o[i],e.get(n)||(r[n]=t("validate must not be empty"));return r},onSubmit:function(e,n){var r,i,s,a;return null!=e&&e.preventDefault(),i=this.getLocalValidationErrors(this.state.editedAccount),s=null!=(a=this.state.editedAccount)?a.get("id"):void 0,r=this.state.editedAccount.toJS(),i.length>0?(p.alertError(t("account errors")),this.setState({submitted:!0,errors:i})):n===!0?o.check(r,s):s?o.edit(r,s):o.create(r)}})}),require.register("components/account_config_delete",function(e,n,r){var o,i,s,a,l,c,u,p;u=React.DOM.div,o=n("../actions/account_action_creator"),c=n("../actions/layout_action_creator"),p=n("./basic_components"),s=p.FieldSet,l=p.FormButtons,a=p.FormButton,r.exports=i=React.createClass({displayName:"AccountConfigDelete",getInitialState:function(){var e;return e={},e.deleting=!1,e},render:function(){return s({text:t("account danger zone")},l(null,a({className:"btn-remove","default":!0,danger:!0,onClick:this.onRemove,spinner:this.state.deleting,icon:"trash",text:t("account remove")})))},onRemove:function(e){var n;return null!=e&&e.preventDefault(),n=this.props.editedAccount.get("label"),c.displayModal({title:t("app confirm delete"),subtitle:t("account remove confirm",{label:n}),closeLabel:t("app cancel"),actionLabel:t("app confirm"),action:function(e){return function(){return c.hideModal(),e.setState({deleting:!0}),o.remove(e.props.editedAccount.get("id"))}}(this)})}})}),require.register("components/account_config_input",function(e,n,r){var o,i,s,a,l,c,u,p,d,h,f;h=React.DOM,c=h.div,p=h.label,u=h.input,d=h.textarea,f=n("./basic_components"),s=f.ErrorLine,i=f.Dropdown,l=React.addons.classSet,a=n("../mixins/router_mixin"),r.exports=o=React.createClass({displayName:"AccountInput",mixins:[a,React.addons.LinkedStateMixin],propTypes:{name:React.PropTypes.string.isRequired,error:React.PropTypes.string,className:React.PropTypes.string,onClick:React.PropTypes.func,onInput:React.PropTypes.func,onBlur:React.PropTypes.func,type:React.PropTypes.oneOf(["checkbox","textarea","email","text","password"]),valueLink:React.PropTypes.shape({value:React.PropTypes.any,requestChange:React.PropTypes.func.isRequired}),options:function(e){return"dropdown"===e.type?React.PropTypes.object.isRequired.apply(this,arguments):void 0}},getDefaultProps:function(){return{type:"text"}},render:function(){var e,n,r;return e=this.props.name,r=this.props.type||"text",n=this.buildPlaceHolder(r,e),c({key:"account-input-"+e,className:this.buildMainClasses(e)},p({htmlFor:"mailbox-"+e,className:"col-sm-2 col-sm-offset-2 control-label"},t("account "+e)),c({className:"col-sm-3"},"checkbox"===r?u({id:"mailbox-"+e,name:"mailbox-"+e,checkedLink:this.props.valueLink,type:r,onClick:this.props.onClick}):"textarea"===r?d({id:"mailbox-"+e,name:"mailbox-"+e,valueLink:this.props.valueLink,className:"form-control",placeholder:n,onBlur:this.props.onBlur,onInput:this.props.onInput}):"dropdown"===r?i({id:"mailbox-"+e,name:"mailbox-"+e,valueLink:this.props.valueLink,options:this.props.options,allowUndefined:this.props.allowUndefined}):u({id:"mailbox-"+e,name:"mailbox-"+e,valueLink:this.props.valueLink,type:r,className:"form-control",placeholder:n,onBlur:this.props.onBlur,onInput:this.props.onInput})),this.props.error?s({text:this.props.error}):void 0)},buildMainClasses:function(e){var t;return t="form-group account-item-"+e+" ",this.props.error&&(t=""+t+" has-error "),this.props.className&&(t=""+t+" "+this.props.className+" "),t},buildPlaceHolder:function(e,n){var r;return r=null,("text"===e||"email"===e||"signature"===n)&&(r=t("account "+n+" short")),r}})}),require.register("components/account_config_item",function(e,n,r){var o,i,s,a,l,c,u,p,d,h,f;f=React.DOM,d=f.li,h=f.span,u=f.i,p=f.input,c=React.addons.classSet,l=n("./basic_components").Spinner,o=n("../actions/account_action_creator"),i=n("../actions/layout_action_creator"),a=n("../mixins/router_mixin"),r.exports=s=React.createClass({displayName:"MailboxItem",mixins:[a,React.addons.LinkedStateMixin],propTypes:{mailbox:React.PropTypes.object},getInitialState:function(){return{edited:!1,favorite:this.props.favorite,deleting:!1}},render:function(){var e,n,r,o,i,s,a,f,m;return f=this.buildIndentation(),m=this.buildFavoriteValues(),n=m.favoriteClass,r=m.favoriteTitle,s=this.props.mailbox.get("nbTotal")||0,a=this.props.mailbox.get("nbUnread")||0,i=this.props.mailbox.get("nbRecent")||0,o=this.props.mailbox.get("id"),e=c({row:!0,box:!0,"box-item":!0,edited:this.state.edited}),this.state.edited?d({className:e,key:o},h({className:"col-xs-1 box-action save",onClick:this.updateMailbox,title:t("mailbox title edit save")},u({className:"fa fa-check"})),h({className:"col-xs-1 box-action cancel",onClick:this.undoMailbox,title:t("mailbox title edit cancel")},u({className:"fa fa-undo"})),p({className:"col-xs-6 box-label",ref:"label",defaultValue:this.props.mailbox.get("label"),type:"text",onKeyDown:this.onKeyDown})):d({className:e,key:o},h({className:"col-xs-1 box-action edit",onClick:this.editMailbox,title:t("mailbox title edit")},u({className:"fa fa-pencil"})),this.state.deleting?h({className:"col-xs-1 box-action delete"},l()):h({className:"col-xs-1 box-action delete",onClick:this.deleteMailbox,title:t("mailbox title delete")},u({className:"fa fa-trash-o"})),h({className:"col-xs-6 box-label",onClick:this.editMailbox},""+f+this.props.mailbox.get("label")),h({className:"col-xs-1 box-action favorite",title:r,onClick:this.toggleFavorite},u({className:n})),h({className:"col-xs-1 text-center box-count box-total"},s),h({className:"col-xs-1 text-center box-count box-unread"},a),h({className:"col-xs-1 text-center box-count box-new"},i))},buildIndentation:function(){return new Array(this.props.mailbox.get("depth")+1).join("    ")},buildFavoriteValues:function(){var e,n;return this.state.favorite?(e="fa fa-eye mailbox-visi-yes",n=t("mailbox title favorite")):(e="fa fa-eye-slash mailbox-visi-no",n=t("mailbox title not favorite")),{favoriteClass:e,favoriteTitle:n}},onKeyDown:function(e){switch(e.key){case"Enter":return this.updateMailbox()}},editMailbox:function(e){return e.preventDefault(),this.setState({edited:!0})},undoMailbox:function(e){return e.preventDefault(),this.setState({edited:!1})},updateMailbox:function(e){var t;return null!=e&&e.preventDefault(),t={label:this.refs.label.getDOMNode().value.trim(),mailboxID:this.props.mailbox.get("id"),accountID:this.props.accountID},o.mailboxUpdate(t,function(e){return function(t){return t?void 0:e.setState({edited:!1})}}(this))},toggleFavorite:function(e){var t,n;return t={favorite:!this.state.favorite,mailboxID:this.props.mailbox.get("id"),accountID:this.props.accountID},n=this.state.favorite,this.setState({favorite:!this.state.favorite}),o.mailboxUpdate(t,function(e){return e?this.setState({favorite:n}):void 0})},deleteMailbox:function(e){var n;return null!=e&&e.preventDefault(),n={title:t("app confirm delete"),subtitle:t("account confirm delbox"),closeLabel:t("app cancel"),actionLabel:t("app confirm"),action:function(e){return function(){var n;return i.hideModal(),e.setState({deleting:!0}),n={mailboxID:e.props.mailbox.get("id"),accountID:e.props.accountID},o.mailboxDelete(n,function(n){var r;return null!=n?(r=""+t("mailbox delete ko")+" "+n,i.alertError(r)):i.notify(t("mailbox delete ok"),{autoclose:!0}),e.isMounted()?e.setState({deleting:!1}):void 0})}}(this)},i.displayModal(n)}})}),require.register("components/account_config_mailboxes",function(e,n,r){var o,i,s,a,l,c,u,p,d,h,f,m,g,v,y,b,S,k,w,E,_,x,C,T=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};x=React.DOM,g=x.div,y=x.h4,_=x.ul,w=x.li,E=x.span,v=x.form,b=x.i,S=x.input,k=x.label,m=React.addons.classSet,o=n("../actions/account_action_creator"),l=n("../actions/layout_action_creator"),p=n("../mixins/router_mixin"),d=n("../mixins/should_update_mixin"),c=n("./account_config_item"),u=n("./mailbox_picker"),C=n("./basic_components"),h=C.SubTitle,a=C.Form,s=n("./account_config_delete"),f=n("../libs/cached_transform"),r.exports=i=React.createClass({displayName:"AccountConfigMailboxes",mixins:[p,React.addons.LinkedStateMixin,d.UnderscoreEqualitySlow],propTypes:{editedAccount:React.PropTypes.instanceOf(Immutable.Map).isRequired,requestChange:React.PropTypes.func.isRequired,errors:React.PropTypes.instanceOf(Immutable.Map).isRequired,onSubmit:React.PropTypes.func.isRequired},getInitialState:function(){return{newMailboxName:"",newMailboxParent:null}},makeLinkState:function(e){var t;return t=this.props.editedAccount.get(e),f(this,"__cacheLS",t,function(n){return function(){return{value:t,requestChange:function(t){var r;return r={},r[e]=t,n.props.requestChange(r)}}}}(this))},render:function(){return a({className:"form-horizontal"},h({className:"config-title"},t("account special mailboxes")),this.renderMailboxChoice("draft"),this.renderMailboxChoice("sent"),this.renderMailboxChoice("trash"),h({className:"config-title"},t("account mailboxes")),_({className:"folder-list list-unstyled boxes container"},this.props.editedAccount.get("mailboxes").length?this.renderTableHeader():void 0,this.props.editedAccount.get("mailboxes").map(function(e){return function(t,n){return c({key:n,accountID:e.props.editedAccount.get("id"),favorite:T.call(e.props.editedAccount.get("favorites"),n)>=0,mailbox:t})}}(this)).toJS(),this.renderTableFooter()))},renderError:function(){var e;return this.props.error&&"AccountConfigError"===this.props.error.name?(e=t("config error "+this.props.error.field),g({className:"alert alert-warning"},e)):this.props.error?g({className:"alert alert-warning"},this.props.error.message):0!==Object.keys(this.props.errors).length?g({className:"alert alert-warning"},t("account errors")):void 0},renderTableHeader:function(){return w({className:"row box title",key:"title"},E({className:"col-xs-1"},""),E({className:"col-xs-1"},""),E({className:"col-xs-6"},""),E({className:"col-xs-1"},""),E({className:"col-xs-1 text-center"},t("mailbox title total")),E({className:"col-xs-1 text-center"},t("mailbox title unread")),E({className:"col-xs-1 text-center"},t("mailbox title new")))},renderTableFooter:function(){return w({className:"row box new",key:"new"},E({className:"col-xs-1 box-action add",onClick:this.addMailboxClicked,title:t("mailbox title add")},b({className:"fa fa-plus"})),E({className:"col-xs-1 box-action cancel",onClick:this.resetMailboxClicked,title:t("mailbox title add cancel")},b({className:"fa fa-undo"})),g({className:"col-xs-6"},S({id:"newmailbox",type:"text",className:"form-control",placeholder:t("account newmailbox placeholder"),valueLink:this.linkState("newMailboxName"),onKeyDown:this.onNewMailboxKeyDown})),k({className:"col-xs-2 text-center control-label"},t("account newmailbox parent")),g({className:"col-xs-2 text-center"},u({allowUndefined:!0,valueLink:this.linkState("newMailboxParent"),mailboxes:this.props.editedAccount.get("mailboxes")})))},renderMailboxChoice:function(e){var n,r,o;return o=""+e+"Mailbox",r=t("account "+e+" mailbox"),n="form-group "+e+" ",this.props.editedAccount.get(o)||(n+="has-error"),g({className:n},k({className:"col-sm-2 col-sm-offset-2 control-label"},r),g({className:"col-sm-3"},u({allowUndefined:!1,valueLink:this.makeLinkState(o),mailboxes:this.props.editedAccount.get("mailboxes")})))},onNewMailboxKeyDown:function(e){return"Enter"===e.key?(e.preventDefault(),this.setState({newMailboxName:e.target.value},function(e){return function(){return e.addMailboxClicked()}}(this))):void 0},addMailboxClicked:function(e){var t;return null!=e&&e.preventDefault(),t={label:this.state.newMailboxName,accountID:this.props.editedAccount.get("id"),parentID:this.state.newMailboxParent},o.mailboxCreate(t,function(e){return function(t){return t?void 0:e.setState({newMailboxName:""})}}(this))},resetMailboxClicked:function(e){return e.preventDefault(),this.refs.newmailbox.getDOMNode().value="",this.setState({
newMailboxParent:null})}})}),require.register("components/account_config_main",function(e,n,r){var o,i,s,a,l,c,u,p,d,h,f,m,g,v,y,b,S,k,w,E,x,C,T,M,A,D,R;R=React.DOM,b=R.div,M=R.p,k=R.form,x=R.label,E=R.input,g=R.button,D=R.ul,T=R.li,f=R.a,A=R.span,w=R.i,S=R.fieldset,C=R.legend,v=React.addons.classSet,a=n("./account_config_input"),s=n("./account_config_delete"),o=n("../actions/account_action_creator"),d=n("../mixins/router_mixin"),m=n("./basic_components"),y=n("../utils/discovery_to_fields"),c=m.Form,l=m.FieldSet,p=m.FormButtons,u=m.FormButton,h={NONE:t("account smtpMethod NONE"),"CRAM-MD5":t("account smtpMethod CRAM-MD5"),LOGIN:t("account smtpMethod LOGIN"),PLAIN:t("account smtpMethod PLAIN")},r.exports=i=React.createClass({displayName:"AccountConfigMain",mixins:[d],propTypes:{editedAccount:React.PropTypes.instanceOf(Immutable.Map).isRequired,requestChange:React.PropTypes.func.isRequired,isWaiting:React.PropTypes.bool.isRequired},shouldComponentUpdate:function(e,t){var n,r;return r=_.isEqual(t,this.state),n=_.isEqual(e,this.props),!(r&&n)},getInitialState:function(){var e,t,n;return e=null!=(n=this.props.editedAccount.get("login"))?n.split("@")[1]:void 0,this.props.editedAccount.get("id")&&e&&(this._lastDiscovered=e),t={imapAdvanced:!1,smtpAdvanced:!1,displayGMAILSecurity:!1}},makeLinkState:function(e){var t,n;return t=(null!=this.__cacheLS?this.__cacheLS:this.__cacheLS={})[e],n=this.props.editedAccount.get(e)||"",(null!=t?t.value:void 0)===n?t:this.__cacheLS[e]={value:n,requestChange:function(t){return function(n){return t.props.requestChange(t.makeChanges(e,n))}}(this)}},makeChanges:function(e,t){var n;switch(n={},n[e]=t,e){case"imapPort":n.imapSSL="993"===t,n.imapTLS=!1;break;case"smtpPort":n.smtpSSL="465"===t,n.smtpTLS="587"===t;break;case"imapSSL":this.state.imapManualPort||(n.imapPort=t?"993":"143");break;case"smtpSSL":this.state.smtpManualPort||(n.smtpPort=t?"465":"25");break;case"smtpTLS":this.state.smtpManualPort||(n.smtpPort=t?"587":"25");break;case"login":this.doDiscovery(null!=t?t.split("@")[1]:void 0)}return n},componentWillReceiveProps:function(e){var t,n;return n=function(t,n){return null==n&&(n=""),e.errors.get(t)&&e.editedAccount.get(t)!==n},t={},n("imapLogin")&&(t.imapAdvanced=!0),n("smtpLogin")&&(t.smtpAdvanced=!0),n("smtpPassword")&&(t.smtpAdvanced=!0),n("smtpMethod","PLAIN")&&(t.smtpAdvanced=!0),t.smtpAdvanced||t.imapAdvanced?this.setState(t):void 0},buildButtonLabel:function(){var e;return e=this.props.isWaiting?"saving":this.props.editedAccount.get("id")?"save":"add",t("account "+e)},buildInput:function(e,t){var n;return null==t&&(t={}),null==t.name&&(t.name=e),t.key="account-config-field-"+e,null==t.valueLink&&(t.valueLink=this.makeLinkState(e)),null==t.error&&(t.error=null!=(n=this.props.errors)?n.get(e):void 0),a(t)},render:function(){var e,n,r;return e=v({"form-horizontal":!0,"form-account":!0,waiting:this.props.isWaiting}),n=null!=(null!=(r=this.props.editedAccount)?r.get("oauthProvider"):void 0),c({className:e},n?M(null,t("account oauth")):void 0,l({text:t("account identifiers")},this.buildInput("label"),this.buildInput("name"),this.buildInput("login"),n?void 0:this.buildInput("password",{type:"password"})),this.buildInput("accountType",{className:"hidden"}),this.state.displayGMAILSecurity?this._renderGMAILSecurity():void 0,n?void 0:this._renderReceivingServer(),n?void 0:this._renderSendingServer(),this._renderButtons())},_renderReceivingServer:function(){var e;return e=this.state.imapAdvanced?"hide":"show",l({text:t("account receiving server")},this.buildInput("imapServer"),this.buildInput("imapPort"),this.buildInput("imapSSL",{type:"checkbox"}),this.buildInput("imapTLS",{type:"checkbox"}),b({className:"form-group advanced-imap-toggle"},f({className:"col-sm-3 col-sm-offset-2 control-label clickable",onClick:this.toggleIMAPAdvanced},t("account imap "+e+" advanced"))),this.state.imapAdvanced?this.buildInput("imapLogin"):void 0)},_renderSendingServer:function(){var e;return e=this.state.smtpAdvanced?"hide":"show",l({text:t("account sending server")},this.buildInput("smtpServer"),this.buildInput("smtpPort"),this.buildInput("smtpSSL",{type:"checkbox"}),this.buildInput("smtpTLS",{type:"checkbox"}),b({className:"form-group advanced-smtp-toggle"},f({className:"col-sm-3 col-sm-offset-2 control-label clickable",onClick:this.toggleSMTPAdvanced},t("account smtp "+e+" advanced"))),this.state.smtpAdvanced?this.buildInput("smtpMethod",{type:"dropdown",options:h,allowUndefined:!0}):void 0,this.state.smtpAdvanced?this.buildInput("smtpLogin"):void 0,this.state.smtpAdvanced?this.buildInput("smtpPassword",{type:"password"}):void 0)},_renderGMAILSecurity:function(){var e;return e="https://www.google.com/settings/security/lesssecureapps",l({text:t("gmail security tile")},M(null,t("gmail security body",{login:this.state.login.value})),M(null,f({target:"_blank",href:e},t("gmail security link"))))},_renderButtons:function(){return 0===this.props.errors.length?l({text:t("account actions")},p(null,u({"class":"action-save",contrast:!0,icon:"save",spinner:this.props.isWaiting,onClick:this.onSubmit,text:this.buildButtonLabel()}),u({"class":"action-check",spinner:this.props.checking,onClick:this.onCheck,icon:"ellipsis-h",text:t("account check")}))):void 0},onSubmit:function(e){return this.props.onSubmit(e,!1)},onCheck:function(e){return this.props.onSubmit(e,!0)},toggleSMTPAdvanced:function(){return this.setState({smtpAdvanced:!this.state.smtpAdvanced})},toggleIMAPAdvanced:function(){return this.setState({imapAdvanced:!this.state.imapAdvanced})},doDiscovery:function(e){return null!=e&&e.length>3&&e!==this._lastDiscovered?this.discoverTimeout?this.nextDiscover=e:this.discoverTimeout=setTimeout(function(t){return function(){return t.doDiscoveryNow(e)}}(this),2e3):void 0},doDiscoveryNow:function(e){return o.discover(e,function(e){return function(t,n){var r,o;return t||(r=y(n),o="imap.googlemail.com"===r.imapServer,e.setState({displayGMAILSecurity:o}),e.props.requestChange(r)),e.nextDiscover?(e.doDiscoveryNow(e.nextDiscover),e.nextDiscover=null):e.discoverTimeout=null}}(this))}})}),require.register("components/account_config_signature",function(e,n,r){var o,i,s,a,l,c,u,p,d,h,f,m,g,v,y,b,S,k,w,E,_,x;_=React.DOM,m=_.div,v=_.h4,E=_.ul,k=_.li,w=_.span,g=_.form,y=_.i,b=_.input,S=_.label,f=React.addons.classSet,o=n("../actions/account_action_creator"),u=n("../actions/layout_action_creator"),p=n("../mixins/router_mixin"),i=n("./account_config_input"),d=n("../mixins/should_update_mixin"),h=n("../libs/cached_transform"),x=n("./basic_components"),a=x.Form,s=x.FieldSet,c=x.FormButtons,l=x.FormButton,r.exports=React.createClass({displayName:"AccountConfigSignature",mixins:[React.addons.LinkedStateMixin,d.UnderscoreEqualitySlow],propTypes:{editedAccount:React.PropTypes.instanceOf(Immutable.Map).isRequired,requestChange:React.PropTypes.func.isRequired,errors:React.PropTypes.instanceOf(Immutable.Map).isRequired,onSubmit:React.PropTypes.func.isRequired,saving:React.PropTypes.bool.isRequired},makeLinkState:function(e){var t;return t=this.props.editedAccount.get(e),h(this,"__cacheLS",t,function(n){return function(){return{value:t,requestChange:function(t){var r;return r={},r[e]=t,n.props.requestChange(r)}}}}(this))},render:function(){return a({className:"form-horizontal form-account account-signature-form"},s({text:t("account signature")},i({type:"textarea",name:"signature",valueLink:this.makeLinkState("signature"),errors:this.props.errors})),s({text:t("account actions")},c(null,l({className:"signature-save",spinner:this.props.saving,icon:"save",onClick:this.props.onSubmit,text:t("account signature save")}))))}})}),require.register("components/account_picker",function(e,t,n){var r,o,i,s,a,l,c,u,p,d;d=React.DOM,s=d.div,p=d.ul,l=d.li,c=d.p,u=d.span,o=d.a,i=d.button,a=d.input,r=t("../mixins/router_mixin"),n.exports=React.createClass({displayName:"AccountPicker",shouldComponentUpdate:function(e,t){return!_.isEqual(t,this.state)||!_.isEqual(e,this.props)},render:function(){var e;return e=this.props.accounts,1===Object.keys(e).length?this.renderNoChoice():this.renderPicker()},onChange:function(e){var t;return t=e.target.dataset.value,this.props.valueLink.requestChange(t)},renderLabel:function(e){var t;return"string"==typeof e?e:(t=e.get("name")||e.get("label"),""+t+" <"+e.get("login")+">")},renderNoChoice:function(){var e;return e=this.props.accounts.get(this.props.valueLink.value),c({className:"form-control-static align-item"},this.renderLabel(e))},renderPicker:function(){var e;return e=this.props.accounts.get(this.props.valueLink.value),s({className:"account-picker align-item"},u({className:"compose-from dropdown-toggle","data-toggle":"dropdown"},u({ref:"account","data-value":this.props.valueLink.value},this.renderLabel(e)),u({className:"caret"})),p({className:"dropdown-menu",role:"menu"},this.props.accounts.filter(function(e){return function(t,n){return n!==e.props.valueLink.value}}(this)).map(function(e){return function(t,n){return e.renderAccount(n,t)}}(this)).toJS()))},renderAccount:function(e,t){return l({role:"presentation",key:e},o({role:"menuitem",onClick:this.onChange,"data-value":e},this.renderLabel(t)))}})}),require.register("components/alert",function(e,n,r){var o,i,s,a,l,c,u;u=React.DOM,a=u.div,s=u.button,l=u.span,c=u.strong,o=n("../constants/app_constants").AlertLevel,i=n("../actions/layout_action_creator"),r.exports=React.createClass({displayName:"Alert",render:function(){var e,n;return e=this.props.alert,null!=e.level&&(n={},n[o.SUCCESS]="alert-success",n[o.INFO]="alert-info",n[o.WARNING]="alert-warning",n[o.ERROR]="alert-danger"),a({className:"row row-alert"},null!=e.level?a({ref:"alert",className:"alert "+n[e.level]+" alert-dismissible",role:"alert"},s({type:"button",className:"close",onClick:this.hide},l({"aria-hidden":"true"},"×"),l({className:"sr-only"},t("app alert close"))),c(null,e.message)):void 0)},hide:function(){return i.alertHide()},autohide:function(){},componentDidMount:function(){return this.autohide()},componentDidUpdate:function(){return this.autohide()}})}),require.register("components/application",function(e,n,r){var o,i,s,a,l,c,u,p,d,h,f,m,g,v,y,b,S,k,w,E,_,x,C,T,M,A,D,R,N,O;O=React.DOM,_=O.div,D=O.section,M=O.main,A=O.p,R=O.span,w=O.a,C=O.i,N=O.strong,x=O.form,T=O.input,E=O.button,i=n("./alert"),c=n("./menu"),h=n("./modal"),f=n("./panel"),b=n("./toast_container"),k=n("./tooltips-manager"),m=n("../mixins/router_mixin"),v=n("../mixins/store_watch_mixin"),S=n("../mixins/tooltip_refresher_mixin"),o=n("../stores/account_store"),d=n("../stores/message_store"),l=n("../stores/layout_store"),g=n("../stores/search_store"),y=[o,d,l,g],a=n("../actions/layout_action_creator"),u=n("../actions/message_action_creator"),p=n("../constants/app_constants").MessageFilter,r.exports=s=React.createClass({displayName:"Application",mixins:[v(y),m,S],render:function(){var e,n,r,o,i,s,a;return o=this.props.router.current,null==o?_(null,t("app loading")):(e=l.getDisposition(),r=l.getListModeCompact(),n=l.isPreviewFullscreen(),a=l.getPreviewSize(),s=this.state.modal,i=["layout","layout-"+e,r?"layout-compact":void 0,n?"layout-preview-fullscreen":void 0,"layout-preview-"+a].join(" "),_({className:i},_({className:"app"},c({ref:"menu",layout:this.props.router.current}),M({className:null!=o.secondPanel?null:"full"},_({className:"panels"},this.getPanel(o.firstPanel,"firstPanel"),null!=o.secondPanel?this.getPanel(o.secondPanel,"secondPanel"):D({key:"placeholder","aria-expanded":!1})))),null!=s?h(s):void 0,b(),k({key:"tooltips"})))},getPanel:function(e,t){return f({ref:t,action:e.action,accountID:e.parameters.accountID,mailboxID:e.parameters.mailboxID,messageID:e.parameters.messageID,tab:e.parameters.tab,useIntents:this.state.useIntents,selectedMailboxID:this.state.selectedMailboxID})},getStateFromStores:function(){var e,t,n,r;return t=o.getSelectedOrDefault(),e=null!=(r=this.props.router.current)?r.firstPanel:void 0,n="account.mailbox.messages"===(null!=e?e.action:void 0)?e.parameters.mailboxID:null,{selectedAccount:t,currentSearch:g.getCurrentSearch(),modal:l.getModal(),useIntents:l.intentAvailable(),selectedMailboxID:n}},componentWillMount:function(){return this.onRoute=function(e){return function(t){var n,r,o,i;return n=t.firstPanel,i=t.secondPanel,null!=n&&e.checkAccount(n.action),null!=i&&e.checkAccount(i.action),null!=i&&null!=i.parameters.messageID?(r=null!=i.parameters.conversationID,o=i.parameters.messageID,u.setCurrent(o,r)):"compose"!==n&&u.setCurrent(null),e.forceUpdate()}}(this),this.props.router.on("fluxRoute",this.onRoute)},checkAccount:function(e){var n,r,o;return n=this.state.selectedAccount,o=null==(null!=n?n.get("draftMailbox"):void 0)||null==(null!=n?n.get("sentMailbox"):void 0)||null==(null!=n?n.get("trashMailbox"):void 0),r="account.mailbox.messages"===e||"message"===e||"conversation"===e||"compose"===e||"edit"===e,null!=n&&o&&r?(this.redirect({direction:"first",action:"account.config",parameters:[n.get("id"),"mailboxes"],fullWidth:!0}),a.alertError(t("account no special mailboxes"))):void 0},componentWillUnmount:function(){return this.props.router.off("fluxRoute",this.onRoute)}})}),require.register("components/attachement_preview",function(e,n,r){var o,i,s,a,l,c,u;u=React.DOM,c=u.li,l=u.img,s=u.a,a=u.i,o=n("../utils/message_utils"),i=n("../constants/app_constants").Tooltips,r.exports=React.createClass({displayName:"AttachmentPreview",icons:{archive:"fa-file-archive-o",audio:"fa-file-audio-o",code:"fa-file-code-o",image:"fa-file-image-o",pdf:"fa-file-pdf-o",word:"fa-file-word-o",presentation:"fa-file-powerpoint-o",spreadsheet:"fa-file-excel-o",text:"fa-file-text-o",video:"fa-file-video-o",word:"fa-file-word-o"},render:function(){return this.props.previewLink?c({key:this.props.key},s({className:"file-details",target:"_blank",href:this.props.file.url,"aria-describedby":i.OPEN_ATTACHMENT,"data-tooltip-direction":"top"},this.props.preview?l({height:48,src:this.props.file.url}):void 0,this.renderIcon(),this.props.file.generatedFileName,this.displayFilesize(this.props.file.length)),s({className:"file-actions",href:""+this.props.file.url+"?download=1","aria-describedby":i.DOWNLOAD_ATTACHMENT,"data-tooltip-direction":"top"},a({className:"fa fa-download"}))):c({key:this.props.key},this.renderIcon(),s({href:""+this.props.file.url+"?download=1","aria-describedby":i.DOWNLOAD_ATTACHMENT,"data-tooltip-direction":"left"},""+this.props.file.generatedFileName+"\n("+this.displayFilesize(this.props.file.length)+")"))},renderIcon:function(){var e;return e=o.getAttachmentType(this.props.file.contentType),a({className:"mime "+e+" fa "+(this.icons[e]||"fa-file-o")})},displayFilesize:function(e){return 1024>e?""+e+" "+t("length bytes"):1048576>e?""+(0|e/1024)+" "+t("length kbytes"):""+(0|e/1048576)+" "+t("length mbytes")}})}),require.register("components/basic_components",function(e,t,n){var r,o,i,s,a,l,c,u,p,d,h,f,m,g,v,y,b,S,k,w,E,_,x,C,T,M,A,D,R,N,O,I,P,L,F,U;U=React.DOM,x=U.div,P=U.section,M=U.h3,A=U.h4,F=U.ul,I=U.li,w=U.a,D=U.i,E=U.button,L=U.span,C=U.fieldset,O=U.legend,N=U.label,R=U.img,T=U.form,_=React.addons.classSet,v=t("../libs/prop_types"),o=React.createClass({render:function(){return P({id:this.props.id,key:this.props.key,className:"panel"},this.props.children)}}),k=React.createClass({render:function(){return M({refs:this.props.ref,className:"title"},this.props.text)}}),b=React.createClass({render:function(){return A({className:"subtitle "+this.props.className},this.props.children)}}),S=React.createClass({render:function(){var e,t,n;return F({className:"nav nav-tabs",role:"tablist"},function(){var r,o,i;r=this.props.tabs,i=[];for(e in r)t=r[e],n=(null!=(o=t["class"])?o.indexOf("active"):void 0)>=0?null:t.url,i.push(I({key:"tab-li-"+e,className:t["class"]},w({href:n,key:"tab-"+e},t.text)));return i}.call(this))}}),a=React.createClass({render:function(){return x({className:"col-sm-5 col-sm-offset-2 control-label"},this.props.text)}}),c=React.createClass({render:function(){return T({id:this.props.id,className:this.props.className,method:"POST"},this.props.children)}}),l=React.createClass({render:function(){return C(null,O(null,this.props.text),this.props.children)}}),u=React.createClass({render:function(){var e;return e="btn ",e+=this.props.contrast?"btn-cozy-contrast ":this.props["default"]?"btn-cozy-default ":"btn-cozy ",this.props.danger&&(e+="btn-danger "),null!=this.props.className&&(e+=this.props.className),E({className:e,onClick:this.props.onClick},this.props.spinner?L(null,y({white:!0})):L({className:"fa fa-"+this.props.icon}),L(null,this.props.text))}}),p=React.createClass({render:function(){return x({className:"col-sm-offset-4"},this.props.children)}}),m=React.createClass({onClick:function(){return this.props.onClick(this.props.onClickValue)},render:function(){var e,t;return t={role:"presentation"},this.props.key&&(t.key=this.props.key),this.props.liClassName&&(t.className=this.props.liClassName),e={role:"menuitemu",onClick:this.onClick},this.props.className&&(e.className=this.props.className),this.props.href&&(e.href=this.props.href),this.props.target&&(e.target=this.props.href),I(t,w(e,this.props.children))}}),f=React.createClass({render:function(){var e;return e={role:"presentation",className:"dropdown-header"},this.props.key&&(e.key=this.props.key),I(e,this.props.children)}}),h=React.createClass({render:function(){var e;return e={role:"presentation",className:"divider"},this.props.key&&(e.key=this.props.key),I(e)}}),i=React.createClass({getDefaultProps:function(){return{className:"",btnClassName:"",allowUndefined:!1}},propTypes:{valueLink:v.valueLink(v.string).isRequired,allowUndefined:React.PropTypes.bool.isRequired,options:React.PropTypes.object.isRequired,className:React.PropTypes.string,id:React.PropTypes.string,btnClassName:React.PropTypes.string,defaultLabel:React.PropTypes.string,undefinedValue:React.PropTypes.string},render:function(){var e,t,n,r,o,i;return i=this.props.valueLink||{value:this.props.value,requestChange:this.props.onChange},t="dropdown "+this.props.className,e="dropdown-toggle "+this.props.btnClassName,r=this.props.options[i.value],x({className:t,id:this.props.id},E({className:e,"data-toggle":"dropdown"},r||this.props.defaultLabel,L({className:"caret"},"")),F({className:"dropdown-menu",role:"menu"},this.props.allowUndefined&&null!=r?s({key:null,value:this.props.undefinedValue,requestChange:i.requestChange}):void 0,function(){var e,t;e=this.props.options,t=[];for(n in e)o=e[n],n!==i.value?t.push(s({key:n,value:o,requestChange:i.requestChange})):t.push(void 0);return t}.call(this)))}}),s=React.createClass({onClick:function(){return this.props.requestChange(this.props.key)},render:function(){return I({role:"presentation",key:this.props.key,onClick:this.onClick},w({role:"menuitem"},this.props.value))}}),r=React.createClass({render:function(){var e,t,n,r,o;return t=0,(null!=(r=this.props.contact.name)?r.length:void 0)>0&&this.props.contact.address?(e=this.props.contact.address.replace(/\W/g,""),n=L(null,L({className:"highlight"},this.props.contact.name),L({className:"contact-address",key:e},D({className:"fa fa-angle-left"}),this.props.contact.address,D({className:"fa fa-angle-right"})))):n=(null!=(o=this.props.contact.name)?o.length:void 0)>0?L({key:"label-"+t++},this.props.contact.name):L(null,this.props.contact.address),n}}),y=React.createClass({displayName:"Spinner",protoTypes:{white:React.PropTypes.bool},render:function(){var e;return e=this.props.white?"-white":"",R({src:"images/spinner"+e+".svg",alt:"spinner",className:"button-spinner"})}}),g=React.createClass({displayName:"Progress",propTypes:{value:React.PropTypes.number.isRequired,max:React.PropTypes.number.isRequired},render:function(){return x({className:"progress"},x({className:_({"progress-bar":!0,actived:this.props.value>0}),style:{width:0},role:"progressbar","aria-valuenow":this.props.value,"aria-valuemin":"0","aria-valuemax":this.props.max}))}}),d=React.createClass({displayName:"Icon",propTypes:{type:React.PropTypes.string.isRequired},render:function(){var e;return e=""+(this.props.className||"")+" fa fa-"+this.props.type,D({className:e,onClick:this.props.onClick})}}),n.exports={AddressLabel:r,Container:o,Dropdown:i,ErrorLine:a,Form:c,FieldSet:l,FormButton:u,FormButtons:p,Icon:d,MenuItem:m,MenuHeader:f,MenuDivider:h,Progress:g,Spinner:y,SubTitle:b,Title:k,Tabs:S}}),require.register("components/compose",function(e,n,r){var o,i,s,a,l,c,u,p,d,h,f,m,g,v,y,b,S,k,w,E,x,C,T,M,A,D,R,N,O,I;N=React.DOM,S=N.div,M=N.section,w=N.h3,y=N.a,E=N.i,D=N.textarea,k=N.form,C=N.label,O=React.DOM,A=O.span,R=O.ul,T=O.li,x=O.input,b=React.addons.classSet,l=n("./compose_editor"),c=n("./compose_toolbox"),u=n("./file_picker"),d=n("./mails_input"),o=n("./account_picker"),i=n("../stores/account_store"),f=n("../stores/message_store"),I=n("../constants/app_constants"),a=I.ComposeActions,v=I.Tooltips,m=n("../utils/message_utils"),p=n("../actions/layout_action_creator"),h=n("../actions/message_action_creator"),g=n("../mixins/router_mixin"),r.exports=s=React.createClass({displayName:"Compose",mixins:[g,React.addons.LinkedStateMixin],propTypes:{selectedAccountID:React.PropTypes.string.isRequired,selectedAccountLogin:React.PropTypes.string.isRequired,layout:React.PropTypes.string,accounts:React.PropTypes.object.isRequired,message:React.PropTypes.object,action:React.PropTypes.string,callback:React.PropTypes.func,onCancel:React.PropTypes.func,settings:React.PropTypes.object.isRequired,useIntents:React.PropTypes.bool.isRequired},getDefaultProps:function(){return{layout:"full"}},shouldComponentUpdate:function(e,t){return!_.isEqual(t,this.state)||!_.isEqual(e,this.props)},render:function(){var e,n,r,i,s,a,p;if(this.props.accounts)return s=this.buildClosePanelUrl(this.props.layout),i="compose-label",r="compose-input",n=this.state.ccShown?" shown ":"",e=this.state.bccShown?" shown ":"",a=Array.isArray(this.state.to)&&this.state.to.length>0&&""!==this.state.subject,M({className:b({compose:!0,panel:"full"===this.props.layout}),"aria-expanded":!0},k({className:"form-compose",method:"POST"},S({className:"form-group account"},C({htmlFor:"compose-from",className:i},t("compose from")),o({accounts:this.props.accounts,valueLink:this.linkState("accountID")})),S({className:"clearfix"},null),S({className:r},S({className:"btn-toolbar compose-toggle",role:"toolbar"},S(null),y({className:"compose-toggle-cc",onClick:this.onToggleCc},t("compose toggle cc")),y({className:"compose-toggle-bcc",onClick:this.onToggleBcc},t("compose toggle bcc")))),d({id:"compose-to",valueLink:this.linkState("to"),label:t("compose to"),ref:"to"}),d({id:"compose-cc",className:"compose-cc"+n,valueLink:this.linkState("cc"),label:t("compose cc"),placeholder:t("compose cc help"),ref:"cc"}),d({id:"compose-bcc",className:"compose-bcc"+e,valueLink:this.linkState("bcc"),label:t("compose bcc"),placeholder:t("compose bcc help"),ref:"bcc"}),S({className:"form-group"},S({className:r},x({id:"compose-subject",name:"compose-subject",ref:"subject",valueLink:this.linkState("subject"),type:"text",className:"form-control compose-subject",placeholder:t("compose subject help")}))),S({className:"compose-content"},l({id:"compose-editor",messageID:null!=(p=this.props.message)?p.get("id"):void 0,html:this.linkState("html"),text:this.linkState("text"),accounts:this.props.accounts,accountID:this.state.accountID,settings:this.props.settings,onSend:this.onSend,composeInHTML:this.state.composeInHTML,focus:a,ref:"editor",getPicker:this.getPicker,useIntents:this.props.useIntents})),S({className:"attachements"},u({className:"",editable:!0,valueLink:this.linkState("attachments"),ref:"attachments"})),c({saving:this.state.saving,sending:this.state.sending,onSend:this.onSend,onDelete:this.onDelete,onDraft:this.onDraft,onCancel:this.onCancel,canDelete:null!=this.props.message}),S({className:"clearfix"},null)))},finalRedirect:function(){return null!=this.props.inReplyTo?this.redirect(f.getMessageHash(this.props.inReplyTo)):this.redirect(this.buildUrl({direction:"first",action:"default",fullWidth:!0}))},onCancel:function(e){return e.preventDefault(),null!=this.props.onCancel?this.props.onCancel():this.finalRedirect()},_initCompose:function(){var e;return this._saveInterval&&window.clearInterval(this._saveInterval),this._saveInterval=window.setInterval(this._autosave,3e4),this._autosave(),this.getDOMNode().scrollIntoView(),Array.isArray(this.state.to)&&0!==this.state.to.length?null!=this.props.inReplyTo&&null!=(e=document.getElementById("compose-editor"))?e.focus():void 0:setTimeout(function(){var e;return null!=(e=document.getElementById("compose-to"))?e.focus():void 0},10)},componentDidMount:function(){return this._initCompose()},componentDidUpdate:function(){switch(this.state.focus){case"cc":return setTimeout(function(){return document.getElementById("compose-cc").focus()},0),this.setState({focus:""});case"bcc":return setTimeout(function(){return document.getElementById("compose-bcc").focus()},0),this.setState({focus:""})}},componentWillUnmount:function(){var e,n,r,o,i,s;return this._saveInterval&&window.clearInterval(this._saveInterval),e=function(e){return function(){return window.setTimeout(function(){var t;return p.hideModal(),t=e.state.id,h["delete"]({messageID:t,silent:i,isDraft:!0,inReplyTo:e.props.inReplyTo})},5)}}(this),n=function(e){return function(){var n;return null!=e.state.originalConversationID?(n={id:e.state.id,accountID:e.state.accountID,mailboxIDs:e.state.mailboxIDs,from:e.state.from,to:e.state.to,cc:e.state.cc,bcc:e.state.bcc,subject:e.state.subject,isDraft:!0,attachments:e.state.attachments,inReplyTo:e.state.inReplyTo,references:e.state.references,text:e.state.text,html:e.state.html,conversationID:e.state.originalConversationID},h.send(n,function(e,n){var r,o;return null!=e||null==n?(o=""+t("message action draft ko")+" "+e,p.alertError(o)):(o=""+t("message action draft ok"),p.notify(o,{autoclose:!0}),null!=n.conversationID?(r=n.conversationID,h.fetchConversation(r)):void 0)})):void 0}}(this),!this.state.isDeleted&&this.state.isDraft&&null!=this.state.id?(this.state.composeInHTML?(r=m.cleanReplyText(this.state.html).replace(/\s/gim,""),o=m.cleanReplyText(this.state.initHtml).replace(/\s/gim,""),s=r!==o):s=this.state.text!==this.state.initText,i=this.state.isNew&&!s,i?e():setTimeout(function(){var r;return r={title:t("app confirm delete"),subtitle:t("compose confirm keep draft"),closeModal:function(){return n(),p.hideModal()},closeLabel:t("compose confirm draft keep"),actionLabel:t("compose confirm draft delete"),action:e},p.displayModal(r)},0)):void 0},getInitialState:function(){var e,t,n,r,o,i;if(n=this.props.message){r={composeInHTML:this.props.settings.get("composeInHTML"),isNew:!1},null==n.get("html")&&n.get("text")&&(r.conposeInHTML=!1),i=n.toJS();for(t in i)o=i[t],r[t]=o;r.attachments=n.get("attachments")}else e=this.props.accounts.get(this.props.selectedAccountID),r=m.makeReplyMessage(e.get("login"),this.props.inReplyTo,this.props.action,this.props.settings.get("composeInHTML"),e.get("signature")),r.isNew=!0,null==r.accountID&&(r.accountID=this.props.selectedAccountID),r.originalConversationID=r.conversationID;return r.isDraft=!0,r.sending=!1,r.saving=!1,r.ccShown=Array.isArray(r.cc)&&r.cc.length>0,r.bccShown=Array.isArray(r.bcc)&&r.bcc.length>0,r.initHtml=r.html,r.initText=r.text,r},componentWillReceiveProps:function(e){return e.message!==this.props.message?(this.props.message=e.message,this.setState(this.getInitialState())):void 0},onDraft:function(e){return e.preventDefault(),this._doSend(!0)},onSend:function(e){return null!=e&&e.preventDefault(),this._doSend(!1)},_doSend:function(e){var n,r,o,i;return n=this.props.accounts.get(this.state.accountID),r={name:n.get("name")||void 0,address:n.get("login")},o={id:this.state.id,accountID:this.state.accountID,mailboxIDs:this.state.mailboxIDs,from:[r],to:this.state.to,cc:this.state.cc,bcc:this.state.bcc,subject:this.state.subject,isDraft:e,attachments:this.state.attachments,inReplyTo:this.state.inReplyTo,references:this.state.references},e||(o.conversationID=this.state.originalConversationID),i=!0,e||(0===this.state.to.length&&0===this.state.cc.length&&0===this.state.bcc.length?(i=!1,p.alertError(t("compose error no dest")),setTimeout(function(){return document.getElementById("compose-to").focus()},0)):""===this.state.subject&&(i=!1,p.alertError(t("compose error no subject")),setTimeout(function(e){return function(){return e.refs.subject.getDOMNode().focus()}}(this),0))),i?(this.state.composeInHTML?(o.html=this._cleanHTML(this.state.html),o.text=m.cleanReplyText(o.html),o.html=m.wrapReplyHtml(o.html)):o.text=this.state.text.trim(),!e&&this._saveInterval&&window.clearInterval(this._saveInterval),e?this.setState({saving:!0}):this.setState({sending:!0,isDraft:!1}),h.send(o,function(n){return function(r,o){var i,s,a,l,c,u,d,f,m;null==r&&null==n.state.id&&null!=o&&h.setCurrent(o.id),c=_.clone(n.state),e?c.saving=!1:(c.isDraft=!1,c.sending=!1);for(s in o)u=o[s],"attachments"!==s&&"html"!==s&&"text"!==s&&(c[s]=u);for(m=Object.keys(n.state),d=0,f=m.length;f>d;d++)s=m[d],"saving"!==s&&(c[s]=n.state[s]);return n.isMounted()&&n.setState(c),e?a=t("message action draft ko"):(a=t("message action sent ko"),l=t("message action sent ok")),null!=r||null==o?p.alertError(""+a+" "+r):(e||p.notify(l,{autoclose:!0}),null==n.state.id&&h.setCurrent(o.id),e?void 0:(null!=o.conversationID&&(i=o.conversationID,h.fetchConversation(i)),n.finalRedirect()))}}(this))):void 0},_autosave:function(){return this.props.settings.get("autosaveDraft")?this._doSend(!0):void 0},_cleanHTML:function(e){var t,n,r,o,i,s,a;if(i=new DOMParser,t=i.parseFromString(e,"text/html"),t||(t=document.implementation.createHTMLDocument(""),t.documentElement.innerHTML=e),t){for(r=function(e){return e.setAttribute("src","cid:"+e.dataset.src)},o=t.querySelectorAll("IMG[data-src]"),s=0,a=o.length;a>s;s++)n=o[s],r(n);return t.documentElement.innerHTML}return console.error("Unable to parse HTML content of message"),e},onDelete:function(e){var n,r,o,i,s;return e.preventDefault(),s=this.props.message.get("subject"),null!=s&&""!==s?(i={subject:this.props.message.get("subject")},n=t("mail confirm delete",i)):n=t("mail confirm delete nosubject"),r=function(e){return function(){var t;return p.hideModal(),t=e.props.message.get("id"),e.setState({isDeleted:!0},function(){return h["delete"]({messageID:t},function(t){var n;return null==t?e.props.callback?e.props.callback():(n=[e.props.selectedAccountID,e.props.selectedMailboxID],e.redirect({direction:"first",action:"account.mailbox.messages",parameters:n,fullWidth:!0})):void 0})})}}(this),o={title:t("mail confirm delete title"),subtitle:n,closeLabel:t("mail confirm delete cancel"),actionLabel:t("mail confirm delete delete"),action:r},p.displayModal(o)},onToggleCc:function(e){var t,n,r,o,i;for(n=function(e){return e.classList.toggle("shown")},i=this.getDOMNode().querySelectorAll(".compose-cc"),r=0,o=i.length;o>r;r++)e=i[r],n(e);return t=this.state.ccShown?"":"cc",this.setState({ccShown:!this.state.ccShown,focus:t})},onToggleBcc:function(e){var t,n,r,o,i;for(n=function(e){return e.classList.toggle("shown")},i=this.getDOMNode().querySelectorAll(".compose-bcc"),r=0,o=i.length;o>r;r++)e=i[r],n(e);return t=this.state.bccShown?"":"bcc",this.setState({bccShown:!this.state.bccShown,focus:t})},getPicker:function(){return this.refs.attachments}})}),require.register("components/compose_editor",function(e,t,n){var r,o,i,s,a,l;l=React.DOM,s=l.div,i=l.button,a=l.textarea,o=t("../utils/file_utils"),n.exports=r=React.createClass({displayName:"ComposeEditor",mixins:[React.addons.LinkedStateMixin],getInitialState:function(){return{html:this.props.html,text:this.props.text,target:!1}},componentWillReceiveProps:function(e){return e.messageID!==this.props.messageID?this.setState({html:e.html,text:e.text}):void 0},shouldComponentUpdate:function(e,t){return!_.isEqual(t,this.state)||!_.isEqual(e,this.props)},onHTMLChange:function(e){return this.props.html.requestChange(this.refs.html.getDOMNode().innerHTML);
},onTextChange:function(e){return this.props.text.requestChange(this.refs.content.getDOMNode().value)},render:function(){var e,t;return e=this.props.settings.get("composeOnTop")?"folded":"",t=this.state.target?"target":"",s(null,this.props.useIntents?s({className:"btn-group editor-actions"},i({className:"btn btn-default",onClick:this.choosePhoto},span({className:"fa fa-image","aria-describedby":Tooltips.COMPOSE_IMAGE,"data-tooltip-direction":"top"}))):void 0,this.props.composeInHTML?s({className:"form-control rt-editor "+e+" "+t,ref:"html",contentEditable:!0,onKeyDown:this.onKeyDown,onInput:this.onHTMLChange,onDragOver:this.allowDrop,onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onDrop:this.handleFiles,onBlur:this.onHTMLChange,dangerouslySetInnerHTML:{__html:this.state.html.value}}):a({className:"editor "+t,ref:"content",onKeyDown:this.onKeyDown,onChange:this.onTextChange,onBlur:this.onTextChange,defaultValue:this.state.text.value,onDragOver:this.allowDrop,onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onDrop:this.handleFiles}))},_initCompose:function(){var e,t,n,r,o,i;if(this.props.composeInHTML){if(this.setCursorPosition(),t=document.queryCommandEnabled("insertBrOnReturn"),jQuery(".rt-editor").on("keypress",function(e){var n;if(13===e.keyCode)return n=function(){var e,n,r,o,i,s,a,l,c;for(o=function(e){var t;if(t=document.documentElement.matches||document.documentElement.matchesSelector||document.documentElement.webkitMatchesSelector||document.documentElement.mozMatchesSelector||document.documentElement.oMatchesSelector||document.documentElement.msMatchesSelector,null!=t)return t.call(e,".rt-editor blockquote, .rt-editor blockquote *");for(;null!=e&&"BLOCKQUOTE"!==e.tagName;)e=e.parentNode;return"BLOCKQUOTE"===e.tagName},l=document.getSelection().anchorNode,null!=l.lastChild&&(l=l.lastChild,null!=l.previousElementSibling&&(l=l.previousElementSibling)),c=l;c&&!(c instanceof Element);)c=c.parentNode;if(null!=l&&o(c)){for(e=t?"\r\n<br>\r\n<br class='cozyInsertedBr'>\r\n":"\r\n<div></div><div><br class='cozyInsertedBr'></div>\r\n",document.execCommand("insertHTML",!1,e),i=document.querySelector(".cozyInsertedBr"),t&&(i=i.previousElementSibling),r=function(e){var t;for(t=e.tagName;null!=e.parentNode&&"true"!==e.contentEditable;)e=e.parentNode,t=""+e.tagName+" > "+t;return t},a=window.getSelection(),s=document.createRange(),s.selectNode(i),a.removeAllRanges(),a.addRange(s),n=r(i).split(">").length;n>0;)document.execCommand("outdent",!1,null),n--;i=document.querySelector(".cozyInsertedBr"),null!=i&&i.parentNode.removeChild(i),document.execCommand("removeFormat",!1,null)}},setTimeout(n,50)}),!document.querySelector(".rt-editor blockquote")||document.querySelector(".rt-editor .originalToggle"))return jQuery(".rt-editor .originalToggle").on("click",function(){return jQuery(".rt-editor").toggleClass("folded")});try{return n=jQuery(".rt-editor blockquote").eq(0).prev(),n.text(n.text().replace("…","")),n.append('<span class="originalToggle">…</>'),n.on("click",function(){return jQuery(".rt-editor").toggleClass("folded")})}catch(s){return e=s,console.error(e)}}else if(this.props.focus)return r=this.refs.content.getDOMNode(),this.props.settings.get("composeOnTop")||(i=r.getBoundingClientRect(),r.scrollTop=r.scrollHeight-i.height,"number"==typeof r.selectionStart?(r.selectionStart=r.value.length,r.selectionEnd=r.value.length):"undefined"!=typeof r.createTextRange&&(setTimeout(function(){return r.focus()},0),o=r.createTextRange(),o.collapse(!1),o.select())),setTimeout(function(){return r.focus()},0)},setCursorPosition:function(){var e,t,n,r,o,i;return this.props.focus&&(t=null!=(i=this.refs.html)?i.getDOMNode():void 0,null!=t&&(document.querySelector(".rt-editor").focus(),!this.props.settings.get("composeOnTop")&&(e=this.props.accounts[this.props.accountID],o=document.getElementById("signature"),null!=e.signature&&e.signature.length>0&&null!=o?(t=o,t.innerHTML="<p><br /></p>\n"+t.innerHTML,t=t.firstChild):(t.innerHTML+="<p><br /></p><p><br /></p>",t=t.lastChild),null!=t)))?(t.scrollIntoView(!1),t.innerHTML="<br >",r=window.getSelection(),n=document.createRange(),n.selectNodeContents(t),r.removeAllRanges(),r.addRange(n),document.execCommand("delete",!1,null),t.focus()):void 0},componentDidMount:function(){return this._initCompose()},componentDidUpdate:function(e,t){return e.messageID!==this.props.messageID&&this._initCompose(),e.accountID!==this.props.accountID?this._updateSignature():void 0},_updateSignature:function(){var e,t,n,r,o;return n=this.props.accounts[this.props.accountID].signature,null!=this.refs.html?(o=document.getElementById("signature"),null!=n&&n.length>0?(r=n.replace(/\n/g,"<br>"),null!=o?o.innerHTML="-- \n<br>"+r+"</p>":this.refs.html.getDOMNode().innerHTML+='<p><br></p><p id="signature">-- \n<br>'+r+"</p>"):null!=o&&o.parentNode.removeChild(o),this.onHTMLChange()):null!=this.refs.content?(e=this.refs.content.getDOMNode(),t=this.props.accounts[oldProps.accountID].signature,null!=n&&n.length>0?t&&t.length>0?e.textContent=e.textContent.replace(t,n):e.textContent+="\n\n-- \n"+n:t&&t.length>0&&(t="-- \n"+n,e.textContent=e.textContent.replace(t,"")),this.onTextChange()):void 0},onKeyDown:function(e){return e.ctrlKey&&"Enter"===e.key?this.props.onSend():void 0},allowDrop:function(e){return e.preventDefault()},onDragEnter:function(e){return this.state.target?void 0:this.setState({target:!0})},onDragLeave:function(e){return this.state.target?this.setState({target:!1}):void 0},handleFiles:function(e){var t,n,r,i,s,a,l;if(e.preventDefault(),n=e.target.files||e.dataTransfer.files,this.props.getPicker().addFiles(n),this.props.composeInHTML)for(a=0,l=n.length;l>a;a++)t=n[a],"image"===t.type.split("/")[0]&&(r="editor-img-"+new Date,i="<img data-src='"+t.name+"' id='"+r+"'>",document.activeElement.classList.contains("rt-editor")?document.execCommand("insertHTML",!1,i):(s=document.getElementById("signature"),null!=s?s.previousElementSibling.innerHTML+=i:document.querySelector(".rt-editor").innerHTML+=i),o.fileToDataURI(t,function(e){return function(t){return i=document.getElementById(r),i?(i.removeAttribute("id"),i.src=t,e.onHTMLChange()):void 0}}(this)));return this.setState({target:!1})},choosePhoto:function(e){var t,n;return e.preventDefault(),t={type:"pickObject",params:{objectType:"singlePhoto",isCropped:!1}},n=3e4,window.intentManager.send("nameSpace",t,n).then(this.choosePhoto_answer,function(e){return console.error("response in error : ",e)})},choosePhoto_answer:function(e){var t,n,r,i,s,a,l;return t=e.data,t.newPhotoChosen&&(r=o.dataURItoBlob(t.dataUrl),n=new Blob([r.blob,{type:r.mime}]),n.name=t.name,a=this.props.getPicker(),a.addFiles([n]),this.props.composeInHTML)?(document.activeElement.classList.contains("rt-editor")?document.execCommand("insertHTML",!1,'<img src="'+t.dataUrl+'" data-src="'+t.name+'">'):(s=document.createElement("img"),s.src=t.dataUrl,s.dataset.src=t.name,l=document.getElementById("signature"),null!=l?l.parentNode.insertBefore(s,l):(i=document.querySelector(".rt-editor"),null!=i&&i.appendChild(s))),this.onHTMLChange()):void 0}})}),require.register("components/compose_toolbox",function(e,n,r){var o,i,s,a,l,c;c=React.DOM,a=c.div,s=c.button,l=c.span,i=n("./basic_components").Spinner,r.exports=o=React.createClass({displayName:"ComposeToolbox",render:function(){var e;return e=this.props.sending?t("compose action sending"):t("compose action send"),a({className:"composeToolbox"},a({className:"btn-toolbar",role:"toolbar"},a({className:""},s({className:"btn btn-cozy btn-send",type:"button",disable:this.props.sending?!0:null,onClick:this.props.onSend},this.props.sending?l(null,i({white:!0})):l({className:"fa fa-send"}),l(null,e)),s({className:"btn btn-cozy btn-save",disable:this.props.saving?!0:null,type:"button",onClick:this.props.onDraft},this.props.saving?l(null,i({white:!0})):l({className:"fa fa-save"}),l(null,t("compose action draft"))),this.props.canDelete?s({className:"btn btn-cozy-non-default btn-delete",type:"button",onClick:this.props.onDelete},l({className:"fa fa-trash-o"}),l(null,t("compose action delete"))):void 0,s({onClick:this.props.onCancel,className:"btn btn-cozy-non-default btn-cancel"},t("app cancel")))))}})}),require.register("components/contact_label",function(e,n,r){var o,i,s,a,l,c,u,p,d,h,f,m,g,v,y,b,S,k;k=React.DOM,y=k.section,f=k.header,S=k.ul,g=k.li,b=k.span,m=k.i,v=k.p,h=k.h3,p=k.a,d=k.button,u=n("../constants/app_constants").Tooltips,c=n("../utils/message_utils"),a=n("../stores/contact_store"),i=n("../actions/contact_action_creator"),l=n("../actions/layout_action_creator"),o=n("./basic_components").AddressLabel,r.exports=s=React.createClass({shouldComponentUpdate:function(e,t){var n;return n=!_.isEqual(e,this.props)},render:function(){var e,t;return null!=this.props.contact?(t=a.getByAddress(this.props.contact.address),null!=t?(e=t.get("id"),b({ref:"contact",onClick:function(e){return e.stopPropagation()}},o({contact:this.props.contact}),p({className:"show-contact",target:"_blank",href:"/#apps/contacts/contact/"+e},d({className:"fa fa-user","aria-describedby":u.SHOW_CONTACT,"data-tooltip-direction":"top"})))):b({ref:"contact",className:"participant"},o({contact:this.props.contact}),b({className:"add-contact",onClick:function(e){return function(t){return t.stopPropagation(),e.addContact()}}(this)},d({className:"fa fa-user-plus","aria-describedby":u.ADD_CONTACT,"data-tooltip-direction":"top"})))):b()},componentDidMount:function(){},componentDidUpdate:function(){},addContact:function(){var e,n;return n={contact:c.displayAddress(this.props.contact)},e={title:t("message contact creation title"),subtitle:t("message contact creation",n),closeLabel:t("app cancel"),actionLabel:t("app confirm"),action:function(e){return function(){return i.createContact(e.props.contact,function(){return e.forceUpdate()}),l.hideModal()}}(this)},l.displayModal(e)}})}),require.register("components/conversation",function(e,n,r){var o,i,s,a,l,c,u,p,d,h,f,m,g,v,y,b,S,k,w,E,x,C,T,M,A=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};M=React.DOM,E=M.section,b=M.header,C=M.ul,k=M.li,x=M.span,S=M.i,w=M.p,y=M.h3,m=M.a,g=M.button,a=n("./message"),f=n("./toolbar_conversation"),v=React.addons.classSet,l=n("../constants/app_constants").MessageFlags,u=n("../mixins/router_mixin"),h=n("../mixins/store_watch_mixin"),d=n("../mixins/should_update_mixin"),i=n("../actions/layout_action_creator"),p=n("../stores/settings_store"),o=n("../stores/account_store"),c=n("../stores/message_store"),s=n("../stores/layout_store"),T=1,r.exports=React.createClass({displayName:"Conversation",mixins:[u,h([p,o,c,s]),d.UnderscoreEqualitySlow],propTypes:{messageID:React.PropTypes.string},getStateFromStores:function(){var e,t,n,r,i,a,u,d,h,f,m,g,v,y,b,S;return i=c.getByID(this.props.messageID),f=null!=(g=o.getSelectedMailbox())?g.get("id"):void 0,h=o.getSelectedOrDefault(),null!=i&&(t=null!=i?i.get("conversationID"):void 0,m=null!=h?h.get("trashMailbox"):void 0,e=c.getConversation(t,m),d=c.getPreviousMessage(),a=c.getNextMessage(),r=c.getConversationsLength().get(t),null==f&&(f=Object.keys(i.get("mailboxIDs"))[0])),n=o.hasConversationEnabled(f),n&&(n=p.get("displayConversation")),u={accounts:o.getAll(),mailboxes:o.getAllMailboxes(),selectedAccount:o.getSelectedOrDefault(),selectedMailboxID:f,settings:p.get(),useIntents:s.intentAvailable(),conversationID:t,conversation:e,conversationLength:r,prevMessage:d,nextMessage:a,displayConversations:n},(null!=(v=this.state)?v.compact:void 0)!==!1&&(u.compact=!0),(null!=(y=u.conversation)?y.length:void 0)!==(null!=(b=this.state)&&null!=(S=b.conversation)?S.length:void 0)&&(u.expanded=[],null!=e&&e.forEach(function(t,n){var r,o,i;return i=l.SEEN,o=A.call(t.get("flags"),i)<0,r=n===e.length-1,0===u.expanded.length&&(o||r)?u.expanded.push(n):void 0}),u.compact=!0),u},renderToolbar:function(){var e,t,n,r;return f({nextMessageID:null!=(e=this.state.nextMessage)?e.get("id"):void 0,nextConversationID:null!=(t=this.state.nextMessage)?t.get("conversationID"):void 0,prevMessageID:null!=(n=this.state.prevMessage)?n.get("id"):void 0,prevConversationID:null!=(r=this.state.prevMessage)?r.get("conversationID"):void 0,settings:this.state.settings})},renderMessage:function(e,t){var n;return n=function(t){return function(){var n;return n=t.state.expanded.slice(0),A.call(n,e)>=0?n=n.filter(function(t){return e!==t}):n.push(e),t.setState({expanded:n})}}(this),a({ref:"message",accounts:this.state.accounts,active:t,inConversation:this.state.conversation.length>1,key:e.toString(),mailboxes:this.state.mailboxes,message:this.state.conversation.get(e),selectedAccountID:this.state.selectedAccount.get("id"),selectedAccountLogin:this.state.selectedAccount.get("login"),selectedMailboxID:this.state.selectedMailboxID,settings:this.state.settings,displayConversations:this.state.displayConversation,useIntents:this.state.useIntents,toggleActive:n})},renderGroup:function(e,n){var r,o,i;return e.length>3&&this.state.compact?(o=[],r=e[0],i=e[e.length-1],o.push(this.renderMessage(r,!1)),o.push(g({className:"more",onClick:function(e){return function(){return e.setState({compact:!1})}}(this)},S({className:"fa fa-refresh"}),t("load more messages",e.length-2))),o.push(this.renderMessage(i,!1))):o=function(){var t,r,o;for(o=[],t=0,r=e.length;r>t;t++)n=e[t],o.push(this.renderMessage(n,!1));return o}.call(this),o},render:function(){var e,n,r,o,s;return this.state.conversation?(o=this.state.conversation.get(0),s=[],r=this.state.conversation.length-1,this.state.conversation.forEach(function(e){return function(t,n){var r;return A.call(e.state.expanded,n)>=0?s.push(n):(r=s[s.length-1],_.isArray(r)||s.push(r=[]),r.push(n))}}(this)),E({ref:"conversation",className:"conversation panel","aria-expanded":!0},b(null,y({className:"conversation-title","data-message-id":o.get("id"),"data-conversation-id":o.get("conversationID")},o.get("subject")),this.renderToolbar(),m({className:"clickable btn btn-default fa fa-close",href:this.buildClosePanelUrl("second"),onClick:i.minimizePreview})),function(){var t,r,o;for(o=[],n=t=0,r=s.length;r>t;n=++t)e=s[n],_.isArray(e)?o.push(this.renderGroup(e,n)):o.push(this.renderMessage(e,!0));return o}.call(this))):E({key:"conversation",className:"conversation panel","aria-expanded":!0},w(null,t("app loading")))}})}),require.register("components/date_range_picker",function(e,n,r){var o,i,s,a,l,c,u,p,d,h,f,m;m=React.DOM,l=m.div,f=m.ul,p=m.li,h=m.span,c=m.i,s=m.button,u=m.input,i=n("../constants/app_constants").Tooltips,d="DD/MM/YYYY",a="%d/%m/%Y",r.exports=o=React.createClass({displayName:"DateRangePicker",propTypes:{active:React.PropTypes.bool,onDateFilter:React.PropTypes.func.isRequired},getInitialState:function(){return{isActive:this.props.active,label:t("daterangepicker placeholder"),startDate:"",endDate:""}},shouldComponentUpdate:function(e,t){var n;return n=!_.isEqual(t,this.state)||!_.isEqual(e,this.props)},componentWillReceiveProps:function(e){return this.state.isActive&&!e.active?this.setState({isActive:!1,startDate:"",endDate:""}):e.active&&!this.props.active?this.setState({isActive:!0}):void 0},onStartChange:function(e){var t,n;return n=null!=e.target?e.target.value:""+e.dd+"/"+e.mm+"/"+e.yyyy,t=!!n&&!!this.state.endDate,this.setState({isActive:t,startDate:n},this.filterize)},onEndChange:function(e){var t,n;return n=e.target?e.target.value:""+e.dd+"/"+e.mm+"/"+e.yyyy,t=!!this.state.startDate&&!!n,this.setState({isActive:t,endDate:n},this.filterize)},filterize:function(){var e,t,n,r,o,i,s;if(!(!this.state.startDate^!this.state.endDate))return r=this.state.startDate?(i=this.state.startDate.split("/"),e=i[0],n=i[1],o=i[2],i,""+o+"-"+n+"-"+e+"T00:00:00.000Z"):void 0,t=this.state.endDate?(s=this.state.endDate.split("/"),e=s[0],n=s[1],o=s[2],s,""+o+"-"+n+"-"+e+"T23:59:59.999Z"):void 0,this.props.onDateFilter(r,t)},reset:function(){return this.setState({isActive:!1,startDate:"",endDate:""},this.filterize)},presetYesterday:function(){return this.setState({isActive:!0,startDate:moment().subtract(1,"day").format(d),endDate:moment().subtract(1,"day").format(d)},this.filterize)},presetLastWeek:function(){return this.setState({isActive:!0,startDate:moment().subtract(1,"week").format(d),endDate:moment().format(d)},this.filterize)},presetLastMonth:function(){return this.setState({isActive:!0,startDate:moment().subtract(1,"month").format(d),endDate:moment().format(d)},this.filterize)},render:function(){return l({className:"dropdown date-range-picker","aria-describedby":i.FILTER_DATE_RANGE,"data-tooltip-direction":"bottom"},s({className:"dropdown-toggle",role:"menuitem","data-toggle":"dropdown","aria-selected":this.state.isActive},c({className:"fa fa-calendar"}),h({className:"btn-label"},""+this.state.label),h({className:"caret"})),l({className:"dropdown-menu"},f({className:"presets list-unstyled"},p({role:"presentation"},s({role:"menuitem",onClick:this.presetYesterday},t("daterangepicker presets yesterday"))),p({role:"presentation"},s({role:"menuitem",onClick:this.presetLastWeek},t("daterangepicker presets last week"))),p({role:"presentation"},s({role:"menuitem",onClick:this.presetLastMonth},t("daterangepicker presets last month"))),p({role:"presentation"},s({role:"menuitem",onClick:this.reset},t("daterangepicker clear")))),l({className:"date-pickers"},u({ref:"date-range-picker-start",id:"date-range-picker-start",type:"text",name:"date-range-picker-start",value:this.state.startDate,onChange:this.onStartChange}),u({ref:"date-range-picker-end",id:"date-range-picker-end",type:"text",name:"date-range-picker-end",value:this.state.endDate,onChange:this.onEndChange}))))},initDatepicker:function(){var e;return e={staticPos:!0,fillGrid:!0,hideInput:!0},datePickerController.createDatePicker(_.extend({},e,{formElements:{"date-range-picker-start":a},callbackFunctions:{datereturned:[this.onStartChange]}})),datePickerController.createDatePicker(_.extend({},e,{formElements:{"date-range-picker-end":a},callbackFunctions:{datereturned:[this.onEndChange]}}))},componentDidMount:function(){return this.initDatepicker()},componentDidUpdate:function(){return datePickerController.setDateFromInput("date-range-picker-start"),datePickerController.setDateFromInput("date-range-picker-end")}})}),require.register("components/file_picker",function(e,n,r){var o,i,s,a,l,c,u,p,d,h,f,m,g;g=React.DOM,c=g.div,u=g.form,d=g.input,m=g.ul,h=g.li,f=g.span,p=g.i,l=g.a,a=n("../utils/message_utils"),s=React.PropTypes.shape({fileName:React.PropTypes.string,length:React.PropTypes.number,contentType:React.PropTypes.string,generatedFileName:React.PropTypes.string,contentDisposition:React.PropTypes.string,contentId:React.PropTypes.string,transferEncoding:React.PropTypes.string,rawFileObject:React.PropTypes.object,url:React.PropTypes.string}),i=React.createClass({displayName:"FilePicker",propTypes:{editable:React.PropTypes.bool,display:React.PropTypes.func,value:React.PropTypes.instanceOf(Immutable.Vector),valueLink:React.PropTypes.shape({value:React.PropTypes.instanceOf(Immutable.Vector),requestChange:React.PropTypes.func}),messageID:React.PropTypes.string},getDefaultProps:function(){return{editable:!1,valueLink:{value:Immutable.Vector.empty(),requestChange:function(){}}}},getInitialState:function(){return{files:this.props.value||this.props.valueLink.value,target:!1}},componentWillReceiveProps:function(e){return this.setState({files:e.value||e.valueLink.value})},addFiles:function(e){var t;return e=function(){var n,r,o;for(o=[],n=0,r=e.length;r>n;n++)t=e[n],o.push(this._fromDOM(t));return o}.call(this),e=this.state.files.concat(e).toVector(),this.props.valueLink.requestChange(e)},deleteFile:function(e){var t;return t=this.state.files.filter(function(t){return t.get("generatedFileName")!==e.generatedFileName}).toVector(),this.props.valueLink.requestChange(t)},displayFile:function(e){return e.url?window.open(e.url):e.rawFileObject?window.open(URL.createObjectURL(e.rawFileObject)):console.log("broken file : ",e)},render:function(){var e,n;return e="file-picker",this.props.className&&(e+=" "+this.props.className),n="dropzone",this.state.target&&(n+=" target"),c({className:e},m({className:"files list-unstyled"},this.state.files.toJS().map(function(e){return function(t){return o({key:t.generatedFileName,file:t,editable:e.props.editable,"delete":function(){return e.deleteFile(t)},display:function(){return e.displayFile(t)},messageID:e.props.messageID})}}(this))),this.props.editable?c({className:"dropzone-wrapper"},f({className:"file-wrapper"},d({type:"file",multiple:"multiple",ref:"file",onChange:this.handleFiles})),c({className:n},p({className:"fa fa-paperclip"}),f(null,t("picker drop here"))),c({className:"dropzone dropzone-mask",onDragOver:this.allowDrop,onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onDrop:this.handleFiles,onClick:this.onOpenFile})):void 0)},onOpenFile:function(e){return e.preventDefault(),jQuery(this.refs.file.getDOMNode()).trigger("click")},allowDrop:function(e){return e.preventDefault()},onDragEnter:function(e){return this.state.target?void 0:this.setState({target:!0})},onDragLeave:function(e){return this.state.target?this.setState({target:!1}):void 0},handleFiles:function(e){var t;return e.preventDefault(),t=e.target.files||e.dataTransfer.files,this.addFiles(t),this.setState({target:!1})},_fromDOM:function(e){var t,n,r;return n=this.state.files.filter(function(t){return t.get("fileName")===e.name}).count(),r=e.name,n>0&&(t=e.name.indexOf("."),r=r.substring(0,t)+"-"+(n+1)+r.substring(t)),Immutable.Map({fileName:e.name,length:e.size,contentType:e.type,rawFileObject:e,generatedFileName:r,contentDisposition:null,contentId:e.name,transferEncoding:null,content:null,url:null})}}),r.exports=i,o=React.createClass({displayName:"FileItem",propTypes:{file:React.PropTypes.shape({fileName:React.PropTypes.string,contentType:React.PropTypes.string,length:React.PropTypes.number}).isRequired,editable:React.PropTypes.bool,display:React.PropTypes.func,"delete":React.PropTypes.func,messageID:React.PropTypes.string},getDefaultProps:function(){return{editable:!1}},getInitialState:function(){return{}},render:function(){var e,t,n,r;return e=this.props.file,null!=e.url||e.rawFileObject||(window.cozyMails.log(new Error("Wrong file "+JSON.stringify(e))),e.url="message/"+this.props.messageID+"/attachments/"+e.generatedFileName),r=a.getAttachmentType(e.contentType),n={archive:"fa-file-archive-o",audio:"fa-file-audio-o",code:"fa-file-code-o",image:"fa-file-image-o",pdf:"fa-file-pdf-o",word:"fa-file-word-o",presentation:"fa-file-powerpoint-o",spreadsheet:"fa-file-excel-o",text:"fa-file-text-o",video:"fa-file-video-o",word:"fa-file-word-o"},t=n[r]||"fa-file-o",h({className:"file-item",key:this.props.key},p({className:"mime "+r+" fa "+t}),l({className:"file-name",target:"_blank",onClick:this.doDisplay,href:e.url,"data-file-url":e.url,"data-file-name":e.generatedFileName,"data-file-type":e.contentType},e.generatedFileName),f({className:"file-size"},"("+(e.length/1e3).toFixed(1)+"Ko)"),f({className:"file-actions"},l({className:"fa fa-download",href:""+e.url+"?download=1"}),this.props.editable?p({className:"fa fa-times delete",onClick:this.doDelete}):void 0))},doDisplay:function(e){return e.preventDefault(),e.stopPropagation(),this.props.display()},doDelete:function(e){return e.preventDefault(),e.stopPropagation(),this.props["delete"]()}})}),require.register("components/mailbox_picker",function(e,n,r){var o,i,s,a,l,c,u,p,d,h,f,m;m=React.DOM,p=m.div,f=m.ul,d=m.li,h=m.span,l=m.a,c=m.button,o=n("./basic_components").Dropdown,i=n("../libs/prop_types"),s=n("../mixins/router_mixin"),u=n("../libs/cached_transform"),a=n("../mixins/should_update_mixin"),r.exports=React.createClass({displayName:"MailboxPicker",mixins:[s,a.UnderscoreEqualitySlow],propTypes:{allowUndefined:React.PropTypes.bool,mailboxes:i.immutableMapStringTo(i.Mailbox),valueLink:i.valueLink(i.string).isRequired},getDefaultOptions:function(){return{allowUndefined:!0}},makeOptions:function(){return u(this,"mailboxesOptions",this.props.mailboxes,function(e){return function(){return e.props.mailboxes.map(function(e){var t;return t=new Array(e.get("depth")+1).join("--"),""+t+e.get("label")}).toJS()}}(this))},render:function(){var e;return(null!=(e=this.props.mailboxes)?e.length:void 0)?o({valueLink:this.props.valueLink,className:"btn-group btn-group-sm pull-left",btnClassName:"btn",options:this.makeOptions(),defaultLabel:t("mailbox pick one"),undefinedLabel:t("mailbox pick null"),allowUndefined:this.props.allowUndefined,undefinedValue:null}):p(null)}})}),require.register("components/mails_input",function(e,n,r){var o,i,s,a,l,c,u,p,d,h,f,m,g,v,y,b;b=React.DOM,p=b.div,f=b.label,v=b.textarea,g=b.span,y=b.ul,m=b.li,c=b.a,h=b.img,d=b.i,l=n("../utils/message_utils"),i=n("../stores/contact_store"),o=n("../actions/contact_action_creator"),s=n("../actions/layout_action_creator"),u=React.addons.classSet,r.exports=a=React.createClass({displayName:"MailsInput",getStateFromStores:function(){return{contacts:i.getResults()}},componentWillMount:function(){return this.setState({contacts:null,open:!1})},getInitialState:function(){var e;return e=this.getStateFromStores(),e.known=this.props.valueLink.value,e.unknown="",e.selected=0,e.open=!1,e},componentWillReceiveProps:function(e){return this.setState({known:e.valueLink.value})},componentDidMount:function(){return i.on("change",this._setStateFromStores)},componentWillUnmount:function(){return i.removeListener("change",this._setStateFromStores)},_setStateFromStores:function(){return this.setState(this.getStateFromStores())},shouldComponentUpdate:function(e,t){return!_.isEqual(t,this.state)||!_.isEqual(e,this.props)},render:function(){var e,t,n,r,o,i,s,a,h,m,b,S;return b=function(e){return function(t,n){var r,o,i,s;return s=function(){var n;return n=e.state.known.filter(function(e){return e.address!==t.address}),e.props.valueLink.requestChange(n)},i=function(n){var r;return n.stopPropagation(),null!=t?(r={name:t.name,address:t.address},n.dataTransfer.setData("address",JSON.stringify(r)),n.dataTransfer.effectAllowed="all",n.dataTransfer.setData(e.props.id,!0)):void 0},o=function(e){return"move"===e.dataTransfer.dropEffect?s():void 0},r=null!=t.name&&""!==t.name.trim()?t.name:t.address,g({className:"address-tag",draggable:!0,onDragStart:i,onDragEnd:o,key:""+e.props.id+"-"+t.address+"-"+n,title:t.address},r,c({className:"clickable",onClick:s},d({className:"fa fa-times"})))}}(this),o=this.state.known.map(b),a=function(e){return function(){return e.refs.contactInput.getDOMNode().focus()}}(this),s=function(e){return function(t){var n,r;return r=t.target.value.split(","),2===r.length?(n=_.clone(e.state.known),n.push(l.parseAddress(r[0])),e.props.valueLink.requestChange(n),e.setState({unknown:r[1].trim()})):e.setState({unknown:t.target.value})}}(this),h=function(e){return function(t){var n;return n=e.refs.contactInput.getDOMNode(),n.cols=n.value.length+2,n.style.height=n.scrollHeight+"px"}}(this),n=""+(this.props.className||"")+" form-group mail-input "+this.props.id,t="compose-label control-label",i=u({"contact-form":!0,open:this.state.open&&(null!=(S=this.state.contacts)?S.length:void 0)>0}),r=0,e=function(e){return function(t){var n;return t.preventDefault(),n=Array.prototype.slice.call(t.dataTransfer.types),-1===n.indexOf(e.props.id)?t.dataTransfer.dropEffect="move":t.dataTransfer.dropEffect="none"}}(this),m=o.length>0?"":this.props.placeholder,p({className:n,onClick:a,onDrop:this.onDrop,onDragEnter:e,onDragLeave:e,onDragOver:e},f({htmlFor:this.props.id,className:t},this.props.label),o,p({className:"contact-group dropdown "+i},v({id:this.props.id,name:this.props.id,className:"form-control compose-input",onKeyDown:this.onKeyDown,onBlur:this.onBlur,onDrop:this.onDrop,onDragEnter:e,onDragLeave:e,onDragOver:e,ref:"contactInput",rows:1,value:this.state.unknown,onChange:s,onInput:h,placeholder:m,autoComplete:"off",spellCheck:"off"}),null!=this.state.contacts?y({className:"dropdown-menu contact-list"},this.state.contacts.map(function(e){return function(t,n){var o;return o=r===e.state.selected,r++,e.renderContact(t,o)}}(this)).toJS()):void 0))},renderContact:function(e,t){var n,r,o;return o=function(t){return function(){return t.onContact(e)}}(this),n=e.get("avatar"),r=u({selected:t}),m({className:r,onClick:o},c(null,null!=n?h({className:"avatar",src:n}):d({className:"avatar fa fa-user"}),""+e.get("fn")+" <"+e.get("address")+">"))},onQuery:function(e){var t,n;return n=this.refs.contactInput.getDOMNode().value.split(",").pop().replace(/^\s*/,""),null!=e&&"string"==typeof e?(n+=e,t=!1):null!=e&&"object"==typeof e&&(t=!0),n.length>2||t&&!this.state.open?(o.searchContactLocal(n),this.setState({open:!0}),!0):(this.state.open&&this.setState({contacts:null,open:!1}),!1)},onKeyDown:function(e){var t,n,r,o,i,s;switch(n=null!=(i=this.state.contacts)?i.count():void 0,o=this.state.selected,e.key){case"Enter":return(13===e.keyCode||13===e.which)&&this.addContactFromInput(),(null!=(s=this.state.contacts)?s.count():void 0)>0?(t=this.state.contacts.slice(o).first(),this.onContact(t)):this.onQuery(),e.preventDefault(),!1;case"ArrowUp":return this.setState({selected:0===o?n-1:o-1});case"ArrowDown":return this.setState({selected:o===n-1?0:o+1});case"Backspace":if(r=this.refs.contactInput.getDOMNode(),r.value=r.value.trim(),r.value.length<2)return this.setState({open:!1});break;case"Escape":return this.setState({contacts:null,open:!1});default:if(null!=e.key||1===e.key.toString().length)return this.onQuery(String.fromCharCode(e.which)),!0}},onBlur:function(){return setTimeout(function(e){return function(){return e.addContactFromInput(!0)}}(this),100)},addContactFromInput:function(e){var n,r,o,i,a,c;if(null==e&&(e=!1),this.state.selected=0,this.isMounted()){if(i={},i.open=!1,a=this.refs.contactInput.getDOMNode().value,""===a.trim())return this.setState(i);if(n=l.parseAddress(a),n.isValid)return this.state.known.push(n),i.known=this.state.known,i.unknown="",this.props.valueLink.requestChange(i.known),this.setState(i);if(r=0===(null!=(c=this.state.contacts)?c.length:void 0),!e&&r)return o=t("compose wrong email format",{address:n.address}),s.alertError(o)}},onContact:function(e){var t,n;return t={name:e.get("fn"),address:e.get("address")},n=_.clone(this.state.known),n.push(t),this.props.valueLink.requestChange(n),this.setState({unknown:"",contacts:null,open:!1}),setTimeout(function(e){return function(){var t;return t=e.refs.contactInput.getDOMNode().focus()}}(this),200)},onDrop:function(e){var t,n,r,o,i;return e.preventDefault(),e.stopPropagation(),i=JSON.parse(e.dataTransfer.getData("address")),o=i.name,t=i.address,n=this.state.known.some(function(e){return e.name===o&&e.address===t}),null==t||n?e.dataTransfer.dropEffect="none":(t={name:o,address:t},r=_.clone(this.state.known),r.push(t),this.props.valueLink.requestChange(r),this.setState({unknown:"",contacts:null,open:!1}),e.dataTransfer.dropEffect="move")}})}),require.register("components/menu",function(e,n,r){var o,i,s,a,l,c,u,p,d,h,f,m,g,v,y,b,S,k,w,E,x,C,T,M,A,D,R,N,O=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};R=React.DOM,E=R.div,b=R.aside,T=R.nav,D=R.ul,C=R.li,M=R.span,y=R.a,x=R.i,S=R.button,k=React.addons.classSet,h=n("../mixins/router_mixin"),g=n("../mixins/store_watch_mixin"),o=n("../actions/account_action_creator"),s=n("../actions/layout_action_creator"),u=n("../actions/message_action_creator"),i=n("../stores/account_store"),a=n("../stores/layout_store"),d=n("../stores/refreshes_store"),f=n("../stores/search_store"),p=n("../utils/message_utils"),w=n("../utils/colorhash"),c=n("./menu_mailbox_item"),N=n("../constants/app_constants"),m=N.SpecialBoxIcons,v=N.Tooltips,A=["inboxMailbox","draftMailbox","sentMailbox","trashMailbox","junkMailbox","allMailbox"],r.exports=l=React.createClass({displayName:"Menu",mixins:[h,g([i,a,d,f])],shouldComponentUpdate:function(e,t){return!_.isEqual(t,this.state)||!_.isEqual(e,this.props)},getStateFromStores:function(){
return{onlyFavorites:!this.state||this.state.onlyFavorites===!0,isDrawerExpanded:a.isDrawerExpanded(),refreshes:d.getRefreshing(),accounts:i.getAll(),selectedAccount:i.getSelectedOrDefault(),mailboxes:i.getSelectedMailboxes(!0),favorites:i.getSelectedFavorites(!0),search:f.getCurrentSearch()}},selectedFirstSort:function(e,t){var n,r;return(null!=(n=this.state.selectedAccount)?n.get("id"):void 0)===e.get("id")?-1:(null!=(r=this.state.selectedAccount)?r.get("id"):void 0)===t.get("id")?1:0},_toggleFavorites:function(){return this.setState({onlyFavorites:!this.state.onlyFavorites})},displayErrors:function(e){var n,r;return n=e.get("errors"),r={title:t("modal please contribute"),subtitle:t("modal please report"),allowCopy:!0,closeLabel:t("app alert close"),content:React.DOM.pre({style:{"max-height":"300px","word-wrap":"normal"}},n.join("\n\n"))},s.displayModal(r)},render:function(){return b({role:"menubar","aria-expanded":this.state.isDrawerExpanded},this.state.accounts.length?this.renderComposeButton():void 0,T({className:"mainmenu"},this.state.search&&!this.state.selectedAccount?E({className:"active"},E({className:"account-title"},y({role:"menuitem",className:"account active"},x({className:"fa fa-search"}),E({className:"account-details"},M({},this.state.search))))):void 0,this.state.accounts.length?this.state.accounts.sort(this.selectedFirstSort).map(this.getAccountRender).toJS():void 0),T({className:"submenu"},this.renderNewMailboxButton(),S({role:"menuitem",className:"btn fa fa-question-circle help","aria-describedby":v.HELP_SHORTCUTS,"data-tooltip-direction":"top",onClick:function(){return Mousetrap.trigger("?")}}),S({role:"menuitem",className:k({btn:!0,fa:!0,"drawer-toggle":!0,"fa-caret-right":!this.state.isDrawerExpanded,"fa-caret-left":this.state.isDrawerExpanded}),onClick:s.drawerToggle})))},renderComposeButton:function(){var e;return e=this.buildUrl({direction:"first",action:"compose",parameters:null,fullWidth:!0}),y({href:e,className:"compose-action btn btn-cozy"},x({className:"fa fa-pencil"}),M({className:"item-label"}," "+t("menu compose")))},renderNewMailboxButton:function(){var e,n,r,o;return r=this.state.accounts.length?this.buildUrl({direction:"first",action:"account.mailbox.messages",parameters:[null!=(o=this.state.selectedAccount)?o.get("id"):void 0],fullWidth:!0}):this.buildUrl({direction:"first",action:"account.new",fullWidth:!0}),"account.new"===this.props.layout.firstPanel.action?(e="active",n=r):(e="",n=this.buildUrl({direction:"first",action:"account.new",fullWidth:!0})),y({href:n,role:"menuitem",className:"btn new-account-action "+e},x({className:"fa fa-plus"}),M({className:"item-label"},t("menu account new")))},getAccountRender:function(e,n){var r,o,s,a,l,u,p,d,h,f,m,g,b,S,_;return d=e===this.state.selectedAccount,s=e.get("id"),f=e.get("totalUnread"),u=i.getDefaultMailbox(s),g=this.state.refreshes,_=null!=u?this.buildUrl({direction:"first",action:"account.mailbox.messages",parameters:[s,null!=u?u.get("id"):void 0],fullWidth:!0}):this.buildUrl({direction:"first",action:"account.config",parameters:[s,"account"],fullWidth:!0}),r=k({active:d}),this.state.onlyFavorites?(h=this.state.favorites,p="fa-ellipsis-h",S=t("menu favorites off")):(h=this.state.mailboxes,p="fa-ellipsis-h",S=t("menu favorites on")),a=this.state.mailboxes.length===this.state.favorites.length,l=this.buildUrl({direction:"first",action:"account.config",parameters:[s,"account"],fullWidth:!0}),b=A.map(function(t){return e.get(t)}),o=w(e.get("label")),E({className:r,key:n},E({className:"account-title"},y({href:_,role:"menuitem",className:"account "+r,"data-toggle":"tooltip","data-delay":"10000","data-placement":"right"},x({className:"avatar",style:{"background-color":o}},e.get("label")[0]),E({className:"account-details"},M({"data-account-id":n,className:"item-label display-label"},e.get("label")),M({"data-account-id":n,className:"item-label display-login"},e.get("login"))),(m=g.get(s))&&m.get("errors").length?M({className:"refresh-error"},x({className:"fa warning",onClick:this.displayErrors},m)):void 0),d?y({href:l,className:"mailbox-config"},x({className:"fa fa-cog","aria-describedby":v.ACCOUNT_PARAMETERS,"data-tooltip-direction":"right"})):void 0,f>0&&!m?M({className:"badge"},f):void 0),d?D({role:"group",className:"list-unstyled mailbox-list"},null!=h?h.filter(function(e){var t;return t=e.get("id"),O.call(b,t)>=0}).map(function(t){return function(n,r){return c({account:e,mailbox:n,key:r,selectedMailboxID:t.state.selectedMailboxID,refreshes:g,displayErrors:t.displayErrors})}}(this)).toJS():void 0,null!=h?h.filter(function(e){var t;return t=e.get("id"),O.call(b,t)<0}).map(function(t){return function(n,r){return c({account:e,mailbox:n,key:r,selectedMailboxID:t.state.selectedMailboxID,refreshes:g,displayErrors:t.displayErrors})}}(this)).toJS():void 0,a?void 0:C({className:"toggle-favorites"},y({role:"menuitem",tabIndex:0,onClick:this._toggleFavorites,key:"toggle"},x({className:"fa "+p}),M({className:"item-label"},S)))):void 0)}})}),require.register("components/menu_mailbox_item",function(e,n,r){var o,i,s,a,l,c,u,p,d,h,f,m,g,v,y,b,S,k;S=React.DOM,f=S.div,p=S.aside,v=S.nav,b=S.ul,g=S.li,y=S.span,u=S.a,m=S.i,d=S.button,h=React.addons.classSet,a=n("../mixins/router_mixin"),s=n("../actions/message_action_creator"),o=n("../actions/layout_action_creator"),k=n("../constants/app_constants"),l=k.SpecialBoxIcons,c=k.Tooltips,r.exports=i=React.createClass({displayName:"MenuMailboxItem",mixins:[a],shouldComponentUpdate:function(e,t){return!_.isEqual(t,this.state)||!_.isEqual(e,this.props)},getInitialState:function(){return{target:!1}},onClickMailbox:function(){return this.props.mailbox.get("id")===this.props.selectedMailboxID&&this.props.account.get("supportRFC4551")?s.refreshMailbox(this.props.selectedMailboxID):void 0},render:function(){var e,n,r,o,i,s,a,p,f,v,b,S,k,w;s=this.props.mailbox.get("id"),p=this.buildUrl({direction:"first",action:"account.mailbox.messages",parameters:[this.props.account.get("id"),s]}),v=this.props.mailbox.get("nbTotal")||0,b=this.props.mailbox.get("nbUnread")||0,f=this.props.mailbox.get("nbRecent")||0,w=t("menu mailbox total",v),b>0&&(w+=" "+t("menu mailbox unread",b)),f>0&&(w+=" "+t("menu mailbox new",f)),a="fa-folder-o",k=!1;for(e in l)i=l[e],this.props.account.get(e)===s&&(a=i,k=e);return r=h({active:s===this.props.selectedMailboxID,target:this.state.target}),n=h({target:this.state.target,special:k,news:f>0}),k&&(n+=" "+k),S=this.props.refreshes.get(s),o=this.props.displayErrors.bind(null,S),g({className:r},u({href:p,onClick:this.onClickMailbox,className:""+n+" lv-"+this.props.mailbox.get("depth"),role:"menuitem","data-mailbox-id":s,onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onDragOver:this.onDragOver,onDrop:function(e){return function(t){return e.onDrop(t,s)}}(this),title:w,"data-toggle":"tooltip","data-placement":"right",key:this.props.key},m({className:"fa "+a}),y({className:"item-label"},""+this.props.mailbox.get("label")),(null!=S?S.get("errors").length:void 0)?y({className:"refresh-error",onClick:o},m({className:"fa fa-warning"},null)):void 0),this.props.account.get("trashMailbox")===s?d({"aria-describedby":c.EXPUNGE_MAILBOX,"data-tooltip-direction":"right",onClick:this.expungeMailbox},y({className:"fa fa-recycle"})):void 0,!S&&b&&b>0?y({className:"badge"},b):void 0)},onDragEnter:function(e){return this.state.target?void 0:this.setState({target:!0})},onDragLeave:function(e){return this.state.target?this.setState({target:!1}):void 0},onDragOver:function(e){return e.preventDefault()},onDrop:function(e,t){var n,r,o,i,a;return r=e.dataTransfer.getData("text"),a=JSON.parse(r),i=a.messageID,o=a.mailboxID,n=a.conversationID,this.setState({target:!1}),s.move({messageID:i,conversationID:n},o,t)},expungeMailbox:function(e){return e.preventDefault(),o.displayModal({title:t("app confirm delete"),subtitle:t("account confirm delbox"),closeLabel:t("app cancel"),actionLabel:t("app confirm"),action:function(e){return function(){return o.hideModal(),AccountActionCreator.mailboxExpunge({accountID:e.props.account.get("id"),mailboxID:e.props.mailbox.get("id")})}}(this)})}})}),require.register("components/message-content",function(e,n,r){var o,i,s,a,l,c,u,p,d,h,f,m,g,v,y;y=React.DOM,l=y.div,s=y.article,u=y.header,c=y.footer,v=y.ul,h=y.li,g=y.span,p=y.i,f=y.p,i=y.a,a=y.button,m=y.pre,d=y.iframe,r.exports=o=React.createClass({displayName:"MessageContent",shouldComponentUpdate:function(e,t){return!_.isEqual(t,this.state)||!_.isEqual(e,this.props)},render:function(){return this.props.messageDisplayHTML&&this.props.html?l(null,this.props.imagesWarning?l({className:"imagesWarning alert alert-warning content-action",ref:"imagesWarning"},p({className:"fa fa-shield"}),t("message images warning"),a({className:"btn btn-xs btn-warning",type:"button",ref:"imagesDisplay",onClick:this.props.displayImages},t("message images display"))):void 0,d({"data-message-id":this.props.messageID,name:"frame-"+this.props.messageID,className:"content",ref:"content",allowTransparency:!0,frameBorder:0})):l({className:"row"},l({className:"preview",ref:"content"},f({dangerouslySetInnerHTML:{__html:this.props.rich}})))},_initFrame:function(e){var t,n,r,o,i,s,a;return i=document.querySelector("#panels > .panel:nth-of-type(2)"),null==i||this.props.composing||(i.scrollTop=0),this.props.messageDisplayHTML&&this.refs.content?(r=this.refs.content.getDOMNode(),n=r.contentDocument||(null!=(a=r.contentWindow)?a.document:void 0),t=!1,s=0,o=function(e){return function(i){var a,l,c;return s=0,n=r.contentDocument||(null!=(l=r.contentWindow)?l.document:void 0),null==n?e.props.displayHTML(!1):(n.documentElement.innerHTML=e.props.html,window.cozyMails.customEvent("MESSAGE_LOADED",e.props.messageID),a=function(e){var i,a;return i=n.documentElement.scrollHeight,60>i?r.style.height="60px":r.style.height=""+(i+60)+"px",s++,t&&s>10?(n.body.removeEventListener("load",o),null!=(a=r.contentWindow)?a.removeEventListener("resize"):void 0):void 0},a(),setTimeout(a,1e3),n.body.onload=a,t?(r.contentWindow.onresize=a,window.onresize=a,null!=(c=r.contentWindow)?c.addEventListener("resize",a,!0):void 0):void 0)}}(this),"mount"===e&&"complete"!==n.readyState?r.addEventListener("load",o):o()):window.cozyMails.customEvent("MESSAGE_LOADED",this.props.messageID)},componentDidMount:function(){return this._initFrame("mount")},componentDidUpdate:function(){return this._initFrame("update")}})}),require.register("components/message-list-body",function(e,t,n){var r,o,i,s;s=React.DOM.ul,o=t("./message-list-item"),r=t("../utils/dom_utils"),n.exports=i=React.createClass({displayName:"MessageListBody",getInitialState:function(){var e;return e={messageID:null}},shouldComponentUpdate:function(e,t){var n,r;return r=Object.keys(e).filter(function(t){return function(n){return"function"!=typeof e[n]&&!_.isEqual(e[n],t.props[n])}}(this)),n=!_.isEqual(t,this.state)||r.length>0},_isActive:function(e,t){return this.props.messageID===e||this.props.displayConversations&&null!=t&&this.props.conversationID===t},render:function(){return s({className:"list-unstyled",ref:"messageList"},this.props.messages.map(function(e){return function(t,n){var r,i,s;return i=t.get("id"),r=t.get("conversationID"),o({message:t,accountID:e.props.accountID,mailboxID:e.props.mailboxID,accounts:e.props.accounts,mailboxes:e.props.mailboxes,conversationLengths:null!=(s=e.props.conversationLengths)?s.get(r):void 0,key:n,isActive:e._isActive(i,r),edited:e.props.edited,settings:e.props.settings,selected:null!=e.props.selected[i],login:e.props.login,displayConversations:e.props.displayConversations,isTrash:e.props.isTrash,ref:"messageItem",onSelect:function(t){return e.props.onSelect(i,t)}})}}(this)).toJS())},componentDidMount:function(){return this._onMount()},componentDidUpdate:function(){return this._onMount()},_onMount:function(){var e,t,n,o,i,s,a;return this.state.messageID!==this.props.messageID?(n=null!=(o=this.refs.messageList)&&null!=(i=o.getDOMNode())?i.parentNode:void 0,e=document.querySelector("[data-message-id='"+this.props.messageID+"']"),null==e||r.isVisible(e)||(t=null!=n?n.scrollTop:void 0,e.scrollIntoView(!1),t!==(null!=(s=this.refs.scrollable)&&null!=(a=s.getDOMNode())?a.scrollTop:void 0)&&null!=n&&(n.scrollTop+=e.getBoundingClientRect().height/2)),this.setState({messageID:this.props.messageID})):void 0}})}),require.register("components/message-list-item",function(e,t,n){var r,o,i,s,a,l,c,u,p,d,h,f,m,g,v,y,b,S,k,w,E,x,C,T=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},M=[].slice;x=React.DOM,m=x.div,k=x.section,S=x.p,E=x.ul,b=x.li,p=x.a,w=x.span,g=x.i,d=x.button,y=x.input,v=x.img,C=t("../constants/app_constants"),s=C.MessageFlags,o=C.MailboxFlags,r=t("./basic_components").Icon,u=t("../mixins/router_mixin"),h=React.addons.classSet,l=t("../utils/message_utils"),f=t("../utils/colorhash"),c=t("./participant"),i=t("../actions/message_action_creator"),n.exports=a=React.createClass({displayName:"MessagesItem",mixins:[u],shouldComponentUpdate:function(e,t){var n,r;return r=Object.keys(e).filter(function(t){return function(n){return"function"!=typeof e[n]&&!_.isEqual(e[n],t.props[n])}}(this)),n=!_.isEqual(t,this.state)||r.length>0},render:function(){var e,t,n,o,i,a,c,u,d,y,S,k;return u=this.props.message,a=u.get("flags"),n=h({message:!0,unseen:(y=s.SEEN,T.call(a,y)<0),active:this.props.isActive,edited:this.props.edited}),o="compact"===this.props.settings.get("listStyle"),i=l.formatDate(u.get("createdAt"),o),e=l.getAvatar(u),d=this.props.edited?w:p,b({className:n,key:this.props.key,"data-message-id":u.get("id"),"data-conversation-id":u.get("conversationID"),draggable:!this.props.edited,onClick:this.onMessageClick,onDragStart:this.onDragStart},d({href:this.getUrl(),className:"wrapper","data-message-id":u.get("id"),onClick:this.onMessageClick,onDoubleClick:this.onMessageDblClick,ref:"target"},m({className:"markers-wrapper"},r({className:"select",onClick:this.onSelect,type:this.props.selected?"check-square-o":"square-o"}),(S=s.SEEN,T.call(a,S)<0?r({type:"circle"}):void 0),(k=s.FLAGGED,T.call(a,k)>=0?r({type:"star"}):void 0)),m({className:"avatar-wrapper select-target"},null!=e?v({className:"avatar",src:e}):(c=u.get("from")[0],t=""+(null!=c?c.name:void 0)+" <"+(null!=c?c.address:void 0)+">",g({className:"avatar placeholder",style:{"background-color":f(t)}},(null!=c?c.name:void 0)?null!=c?c.name[0]:void 0:null!=c?c.address[0]:void 0))),m({className:"metas-wrapper"},m({className:"metas"},m({className:"participants ellipsable"},this.getParticipants(u)),m({className:"subject ellipsable"},this.highlightSearch(u.get("subject"))),m.apply(null,[{className:"mailboxes"}].concat(M.call(this.getMailboxTags(u)))),m({className:"date"},i),m({className:"extras"},u.get("hasAttachments")?g({className:"attachments fa fa-paperclip"}):void 0,this.props.displayConversations&&this.props.conversationLengths>1?w({className:"conversation-length"},""+this.props.conversationLengths):void 0),m({className:"preview ellipsable"},this.highlightSearch(l.getPreview(u)))))))},_doCheck:function(){return this.props.selected?setTimeout(function(e){return function(){var t;return null!=(t=e.refs.select)?t.getDOMNode().checked=!0:void 0}}(this),50):setTimeout(function(e){return function(){var t;return null!=(t=e.refs.select)?t.getDOMNode().checked=!1:void 0}}(this),50)},highlightSearch:function(e,t){return null==t&&(t=null),S.apply(null,[t].concat(M.call(l.highlightSearch(e))))},getMailboxTags:function(){var e,t;return e=this.props.message.get("accountID"),t=this.props.accounts.get(e).get("label"),Object.keys(this.props.message.get("mailboxIDs")).filter(function(e){return function(t){var n,r;return n=e.props.mailboxes.get(t),n?e.props.mailboxID&&(r=o.ALL,T.call(n.get("attribs"),r)>=0)?!1:e.props.mailboxID===t?!1:!0:!1}}(this)).map(function(e){return function(n){var r,o;return r=e.props.mailboxes.get(n),o=r.get("label"),e.props.accountID||(o=""+t+":"+o),w({className:"mailbox-tag"},o)}}(this))},componentDidMount:function(){return this._doCheck()},componentDidUpdate:function(){return this._doCheck()},onSelect:function(e){return this.props.onSelect(!this.props.selected),e.preventDefault(),e.stopPropagation()},getUrl:function(){var e,t,n,r;return n={messageID:this.props.message.get("id")},r=s.DRAFT,T.call(this.props.message.get("flags"),r)>=0&&!this.props.isTrash?e="edit":(t=this.props.message.get("conversationID"),null!=t&&this.props.displayConversations?(e="conversation",n.conversationID=t):e="message"),this.buildUrl({direction:"second",action:e,parameters:n})},onMessageClick:function(e){var t,n;return n=this.refs.target.getDOMNode(),this.props.edited&&e.target.classList.contains("select-target")?(this.props.onSelect(!this.props.selected),e.preventDefault(),e.stopPropagation()):e.target.classList.contains("wrapper")?(e.preventDefault(),e.stopPropagation()):"checkbox"!==e.target.getAttribute("type")&&(e.preventDefault(),e.stopPropagation(),i.setCurrent(n.dataset.messageId,!0),this.props.settings.get("displayPreview"))?(t="#"+n.getAttribute("href").split("#")[1],this.redirect(t)):void 0},onMessageDblClick:function(e){var t;return this.props.edited?void 0:(t=e.currentTarget.href.split("#")[1],window.router.navigate(t,{trigger:!0}))},onDragStart:function(e){var t;return e.stopPropagation(),t={mailboxID:this.props.mailboxID},this.props.displayConversations?t.conversationID=e.currentTarget.dataset.conversationId:t.messageID=e.currentTarget.dataset.messageId,e.dataTransfer.setData("text",JSON.stringify(t)),e.dataTransfer.effectAllowed="move",e.dataTransfer.dropEffect="move"},getParticipants:function(e){var t,n,r;return t=e.get("from"),r=e.get("to").concat(e.get("cc")).filter(function(e){return function(n){var r;return n.address!==e.props.login&&n.address!==(null!=(r=t[0])?r.address:void 0)}}(this)),n=r.length>0?", ":" ",S(null,c({participants:t,onAdd:this.addAddress,ref:"from",tooltip:!1}),w(null,n),c({participants:r,onAdd:this.addAddress,ref:"to",tooltip:!1}))},addAddress:function(e){return ContactActionCreator.createContact(e)}})}),require.register("components/message-list",function(e,n,r){var o,i,s,a,l,c,u,p,d,h,f,m,g,v,y,b,S,k,w,E,x,C,T,M,A,D,R,N,O,I,P,L,F,U;L=React.DOM,T=L.div,O=L.section,N=L.p,P=L.ul,R=L.li,w=L.a,I=L.span,M=L.i,E=L.button,D=L.input,A=L.img,F=n("../constants/app_constants"),c=F.MessageFlags,k=F.Tooltips,m=n("../mixins/router_mixin"),S=n("../mixins/tooltip_refresher_mixin"),y=n("../mixins/store_watch_mixin"),a=n("../stores/layout_store"),x=React.addons.classSet,i=n("../utils/dom_utils"),d=n("../utils/message_utils"),g=n("../utils/socketio_utils"),C=n("../utils/colorhash"),o=n("../actions/contact_action_creator"),s=n("../actions/layout_action_creator"),l=n("../actions/message_action_creator"),h=n("./participant"),U=n("./basic_components"),v=U.Spinner,f=U.Progress,b=n("./toolbar_messageslist"),p=n("./message-list-body"),r.exports=u=React.createClass({displayName:"MessageList",mixins:[m,S,y([a])],shouldComponentUpdate:function(e,t){var n;return n=!_.isEqual(t,this.state)||!_.isEqual(e,this.props)},getInitialState:function(){return{edited:!1,selected:{},allSelected:!1}},getStateFromStores:function(){return{fullscreen:a.isPreviewFullscreen()}},componentWillReceiveProps:function(e){var t,n,r;r=_.clone(this.state.selected);for(t in r)n=r[t],e.messages.get(t)||delete r[t];return this.setState({selected:r}),0===Object.keys(r).length?this.setState({allSelected:!1,edited:!1}):void 0},render:function(){return O({key:"messages-list-"+this.props.mailboxID,ref:"list","data-mailbox-id":this.props.mailboxID,className:"messages-list panel","aria-expanded":!this.state.fullscreen},b({settings:this.props.settings,accountID:this.props.accountID,mailboxID:this.props.mailboxID,mailboxes:this.props.mailboxes,messages:this.props.messages,edited:this.state.edited,selected:this.state.selected,allSelected:this.state.allSelected,displayConversations:this.props.displayConversations,toggleEdited:this.toggleEdited,toggleAll:this.toggleAll,afterAction:this.afterMessageAction,queryParams:this.props.queryParams,noFilters:this.props.noFilters}),f({value:this.props.refresh,max:1}),0===this.props.messages.count()?this.props.fetching?N({className:"listFetching list-loading"},t("list fetching")):N({className:"listEmpty",ref:"listEmpty"},this.props.emptyListMessage):T({className:"main-content",ref:"scrollable"},p({messages:this.props.messages,settings:this.props.settings,accountID:this.props.accountID,mailboxID:this.props.mailboxID,messageID:this.props.messageID,conversationID:this.props.conversationID,conversationLengths:this.props.conversationLengths,accounts:this.props.accounts,mailboxes:this.props.mailboxes,login:this.props.login,edited:this.state.edited,selected:this.state.selected,allSelected:this.state.allSelected,displayConversations:this.props.displayConversations,isTrash:this.props.isTrash,ref:"listBody",onSelect:this.onMessageSelectionChange}),this.renderFooter()))},renderFooter:function(){return this.props.canLoadMore?N({className:"text-center list-footer"},this.props.fetching?v():w({className:"more-messages",onClick:this.props.loadMoreMessage,ref:"nextPage"},t("list next page"))):N({ref:"listEnd"},t("list end"))},toggleEdited:function(){return this.state.edited?this.setState({allSelected:!1,edited:!1,selected:{}}):this.setState({edited:!0})},toggleAll:function(){var e;return Object.keys(this.state.selected).length>0?this.setState({allSelected:!1,edited:!1,selected:{}}):(e={},this.props.messages.map(function(t,n){return e[n]=!0}).toJS(),this.setState({allSelected:!0,edited:!0,selected:e}))},onMessageSelectionChange:function(e,t){var n,r;return r=_.clone(this.state.selected),t?r[e]=t:delete r[e],n=Object.keys(r).length>0?{edited:!0,selected:r}:{allSelected:!1,edited:!1,selected:{}},this.setState(n)},afterMessageAction:function(){return setTimeout(function(e){return function(){var t;return t=e.refs.nextPage||e.refs.listEnd||e.refs.listEmpty,null!=t&&i.isVisible(t.getDOMNode())?e.props.loadMoreMessage():void 0}}(this),100)},_loadNext:function(){var e,t;return e=null!=(t=this.refs.listBody)?t.getDOMNode().lastElementChild:void 0,null!=this.refs.nextPage&&null!=e&&i.isVisible(e)?this.props.loadMoreMessage():void 0},_handleRealtimeGrowth:function(){var e;return"-"===this.props.pageAfter||null==this.refs.listEnd||i.isVisible(this.refs.listEnd.getDOMNode())?void 0:(e=this.props.messages.last().get("date"),g.changeRealtimeScope(this.props.mailboxID,e))},_initScroll:function(){var e;if(null!=this.refs.nextPage)return null!=this.refs.scrollable?(e=this.refs.scrollable.getDOMNode(),setTimeout(function(t){return function(){return e.removeEventListener("scroll",t._loadNext),e.addEventListener("scroll",t._loadNext),t._loadNext(),null==t._checkNextInterval?t._checkNextInterval=window.setInterval(t._loadNext,1e4):void 0}}(this),0)):void 0},componentDidMount:function(){return this._initScroll()},componentDidUpdate:function(){return this._initScroll(),this._handleRealtimeGrowth()},componentWillUnmount:function(){var e;return null!=this.refs.scrollable&&(e=this.refs.scrollable.getDOMNode(),e.removeEventListener("scroll",this._loadNext),null!=this._checkNextInterval)?window.clearInterval(this._checkNextInterval):void 0}})}),require.register("components/message",function(e,n,r){var o,i,s,a,l,c,u,p,d,h,f,m,g,v,y,b,S,k,w,E,_,x,C,T,M,A,D;D=React.DOM,S=D.div,v=D.article,w=D.header,k=D.footer,A=D.ul,x=D.li,M=D.span,E=D.i,C=D.p,g=D.a,y=D.button,T=D.pre,_=D.iframe,u=n("./message_header"),c=n("./message_footer"),f=n("./toolbar_message"),a=n("./message-content"),l=n("../constants/app_constants").MessageFlags,i=n("../actions/layout_action_creator"),s=n("../actions/message_action_creator"),o=n("../actions/contact_action_creator"),d=n("../mixins/router_mixin"),h=n("../mixins/should_update_mixin"),m=n("../mixins/tooltip_refresher_mixin"),b=React.addons.classSet,p=/:\/\//,r.exports=React.createClass({displayName:"Message",mixins:[d,m,h.UnderscoreEqualitySlow],propTypes:{accounts:React.PropTypes.object.isRequired,active:React.PropTypes.bool,inConversation:React.PropTypes.bool,displayConversations:React.PropTypes.bool,key:React.PropTypes.string.isRequired,mailboxes:React.PropTypes.object.isRequired,message:React.PropTypes.object.isRequired,selectedAccountID:React.PropTypes.string.isRequired,selectedAccountLogin:React.PropTypes.string.isRequired,selectedMailboxID:React.PropTypes.string.isRequired,settings:React.PropTypes.object.isRequired,useIntents:React.PropTypes.bool.isRequired,toggleActive:React.PropTypes.func.isRequired},getInitialState:function(){return{composeAction:"",headers:!1,messageDisplayHTML:this.props.settings.get("messageDisplayHTML"),messageDisplayImages:this.props.settings.get("messageDisplayImages"),currentMessageID:null,prepared:{}}},_prepareMessage:function(e){var n,r,o,i,s,a,c,u,p,d,h,f,m,g;i=[],m=e.get("headers");for(a in m)f=m[a],Array.isArray(f)?i.push(""+a+": "+f.join("\n    ")):i.push(""+a+": "+f);if(p=e.get("text"),s=e.get("html"),n=e.get("alternatives"),h=/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[-;:&=\+\$,\w]+@)?[A-Za-z0-9.-]+|(?:www.|[-;:&=\+\$,\w]+@)[A-Za-z0-9.-]+)((?:\/[\+~%\/.\w-_]*)?\??(?:[-\+=&;%@.\w_]*)#?(?:[\w]*))?)/gim,null==p&&null==s&&(p=(null!=n?n.length:void 0)>0?t("calendar unknown format"):""),null!=p&&null==s&&this.state.messageDisplayHTML)try{s=markdown.toHTML(p.replace(/(^>.*$)([^>]+)/gm,"$1\n$2")),s="<div class='textOnly'>"+s+"</div>"}catch(v){r=v,s="<div class='textOnly'>"+p+"</div>"}return null==s||null!=p||this.state.messageDisplayHTML||(p=toMarkdown(s)),c=e.get("mailboxIDs"),d=null!=(g=this.props.accounts[this.props.selectedAccountID])?g.trashMailbox:void 0,null!=p&&(u=p.replace(h,'<a href="$1" target="_blank">$1</a>'),u=u.replace(/^>>>>>[^>]?.*$/gim,'<span class="quote5">$&</span>'),u=u.replace(/^>>>>[^>]?.*$/gim,'<span class="quote4">$&</span>'),u=u.replace(/^>>>[^>]?.*$/gim,'<span class="quote3">$&</span>'),u=u.replace(/^>>[^>]?.*$/gim,'<span class="quote2">$&</span>'),u=u.replace(/^>[^>]?.*$/gim,'<span class="quote1">$&</span>')),o=this.props.message.get("flags").slice(),{attachments:e.get("attachments"),fullHeaders:i,text:p,rich:u,html:s,isDraft:o.indexOf(l.DRAFT)>-1,isDeleted:null!=c[d]}},componentWillMount:function(){return this._markRead(this.props.message,this.props.active)},componentWillReceiveProps:function(e){var t;return t={},e.message.get("id")!==this.props.message.get("id")&&(this._markRead(e.message,e.active),t.messageDisplayHTML=e.settings.get("messageDisplayHTML"),t.messageDisplayImages=e.settings.get("messageDisplayImages")),this.setState(t)},_markRead:function(e,t){var n,r,o;return r=e.get("id"),this.state.currentMessageID!==r&&(o={currentMessageID:r,prepared:this._prepareMessage(e)},this.setState(o),n=e.get("flags").slice(),t&&-1===n.indexOf(l.SEEN))?setTimeout(function(){return s.mark({messageID:r},l.SEEN)},1):void 0},prepareHTML:function(e){var t,n,r,o,i,s,a,l,c,u,d,h;if(s=!0,a=new DOMParser,e='<html><head>\n    <link rel="stylesheet" href="./fonts/fonts.css" />\n    <link rel="stylesheet" href="./mail_stylesheet.css" />\n    <style>body { visibility: hidden; }</style>\n</head><body>'+e+"</body></html>",t=a.parseFromString(e,"text/html"),o=[],t||(t=document.implementation.createHTMLDocument(""),t.documentElement.innerHTML=e),t||(console.error("Unable to parse HTML content of message"),s=!1),t&&!this.state.messageDisplayImages)for(o=t.querySelectorAll("IMG[src]"),o=Array.prototype.filter.call(o,function(e){return p.test(e.getAttribute("src"))}),l=0,u=o.length;u>l;l++)r=o[l],r.dataset.src=r.getAttribute("src"),r.removeAttribute("src");for(h=t.querySelectorAll("a[href]"),c=0,d=h.length;d>c;c++)i=h[c],i.target="_blank",n=i.getAttribute("href"),""===n||p.test(n)||i.setAttribute("href","http://"+n);return null!=t?this._htmlContent=t.documentElement.innerHTML:this._htmlContent=e,{messageDisplayHTML:s,images:o}},isUnread:function(){return-1===this.props.message.get("flags").indexOf(l.SEEN)},onHeaderClicked:function(){var e;return e=this.props.message.get("id"),this.isUnread()&&!this.props.active&&s.mark({messageID:e},l.SEEN),this.props.toggleActive(e)},render:function(){var e,t,n,r,o,i,s,l;return r=this.props.message,i=this.state.prepared,this.state.messageDisplayHTML&&null!=i.html?(s=this.prepareHTML(i.html),o=s.messageDisplayHTML,t=s.images,n=t.length>0&&!this.state.messageDisplayImages):(o=!1,n=!1),e=b({message:!0,active:this.props.active,isDraft:i.isDraft,isDeleted:i.isDeleted,isUnread:this.isUnread()}),v({className:e,key:this.props.key,"data-id":this.props.message.get("id")},w({onClick:this.onHeaderClicked},u({message:this.props.message,isDraft:this.state.prepared.isDraft,isDeleted:this.state.prepared.isDeleted,active:this.props.active,ref:"header"}),this.props.active?this.renderToolbox():void 0),this.props.active?S({className:"full-headers"},T(null,null!=i&&null!=(l=i.fullHeaders)?l.join("\n"):void 0)):void 0,this.props.active?a({ref:"messageContent",messageID:r.get("id"),messageDisplayHTML:o,html:this._htmlContent,text:i.text,rich:i.rich,imagesWarning:n,displayImages:this.displayImages,displayHTML:this.displayHTML}):void 0,this.props.active?k(null,c({message:this.props.message,ref:"footer"}),this.renderToolbox(!1)):void 0)},renderToolbox:function(e){return null==e&&(e=!0),f({full:e,message:this.props.message,mailboxes:this.props.mailboxes,selectedMailboxID:this.props.selectedMailboxID,inConversation:this.props.inConversation,onDelete:this.onDelete,onHeaders:this.onHeaders,onMove:this.onMove,onMark:this.onMark,onConversationDelete:this.onConversationDelete,onConversationMark:this.onConversationMark,onConversationMove:this.onConversationMove,ref:"toolbarMessage"})},onDelete:function(e){var n,r,o;return e.preventDefault(),e.stopPropagation(),o=this.props.settings.get("messageConfirmDelete"),r=this.props.message.get("id"),n=t("mail confirm delete",{subject:this.props.message.get("subject")}),o?i.displayModal({title:t("app confirm delete"),subtitle:n,closeLabel:t("app cancel"),actionLabel:t("app confirm"),action:function(){return s["delete"]({messageID:r}),i.hideModal()}}):s["delete"]({messageID:r})},onConversationDelete:function(){var e;return e=this.props.message.get("conversationID"),s["delete"]({conversationID:e})},onMark:function(e){var t;return t=this.props.message.get("id"),s.mark({messageID:t},e)},onConversationMark:function(e){var t;return t=this.props.message.get("conversationID"),s.mark({conversationID:t},e)},onMove:function(e){var t,n,r;return n=this.props.message.get("id"),t=this.props.selectedMailboxID,r=this.props.message.get("subject"),s.move({messageID:n},t,e)},onConversationMove:function(e){var t,n,r;return t=this.props.message.get("conversationID"),n=this.props.selectedMailboxID,r=this.props.message.get("subject"),s.move({conversationID:t},n,e)},onCopy:function(e){return i.alertWarning(t("app unimplemented"))},onHeaders:function(e){var t;return e.preventDefault(),t=this.props.message.get("id"),document.querySelector(".conversation [data-id='"+t+"']").classList.toggle("with-headers")},addAddress:function(e){return o.createContact(e)},displayImages:function(e){return e.preventDefault(),this.setState({messageDisplayImages:!0})},displayHTML:function(e){return null==e&&(e=!0),this.setState({messageDisplayHTML:e})}})}),require.register("components/message_footer",function(e,t,n){var r,o,i,s,a,l,c,u,p;p=React.DOM,s=p.div,c=p.span,u=p.ul,l=p.li,i=p.a,a=p.i,o=t("../utils/message_utils"),r=t("./attachement_preview"),n.exports=React.createClass({displayName:"MessageFooter",propTypes:{message:React.PropTypes.object.isRequired},render:function(){return s({className:"attachments"},this.renderAttachments())},renderAttachments:function(){var e,t,n,i;return e=(null!=(i=this.props.message.get("attachments"))?i.toJS():void 0)||[],e.length?(n=_.groupBy(e,function(e){return"image"===o.getAttachmentType(e.contentType)?"preview":"binary"}),u({className:null},function(){var e,o,i,s;if(n.preview){for(i=n.preview,s=[],e=0,o=i.length;o>e;e++)t=i[e],s.push(r({ref:"attachmentPreview",file:t,key:t.checksum,
preview:!0,previewLink:!0}));return s}}(),function(){var e,o,i,s;if(n.binary){for(i=n.binary,s=[],e=0,o=i.length;o>e;e++)t=i[e],s.push(r({ref:"attachmentPreview",file:t,key:t.checksum,preview:!1,previewLink:!0}));return s}}())):void 0}})}),require.register("components/message_header",function(e,n,r){var o,i,s,a,l,c,u,p,d,h,f,m=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},g=[].slice;f=React.DOM,c=f.div,h=f.span,u=f.i,p=f.img,l=f.a,o=n("../constants/app_constants").MessageFlags,a=n("./popup_message_details"),s=n("./popup_message_attachments"),i=n("../mixins/participant_mixin"),d=n("../utils/message_utils"),r.exports=React.createClass({displayName:"MessageHeader",propTypes:{message:React.PropTypes.object.isRequired,isDraft:React.PropTypes.bool,isDeleted:React.PropTypes.bool},mixins:[i],shouldComponentUpdate:function(e,t){var n;return n=!_.isEqual(e,this.props)},render:function(){var e,n;return e=d.getAvatar(this.props.message),c({key:"message-header-"+this.props.message.get("id")},e?c({className:"sender-avatar"},p({className:"media-object",src:e})):void 0,c({className:"infos"},this.renderAddress("from"),this.props.active?this.renderAddress("to"):void 0,this.props.active?this.renderAddress("cc"):void 0,c({className:"metas indicators"},this.props.message.get("attachments").length?s({message:this.props.message}):void 0,this.props.active?(n=o.FLAGGED,m.call(this.props.message.get("flags"),n)>=0?u({className:"fa fa-star"}):void 0,this.props.isDraft?l({href:"#edit/"+this.props.message.get("id")},u({className:"fa fa-edit"}),h(null,t("edit draft"))):void 0,this.props.isDeleted?u({className:"fa fa-trash"}):void 0):void 0),c({className:"metas date"},d.formatDate(this.props.message.get("createdAt"))),a({message:this.props.message})))},renderAddress:function(e){var n;return n=this.props.message.get(e),n.length?c({className:"addresses "+e,key:"address-"+e},c.apply(null,[{className:"addresses-wrapper"},"from"!==e?h(null,t("mail "+e)):void 0].concat(g.call(this.formatUsers(n))))):void 0}})}),require.register("components/modal",function(e,n,r){var o;r.exports=o=React.createClass({displayName:"Modal",render:function(){var e;return e="",this.props.content||(e="no-content"),React.DOM.div({className:"modal fade in",role:"dialog",style:{display:"block"}},React.DOM.div({className:"modal-dialog"},React.DOM.div({className:"modal-content"},null!=this.props.title?React.DOM.div({className:"modal-header"},null!=this.props.closeLabel?React.DOM.button({type:"button",className:"close",onClick:this.props.closeModal},React.DOM.i({className:"fa fa-times"})):void 0,React.DOM.h4({className:"modal-title"},this.props.title)):void 0,React.DOM.div({className:"modal-body "+e},null!=this.props.subtitle?React.DOM.span(null,this.props.subtitle):void 0,null!=this.props.content?React.DOM.div({ref:"content"},this.props.content):void 0),React.DOM.div({className:"modal-footer"},this.props.allowCopy?React.DOM.button({type:"button",className:"btn btn-cozy modal-copy",onClick:this.copyContent},t("modal copy content")):void 0,null!=this.props.actionLabel&&this.props.action?React.DOM.button({type:"button",className:"btn btn-cozy modal-action",onClick:this.props.action},this.props.actionLabel):void 0,null!=this.props.closeLabel?React.DOM.button({type:"button",className:"btn btn-cozy-non-default modal-close",onClick:this.props.closeModal},this.props.closeLabel):void 0))))},copyContent:function(){var e,t,n;return t=window.getSelection(),t.rangeCount>0&&t.removeAllRanges(),e=document.createRange(),e.selectNode(null!=(n=this.refs.content)?n.getDOMNode():void 0),t.addRange(e),document.execCommand("copy")}})}),require.register("components/panel",function(e,n,r){var o,i,s,a,l,c,u,p,d,h,f,m,g,v,y,b,S,k,w,E=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};o=n("./account_config"),s=n("./compose"),l=n("./conversation"),p=n("./message-list"),v=n("./settings"),m=n("./search_result"),b=n("./basic_components").Spinner,f=n("../mixins/router_mixin"),S=n("../mixins/store_watch_mixin"),k=n("../mixins/tooltip_refresher_mixin"),i=n("../stores/account_store"),d=n("../stores/message_store"),g=n("../stores/search_store"),y=n("../stores/settings_store"),c=n("../actions/message_action_creator"),w=n("../constants/app_constants"),a=w.ComposeActions,u=w.MessageFilter,r.exports=h=React.createClass({displayName:"Panel",mixins:[S([i,d,y,g]),k,f],shouldComponentUpdate:function(e,t){var n;return n=!_.isEqual(t,this.state)||!_.isEqual(e,this.props)},render:function(){var e,t;return"account.mailbox.messages"===this.props.action?this.renderList():"search"===this.props.action?(t=encodeURIComponent(g.getCurrentSearch()),m({key:"search-"+t})):"account.config"===this.props.action||"account.new"===this.props.action?(e=this.props.accountID||"new",o({key:"account-config-"+e,tab:this.props.tab})):"message"===this.props.action||"conversation"===this.props.action?l({messageID:this.props.messageID,key:"conversation-"+this.props.messageID,ref:"conversation"}):"compose"===this.props.action||"edit"===this.props.action||"compose.reply"===this.props.action||"compose.reply-all"===this.props.action||"compose.forward"===this.props.action?this.renderCompose():"settings"===this.props.action?v({key:"settings",ref:"settings",settings:this.state.settings}):(console.error("Unknown action "+this.props.action),window.cozyMails.logInfo("Unknown action "+this.props.action),React.DOM.div(null,"Unknown component "+this.props.action))},renderList:function(){var e,n,r,o,s,a,l,h,f,m,g,v,y,b,S;return n=this.props.accountID,m=this.props.mailboxID,e=i.getByID(n),null==e?(setTimeout(function(e){return function(){return e.redirect({direction:"first",action:"default"})}}(this),1),React.DOM.div(null,"redirecting")):(f=e.get("mailboxes").get(m),g=d.getMessagesToDisplay(m,this.state.settings.get("displayConversation")),v=(null!=f?f.get("nbTotal"):void 0)||0,l=function(){switch(this.state.queryParams.filter){case u.FLAGGED:return t("no flagged message");case u.UNSEEN:return t("no unseen message");case u.ALL:return t("list empty");default:return t("no filter message")}}.call(this),this.state.settings.get("displayConversation")&&(o=this.state.currentConversationID,null==o&&g.length>0&&(o=g.first().get("conversationID")),s=d.getConversationsLength()),r=[null!=(y=this.state.selectedAccount)?y.get("trashMailbox"):void 0,null!=(b=this.state.selectedAccount)?b.get("draftMailbox"):void 0,null!=(S=this.state.selectedAccount)?S.get("junkMailbox"):void 0],a=E.call(r,m)>=0?!1:this.state.settings.get("displayConversation"),h=r[0]===m,p({key:"messageList-"+m,messages:g,accountID:n,mailboxID:m,messageID:this.state.currentMessageID,conversationID:o,login:null!=e?e.get("login"):void 0,accounts:this.state.accounts,mailboxes:this.state.mailboxes,settings:this.state.settings,fetching:this.state.fetching,refresh:this.state.refresh,isTrash:h,conversationLengths:s,emptyListMessage:l,ref:"messageList",displayConversations:a,queryParams:this.state.queryParams,canLoadMore:this.state.queryParams.hasNextPage,loadMoreMessage:function(){return c.fetchMoreOfCurrentQuery()}}))},renderCompose:function(){var e,t,n;if(n={layout:"full",action:null,inReplyTo:null,settings:this.state.settings,accounts:this.state.accounts,selectedAccountID:this.state.selectedAccount.get("id"),selectedAccountLogin:this.state.selectedAccount.get("login"),selectedMailboxID:this.props.selectedMailboxID,useIntents:this.props.useIntents,ref:"compose"},e=null,"compose"===this.props.action)t=null,e=s(n);else if("edit"===this.props.action)n.message=d.getByID(this.props.messageID),e=s(n);else if("compose.reply"===this.props.action)n.action=a.REPLY,e=this.getReplyComponent(n);else if("compose.reply-all"===this.props.action)n.action=a.REPLY_ALL,e=this.getReplyComponent(n);else{if("compose.forward"!==this.props.action)throw new Error("unknown compose type : "+this.prop.action);n.action=a.FORWARD,e=this.getReplyComponent(n)}return e},getReplyComponent:function(e){var t,n;return n=d.getByID(this.props.messageID),this.state.isLoadingReply&&null==n?t=b():(n=d.getByID(this.props.messageID),n.set("id",this.props.messageID),e.inReplyTo=n,t=s(e)),t},getStateFromStores:function(){return{accounts:i.getAll(),mailboxes:i.getAllMailboxes(),selectedAccount:i.getSelectedOrDefault(),favoriteMailboxes:i.getSelectedFavorites(),selectedMailboxes:i.getSelectedMailboxes(!0),allMailboxes:i.getAllMailboxes(),accountWaiting:i.isWaiting(),fetching:d.isFetching(),queryParams:d.getQueryParams(),currentMessageID:d.getCurrentID(),conversation:d.getCurrentConversation(),currentConversationID:d.getCurrentConversationID(),settings:y.get(),isLoadingReply:null==d.getByID(this.props.messageID),refresh:i.getMailboxRefresh(this.props.mailboxID)}}})}),require.register("components/participant",function(e,t,n){var r,o,i,s,a,l,c,u=[].slice;c=React.DOM,l=c.span,s=c.a,a=c.i,r=t("../utils/message_utils"),o=React.createClass({displayName:"Participant",render:function(){var e;return e=r.displayAddress(this.props.address),null==this.props.address?l(null):l.apply(null,[{className:"address-item","data-toggle":"tooltip",ref:"participant",title:this.props.address.address,key:this.props.key}].concat(u.call(r.highlightSearch(e))))},_initTooltip:function(){return this.props.tooltip&&null!=this.refs.participant?r.tooltip(this.refs.participant.getDOMNode(),this.props.address,this.props.onAdd):void 0},componentDidMount:function(){return this._initTooltip()},componentDidUpdate:function(){return this._initTooltip()}}),i=React.createClass({displayName:"Participants",render:function(){var e,t;return l({className:"address-list"},function(){var n,r,i,s;if(this.props.participants){for(i=this.props.participants,s=[],t=n=0,r=i.length;r>n;t=++n)e=i[t],s.push(l({key:t,className:null},o({key:t,address:e,onAdd:this.props.onAdd,tooltip:this.props.tooltip}),t<this.props.participants.length-1?l(null,", "):void 0));return s}}.call(this))}}),n.exports=i}),require.register("components/popup_message_attachments",function(e,t,n){var r,o,i,s,a,l;l=React.DOM,i=l.div,a=l.ul,s=l.i,o=t("../constants/app_constants").Tooltips,r=t("./attachement_preview"),n.exports=React.createClass({displayName:"MessageAttachmentsPopup",mixins:[OnClickOutside],getInitialState:function(){return{showAttachements:!1}},toggleAttachments:function(){return this.setState({showAttachements:!this.state.showAttachements})},handleClickOutside:function(){return this.setState({showAttachements:!1})},render:function(){var e,t,n;return e=(null!=(n=this.props.message.get("attachments"))?n.toJS():void 0)||[],i({className:"attachments","aria-expanded":this.state.showAttachements,onClick:function(e){return e.stopPropagation()}},s({className:"btn fa fa-paperclip",onClick:this.toggleAttachments,"aria-describedby":o.OPEN_ATTACHMENTS,"data-tooltip-direction":"left"}),i({className:"popup","aria-hidden":!this.state.showAttachements},a({className:null},function(){var n,o,i;for(i=[],n=0,o=e.length;o>n;n++)t=e[n],i.push(r({ref:"attachmentPreview",file:t,key:t.checksum,preview:!1}));return i}())))}})}),require.register("components/popup_message_details",function(e,n,r){var o,i,s,a,l,c,u,p,d=[].slice;p=React.DOM,i=p.div,a=p.table,l=p.tbody,u=p.tr,c=p.td,s=p.i,o=n("../mixins/participant_mixin"),r.exports=React.createClass({displayName:"PopupMessageDetails",mixins:[o,OnClickOutside],getInitialState:function(){return{showDetails:!1}},toggleDetails:function(){return this.setState({showDetails:!this.state.showDetails})},handleClickOutside:function(){return this.setState({showDetails:!1})},render:function(){var e,n,r,o,p,h,f,m;return r=this.props.message.get("from")[0],f=this.props.message.get("to"),e=this.props.message.get("cc"),p=null!=(m=this.props.message.get("reply-to"))?m[0]:void 0,h=function(e,n,r,o){var i,s;return null==r&&(r=!1),null==o&&(o=!1),s=[],r&&(i={className:"label"},o&&(i.rowSpan=o),s.push(c(i,t(r)))),s.push(c({key:"cell-"+e},n)),u.apply(null,[{key:"row-"+e}].concat(d.call(s)))},i({className:"metas details","aria-expanded":this.state.showDetails,onClick:function(e){return e.stopPropagation()}},s({className:"fa fa-caret-down",onClick:this.toggleDetails}),this.state.showDetails?i({className:"popup","aria-hidden":!this.state.showDetails},a(null,l(null,h("from",this.formatUsers(r),"headers from"),f.length?h("to",this.formatUsers(f[0]),"headers to",f.length):void 0,function(){var e,t,r,i;if(f.length){for(r=f.slice(1),i=[],o=e=0,t=r.length;t>e;o=++e)n=r[o],i.push(h("destTo"+o,this.formatUsers(n)));return i}}.call(this),e.length?h("cc",this.formatUsers(e[0]),"headers cc",e.length):void 0,function(){var t,r,i,s;if(e.length){for(i=e.slice(1),s=[],o=t=0,r=i.length;r>t;o=++t)n=i[o],s.push(h("destCc"+o,this.formatUsers(n)));return s}}.call(this),null!=p?h("reply",this.formatUsers(p),"headers reply-to"):void 0,h("created",this.props.message.get("createdAt"),"headers date")))):void 0)}})}),require.register("components/search_bar",function(e,n,r){var o,i,s,a,l,c,u,p,d,h,f,m,g;g=React.DOM,f=g.div,h=g.button,m=g.i,u=n("./search_input"),i=n("./account_picker"),c=n("../mixins/router_mixin"),l=n("../actions/layout_action_creator"),d=n("../mixins/store_watch_mixin"),s=n("../stores/account_store"),p=n("../stores/search_store"),o=n("../actions/account_action_creator"),r.exports=a=React.createClass({displayName:"GlobalSearchBar",mixins:[c,d([s,p])],render:function(){return f({className:"search-bar"},m({className:"fa fa-search"}),i({accounts:this.state.accounts,valueLink:{value:this.state.accountID||"all",requestChange:this.onAccountChanged}}),u({value:this.state.search||"",placeholder:t("filters search placeholder"),onSubmit:this.onSearchTriggered}))},onSearchTriggered:function(e){var t;return""!==e?this.redirect({direction:"first",action:"search",parameters:[this.state.accountID,e]}):(this.setState({search:""}),t=this.state.accountID,"all"===this.state.accountID&&(t=null),this.redirect({direction:"first",action:"account.mailbox.messages",parameters:[t]}))},onAccountChanged:function(e){var t,n;return t=null!=(n=s.getSelected())?n.get("id"):void 0,""!==this.state.search?this.redirect({direction:"first",action:"search",parameters:[e,this.state.search]}):"all"!==e&&e!==t?this.redirect({direction:"first",action:"account.mailbox.messages",parameters:[e]}):this.setState({accountID:e})},getStateFromStores:function(){var e,n,r,o;return n=s.getAll().map(function(e){return e.get("label")}).toOrderedMap().set("all",t("search all accounts")),e=(null!=(o=s.getSelected())?o.get("id"):void 0)||"all",r=p.getCurrentSearch(),{accounts:n,search:r,accountID:e}}})}),require.register("components/search_input",function(e,t,n){var r,o,i,s;s=React.DOM,o=s.div,i=s.input,r=s.button,n.exports=React.createClass({displayName:"SearchInput",getInitialState:function(){return{value:this.props.value}},componentWillReceiveProps:function(e){return this.setState({value:e.value})},onChange:function(e){return this.setState({value:e.target.value})},onKeyUp:function(e){return this.setState({value:e.target.value}),"Enter"===e.key&&(null!=e&&e.preventDefault(),null!=e&&e.stopPropagation(),this.props.onSubmit(e.target.value)),"Escape"===e.key?this.onResetClick():void 0},onCheckClick:function(e){return null!=e&&"function"==typeof e.preventDefault&&e.preventDefault(),null!=e&&"function"==typeof e.stopPropagation&&e.stopPropagation(),this.props.onSubmit(this.state.value)},onResetClick:function(e){return this.setState({value:""}),null!=e&&"function"==typeof e.preventDefault&&e.preventDefault(),null!=e&&"function"==typeof e.stopPropagation&&e.stopPropagation(),this.props.onSubmit("")},render:function(){return o({role:"search"},i({type:"text",placeholder:this.props.placeholder,value:this.state.value,onChange:this.onChange,onKeyUp:this.onKeyUp,name:"searchterm"}),0!==this.state.value.length?o({className:"btn-group"},r({className:"btn fa fa-check",onClick:this.onCheckClick}),r({className:"btn fa fa-close",onClick:this.onResetClick})):void 0)}})}),require.register("components/search_result",function(e,n,r){var o,i,s,a,l,c,u,p;s=n("./message-list"),i=n("../actions/message_action_creator"),u=n("../mixins/store_watch_mixin"),a=n("../stores/message_store"),o=n("../stores/account_store"),l=n("../stores/search_store"),c=n("../stores/settings_store"),p=React.DOM.div,r.exports=React.createClass({displayName:"searchResults",mixins:[u([o,l])],getStateFromStores:function(){var e,n,r;return n=l.getCurrentSearch(),e=l.getCurrentSearchAccountID(),"all"===e&&(e=null),r={currentSearchKey:l.getCurrentSearchKey(),currentSearchResults:l.getCurrentSearchResults(),conversationLengths:a.getConversationsLength(),settings:c.get(),accountID:e,currentMessageID:a.getCurrentID(),currentConversationID:a.getCurrentConversationID(),accounts:o.getAll(),mailboxes:o.getAllMailboxes(),displayConversations:!0,canLoadMore:l.hasMoreSearch(),emptyListMessage:t("list search empty",{query:n})}},render:function(){return s({noFilters:!0,messages:this.state.currentSearchResults,accountID:this.state.accountID,messageID:this.state.currentMessageID,conversationID:this.state.currentConversationID,accounts:this.state.accounts,mailboxes:this.state.mailboxes,settings:this.state.settings,conversationLengths:this.state.conversationLengths,emptyListMessage:this.state.emptyListMessage,displayConversations:this.state.displayConversations,queryParams:null,canLoadMore:this.state.canLoadMore,loadMoreMessage:function(){return i.fetchSearchResults()}})}})}),require.register("components/settings",function(e,n,r){var o,i,s,a,l,c,u,p,d,h,f,m,g,v,y,b,S,k,w,E,_={}.hasOwnProperty;E=React.DOM,d=E.div,m=E.h3,f=E.form,y=E.label,v=E.input,u=E.button,h=E.fieldset,b=E.legend,w=E.ul,S=E.li,c=E.a,k=E.span,g=E.i,p=React.addons.classSet,s=n("../actions/layout_action_creator"),l=n("../actions/settings_action_creator"),a=n("../utils/plugin_utils"),o=n("../utils/api_utils"),i=n("../constants/app_constants").Dispositions,r.exports=React.createClass({displayName:"Settings",render:function(){var e,n,r,o,s,a;return n="col-sm-5 col-sm-offset-1 control-label",e="col-sm-6",r=this.state.settings.layoutStyle||"vertical",o=this.state.settings.listStyle||"default",d({id:"settings"},m({className:null},t("settings title")),this.props.error?d({className:"error"},this.props.error):void 0,f({className:"form-horizontal"},d({className:"form-group"},y({htmlFor:"settings-layoutStyle",className:n},t("settings label layoutStyle")),d({className:e},d({className:"dropdown"},u({id:"settings-layoutStyle",className:"btn btn-default dropdown-toggle",type:"button","data-toggle":"dropdown"},t("settings label layoutStyle "+r)),w({className:"dropdown-menu",role:"menu"},S({role:"presentation","data-target":"layoutStyle","data-style":i.VERTICAL,onClick:this.handleChange},c({role:"menuitem"},t("settings label layoutStyle vertical"))),S({role:"presentation","data-target":"layoutStyle","data-style":i.HORIZONTAL,onClick:this.handleChange},c({role:"menuitem"},t("settings label layoutStyle horizontal"))),S({role:"presentation","data-target":"layoutStyle","data-style":i.THREE,onClick:this.handleChange},c({role:"menuitem"},t("settings label layoutStyle three"))))))),d({className:"form-group"},y({htmlFor:"settings-listStyle",className:n},t("settings label listStyle")),d({className:e},d({className:"dropdown"},u({id:"settings-listStyle",className:"btn btn-default dropdown-toggle",type:"button","data-toggle":"dropdown"},t("settings label listStyle "+o)),w({className:"dropdown-menu",role:"menu"},S({role:"presentation","data-target":"listStyle","data-style":"default",onClick:this.handleChange},c({role:"menuitem"},t("settings label listStyle default"))),S({role:"presentation","data-target":"listStyle","data-style":"compact",onClick:this.handleChange},c({role:"menuitem"},t("settings label listStyle compact")))))))),this._renderOption("displayConversation"),this._renderOption("composeInHTML"),this._renderOption("composeOnTop"),this._renderOption("messageDisplayHTML"),this._renderOption("messageDisplayImages"),this._renderOption("messageConfirmDelete"),this._renderOption("displayPreview"),this._renderOption("desktopNotifications"),this._renderOption("autosaveDraft"),h(null,b(null,t("settings plugins")),function(){var e,r;e=this.state.settings.plugins,r=[];for(a in e)_.call(e,a)&&(s=e[a],r.push(f({className:"form-horizontal",key:a},d({className:"form-group"},y({className:n,htmlFor:"settings-plugin-"+a},t("plugin name "+s.name,{_:s.name})),d({className:"col-sm-1"},null!=s.url?k({className:"clickable",onClick:this.pluginDel,"data-plugin":a,title:t("settings plugin del")},g({className:"fa fa-trash-o"})):v({id:"settings-plugin-"+a,checked:s.active,onChange:this.handleChange,"data-target":"plugin","data-plugin":a,type:"checkbox"})),window.plugins[a].onHelp?d({className:"col-sm-1 plugin-help"},k({className:"clickable",onClick:this.pluginHelp,"data-plugin":a,title:t("settings plugin help")},g({className:"fa fa-question-circle"}))):void 0))));return r}.call(this),f({className:"form-horizontal",key:a},d({className:"form-group"},d({className:"col-xs-4"},v({id:"newpluginName",name:"newpluginName",ref:"newpluginName",type:"text",className:"form-control",placeholder:t("settings plugin new name")})),d({className:"col-xs-6"},v({id:"newpluginUrl",name:"newpluginUrl",ref:"newpluginUrl",type:"text",className:"form-control",placeholder:t("settings plugin new url")})),k({className:"col-xs-1 clickable",onClick:this.pluginAdd,title:t("settings plugin add")},g({className:"fa fa-plus"}))))))},_renderOption:function(e){var n,r;return r="col-sm-5 col-sm-offset-1 control-label",n="col-sm-6",f({className:"form-horizontal"},d({className:"form-group"},y({htmlFor:"settings-"+e,className:r},t("settings label "+e)),d({className:n},v({id:"settings-"+e,checked:this.state.settings[e],onChange:this.handleChange,"data-target":e,type:"checkbox"}))))},handleChange:function(e){var t,n,r,o,i,c;switch(e.preventDefault(),i=e.currentTarget,i.dataset.target){case"autosaveDraft":case"composeInHTML":case"composeOnTop":case"desktopNotifications":case"displayConversation":case"displayPreview":case"messageConfirmDelete":case"messageDisplayHTML":case"messageDisplayImages":if(o=this.state.settings,o[i.dataset.target]=i.checked,this.setState({settings:o}),l.edit(o),null!=window.Notification&&o.desktopNotifications)return Notification.requestPermission(function(e){return Notification.permission!==e?Notification.permission=e:void 0});break;case"layoutStyle":return o=this.state.settings,o.layoutStyle=i.dataset.style,s.setDisposition(o.layoutStyle),this.setState({settings:o}),l.edit(o);case"listStyle":return o=this.state.settings,o.listStyle=i.dataset.style,this.setState({settings:o}),l.edit(o);case"plugin":t=i.dataset.plugin,o=this.state.settings,i.checked?a.activate(t):a.deactivate(t),c=o.plugins;for(r in c)_.call(c,r)&&(n=c[r],n.active=window.plugins[r].active);return this.setState({settings:o}),l.edit(o)}},pluginAdd:function(){var e,t;return e=this.refs.newpluginName.getDOMNode().value.trim(),t=this.refs.newpluginUrl.getDOMNode().value.trim(),a.loadJS(t,function(n){return function(){var r;return a.activate(e),r=n.state.settings,r.plugins[e]={name:e,active:!0,url:t},n.setState({settings:r}),l.edit(r)}}(this))},pluginDel:function(e){var t,n,r;return e.preventDefault(),r=e.currentTarget,t=r.dataset.plugin,n=this.state.settings,a.deactivate(t),delete n.plugins[t],this.setState({settings:n}),l.edit(n)},pluginHelp:function(e){var t,n;return e.preventDefault(),n=e.currentTarget,t=n.dataset.plugin,window.plugins[t].onHelp()},registerMailto:function(){var e;return e=window.location,window.navigator.registerProtocolHandler("mailto",""+e.origin+e.pathname+"#compose?mailto=%s","Cozy")},getInitialState:function(e){var t;return t=this.props.settings.toObject(),{settings:this.props.settings.toObject()}}})}),require.register("components/toast",function(e,n,r){var o,i,s,a,l,c,u,p,d,h,f,m,g,v,y,b,S,k,w,E;w=React.DOM,h=w.a,v=w.h4,b=w.pre,g=w.div,f=w.button,S=w.span,k=w.strong,y=w.i,u=n("../utils/socketio_utils"),s=n("../app_dispatcher"),p=n("../mixins/store_watch_mixin"),c=n("../stores/layout_store"),l=n("../actions/layout_action_creator"),E=n("../constants/app_constants"),o=E.ActionTypes,i=E.AlertLevel,a=React.addons.CSSTransitionGroup,m=React.addons.classSet,r.exports=d=React.createClass({displayName:"Toast",render:function(){var e,n,r,o,s;return o=this.props.toast.toJS(),r=null!=(s=o.errors)?s.length:void 0,n=m({toast:!0,"alert-dismissible":o.finished,"toast-error":o.level===i.ERROR}),g({className:n,role:"alert",key:this.props.key},o.message?g({className:"message"},o.message):void 0,o.finished||r?f({type:"button",className:"close",onClick:this.acknowledge},S({"aria-hidden":"true"},"×"),S({className:"sr-only"},t("app alert close"))):void 0,null!=o.actions?(e="btn btn-cancel btn-cozy-non-default btn-xs",g({className:"toast-actions"},o.actions.map(function(t,n){return f({className:e,type:"button",key:n,onClick:t.onClick},t.label)}))):void 0,r?(e="btn btn-cancel btn-cozy-non-default btn-xs",g({className:"toast-actions"},f({className:e,type:"button",key:"errors",onClick:this.onModalShowClicked},t("there were errors",{smart_count:o.errors.length})))):void 0)},onModalShowClicked:function(){var e;return e=JSON.stringify(this.props.toast.get("errors")[0]),l.displayModal({title:t("modal please contribute"),subtitle:t("modal please report"),closeLabel:t("app alert close"),content:b({style:{"max-height":"300px","word-wrap":"normal"}},e)})},acknowledge:function(){return s.handleViewAction({type:o.RECEIVE_TASK_DELETE,value:this.props.toast.get("id")})}})}),require.register("components/toast_container",function(e,t,n){var r,o,i,s,a,l,c,u;u=React.DOM.div,a=t("./toast"),s=t("../mixins/store_watch_mixin"),i=t("../stores/layout_store"),o=t("../actions/layout_action_creator"),r=React.addons.CSSTransitionGroup,c=React.addons.classSet,n.exports=l=React.createClass({displayName:"ToastContainer",mixins:[s([i])],getStateFromStores:function(){return{toasts:i.getToasts(),hidden:!i.isShown()}},shouldComponentUpdate:function(e,t){var n,r;return r=_.isEqual(t,this.state),n=_.isEqual(e,this.props),!(r&&n)},render:function(){var e,t;return t=this.state.toasts.map(function(e,t){return a({toast:e,key:t})}).toVector().toJS(),e=c({"toasts-container":!0,"action-hidden":this.state.hidden,"has-toasts":0!==t.length}),u({className:e},r({transitionName:"toast"},t))},toggleHidden:function(){return this.state.hidden?o.toastsShow():o.toastsHide()},_clearToasts:function(){return setTimeout(function(){var e;return e=document.querySelectorAll(".toast-enter"),Array.prototype.forEach.call(e,function(e){return e.classList.add("hidden")})},1e4)},closeAll:function(){return o.clearToasts()},componentDidMount:function(){return this._clearToasts()},componentDidUpdate:function(){return this._clearToasts()}})}),require.register("components/toolbar_conversation",function(e,t,n){var r,o,i,s,a,l,c,u,p,d,h;h=React.DOM,d=h.nav,p=h.div,c=h.button,l=h.a,a=t("../constants/app_constants").Tooltips,u=React.addons.classSet,o=t("../stores/layout_store"),r=t("../actions/layout_action_creator"),i=t("../mixins/router_mixin"),s=t("../mixins/store_watch_mixin"),n.exports=React.createClass({displayName:"ToolbarConversation",mixins:[i,s([o])],propTypes:{nextMessageID:React.PropTypes.string,nextConversationID:React.PropTypes.string,prevMessageID:React.PropTypes.string,prevConversationID:React.PropTypes.string,settings:React.PropTypes.object.isRequired},getStateFromStores:function(){return{fullscreen:o.isPreviewFullscreen()}},getUrlParams:function(e,t){var n,r,o;return this.props.settings.get(null!=t)?(n="conversation",r={messageID:e,conversationID:t}):(n="message",r={messageID:e}),o={direction:"second",action:n,parameters:r}},render:function(){return d({className:"toolbar toolbar-conversation btn-toolbar"},p({className:"btn-group"},this.renderNav("prev"),this.renderNav("next")),this.renderFullscreen())},renderNav:function(e){var t,n,r,o,i;if(null!=this.props[""+e+"MessageID"])return r=this.props[""+e+"MessageID"],n=this.props[""+e+"ConversationID"],"prev"===e?(o=a.PREVIOUS_CONVERSATION,t="left"):(o=a.NEXT_CONVERSATION,t="right"),i=this.getUrlParams(r,n),l({className:"btn btn-default fa fa-chevron-"+t,onClick:function(e){return function(){return e.redirect(i)}}(this),href:this.buildUrl(i),"aria-describedby":o,"data-tooltip-direction":"left"})},renderFullscreen:function(){return c({onClick:r.toggleFullscreen,className:u({clickable:!0,btn:!0,"btn-default":!0,fa:!0,fullscreen:!0,"fa-compress":this.state.fullscreen,"fa-expand":!this.state.fullscreen})})}})}),require.register("components/toolbar_message",function(e,t,n){var r,o,i,s,a,l,c,u,p,d,h,f,m,g,v,y,b=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};v=React.DOM,g=v.nav,m=v.div,d=v.button,c=v.a,y=t("../constants/app_constants"),i=y.MessageFlags,r=y.FlagsConstants,l=y.Tooltips,s=t("./toolbox_actions"),a=t("./toolbox_move"),o=t("../actions/layout_action_creator"),u=o.alertError,p=o.notify,f="btn-group btn-group-sm pull-right",h="btn btn-default fa",n.exports=React.createClass({displayName:"ToolbarMessage",propTypes:{message:React.PropTypes.object.isRequired,mailboxes:React.PropTypes.object.isRequired,selectedMailboxID:React.PropTypes.string.isRequired,onDelete:React.PropTypes.func.isRequired,onMove:React.PropTypes.func.isRequired,onHeaders:React.PropTypes.func.isRequired},render:function(){return g({className:"toolbar toolbar-message btn-toolbar",onClick:function(e){return e.stopPropagation()}},this.props.full?m({className:f},this.renderToolboxMove(),this.renderToolboxActions()):void 0,this.props.full?this.renderQuickActions():void 0,this.renderReply())},renderReply:function(){return m({className:f},c({className:""+h+" fa-mail-reply mail-reply",href:"#reply/"+this.props.message.get("id"),"aria-describedby":l.REPLY,"data-tooltip-direction":"top"}),c({className:""+h+" fa-mail-reply-all mail-reply-all",href:"#reply-all/"+this.props.message.get("id"),"aria-describedby":l.REPLY_ALL,"data-tooltip-direction":"top"}),c({className:""+h+" fa-mail-forward mail-forward",href:"#forward/"+this.props.message.get("id"),"aria-describedby":l.FORWARD,"data-tooltip-direction":"top"}))},renderQuickActions:function(){return m({className:f},d({className:""+h+" fa-trash",onClick:this.props.onDelete,"aria-describedby":l.REMOVE_MESSAGE,"data-tooltip-direction":"top"}))},renderToolboxActions:function(){var e,t,n,o,i;return e=this.props.message.get("flags")||[],o=r.FLAGGED,t=b.call(e,o)>=0,i=r.SEEN,n=b.call(e,i)>=0,s({ref:"toolboxActions",mailboxes:this.props.mailboxes,inConversation:this.props.inConversation,isSeen:n,isFlagged:t,messageID:this.props.message.get("id"),message:this.props.message,onMark:this.props.onMark,onHeaders:this.props.onHeaders,onConversationMark:this.props.onConversationMark,onConversationMove:this.props.onConversationMove,onConversationDelete:this.props.onConversationMove,direction:"right",displayConversations:!1})},renderToolboxMove:function(){return a({ref:"toolboxMove",mailboxes:this.props.mailboxes,onMove:this.props.onMove,direction:"right"})}})}),require.register("components/toolbar_messageslist",function(e,n,r){var o,i,s,a,l,c,u,p,d,h,f;f=React.DOM,u=f.aside,h=f.i,p=f.button,d=React.addons.classSet,i=n("./toolbar_messageslist_filters"),o=n("./toolbar_messageslist_actions"),l=n("./search_bar"),s=n("../actions/layout_action_creator"),a=n("../mixins/router_mixin"),r.exports=c=React.createClass({displayName:"ToolbarMessagesList",mixins:[a],propTypes:{settings:React.PropTypes.object.isRequired,accountID:React.PropTypes.string.isRequired,mailboxID:React.PropTypes.string.isRequired,mailboxes:React.PropTypes.object.isRequired,messages:React.PropTypes.object.isRequired,edited:React.PropTypes.bool.isRequired,selected:React.PropTypes.object.isRequired,allSelected:React.PropTypes.bool.isRequired,displayConversations:React.PropTypes.bool.isRequired,toggleEdited:React.PropTypes.func.isRequired,toggleAll:React.PropTypes.func.isRequired,afterAction:React.PropTypes.func
},onFilterChange:function(e){var t,n,r,o,i,s,a,l;switch(s="-",i="date",n="-",t="-",r="-",a=e.type,o=s+i,a){case"from":case"dest":e.value&&(n=e.value,t=""+e.value+"￿");break;case"date":e.range&&(l=e.range,n=l[0],t=l[1]);break;case"flag":e.value&&(r=e.value)}return window.cozyMails.messageClose(),this.redirect({direction:"first",action:"account.mailbox.messages",parameters:[this.props.accountID,this.props.mailboxID,o,a,r,n,t]})},render:function(){return u({role:"toolbar"},p({className:"drawer-toggle",onClick:s.drawerToggle,title:t("menu toggle")},h({className:"fa fa-navicon"})),p({role:"menuitem","aria-selected":this.props.edited,onClick:this.props.toggleAll},h({className:d({fa:!0,"fa-square-o":!this.props.edited,"fa-check-square-o":this.props.allSelected,"fa-minus-square-o":this.props.edited&&!this.props.allSelected})})),this.props.edited?o({settings:this.props.settings,mailboxID:this.props.mailboxID,mailboxes:this.props.mailboxes,messages:this.props.messages,selected:this.props.selected,displayConversations:this.props.displayConversations,afterAction:this.props.afterAction}):this.props.noFilters?void 0:i({accountID:this.props.accountID,mailboxID:this.props.mailboxID,queryParams:this.props.queryParams,onFilterChange:this.onFilterChange}),l())}})}),require.register("components/toolbar_messageslist_actions",function(e,n,r){var o,i,s,a,l,c,u,p,d,h;h=React.DOM,p=h.div,d=h.i,u=h.button,c=n("../constants/app_constants").Tooltips,a=n("./toolbox_actions"),l=n("./toolbox_move"),i=n("../actions/layout_action_creator"),s=n("../actions/message_action_creator"),r.exports=o=React.createClass({displayName:"ActionsToolbarMessagesList",propTypes:{settings:React.PropTypes.object.isRequired,mailboxID:React.PropTypes.string.isRequired,mailboxes:React.PropTypes.object.isRequired,messages:React.PropTypes.object.isRequired,selected:React.PropTypes.object.isRequired,displayConversations:React.PropTypes.bool.isRequired,afterAction:React.PropTypes.func},_hasSelection:function(){return Object.keys(this.props.selected).length>0},_getSelectedAndMode:function(e){var n,r,o;return o=Object.keys(this.props.selected),r=o.length,e=Boolean(e),null==e&&(e=this.props.displayConversations),0===o.length?(i.alertError(t("list mass no message")),!1):e?(n=o.map(function(e){return function(t){return e.props.messages.get(t).get("conversationID")}}(this)),{count:r,conversationIDs:n,applyToConversation:e}):{count:r,messageIDs:o,applyToConversation:e}},render:function(){return p({role:"group"},u({role:"menuitem",onClick:this.onDelete,"aria-disabled":this._hasSelection(),"aria-describedby":c.DELETE_SELECTION,"data-tooltip-direction":"bottom"},d({className:"fa fa-trash-o"})),this.props.displayConversations?void 0:l({ref:"listToolboxMove",mailboxes:this.props.mailboxes,onMove:this.onMove,direction:"left"}),a({ref:"listToolboxActions",direction:"left",mailboxes:this.props.mailboxes,inConversation:!0,displayConversations:this.props.displayConversations,onMark:this.onMark,onConversationDelete:this.onConversationDelete,onConversationMark:this.onConversationMark,onConversationMove:this.onConversationMove}))},onDelete:function(e){var n,r,o,a,l;if(l=this._getSelectedAndMode(e))return o=l.applyToConversation?t("list delete conv confirm",{smart_count:l.count}):t("list delete confirm",{smart_count:l.count}),n=function(e){return function(){return s["delete"](l,function(){var t;return l.count>0&&e.props.messages.count()>0?(t=e.props.messages.first().get("id"),s.setCurrent(t,!0)):void 0}),null!=e.props.afterAction?e.props.afterAction():void 0}}(this),a=!this.props.settings.get("messageConfirmDelete"),a?n():(r={title:t("app confirm delete"),subtitle:o,closeLabel:t("app cancel"),actionLabel:t("app confirm"),action:function(){return n(),i.hideModal()}},i.displayModal(r))},onMove:function(e,t){var n,r;if(r=this._getSelectedAndMode(t))return n=this.props.mailboxID,s.move(r,n,e,function(e){return function(){var t;return r.count>0&&e.props.messages.count()>0?(t=e.props.messages.first().get("id"),s.setCurrent(t,!0)):void 0}}(this)),null!=this.props.afterAction?this.props.afterAction():void 0},onMark:function(e,t){var n;if(n=this._getSelectedAndMode(t))return s.mark(n,e)},onConversationDelete:function(){return this.onDelete(!0)},onConversationMove:function(e){return this.onMove(e,!0)},onConversationMark:function(e){return this.onMark(e,!0)}})}),require.register("components/toolbar_messageslist_filters",function(e,n,r){var o,i,s,a,l,c,u,p,d,h,f,m,g,v;g=React.DOM,p=g.div,m=g.ul,h=g.li,f=g.span,d=g.i,u=g.button,v=n("../constants/app_constants"),a=v.MessageFilter,c=v.Tooltips,l=n("../mixins/router_mixin"),s=n("../actions/layout_action_creator"),o=n("./date_range_picker"),r.exports=i=React.createClass({displayName:"FiltersToolbarMessagesList",propTypes:{accountID:React.PropTypes.string.isRequired,mailboxID:React.PropTypes.string.isRequired},getInitialState:function(){return{expanded:!1}},shouldComponentUpdate:function(e,t){var n;return n=!_.isEqual(t,this.state)||!_.isEqual(e,this.props)},onDateFilter:function(e,t){var n;return n=e&&t?[e,t]:null,this.props.onFilterChange({type:"date",range:n})},toggleFilters:function(e){var t;return t="flag"===this.props.queryParams.type&&this.props.queryParams.filter===e,this.props.onFilterChange({type:"flag",value:t?"-":e})},render:function(){var e;return e="flag"===this.props.queryParams.type&&this.props.queryParams.filter,p({role:"group",className:"filters","aria-expanded":this.state.expanded},u({role:"presentation",onClick:function(e){return function(){return e.setState({expanded:!e.state.expanded})}}(this)},d({className:"fa fa-filter"})),u({role:"menuitem","aria-selected":e===a.UNSEEN,onClick:function(e){return function(){return e.toggleFilters(a.UNSEEN)}}(this),"aria-describedby":c.FILTER_ONLY_UNREAD,"data-tooltip-direction":"bottom"},d({className:"fa fa-eye"}),f({className:"btn-label"},t("filters unseen"))),u({role:"menuitem","aria-selected":e===a.FLAGGED,onClick:function(e){return function(){return e.toggleFilters(a.FLAGGED)}}(this),"aria-describedby":c.FILTER_ONLY_IMPORTANT,"data-tooltip-direction":"bottom"},d({className:"fa fa-star"}),f({className:"btn-label"},t("filters flagged"))),u({role:"menuitem","aria-selected":e===a.ATTACH,onClick:function(e){return function(){return e.toggleFilters(a.ATTACH)}}(this),"aria-describedby":c.FILTER_ONLY_WITH_ATTACHMENT,"data-tooltip-direction":"bottom"},d({className:"fa fa-paperclip"}),f({className:"btn-label"},t("filters attach"))),o({active:"date"===this.props.queryParams.type,onDateFilter:this.onDateFilter}))}})}),require.register("components/toolbar_messageslist_search",function(e,n,r){var o,i,s,a,l,c,u,p,d,h,f,m,g,v,y;v=React.DOM,d=v.div,m=v.i,p=v.button,g=v.input,f=v.form,o=n("./basic_components").Dropdown,y=n("../constants/app_constants"),s=y.MessageFilter,u=y.Tooltips,l=n("./search_input"),a=n("../mixins/router_mixin"),i=n("../actions/layout_action_creator"),h={from:t("list filter from"),dest:t("list filter dest")},r.exports=c=React.createClass({displayName:"SearchToolbarMessagesList",propTypes:{accountID:React.PropTypes.string.isRequired,mailboxID:React.PropTypes.string.isRequired},getInitialState:function(){return{type:"from",value:""}},prevent:function(e){return e.preventDefault()},onTypeChange:function(e){return this.setState({type:e,value:""})},onValueChange:function(e){return this.props.onFilterChange({type:this.state.type,value:e})},render:function(){return f({role:"group",className:"search",onSubmit:this.prevent},o({options:h,valueLink:{value:this.state.type,requestChange:this.onTypeChange}}),l({value:this.state.value,placeholder:t("filters search placeholder"),onSubmit:this.onValueChange}))}})}),require.register("components/toolbox_actions",function(e,n,r){var o,i,s,a,l,c,u,p,d,h,f,m,g,v=[].slice;m=React.DOM,p=m.div,f=m.ul,d=m.li,h=m.span,c=m.a,u=m.button,g=n("./basic_components"),s=g.MenuHeader,a=g.MenuItem,i=g.MenuDivider,o=n("../constants/app_constants").FlagsConstants,r.exports=l=React.createClass({displayName:"ToolboxActions",propTypes:{direction:React.PropTypes.string.isRequired,displayConversations:React.PropTypes.bool.isRequired,isFlagged:React.PropTypes.bool,isSeen:React.PropTypes.bool,mailboxes:React.PropTypes.object.isRequired,message:React.PropTypes.object,messageID:React.PropTypes.string,onConversationDelete:React.PropTypes.func.isRequired,onConversationMark:React.PropTypes.func.isRequired,onConversationMove:React.PropTypes.func.isRequired,onHeaders:React.PropTypes.func,onMark:React.PropTypes.func.isRequired},shouldComponentUpdate:function(e,t){return!_.isEqual(t,this.state)||!_.isEqual(e,this.props)},render:function(){var e;return e="right"===this.props.direction?"right":"left",p({className:"menu-action btn-group btn-group-sm"},u({className:"btn btn-default dropdown-toggle fa fa-cog",type:"button","data-toggle":"dropdown"}," ",h({className:"caret"})),f.apply(null,[{className:"dropdown-menu dropdown-menu-"+e,role:"menu"},this.props.displayConversations?void 0:this.renderMarkActions(),this.props.displayConversations?void 0:i()].concat(v.call(this.renderRawActions()),[this.props.inConversation?this.renderConversationActions():void 0],[this.props.inConversation?i({key:"divider"}):void 0],[this.props.inConversation?s({key:"header-move"},t("mail action conversation move")):void 0],[this.props.inConversation?this.renderMailboxes():void 0])))},renderMarkActions:function(){var e;return e=[s({key:"header-mark"},t("mail action mark")),null!=this.props.isSeen&&this.props.isSeen?void 0:a({key:"action-mark-seen",onClick:this.props.onMark,onClickValue:o.SEEN},t("mail mark read")),null==this.props.isSeen||this.props.isSeen?a({key:"action-mark-unseen",onClick:this.props.onMark,onClickValue:o.UNSEEN},t("mail mark unread")):void 0,null==this.props.isFlagged||this.props.isFlagged?a({key:"action-mark-noflag",onClick:this.props.onMark,onClickValue:o.NOFLAG},t("mail mark nofav")):void 0,null!=this.props.isFlagged&&this.props.isFlagged?void 0:a({key:"action-mark-flagged",onClick:this.props.onMark,onClickValue:o.FLAGGED},t("mail mark fav"))],e.filter(function(e){return Boolean(e)})},renderRawActions:function(){var e;return e=[this.props.displayConversations?void 0:s({key:"header-more"},t("mail action more")),null!=this.props.messageID?a({key:"action-headers",onClick:this.props.onHeaders},t("mail action headers")):void 0,null!=this.props.message?a({key:"action-raw",href:"raw/"+this.props.message.get("id"),target:"_blank"},t("mail action raw")):void 0],e.filter(function(e){return Boolean(e)})},renderConversationActions:function(){var e;return e=[a({key:"conv-delete",onClick:this.props.onConversationDelete},t("mail action conversation delete")),a({key:"conv-seen",onClick:this.props.onConversationMark,onClickValue:o.SEEN},t("mail action conversation seen")),a({key:"conv-unseen",onClick:this.props.onConversationMark,onClickValue:o.UNSEEN},t("mail action conversation unseen")),a({key:"conv-flagged",onClick:this.props.onConversationMark,onClickValue:o.FLAGGED},t("mail action conversation flagged")),a({key:"conv-noflag",onClick:this.props.onConversationMark,onClickValue:o.NOFLAG},t("mail action conversation noflag"))]},renderMailboxes:function(){return this.props.mailboxes.filter(function(e){return function(t,n){return n!==e.props.selectedMailboxID}}(this)).map(function(e){return function(t,n){return a({key:n,className:"pusher pusher-"+t.get("depth"),onClick:e.props.onConversationMove,onClickValue:n},t.get("label"))}}(this)).toJS()}})}),require.register("components/toolbox_move",function(e,n,r){var o,i,s,a,l,c,u,p,d,h,f,m,g;m=React.DOM,c=m.div,f=m.ul,p=m.li,h=m.span,u=m.i,d=m.p,a=m.a,l=m.button,g=n("./basic_components"),o=g.MenuHeader,i=g.MenuItem,r.exports=s=React.createClass({displayName:"ToolboxMove",shouldComponentUpdate:function(e,t){return!_.isEqual(t,this.state)||!_.isEqual(e,this.props)},render:function(){var e;return e="right"===this.props.direction?"right":"left",c({className:"menu-move btn-group btn-group-sm"},l({className:"btn btn-default dropdown-toggle fa fa-folder-open",type:"button","data-toggle":"dropdown"}," ",h({className:"caret"})),f({className:"dropdown-menu dropdown-menu-"+e,role:"menu"},o(null,t("mail action move")),this.renderMailboxes()))},renderMailboxes:function(){return this.props.mailboxes.filter(function(e){return function(t,n){return n!==e.props.selectedMailboxID}}(this)).map(function(e){return function(t,n){return i({key:n,className:"pusher pusher-"+t.get("depth"),onClick:e.props.onMove,onClickValue:n},t.get("label"))}}(this)).toJS()}})}),require.register("components/tooltips-manager",function(e,n,r){var o,i,s,a;o=n("../constants/app_constants").Tooltips,a=React.DOM,i=a.div,s=a.p,r.exports=React.createClass({displayName:"TooltipManager",shouldComponentUpdate:function(){return!1},render:function(){return i(null,this.getTooltip(o.REPLY,t("tooltip reply")),this.getTooltip(o.REPLY_ALL,t("tooltip reply all")),this.getTooltip(o.FORWARD,t("tooltip forward")),this.getTooltip(o.REMOVE_MESSAGE,t("tooltip remove message")),this.getTooltip(o.OPEN_ATTACHMENTS,t("tooltip open attachments")),this.getTooltip(o.OPEN_ATTACHMENT,t("tooltip open attachment")),this.getTooltip(o.DOWNLOAD_ATTACHMENT,t("tooltip download attachment")),this.getTooltip(o.PREVIOUS_CONVERSATION,t("tooltip previous conversation")),this.getTooltip(o.NEXT_CONVERSATION,t("tooltip next conversation")),this.getTooltip(o.FILTER_ONLY_UNREAD,t("tooltip filter only unread")),this.getTooltip(o.FILTER_ONLY_IMPORTANT,t("tooltip filter only important")),this.getTooltip(o.FILTER_ONLY_WITH_ATTACHMENT,t("tooltip filter only attachment")),this.getTooltip(o.ACCOUNT_PARAMETERS,t("tooltip account parameters")),this.getTooltip(o.DELETE_SELECTION,t("tooltip delete selection")),this.getTooltip(o.FILTER,t("tooltip filter")),this.getTooltip(o.QUICK_FILTER,t("tooltip display filters")),this.getTooltip(o.EXPUNGE_MAILBOX,t("tooltip expunge mailbox")),this.getTooltip(o.HELP_SHORTCUTS,t("tooltip help shortcuts")),this.getTooltip(o.ADD_CONTACT,t("tooltip add contact")),this.getTooltip(o.SHOW_CONTACT,t("tooltip show contact")))},getTooltip:function(e,t){return s({id:e,role:"tooltip","aria-hidden":"true"},t)}})}),require.register("constants/app_constants",function(e,t,n){n.exports={ActionTypes:{CHECK_ACCOUNT_REQUEST:"CHECK_ACCOUNT_REQUEST",CHECK_ACCOUNT_SUCCESS:"CHECK_ACCOUNT_SUCCESS",CHECK_ACCOUNT_FAILURE:"CHECK_ACCOUNT_FAILURE",ADD_ACCOUNT_REQUEST:"ADD_ACCOUNT_REQUEST",ADD_ACCOUNT_SUCCESS:"ADD_ACCOUNT_SUCCESS",ADD_ACCOUNT_FAILURE:"ADD_ACCOUNT_FAILURE",REMOVE_ACCOUNT_REQUEST:"REMOVE_ACCOUNT_REQUEST",REMOVE_ACCOUNT_SUCCESS:"REMOVE_ACCOUNT_SUCCESS",REMOVE_ACCOUNT_FAILURE:"REMOVE_ACCOUNT_FAILURE",EDIT_ACCOUNT_REQUEST:"EDIT_ACCOUNT_REQUEST",EDIT_ACCOUNT_SUCCESS:"EDIT_ACCOUNT_SUCCESS",EDIT_ACCOUNT_FAILURE:"EDIT_ACCOUNT_FAILURE",SELECT_ACCOUNT:"SELECT_ACCOUNT",NEW_ACCOUNT_SETTING:"NEW_ACCOUNT_SETTING",MAILBOX_ADD:"MAILBOX_ADD",MAILBOX_CREATE:"MAILBOX_CREATE",MAILBOX_UPDATE:"MAILBOX_UPDATE",MAILBOX_DELETE:"MAILBOX_DELETE",MAILBOX_EXPUNGE:"MAILBOX_EXPUNGE",RECEIVE_RAW_MESSAGE:"RECEIVE_RAW_MESSAGE",RECEIVE_RAW_MESSAGES:"RECEIVE_RAW_MESSAGES",RECEIVE_RAW_MESSAGE_REALTIME:"RECEIVE_RAW_MESSAGE_REALTIME",MESSAGE_SEND:"MESSAGE_SEND",MESSAGE_CURRENT:"MESSAGE_CURRENT",RECEIVE_MESSAGE_DELETE:"RECEIVE_MESSAGE_DELETE",RECEIVE_MAILBOX_UPDATE:"RECEIVE_MAILBOX_UPDATE",MESSAGE_TRASH_REQUEST:"MESSAGE_TRASH_REQUEST",MESSAGE_TRASH_SUCCESS:"MESSAGE_TRASH_SUCCESS",MESSAGE_TRASH_FAILURE:"MESSAGE_TRASH_FAILURE",MESSAGE_MOVE_REQUEST:"MESSAGE_MOVE_REQUEST",MESSAGE_MOVE_SUCCESS:"MESSAGE_MOVE_SUCCESS",MESSAGE_MOVE_FAILURE:"MESSAGE_MOVE_FAILURE",MESSAGE_FLAGS_REQUEST:"MESSAGE_FLAGS_REQUEST",MESSAGE_FLAGS_SUCCESS:"MESSAGE_FLAGS_SUCCESS",MESSAGE_FLAGS_FAILURE:"MESSAGE_FLAGS_FAILURE",MESSAGE_FETCH_REQUEST:"MESSAGE_FETCH_REQUEST",MESSAGE_FETCH_SUCCESS:"MESSAGE_FETCH_SUCCESS",MESSAGE_FETCH_FAILURE:"MESSAGE_FETCH_FAILURE",MESSAGE_UNDO_REQUEST:"MESSAGE_UNDO_REQUEST",MESSAGE_UNDO_SUCCESS:"MESSAGE_UNDO_SUCCESS",MESSAGE_UNDO_FAILURE:"MESSAGE_UNDO_FAILURE",MESSAGE_UNDO_TIMEOUT:"MESSAGE_UNDO_TIMEOUT",CONVERSATION_FETCH_REQUEST:"CONVERSATION_FETCH_REQUEST",CONVERSATION_FETCH_SUCCESS:"CONVERSATION_FETCH_SUCCESS",CONVERSATION_FETCH_FAILURE:"CONVERSATION_FETCH_FAILURE",MESSAGE_RECOVER_REQUEST:"MESSAGE_RECOVER_REQUEST",MESSAGE_RECOVER_SUCCESS:"MESSAGE_RECOVER_SUCCESS",MESSAGE_RECOVER_FAILURE:"MESSAGE_RECOVER_FAILURE",SEARCH_PARAMETER_CHANGED:"SEARCH_PARAMETER_CHANGED",SEARCH_REQUEST:"SEARCH_REQUEST",SEARCH_SUCCESS:"SEARCH_SUCCESS",SEARCH_FAILURE:"SEARCH_FAILURE",SET_CONTACT_QUERY:"SET_CONTACT_QUERY",RECEIVE_RAW_CONTACT_RESULTS:"RECEIVE_RAW_CONTACT_RESULTS",CLEAR_CONTACT_RESULTS:"CLEAR_CONTACT_RESULTS",CONTACT_LOCAL_SEARCH:"CONTACT_LOCAL_SEARCH",SET_DISPOSITION:"SET_DISPOSITION",TOGGLE_LIST_MODE:"TOGGLE_LIST_MODE",RESIZE_PREVIEW_PANE:"RESIZE_PREVIEW_PANE",MAXIMIZE_PREVIEW_PANE:"MAXIMIZE_PREVIEW_PANE",MINIMIZE_PREVIEW_PANE:"MINIMIZE_PREVIEW_PANE",DISPLAY_MODAL:"DISPLAY_MODAL",HIDE_MODAL:"HIDE_MODAL",REFRESH:"REFRESH",INTENT_AVAILABLE:"INTENT_AVAILABLE",SETTINGS_UPDATED:"SETTINGS_UPDATED",RECEIVE_TASK_UPDATE:"RECEIVE_TASK_UPDATE",RECEIVE_TASK_DELETE:"RECEIVE_TASK_DELETE",CLEAR_TOASTS:"CLEAR_TOASTS",RECEIVE_REFRESH_UPDATE:"RECEIVE_REFRESH_UPDATE",RECEIVE_REFRESH_STATUS:"RECEIVE_REFRESH_STATUS",RECEIVE_REFRESH_DELETE:"RECEIVE_REFRESH_DELETE",RECEIVE_REFRESH_NOTIF:"RECEIVE_REFRESH_NOTIF",REFRESH_REQUEST:"REFRESH_REQUEST",REFRESH_SUCCESS:"REFRESH_SUCCESS",REFRESH_FAILURE:"REFRESH_FAILURE",QUERY_PARAMETER_CHANGED:"QUERY_PARAMETER_CHANGED",TOASTS_SHOW:"TOASTS_SHOW",TOASTS_HIDE:"TOASTS_HIDE",DRAWER_SHOW:"DRAWER_SHOW",DRAWER_HIDE:"DRAWER_HIDE",DRAWER_TOGGLE:"DRAWER_TOGGLE"},PayloadSources:{VIEW_ACTION:"VIEW_ACTION",SERVER_ACTION:"SERVER_ACTION"},ComposeActions:{REPLY:"REPLY",REPLY_ALL:"REPLY_ALL",FORWARD:"FORWARD"},AlertLevel:{SUCCESS:"SUCCESS",INFO:"INFO",WARNING:"WARNING",ERROR:"ERROR"},MessageFlags:{FLAGGED:"\\Flagged",SEEN:"\\Seen",DRAFT:"\\Draft"},MessageFilter:{ALL:"all",ATTACH:"attach",FLAGGED:"flagged",UNSEEN:"unseen"},MailboxFlags:{DRAFT:"\\Drafts",SENT:"\\Sent",TRASH:"\\Trash",ALL:"\\All",SPAM:"\\Junk",FLAGGED:"\\Flagged"},FlagsConstants:{SEEN:"\\Seen",UNSEEN:"Unseen",FLAGGED:"\\Flagged",NOFLAG:"Noflag"},Dispositions:{COL:"column",ROW:"row"},SpecialBoxIcons:{inboxMailbox:"fa-inbox",draftMailbox:"fa-file-text-o",sentMailbox:"fa-send-o",trashMailbox:"fa-trash-o",junkMailbox:"fa-fire",allMailbox:"fa-archive"},Tooltips:{REPLY:"TOOLTIP_REPLY",REPLY_ALL:"TOOLTIP_REPLY_ALL",FORWARD:"TOOLTIP_FORWARD",REMOVE_MESSAGE:"TOOLTIP_REMOVE_MESSAGE",OPEN_ATTACHMENTS:"TOOLTIP_OPEN_ATTACHMENTS",OPEN_ATTACHMENT:"TOOLTIP_OPEN_ATTACHMENT",DOWNLOAD_ATTACHMENT:"TOOLTIP_DOWNLOAD_ATTACHMENT",PREVIOUS_CONVERSATION:"TOOLTIP_PREVIOUS_CONVERSATION",NEXT_CONVERSATION:"TOOLTIP_NEXT_CONVERSATION",FILTER_ONLY_UNREAD:"TOOLTIP_FILTER_ONLY_UNREAD",FILTER_ONLY_IMPORTANT:"TOOLTIP_FILTER_ONLY_IMPORTANT",FILTER_ONLY_WITH_ATTACHMENT:"TOOLTIP_FILTER_ONLY_WITH_ATTACHMENT",ACCOUNT_PARAMETERS:"TOOLTIP_ACCOUNT_PARAMETERS",DELETE_SELECTION:"TOOLTIP_DELETE_SELECTION",FILTER:"TOOLTIP_FILTER",QUICK_FILTER:"TOOLTIP_QUICK_FILTER",COMPOSE_IMAGE:"TOOLTIP_COMPOSE_IMAGE",COMPOSE_MOCK:"TOOLTIP_COMPOSE_MOCK",EXPUNGE_MAILBOX:"TOOLTIP_EXPUNGE_MAILBOX",ADD_CONTACT:"TOOLTIP_ADD_CONTACT",SHOW_CONTACT:"TOOLTIP_SHOW_CONTACT",HELP_SHORTCUTS:"TOOLTIP_HELP_SHORTCUT"}}}),require.register("initialize",function(e,t,n){var r,o,i,s;o=function(){var e;return e=0,window.start=function(){return null!=("undefined"!=typeof performance&&null!==performance?performance.now:void 0)&&(e=performance.now()),React.addons.Perf.start()},window.stop=function(){return null!=("undefined"!=typeof performance&&null!==performance?performance.now:void 0)&&console.log(performance.now()-e),React.addons.Perf.stop()},window.printWasted=function(){return stop(),React.addons.Perf.printWasted()},window.printInclusive=function(){return stop(),React.addons.Perf.printInclusive()},window.printExclusive=function(){return stop(),React.addons.Perf.printExclusive()}},s=function(){var e,t,n,r,o;return n=null!=(r=window.performance)?r.timing:void 0,t=Math.ceil(null!=(o=window.performance)?o.now():void 0),null!=n?(e="Response at "+(n.responseEnd-n.navigationStart)+"ms\nOnload at "+(n.loadEventStart-n.navigationStart)+"ms\nPage loaded in "+t+"ms",window.cozyMails.logInfo(e)):void 0},r=function(){var e;return e=t("./utils/intent_manager"),window.intentManager=new e,window.intentManager.send("nameSpace",{type:"ping",from:"mails"}).then(function(e){return LayoutActionCreator.intentAvailability(!0)},function(e){return LayoutActionCreator.intentAvailability(!1)})},i=function(){var e;return e=t("./utils/plugin_utils"),null==window.settings.plugins&&(window.settings.plugins={}),e.merge(window.settings.plugins),e.init()},window.onerror=function(e,t,n,r,o){var i,s,a;return console.error(e,t,n,r,o,null!=o?o.stack:void 0),s=(null!=o?o.toString():void 0)||e,s!==window.lastError?(i={data:{type:"error",error:{msg:e,name:null!=o?o.name:void 0,full:s,stack:null!=o?o.stack:void 0},url:t,line:n,col:r,href:window.location.href}},a=new XMLHttpRequest,a.open("POST","activity",!0),a.setRequestHeader("Content-Type","application/json;charset=UTF-8"),a.send(JSON.stringify(i)),window.lastError=s):void 0},window.onload=function(){var e,n,i,a,l,c,u,p,d,h,f,m,g,v,y;try{return window.__DEV__="localhost"===window.location.hostname,o(),window.cozyMails=t("./utils/api_utils"),null==window.settings&&(window.settings={}),v=window.locale||window.navigator.language||"en",window.cozyMails.setLocale(v),a=t("./actions/layout_action_creator/"),a.setDisposition(window.settings.layoutStyle),u=t("./utils/plugin_utils"),null==window.settings.plugins&&(window.settings.plugins={}),u.merge(window.settings.plugins),u.init(),window.cozyMails.setSetting("plugins",window.settings.plugins),r(),e=t("./stores/account_store"),i=t("./stores/contact_store"),l=t("./stores/layout_store"),c=t("./stores/message_store"),d=t("./stores/settings_store"),p=t("./router"),this.router=new p,window.router=this.router,n=t("./components/application"),h=n({router:this.router}),window.rootComponent=React.renderComponent(h,document.body),Backbone.history.start(),t("./utils/socketio_utils"),window.settings.desktopNotifications&&null!=window.Notification&&Notification.requestPermission(function(e){return Notification.permission!==e?Notification.permission=e:void 0}),s(),window.cozyMails.customEvent("APPLICATION_LOADED")}catch(b){if(m=b,console.error(m,null!=m?m.stack:void 0),g=m.toString(),g!==window.lastError)return f={data:{type:"error",error:{msg:m.message,name:null!=m?m.name:void 0,full:g,stack:null!=m?m.stack:void 0},file:null!=m?m.fileName:void 0,line:null!=m?m.lineNumber:void 0,col:null!=m?m.columnNumber:void 0,href:window.location.href}},y=new XMLHttpRequest,y.open("POST","activity",!0),y.setRequestHeader("Content-Type","application/json;charset=UTF-8"),y.send(JSON.stringify(f)),window.lastError=g}}}),require.register("libs/cached_transform",function(e,t,n){var r=[].slice;n.exports=function(){var e,t,n,o,i,s,a,l,c,u,p,d,h;if(l=arguments[0],i=arguments[1],t=4<=arguments.length?r.call(arguments,2,u=arguments.length-1):(u=2,[]),c=arguments[u++],null==l.__cachedTransforms&&(l.__cachedTransforms={}),n=l.__cachedTransforms[i],a=!0,n){for(h=n.args,o=p=0,d=h.length;d>p;o=++p)e=h[o],t[o]!==e&&(a=!1);if(a)return n.result}return s=c(),l.__cachedTransforms[i]={args:t,result:s},s}}),require.register("libs/flux/dispatcher/dispatcher",function(e,t,n){var r,o,i,s;o=t("../invariant"),i=1,s="ID_",n.exports=r=r=function(){function e(){this._callbacks={},this._isPending={},this._isHandled={},this._isDispatching=!1,this._pendingPayload=null}return e.prototype.register=function(e){var t;return t=s+i++,this._callbacks[t]=e,t},e.prototype.unregister=function(e){var t;return t="Dispatcher.unregister(...): `%s` does not map to a registered callback.",o(this._callbacks[e],t,e),delete this._callbacks[e]},e.prototype.waitFor=function(e){var t,n,r,i,s,a,l;for(o(this._isDispatching,"Dispatcher.waitFor(...): Must be invoked while dispatching."),r="Dispatcher.waitFor(...): Circular dependency detected while waiting for `%s`.",i="Dispatcher.waitFor(...): `%s` does not map to a registered callback.",l=[],n=s=0,a=e.length-1;a>=s;n=s+=1)t=e[n],this._isPending[t]?o(this._isHandled[t],r,t):(o(this._callbacks[t],i,t),l.push(this._invokeCallback(t)));return l},e.prototype.dispatch=function(e){var t,n,r;console.log("DIS",e.action.type,e.action.value),n="Dispatch.dispatch(...): Cannot dispatch in the middle of a dispatch.",o(!this._isDispatching,n),this._startDispatching(e);try{r=[];for(t in this._callbacks)this._isPending[t]||r.push(this._invokeCallback(t));return r}finally{this._stopDispatching()}},e.prototype.isDispatching=function(){return this._isDispatching},e.prototype._invokeCallback=function(e){return this._isPending[e]=!0,this._callbacks[e](this._pendingPayload),this._isHandled[e]=!0},e.prototype._startDispatching=function(e){var t;for(t in this._callbacks)this._isPending[t]=!1,this._isHandled[t]=!1;return this._pendingPayload=e,this._isDispatching=!0},e.prototype._stopDispatching=function(){return this._pendingPayload=null,this._isDispatching=!1},e}()}),require.register("libs/flux/invariant",function(e,t,n){"use strict";var r=function(e,t,n,r,o,i,s,a){if(__DEV__&&void 0===t)throw new Error("invariant requires an error message argument");if(!e){var l;if(void 0===t)l=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[n,r,o,i,s,a],u=0;l=new Error("Invariant Violation: "+t.replace(/%s/g,function(){return c[u++]}))}throw l.framesToPop=1,l}};n.exports=r}),require.register("libs/flux/store/store",function(e,t,n){var r,o,i={}.hasOwnProperty,s=function(e,t){function n(){this.constructor=e}for(var r in t)i.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};r=t("../../../app_dispatcher"),n.exports=o=function(e){function t(){t.__super__.constructor.call(this),this.uniqID=i++,this.__bindHandlers(n.bind(this)),a.call(this)}var n,o,i,a;return s(t,e),t.prototype.uniqID=null,i=0,o={},n=function(e,t){return null==o[this.uniqID]&&(o[this.uniqID]={}),o[this.uniqID][e]=t},a=function(){return this.dispatchToken=r.register(function(e){return function(t){var n,r,i,s;return s=t.action,r=s.type,i=s.value,null!=(n=o[e.uniqID][r])?n.call(e,i):void 0}}(this))},t.prototype.__bindHandlers=function(e){var t;if(__DEV__)throw t="The store "+this.constructor.name+" must define a `__bindHandlers` method",new Error(t)},t}(EventEmitter)}),require.register("libs/panel_router",function(e,t,n){var r,o,i={}.hasOwnProperty,s=function(e,t){function n(){this.constructor=e}for(var r in t)i.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};r=t("../actions/layout_action_creator"),n.exports=o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return s(t,e),t.prototype.patterns={},t.prototype.routes={},t.prototype.previous=null,t.prototype.current=null,t.prototype.cachedPatterns=[],t.prototype.initialize=function(e){var t,n,o;o=this.patterns;for(t in o)n=o[t],this.cachedPatterns.push({key:t,pattern:this._routeToRegExp(n.pattern)}),this.routes[n.pattern]=t,this.routes[""+n.pattern+"/*secondPanel"]=t;return this._bindRoutes(),this.on("route",function(e){return function(t,n){var o,i,s,a,l,c;return"default"===t?(e.current={firstPanel:null,secondPanel:null},l=e.buildUrl({direction:"first",fullWidth:!0,action:r.getDefaultRoute(),parameters:[null]}),e.navigate(l,{trigger:!0})):(c=e._processSubRouting(t,n),i=c[0],a=c[1],o=e.fluxActionFactory(i),s=e.fluxActionFactory(a),e.previous=e.current,e.current={firstPanel:i,secondPanel:a},null!=o&&o(i,"first"),null!=s&&s(a,"second"),e.trigger("fluxRoute",e.current))}}(this))},t.prototype.fluxActionFactory=function(e){var t,n;return t=null,n=this.patterns[null!=e?e.action:void 0],null!=n?(t=r[n.fluxAction],null==t&&console.warn("`"+n.fluxAction+"` method not found in layout actions."),t):void 0},t.prototype._processSubRouting=function(e,t){var n,r,o,i,s,a;return t.pop(),a=t.pop(),o=this.patterns[e].pattern.match(/:[\w]+/g)||[],o.length>t.length&&null!=a&&(t.push(a),a=null),r=this._arrayToNamedParameters(e,t),i=_.first(_.filter(this.cachedPatterns,function(e){return e.pattern.test(a)})),null!=i?(t=this._extractParameters(i.pattern,a),t.pop(),s=this._mergeDefaultParameter({action:i.key,parameters:this._arrayToNamedParameters(i.key,t)})):s=null,n=this._mergeDefaultParameter({action:e,parameters:r}),[n,s]},t.prototype._arrayToNamedParameters=function(e,t){var n,r,o,i,s,a,l;for(r={},i=this.patterns[e].pattern.match(/:[\w]+/g)||[],n=a=0,l=i.length;l>a;n=++a)o=i[n],s=o.substr(1),r[s]=t[n];return r},t.prototype._namedParametersToArray=function(e,t){var n,r,o,i,s,a,l;for(o=[],i=this.patterns[e].pattern.match(/:[\w]+/g)||[],n=a=0,l=i.length;l>a;n=++a)r=i[n],s=r.substr(1),o.push(t[r]);return o},t.prototype.buildUrl=function(e){var t,n,r,o,i,s;return null!=e.firstPanel||null!=e.secondPanel?(t=e.firstPanel||this.current.firstPanel,o=e.secondPanel||this.current.secondPanel):null!=e.direction?"first"===e.direction?(t=e,o=this.current.secondPanel):"second"===e.direction?(t=this.current.firstPanel,o=e):console.warn("`direction` should be `first`, `second`."):console.warn("`direction` parameter is mandatory when using short call."),r=null!=e.firstPanel||"first"===e.direction,r&&e.fullWidth&&(null!=e.secondPanel&&"second"===e.direction&&console.warn("You shouldn't use the fullWidth option with a second panel"),o=null),n=this._getURLFromRoute(t),i=this._getURLFromRoute(o),s="#"+n,null!=i&&i.length>0&&(s=""+s+"/"+i),s},t.prototype.buildClosePanelUrl=function(e){var t;return t="first"===e||"full"===e?_.clone(this.current.secondPanel):_.clone(this.current.firstPanel),null!=t?(t.direction="first",t.fullWidth=!0,this.buildUrl(t)):"#"},t.prototype._getURLFromRoute=function(e){var t,n,r,o,i,s,a,l,c,u;if(e=_.clone(e),null!=(null!=e?e.parameters:void 0)&&(e.parameters=_.clone(e.parameters)),null!=e){if(l=this.patterns[e.action].pattern,null==e.parameters||e.parameters instanceof Array||e.parameters instanceof Object||(e.parameters=[e.parameters]),null!=e.parameters&&e.parameters instanceof Array&&(t=e.action,s=e.parameters,e.parameters=this._arrayToNamedParameters(t,s)),e=this._mergeDefaultParameter(e),a=l.match(/:[\w]+/gi)||[],n=l,e.parameters)for(c=0,u=a.length;u>c;c++)o=a[c],r=o.substr(1),i=e.parameters[r],n=n.replace(o,i);return n}return""},t.prototype._mergeDefaultParameter=function(e){var t,n,r,o;if(e=_.clone(e),o=_.clone(e.parameters||{}),n=this._getDefaultParameters(e.action,e.parameters),null!=n)for(r in n)t=n[r],null==o[r]&&(o[r]=t);return e.parameters=o,e},t}(Backbone.Router)}),require.register("libs/prop_types",function(e,t,n){var r,o,i,s;r=e,s=React.PropTypes;for(o in s)i=s[o],r[o]=i;r.valueLink=function(e){return React.PropTypes.shape({value:e,requestChange:React.PropTypes.func.isRequired})},r.immutableMapStringTo=function(e){return function(t,n,o,i){var s,a,l,c;if(s=r.instanceOf(Immutable.Map).isRequired.apply(this,arguments))return s;c=t[n].values();for(l in c)if(a=c[l],s=e(c,a,o,i))return s;return null}},r.Mailbox=function(){return React.PropTypes.shape({id:r.string,label:r.string,depth:r.number,weight:r.number,attribs:r.arrayOf(r.string)})},r.Account=function(){return React.PropTypes.shape({label:r.string,name:r.string,login:r.string,password:r.string,imapServer:r.string,imapPort:r.string,smtpServer:r.string,smtpPort:r.string,smtpMethod:r.string,draftMailbox:r.string,sentMailbox:r.string,trashMailbox:r.string})}}),require.register("locales/de",function(e,t,n){n.exports={"app loading":"Laden…","app back":"Zurück","app cancel":"Abbrechen","app menu":"Menü","app search":"Suchen…","app alert close":"Schließen","app unimplemented":"Noch nicht implementiert","app error":"Argh, Ich bin nicht fähig diese Aktion auszuführen, bitte probieren Sie es wieder",compose:"Neue E-Mail erstellen","compose default":"Hallo, wie geht es Ihnen Heute?",
"compose from":"Von","compose to":"An","compose to help":"Empfänger Liste","compose cc":"Cc","compose cc help":"Kopie Liste","compose bcc":"Bcc","compose bcc help":"Verborgene Kopie Liste","compose subject":"Betreff","compose content":"Inhalt","compose subject help":"Nachrichten Betreff","compose reply prefix":"Re: ","compose reply separator":"\n\nOn %{date}, %{sender} hat geschrieben \n","compose forward prefix":"Fwd: ","compose forward separator":"\n\nOn %{date}, %{sender} hat geschrieben \n","compose action draft":"Entwurf speichern","compose action send":"Senden","compose action delete":"Entwurf löschen","compose action sending":"Sendet","compose toggle cc":"Cc","compose toggle bcc":"Bcc","compose error no dest":"Sie können keine Nachricht an Niemanden senden","compose error no subject":"Bitte vergeben Sie einen Betreff","compose confirm keep draft":"Nachricht wurde nicht gesandet, Entwurft behalten?","compose wrong email format":"Die vergebene E-Mail Adresse hat kein geeignes Format: %{address}.","compose forward header":"Gesendete Nachricht","compose forward subject":"Betreff:","compose forward date":"Datum:","compose forward from":"Von:","compose forward to":"An:","menu show":"Menü anzeigen","menu compose":"Erstellen","menu account new":"Neues Konto","menu settings":"Parameter","menu mailbox total":"%{smart_count} Nachricht |||| %{smart_count} Nachrichten","menu mailbox unread":", %{smart_count} ungelesene Nachricht ||||, %{smart_count} ungelesene Nachrichten ","menu mailbox new":" und %{smart_count} neue Nachricht |||| und %{smart_count} neue Nachrichten ","menu favorites on":"Favoriten","menu favorites off":"Alle","menu toggle":"Menü umschalten","menu refresh label":"Refresh","menu refreshing":"Refreshing...","list empty":"Keine E-Mail in diesem Postfach.","no flagged message":"Keine wichtige E-Mail in diesem Postfach.","no unseen message":"Alle E-Mails in dieser Box wurden gelesen","no attach message":"Keine Nachrichten mit Anhängen","no filter message":"Keine E-Mail für diesen Filter.","list fetching":"Laden…","list search empty":'Keine Ergebnis für diese Regel gefundnen "%{query}".',"list count":"%{smart_count} Nachricht in diesem Postfach |||| %{smart_count} NAchrichten in diesem Postfach","list search count":"%{smart_count} result found. |||| %{smart_count} results found.","list filter":"Filter","list filter all":"Alle","list filter unseen":"Ungelesen","list filter flagged":"Wichtig","list filter attach":"Anhänge","list sort":"Sortieren","list sort date":"Datum","list sort subject":"Betreff","list option compact":"Kompact","list next page":"Mehr Nachrichten","list end":"Das ist das Ende der Liste","list mass no message":"Keine Nachrichten ausgewählt","list delete confirm":"Möchten Sie wirklich diese Nachricht löschen ? ||||\nMöchten Sie wirklich diese %{smart_count} Nachrichten löschen ?","list delete conv confirm":"Möchten Sie wirklich diese Unterhaltung löschen ? ||||\nMöchten Sie wirklich diese %{smart_count} Unterhaltungen löschen?","mail to":"An: ","mail cc":"Cc: ","headers from":"Von","headers to":"An","headers cc":"Cc","headers reply-to":"Antwort an","headers date":"Datum","headers subject":"Betreff","length bytes":"Bytes","length kbytes":"kB","length mbytes":"MB","mail action reply":"Anworten","mail action reply all":"Allen antworten","mail action forward":"Weiterleiten","mail action delete":"Löschen","mail action mark":"Markieren als","mail action copy":"Kopie","mail action move":"Verschieben","mail action more":"Mehr","mail action headers":"Headers","mail action raw":"Roh Nachricht","mail mark spam":"Spam","mail mark nospam":"Kein Spam","mail mark fav":"wichtig","mail mark nofav":"Nicht wichtig","mail mark read":"Gelesen","mail mark unread":"Ungelesen","mail confirm delete":"Möchten Sie wirklich die Nachricht löschen “%{subject}”?","mail confirm delete nosubject":"Möchten Sie wirklich diese Nachricht löschen?","mail action conversation delete":"Unterhaltung löschen","mail action conversation move":"Unterhaltung verschieben","mail action conversation seen":"Unterhaltung als gelesen markieren","mail action conversation unseen":"Unterhaltung als ungelesen markieren","mail conversation length":"%{smart_count} Nachricht in Unterhaltung. ||||\n%{smart_count} Nachrichten in Unterhaltung.","account new":"Neues Konto","account edit":"Konto bearbeiten","account add":"Hinzufügen","account save":"Speichern","account saving":"Speicherung","account check":"Verbindung prüfen","account accountType short":"IMAP","account accountType":"Konto Typ","account imapPort short":"993","account imapPort":"Port","account imapSSL":"SSL verwenden","account imapServer short":"imap.provider.tld","account imapServer":"IMAP Server","account imapTLS":"TLS verwenden","account label short":"Ein kurzer Postfach Name","account label":"Konto Name","account login short":"Ihre E-Mail Addresse","account login":"E-Mail Addresse","account name short":"Ihr Name, dieser wird angezeigt","account name":"Ihr Name","account password":"Passwort","account receiving server":"Postausgang Server","account sending server":"Posteingang Server","account smtpLogin short":"SMTP Benutzer","account smtpLogin":"SMTP Benutzer (wenn abweichend vom Haupt Login)","account smtpMethod":"Authentifizierungsmethode","account smtpMethod NONE":"Keine","account smtpMethod PLAIN":"Plain","account smtpMethod LOGIN":"Login","account smtpMethod CRAM-MD5":"Cram-MD5","account smtpPassword short":"SMTP Passwort","account smtpPassword":"SMTP Passwort (wenn abweichend vom Haupt Passwort)","account smtpPort short":"465","account smtpPort":"Port","account smtpSSL":"SSL verwenden","account smtpServer short":"smtp.provider.tld","account smtpServer":"SMTP Server","account smtpTLS":"STARTTLS verwenden","account remove":"Konto löschen","account remove confirm":"Möchten Sie dieses Konto wirklich löschen?","account draft mailbox":"Entwurffach","account sent mailbox":"Posteingang","account trash mailbox":"Papierkorb","account mailboxes":"Ordner","account special mailboxes":"Specielle Postfächer","account newmailbox label":"Neuer Ordner","account newmailbox placeholder":"Name","account newmailbox parent":"Parent:","account confirm delbox":"Möchten Sie wirklich alle Nachrichtenn in diesem Postfach löschen?","account tab account":"Konto","account tab mailboxes":"Ordner","account errors":"Einige Daten fehlen oder sind ungültig","account type":"Konto Typ","account updated":"Konto aktualisiert","account checked":"Parameter ok","account creation ok":"Yeah! Das Konot wurde erfolgreich erstellt. Wählen Sie nun die Postfächer, die Sie im Menü sehen möchten","account refreshed":"Konto aktualisiert","account refresh error":"Fehler beim aktualisieren der Konten, Parameter prüfen","account identifiers":"Identifikation","account actions":"Aktionen","account danger zone":"Danger Zone","account no special mailboxes":"Bitte konfigurieren Sie erst spezielle Ordner","account smtp hide advanced":"Erweiterte Parameter verbergen","account smtp show advanced":"Erweiterte Parameter anzeigen","mailbox create ok":"Ordner erstellt","mailbox create ko":"Fehler beim Ordner erstellen","mailbox update ok":"Ordner aktualisiert","mailbox update ko":"Fehler beim Ordner aktualisieren","mailbox delete ok":"Ordner gelöscht","mailbox delete ko":"Fehler beim Ordner löschen","mailbox expunge ok":"Papierkorb geleeren","mailbox expunge ko":"Fehler beim Papierkorb leeren","mailbox title edit":"Ordner umbennen","mailbox title delete":"Ordner löschen","mailbox title edit save":"Speichern","mailbox title edit cancel":"Abbrechen","mailbox title add":"Neuen Ordner hinzufügen","mailbox title add cancel":"Abbrechen","mailbox title favorite":"Ordner wird angezeigt","mailbox title not favorite":"Ordner wird nicht angezeigt","mailbox title total":"Zusammen","mailbox title unread":"Ungelesen","mailbox title new":"Neu","config error auth":"Falsche Verbindungsparameter","config error imapPort":"Falscher IMAP Port","config error imapServer":"Falscher IMAP Server","config error imapTLS":"Falscher IMAP TLS","config error smtpPort":"Falscher SMTP Port","config error smtpServer":"Falscher SMTP Server","config error nomailboxes":"Kein Ordner in diesem Konto, bitte erstellen Sie einen","message action sent ok":"Nachricht senden","message action sent ko":"Fehler beim Nachricht senden: ","message action draft ok":"Nachricht gespeichert","message action draft ko":"Fehler beim Nachricht speichern: ","message delete ok":"Nachricht “%{subject}” gelöscht","message delete ko":"Fehler bei Nachricht löschen: ","message move ok":"Nachricht “%{subject}” wurde verschoben","message move ko":"Fehler beim verschieben von Nachricht “%{subject}”: ","message mark ok":"Nachricht markiert","message mark ko":"Fehler beim Nachricht markieren: ","conversation move ok":"Unterhaltung “%{subject}” wurde verschoben","conversation move ko":"Fehler beim verschieben der Unterhaltung “%{subject}”","conversation delete ok":"Unterhaltung “%{subject}” wurde gelöscht","conversation delete ko":"Fehler beim löschen der Unterhaltung","conversation seen ok":"Unterhaltung markiert als gelesen","conversation seen ko":"Fehler beim gelesen markieren","conversation unseen ok":"Conversation marked as unread","conversation unseen ko":"Fehler beim ungelesen markieren","undo last action":"Rückgänig","message images warning":"Anzeige von Bildern innerhalb der Nachricht wurde geblockt","message images display":"Bilder anzeigen","message html display":"HTML anzeigen","message delete no trash":"Bitte wählen Sie einen Ordner als Papierkorb","message delete already":"Nachricht bereits im Papierkorb","message move already":"Nachricht bereits in diesem Ordner","undo ok":"Nachrichten wieder hergestellt","undo ko":"Fehler beim Nachrichten Wiederherstellen","undo unavalable":"Rückgängig Nachrichten löschen nicht möglich","message preview title":"Anhänge ansehen","settings title":"Einstellungen","settings button save":"Speichern","settings plugins":"Plugins","settings plugins":"Ergänzende Module","settings plugin add":"Hinzufügen","settings plugin del":"Löschen","settings plugin help":"Hilfe","settings plugin new name":"Plugin Name","settings plugin new url":"Plugin URL","settings label composeInHTML":"Rich Nachrichten Editor","settings label composeOnTop":"Antwort am Anfang der Nachricht","settings label desktopNotifications":"Mitteilungen","settings label displayConversation":"Unterhaltungen anzeigen","settings label displayPreview":"Nachrichten Vorschau anzeigen","settings label messageDisplayHTML":"Nachricht in HTML anzeigen","settings label messageDisplayImages":"Bilder in der Nachrichten anzeigen","settings label messageConfirmDelete":"Bestätigung bevor Nachricht löschen","settings label layoutStyle":"Layout anzeigen","settings label layoutStyle horizontal":"Horizontal","settings label layoutStyle vertical":"Vertikal","settings label layoutStyle three":"Drei Spalten","settings label listStyle":"Nachrichten Listen Stil","settings label listStyle default":"Normal","settings label listStyle compact":"Kompact","settings lang":"Sprache","settings lang en":"English","settings lang fr":"Français","settings lang de":"Deutsch","settings save error":"Einstellungen können nicht gespeichert werden, bitte propieren Sie es erneut","picker drop here":"Dateien hier ablegen","mailbox pick one":"Eine auswählen","mailbox pick null":"Kein Postfach dafür","task account-fetch":"Holen %{account}","task box-fetch":"Holen %{box}","task apply-diff-fetch":"Holen Nachrichtenn aus %{box} von %{account}","task apply-diff-remove":"Löschen Nachrichten aus %{box} von %{account}","task recover-uidvalidity":"Analysiere","there were errors":"%{smart_count} Fehler. |||| %{smart_count} Fehler.","modal please report":"Bitte übertragen Sie diese Information zum Cozy.","modal please contribute":"Bitte beitragen","validate must not be empty":"Pflichtfeld","toast hide":"Alarme verbergen","toast show":"Alarme anzeigen","toast close all":"Alle Alarme schließen","notif new title":"CozyEmail","notif new":"%{smart_count} Nachricht nicht gelesen in Konto %{account}||||\n%{smart_count} Nachrichten nicht gelesen in Konto %{account}","notif complete":"Import des Kontos %{account} abgeschlossen.","contact form":"Kontakte auswählen","contact form placeholder":"Kontakt Name","contact create success":"%{contact} wurden zu Ihren Kontakten hinzu gefügt","contact create error":"Fehler beim Hinzufügen Ihrer Kontakte : {error}","gmail security tile":"Über GMAIL Sicherheit","gmail security body":"GMAIL betrachtet Verbindungen die Benutzername und Passwort verwenden nicht als sicher.\nBitte klicken Sie auf den folgenden Link, Stellen Sie sicher das\nSie sich mit Ihrem Konto %{login} angemelden und geben Sie Apps mit geringerer Sicherheit frei.","gmail security link":"Freigabe für Apps mit geringerer Sicherheit.","plugin name Gallery":"Anhang Gallerie","plugin name medium-editor":"Medium Editor","plugin name MiniSlate":"MiniSlate Editor","plugin name Sample JS":"Beispiel","plugin name Keyboard shortcuts":"Tastaturkombinationen","plugin name VCard":"Kontact VCards","plugin modal close":"Schließen","calendar unknown format":"Diese Nachricht enthält eine Einladung für ein Ereignis in einem derzeitig unbekannten Format.","tooltip reply":"Answer","tooltip reply all":"Answer to all","tooltip forward":"Forward","tooltip remove message":"Remove","tooltip open attachments":"Open attachment list","tooltip open attachment":"Open attachment","tooltip download attachment":"Download the attachment","tooltip previous conversation":"Go to previous conversation","tooltip next conversation":"Go to next conversation","tooltip filter only unread":"Nur ungelesene Nachrichten anzeigen","tooltip filter only important":"Nur wichtige Nachrichten anzeigen","tooltip filter only attachment":"Nur Nachrichten mit Anhängen anzeigen","tooltip account parameters":"Account parameters","tooltip delete selection":"Delete all selected messages"}}),require.register("locales/en",function(e,t,n){n.exports={"app loading":"Loading…","app back":"Back","app cancel":"Cancel","app confirm":"Confirm","app menu":"Menu","app search":"Search…","app alert close":"Close","app unimplemented":"Not implemented yet","app error":"Argh, I'm unable to perform this action, please try again","app confirm delete":"Confirm delete",compose:"Compose new email","compose default":"Hello, how are you doing today?","compose from":"From","compose to":"To","compose to help":"Recipients list","compose cc":"Cc","compose cc help":"Copy list","compose bcc":"Bcc","compose bcc help":"Hidden copy list","compose subject":"Subject","compose content":"Content","compose subject help":"Subject","compose reply prefix":"Re: ","compose reply separator":"\n\nOn %{date}, %{sender} wrote \n","compose forward prefix":"Fwd: ","compose forward separator":"\n\nOn %{date}, %{sender} wrote \n","compose action draft":"Save draft","compose action send":"Send","compose action delete":"Delete draft","compose action sending":"Sending","compose toggle cc":"Cc","compose toggle bcc":"Bcc","compose error no dest":"You can not send a message to nobody","compose error no subject":"Please set a subject","compose confirm keep draft":"Message not sent, keep the draft?","compose confirm draft keep":"Keep draft","compose confirm draft delete":"Delete draft","compose wrong email format":"The given email is unproperly formatted: %{address}.","compose forward header":"Forwarded message","compose forward subject":"Subject:","compose forward date":"Date:","compose forward from":"From:","compose forward to":"To:","menu show":"Show menu","menu compose":"Compose","menu account new":"New Mailbox","menu settings":"Parameters","menu mailbox total":"%{smart_count} message|||| %{smart_count} messages","menu mailbox unread":", %{smart_count} unread message ||||, %{smart_count} unread messages ","menu mailbox new":" and %{smart_count} new message|||| and %{smart_count} new messages ","menu favorites on":"Less","menu favorites off":"More","menu toggle":"Toggle Menu","menu refresh label":"Refresh","menu refreshing":"Refreshing...","list empty":"No email in this box.","no flagged message":"No Important email in this box.","no unseen message":"All emails have been read in this box","no attach message":"No message with attachments","no filter message":"No email for this filter.","list fetching":"Loading…","list search empty":'No result found for the query "%{query}".',"list count":"%{smart_count} message in this box |||| %{smart_count} messages in this box","list search count":"%{smart_count} result found. |||| %{smart_count} results found.","list filter":"Filter","list filter all":"All","list filter unseen":"Unseen","list filter flagged":"Important","list filter attach":"Attachments","list filter from":"Sender is","list filter date":"Date in","list filter date placeholder":"DD/MM/YYYY","list filter dest":"Recipient is","list filter subject":"Subject starts with…","list sort":"Sort","list sort date":"Date","list sort subject":"Subject","list option compact":"Compact","list next page":"More messages","list end":"This is the end of the road","list mass no message":"No message selected","list delete confirm":"Do you really want to delete this message ? ||||\nDo you really want to delete %{smart_count} messages?","list delete conv confirm":"Do you really want to delete this conversation ? ||||\nDo you really want to delete %{smart_count} conversation?","mail to":"To: ","mail cc":"Cc: ","headers from":"From","headers to":"To","headers cc":"Cc","headers reply-to":"Reply to","headers date":"Date","headers subject":"Subject","load more messages":"Load %{smart_count} more message |||| load %{smart_count} more messages","length bytes":"bytes","length kbytes":"Kb","length mbytes":"Mb","mail action reply":"Reply","mail action reply all":"Reply all","mail action forward":"Forward","mail action delete":"Delete","mail action mark":"Mark as","mail action copy":"Copy","mail action move":"Move","mail action more":"More","mail action headers":"Headers","mail action raw":"Raw message","mail mark spam":"Spam","mail mark nospam":"No spam","mail mark fav":"Important","mail mark nofav":"Not important","mail mark read":"Read","mail mark unread":"Unread","mail confirm delete title":"Delete message","mail confirm delete":"Do you really want to delete message “%{subject}”?","mail confirm delete nosubject":"Do you really want to delete this message?","mail confirm delete cancel":"Cancel","mail confirm delete delete":"Delete","mail action conversation delete":"Delete conversation","mail action conversation move":"Move conversation","mail action conversation seen":"Mark conversation as read","mail action conversation unseen":"Mark conversation as unread","mail action conversation flagged":"Mark conversation as important","mail action conversation noflag":"Mark conversation as normal","mail conversation length":"%{smart_count} message dans cette conversation. ||||\n%{smart_count} messages dans cette conversation.","account new":"New account","account edit":"Edit account","account add":"Add","account save":"Save","account saving":"Saving","account check":"Check connection","account accountType short":"IMAP","account accountType":"Account type","account imapPort short":"993","account imapPort":"Port","account imapSSL":"Use SSL","account imapServer short":"imap.provider.tld","account imapServer":"IMAP server","account imapTLS":"Use TLS","account imapLogin short":"IMAP user","account imapLogin":"IMAP user (if different from email address)","account label short":"A short mailbox name","account label":"Account label","account login short":"Your email address","account login":"Email address","account name short":"Your name, as it will be displayed","account name":"Your name","account oauth":"This account uses Google OAuth","account password":"Password","account receiving server":"Receiving server","account sending server":"Sending server","account smtpLogin short":"SMTP user","account smtpLogin":"SMTP user (if different from email address)","account smtpMethod":"Authentification method","account smtpMethod NONE":"None","account smtpMethod PLAIN":"Plain","account smtpMethod LOGIN":"Login","account smtpMethod CRAM-MD5":"Cram-MD5","account smtpPassword short":"SMTP password","account smtpPassword":"SMTP password (if different from IMAP password)","account smtpPort short":"465","account smtpPort":"Port","account smtpSSL":"Use SSL","account smtpServer short":"smtp.provider.tld","account smtpServer":"SMTP server","account smtpTLS":"Use STARTTLS","account remove":"Remove this account","account removed":"Account removed","account remove confirm":"Do you really want to remove account “%{label}” ?","account draft mailbox":"Draft box","account sent mailbox":"Sent box","account trash mailbox":"Trash","account mailboxes":"Folders","account special mailboxes":"Special mailboxes","account newmailbox label":"New Folder","account newmailbox placeholder":"Name","account newmailbox parent":"Parent:","account confirm delbox":"Do you really want to delete all messages in this box?","account tab account":"Account","account tab mailboxes":"Folders","account errors":"Some data are missing or invalid","account type":"Account type","account updated":"Account updated","account checked":"Parameters ok","account creation ok":"Yeah! The account has been successfully created. Now select the mailboxes you want to see in the menu","account refreshed":"Account refreshed","account refresh error":"Error refreshing accounts, check parameters","account identifiers":"Identification","account actions":"Actions","account danger zone":"Danger Zone","account no special mailboxes":"Please choose a specific folder for your Drafts, Sent and Deleted emails.","account imap hide advanced":"Hide advanced parameters","account imap show advanced":"Show advanced parameters","account smtp hide advanced":"Hide advanced parameters","account smtp show advanced":"Show advanced parameters","account tab signature":"Signature","account signature short":"Type here the text that will be added to the bottom of all your emails.","account signature":"Email Signature","account signature save":"Save","mailbox create ok":"Folder created","mailbox create ko":"Error creating folder","mailbox update ok":"Folder updated","mailbox update ko":"Error updating folder","mailbox delete ok":"Folder deleted","mailbox delete ko":"Error deleting folder","mailbox expunge ok":"Folder expunged","mailbox expunge ko":"Error expunging folder","mailbox title edit":"Rename folder","mailbox title delete":"Delete folder","mailbox title edit save":"Save","mailbox title edit cancel":"Cancel","mailbox title add":"Add new folder","mailbox title add cancel":"Cancel","mailbox title favorite":"Folder is displayed","mailbox title not favorite":"Folder not displayed","mailbox title total":"Total","mailbox title unread":"Unread","mailbox title new":"New","config error auth":"Wrong connection parameters","config error imapPort":"Wrong IMAP parameters","config error imapServer":"Wrong IMAP server","config error imapTLS":"Wrong IMAP TLS","config error smtpPort":"Wrong SMTP Port","config error smtpServer":"Wrong SMTP Server","config error nomailboxes":"No folder in this account, please create one","action undo":"Undo","action undo ok":"Action cancelled","action undo ko":"Unable to undo action","message action sent ok":"Message sent","message action sent ko":"Error sending message: ","message action draft ok":"Message saved","message action draft ko":"Error saving message: ","message delete ok":"Message “%{subject}” deleted","message delete ko":"Error deleting message: ","message move ok":"Message “%{subject}” moved","message move ko":"Error moving message “%{subject}”: ","message mark ok":"Message marked","message flag ko":"Error marking message","message flag ok":"Message marked","message mark ko":"Error marking message: ","draft delete ok":"Draft “%{subject}” deleted","draft delete ko":"Error deleting draft: ","draft move ok":"Draft “%{subject}” moved","draft move ko":"Error moving draft “%{subject}”: ","draft mark ok":"Draft marked","draft mark ko":"Error marking message: ","conversation move ok":"Conversation “%{subject}” moved","conversation move ko":"Error moving conversation “%{subject}”","conversation delete ok":"Conversation “%{subject}” deleted","conversation delete ko":"Error deleting conversation","conversation seen ok":"Conversation marked as read","conversation seen ko":"Error","conversation unseen ok":"Conversation marked as unread","conversation unseen ko":"Error","undo last action":"Undo last action","conversation flagged ko":"Error","conversation noflag ko":"Error","conversations move ok":"%{smart_count} conversation moved||||\n%{smart_count} conversations moved","conversations move ko":"Error moving %{smart_count} conversation||||\nError moving %{smart_count} conversations","conversations delete ok":"%{smart_count} conversation deleted||||\n%{smart_count} conversations deleted","conversations delete ko":"Error deleting %{smart_count} conversation ||||\nError deleting %{smart_count} conversations","conversations seen ok":"%{smart_count} conversation moved||||\n%{smart_count} conversations moved","conversations seen ko":"Error marking %{smart_count} as read||||\nError marking %{smart_count} as read","conversations unseen ok":"%{smart_count} conversation marked as unread||||\n%{smart_count} conversations marked as unread","conversations unseen ko":"Error marking %{smart_count} conversations as unread||||\nError marking %{smart_count} conversations as unread","conversations flagged ko":"Error marking %{smart_count} conversation as flagged||||\nError marking %{smart_count} conversations as flagged","conversations noflag ko":"%{smart_count} conversation unflagged||||\n%{smart_count} conversations unflagged","message images warning":"Display of images inside message has been blocked","message images display":"Display images","message html display":"Display HTML","message delete no trash":"Please select a Trash folder","message delete already":"Message already in trash folder","message move already":"Message already in this folder","undo ok":"Undone","undo ko":"Error undoing some action","undo unavailable":"Undo not available","message preview title":"View attachments","settings title":"Settings","settings button save":"Save","settings plugins":"Add ons","settings plugins":"Modules complémentaires","settings plugin add":"Add","settings plugin del":"Delete","settings plugin help":"Help","settings plugin new name":"Plugin Name","settings plugin new url":"Plugin URL","settings label autosaveDraft":"Save draft message while composing","settings label composeInHTML":"Rich message editor","settings label composeOnTop":"Reply on top of message","settings label desktopNotifications":"Notifications","settings label displayConversation":"Display conversations","settings label displayPreview":"Display message preview","settings label messageDisplayHTML":"Display message in HTML","settings label messageDisplayImages":"Display images inside messages","settings label messageConfirmDelete":"Confirm before deleting a message","settings label layoutStyle":"Display Layout","settings label layoutStyle horizontal":"Horizontal","settings label layoutStyle vertical":"Vertical","settings label layoutStyle three":"Three cols","settings label listStyle":"Message list style","settings label listStyle default":"Normal","settings label listStyle compact":"Compact","settings lang":"Language","settings lang en":"English","settings lang fr":"Français","settings lang de":"Deutsch","settings save error":"Unable to save settings, please try again","picker drop here":"Drop files here or Choose local files","mailbox pick one":"Pick one","mailbox pick null":"No box for this","task account-fetch":"Refreshing %{account}","task box-fetch":"Refreshing %{box}","task apply-diff-fetch":"Fetching mails from %{box} of %{account}","task apply-diff-remove":"Deleting mails from %{box} of %{account}","task recover-uidvalidity":"Analysing","there were errors":"%{smart_count} error. |||| %{smart_count} errors.","modal please report":"Please transmit this information to cozy.","modal please contribute":"Please contribute","modal copy content":"Copy information into clipboard","validate must not be empty":"This field is required","toast hide":"Hide alerts","toast show":"Display alerts","toast close all":"Close all alerts","notif new title":"CozyEmail","notif new":"%{smart_count} message not read in account %{account}||||\n%{smart_count} messages not read in account %{account}","notif complete":"Importation of account %{account} complete.","contact form":"Select contacts","contact form placeholder":"contact name","contact button label":"Add to addressbook","contact create success":"%{contact} has been added to your contacts","contact create error":"Error adding to your contacts : {error}","message contact creation title":"Add a contact","message contact creation":"Do you want to create a contact for %{contact}?","gmail security tile":"About Gmail security","gmail security body":"Gmail considers connection using username and password not safe.\nPlease click on the following link, make sure\nyou are connected with your %{login} account and enable access for\nless secure apps.","gmail security link":"Enable access for less secure apps.","plugin name Gallery":"Attachment gallery","plugin name medium-editor":"Medium editor","plugin name MiniSlate":"MiniSlate editor","plugin name Sample JS":"Sample","plugin name Keyboard shortcuts":"Keyboard shortcuts","plugin name VCard":"Contacts VCards","plugin modal close":"Close","calendar unknown format":"This message contains an invite to an event in a currently unknown format.","tooltip reply":"Answer","tooltip reply all":"Answer to all","tooltip forward":"Forward","tooltip remove message":"Remove","tooltip open attachments":"Open attachment list","tooltip open attachment":"Open attachment","tooltip download attachment":"Download the attachment","tooltip previous conversation":"Go to previous conversation","tooltip next conversation":"Go to next conversation","tooltip filter only unread":"Show only unread messages","tooltip filter only important":"Show only important messages","tooltip filter only attachment":"Show only messages with attachment","tooltip account parameters":"Account parameters","tooltip delete selection":"Delete all selected messages","tooltip filter":"Filter","tooltip display filters":"Display filters","tooltip expunge mailbox":"Expunge mailbox","tooltip add contact":"Add to your contacts","tooltip show contact":"Show contact","tooltip help shortcuts":"Show list of available shortcuts","filters unseen":"unread","filters flagged":"starred","filters attach":"attachments","filters search placeholder":"Search...","search all accounts":"All accounts","daterangepicker placeholder":"by date","daterangepicker presets yesterday":"yesterday","daterangepicker presets last week":"last week","daterangepicker presets last month":"last month","daterangepicker clear":"clear"}}),require.register("locales/fr",function(e,t,n){n.exports={"app loading":"Chargement…","app back":"Retour","app cancel":"Annuler","app confirm":"Oui","app menu":"Menu","app search":"Rechercher…","app alert close":"Fermer","app unimplemented":"Non implémenté","app error":"Oups, une erreur est survenue, veuillez réessayer","app confirm delete":"Confirmation de suppression",compose:"Écrire un nouveau message","compose default":"Bonjour, comment ça va ?","compose from":"De","compose to":"À","compose to help":"Liste des destinataires principaux","compose cc":"Cc","compose cc help":"Liste des destinataires en copie","compose bcc":"Cci","compose bcc help":"Liste des destinataires en copie cachée","compose subject":"Objet","compose content":"Contenu","compose subject help":"Objet du message","compose reply prefix":"Re: ","compose reply separator":"\n\nLe %{date}, %{sender} a écrit \n","compose forward prefix":"Fwd: ","compose forward separator":"\n\nLe %{date}, %{sender} a écrit \n",
"compose action draft":"Enregistrer","compose action send":"Envoyer","compose action sending":"Envoi…","compose action delete":"Supprimer","compose toggle cc":"Copie à","compose toggle bcc":"Copie cachée à","compose error no dest":"Vous n'avez pas saisi de destinataires","compose error no subject":"Vous n'avez pas saisi de sujet","compose confirm keep draft":"Vous n'avez pas envoyé le message, voulez-vous conserver le brouillon ?","compose confirm draft keep":"Conserver le brouillon","compose confirm draft delete":"Supprimer le brouillon","compose wrong email format":"L'addresse mail donnée n'est pas bien formattée : %{address}.","compose forward header":"Message transféré","compose forward subject":"Sujet :","compose forward date":"Date :","compose forward from":"De :","compose forward to":"Pour :","menu show":"Montrer le menu","menu compose":"Nouveau Message","menu account new":"Ajouter un compte","menu settings":"Paramètres","menu mailbox total":"%{smart_count} message |||| %{smart_count} messages ","menu mailbox unread":" dont %{smart_count} non lu |||| dont %{smart_count} non lus ","menu mailbox new":" et %{smart_count} nouveaux |||| et %{smart_count} nouveaux ","menu favorites on":"Moins","menu favorites off":"Plus","menu toggle":"Menu","menu refresh label":"Rafraîchir","menu refreshing":"Rafraîchissement en cours...","list empty":"Pas d'email dans cette boîte..","no flagged message":"Pas d'email important dans cette boîte.","no unseen message":"Pas d'email non-lu dans cette boîte.","no attach message":"Pas d'email avec des pièces jointes.","no filter message":"Pas d'email pour ce filtre.","list fetching":"Chargement…","list search empty":'Aucun résultat trouvé pour la requête "%{query}".',"list count":"%{smart_count} message dans cette boite |||| %{smart_count} messages dans cette boite","list search count":"%{smart_count} résultat trouvé. |||| %{smart_count} résultats trouvés.","list filter":"Filtrer","list filter all":"Tous","list filter unseen":"Non lus","list filter flagged":"Importants","list filter attach":"Pièces jointes","list filter from":"Expédié par","list filter date":"Date entre","list filter date placeholder":"JJ/MM/AAAA","list filter dest":"Destiné à","list filter subject":"Sujet commence par…","list sort":"Trier","list sort date":"Date","list sort subject":"Sujet","list option compact":"Compact","list next page":"Davantage de messages","list end":"FIN","list mass no message":"Aucun message sélectionné","list delete confirm":"Voulez-vous vraiment supprimer ce message ?||||\nVoulez-vous vraiment supprimer %{smart_count} messages ?","list delete conv confirm":"Voulez-vous vraiment supprimer cette conversation ?||||\nVoulez-vous vraiment supprimer %{smart_count} conversations ?","mail to":"À ","mail cc":"Copie ","headers from":"De","headers to":"À","headers cc":"Copie","headers reply-to":"Répondre à","headers date":"Date","headers subject":"Objet","load more messages":"afficher %{smart_count} message supplémentaire |||| afficher %{smart_count} messages supplémentaires","length bytes":"octets","length kbytes":"ko","length mbytes":"Mo","mail action reply":"Répondre","mail action reply all":"Répondre à tous","mail action forward":"Transférer","mail action delete":"Supprimer","mail action mark":"Marquer comme","mail action copy":"Copier","mail action move":"Déplacer","mail action more":"Plus","mail action headers":"Entêtes","mail action raw":"Message brut","mail mark spam":"Pourriel","mail mark nospam":"Légitime","mail mark fav":"Important","mail mark nofav":"Normal","mail mark read":"Lu","mail mark unread":"Non lu","mail confirm delete title":"Supprimer le message","mail confirm delete":"Voulez-vous vraiment supprimer le message « %{subject} » ?","mail confirm delete nosubject":"Voulez-vous vraiment supprimer ce message","mail confirm delete cancel":"Annuler","mail confirm delete delete":"Supprimer","mail action conversation delete":"Supprimer la conversation","mail action conversation move":"Déplacer la conversation","mail action conversation seen":"Marquer la conversation comme lue","mail action conversation unseen":"Marquer la conversation comme non lue","mail action conversation flagged":"Marquer la conversation comme importante","mail action conversation noflag":"Marquer la conversation comme normale","mail conversation length":"%{smart_count} message dans cette conversation. ||||\n%{smart_count} messages dans cette conversation.","account new":"Nouveau compte","account edit":"Modifier le compte","account add":"Créer","account save":"Enregistrer","account saving":"En cours…","account check":"Tester la connexion","account accountType short":"IMAP","account accountType":"Type de compte","account imapPort short":"993","account imapPort":"Port","account imapSSL":"Utiliser SSL","account imapServer short":"imap.fournisseur.tld","account imapServer":"Serveur IMAP","account imapTLS":"Utiliser STARTTLS","account imapLogin short":"Utilisateur IMAP","account imapLogin":"Utilisateur IMAP (s'il est différent de l'adresse mail)","account label short":"Nom abrégé","account label":"Nom du compte","account login short":"Votre adresse électronique","account login":"Adresse","account name short":"Votre nom, tel qu'il sera affiché","account name":"Votre nom","account oauth":"Ce compte est lié à un compte Google via OAuth","account password":"Mot de passe","account receiving server":"Serveur de réception","account sending server":"Serveur d'envoi","account smtpLogin short":"Utilisateur SMTP","account smtpLogin":"Utilisateur SMTP (s'il est différent de l'adresse Mail)","account smtpMethod":"Méthode d'authentification","account smtpMethod NONE":"Aucune","account smtpMethod PLAIN":"Simple","account smtpMethod LOGIN":"Login","account smtpMethod CRAM-MD5":"Cram-MD5","account smtpPassword short":"Mot de passe SMTP","account smtpPassword":"Mot de passe SMTP (s'il est différent de celui du serveur IMAP)","account smtpPort short":"465","account smtpPort":"Port","account smtpSSL":"Utiliser SSL","account smtpServer short":"smtp.fournisseur.tld","account smtpServer":"Serveur sortant","account smtpTLS":"Utiliser STARTTLS","account remove":"Supprimer ce compte","account removed":"Compte supprimé","account remove confirm":"Voulez-vous vraiment supprimer le compte « %{label} » ?","account draft mailbox":"Enregistrer les brouillons dans","account sent mailbox":"Enregistrer les messages envoyés dans","account trash mailbox":"Corbeille","account mailboxes":"Dossiers","account special mailboxes":"Dossiers spéciaux","account newmailbox label":"Nouveaux dossier","account newmailbox placeholder":"Nom","account newmailbox parent":"Créer sous","account confirm delbox":"Voulez-vous vraiment supprimer tous les messages de la corbeille ?","account tab account":"Compte","account tab mailboxes":"Dossiers","account errors":"Certaines informations manquent ou sont incorrectes","account type":"Type de compte","account updated":"Modification enregistrée","account checked":"Paramètres corrects","account refreshed":"Actualisé","account refresh error":"Une erreur est survenue, vérifiez les paramètres de connexion aux comptes","account creation ok":"Youpi, le compte a été créé ! Sélectionnez à présent les dossiers que vous voulez voir apparaitre dans le menu","account identifiers":"Identification","account danger zone":"Zone dangereuse","account actions":"Actions","account no special mailboxes":"Vous devez choisir un dossier spécifique pour vos Brouillons, emails envoyés et supprimés.","account imap hide advanced":"Masquer les paramètres avancés","account imap show advanced":"Afficher les paramètres avancés","account smtp hide advanced":"Masquer les paramètres avancés","account smtp show advanced":"Afficher les paramètres avancés","account tab signature":"Signature","account signature short":"Saisissez ici le texte qui sera ajouté à la fin de vos courriers.","account signature":"Signature des courriers","account signature save":"Enregistrer","mailbox create ok":"Dossier créé","mailbox create ko":"Erreur de création du dossier","mailbox update ok":"Dossier mis à jour","mailbox update ko":"Erreur de mise à jour","mailbox delete ok":"Dossier supprimé","mailbox delete ko":"Erreur de suppression du dossier","mailbox expunge ok":"Corbeille vidée","mailbox expunge ko":"Erreur de suppression des messages","mailbox title edit":"Renommer le dossier","mailbox title delete":"Supprimer le dossier","mailbox title edit save":"Enregistrer","mailbox title edit cancel":"Annuler","mailbox title add":"Créer un dossier","mailbox title add cancel":"Annuler","mailbox title favorite":"Dossier affiché","mailbox title not favorite":"Dossier non affiché","mailbox title total":"Total","mailbox title unread":"Non lus","mailbox title new":"Nouveaux","config error auth":"Impossible de se connecter avec ces paramètres","config error imapPort":"Paramètres du serveur IMAP invalides","config error imapServer":"Serveur IMAP invalide","config error imapTLS":"Erreur IMAP TLS","config error smtpPort":"Port du serveur d'envoi invalide","config error smtpServer":"Serveur d'envoi invalide","config error nomailboxes":"Ce compte n'a pas encore de dossier, commencez par en créer","action undo":"Annuler","action undo ok":"Action Annulée","action undo ko":"Impossible d'annuler l'action","message action sent ok":"Message envoyé !","message action sent ko":"Une erreur est survenue : ","message action draft ok":"Message sauvegardé !","message action draft ko":"Une erreur est survenue : ","message delete ok":"Message « %{subject} » supprimé","message delete ko":"Impossible de supprimer le message : ","message move ok":"Message « %{subject} » déplacé","message move ko":"Le déplacement de « %{subject} » a échoué","message mark ok":"Le message a été mis à jour","message mark ko":"L'opération a échoué","draft delete ok":"Le brouillon « %{subject} » a été supprimé","draft delete ko":"Erreur lors de la suppression du brouillon « %{subject} » : ","draft move ok":"Le brouillon a été « %{subject} » déplacé","draft move ko":"Erreur lors du déplacement du brouillon « %{subject} » : ","draft mark ok":"Brouillon « %{subject} » mis à jour","draft mark ko":"Erreur de mise à jour du brouillon « %{subject} » : ","conversation move ok":"Conversation « %{subject} » déplacée","conversation move ko":"Le déplacement de « %{subject} » a échoué","conversation delete ok":"Conversation « %{subject} » supprimée","conversation delete ko":"L'opération a échoué","conversation seen ok":"Ok","conversation seen ko":"L'opération a échoué","conversation unseen ok":"Ok","conversation unseen ko":"L'opération a échoué","undo last action":"Annuler","conversation flagged ko":"L'opération a échoué","conversation noflag ko":"L'opération a échoué","conversations move ok":"%{smart_count} conversation déplacée||||\n%{smart_count} conversations déplacées","conversations move ko":"Erreur au déplacement de %{smart_count} conversation||||\nError au déplacement de %{smart_count} conversations","conversations delete ok":"%{smart_count} conversation supprimée||||\n%{smart_count} conversations supprimées","conversations delete ko":"Erreur de suppression de %{smart_count} conversation ||||\nErreur de suppression de %{smart_count} conversations","conversations seen ok":"%{smart_count} conversation marquée lue||||\n%{smart_count} conversations marquées lues","conversations seen ko":"Erreur en marquant %{smart_count} conversation lue||||\nErreur en marquant %{smart_count} conversations lues","conversations unseen ok":"%{smart_count} conversation marquée non-lue||||\n%{smart_count} conversations marquées non-lues","conversations unseen ko":"Erreur en marquant %{smart_count} conversation non-lue||||\nErreur en marquant %{smart_count} conversations non-lues","conversations flagged ko":"Erreur en marquant %{smart_count} conversation importante||||\nErreur en marquant %{smart_count} conversations importantes","conversations noflag ko":"Erreur en marquant %{smart_count} conversation non importante||||\nErreur en marquant %{smart_count} conversations non importantes","message images warning":"L'affichage des images du message a été bloqué","message images display":"Afficher les images","message html display":"Afficher en HTML","message delete no trash":"Choisissez d'abord un dossier Corbeille","message delete already":"Ce message est déjà dans la corbeille","message move already":"Ce message est déjà dans ce dossier","undo ok":"Action annulée","undo ko":"Impossible d'annuler l'action","undo unavailable":"Impossible d'annuler l'action","message preview title":"Voir les pièces jointes","settings title":"Paramètres","settings button save":"Enregistrer","settings plugins":"Modules complémentaires","settings plugin add":"Ajouter","settings plugin del":"Supprimer","settings plugin help":"Documentation","settings plugin new name":"Nom du plugin","settings plugin new url":"Url du plugin","settings label autosaveDraft":"Enregistrer périodiquement les brouillons","settings label composeInHTML":"Éditeur riche","settings label composeOnTop":"Répondre au-dessus du message","settings label desktopNotifications":"Notifications","settings label displayConversation":"Afficher les conversations","settings label displayPreview":"Prévisualiser les messages","settings label messageDisplayHTML":"Afficher les messages en HTML","settings label messageDisplayImages":"Afficher les images","settings label messageConfirmDelete":"Demander confirmation avant de supprimer un message","settings label layoutStyle":"Affichage","settings label layoutStyle horizontal":"Message sous la liste","settings label layoutStyle vertical":"Message à côté de la liste","settings label layoutStyle three":"Trois colonnes","settings label listStyle":"Affichage de la liste des messages","settings label listStyle default":"Normal","settings label listStyle compact":"Compact","settings lang":"Langue","settings lang en":"English","settings lang fr":"Français","settings lang de":"Deutsch","settings save error":"Erreur d'enregistrement des paramètres, veuillez réessayer","picker drop here":"Déposer les fichiers ici ou chercher des fichiers locaux","mailbox pick one":"Choisissez une boîte","mailbox pick null":"Pas de boîte pour ça","task account-fetch":"Rafraîchissement %{account}","task box-fetch":"Rafraîchissement %{box}","task apply-diff-fetch":"Téléchargement des messages du dossier %{box} de %{account}","task apply-diff-remove":"Suppression des messages du dossier %{box} de %{account}","task recover-uidvalidity":"Analyse du compte","there were errors":"%{smart_count} erreur. |||| %{smart_count} erreurs.","modal please report":"Merci de bien vouloir transmettre ces informations à cozy.","modal please contribute":"Merci de contribuer","modal copy content":"Copier ces informations dans le presse papier","validate must not be empty":"Ce champ doit être renseigné","toast hide":"Masquer les alertes","toast show":"Afficher les alertes","toast close all":"Fermer toutes les alertes","notif new title":"Messagerie Cozy","notif new":"%{smart_count} message non-lu dans le compte %{account}||||\n%{smart_count} messages non-lus dans le compte  %{account}","notif complete":"Importation du compte %{account} finie.","contact form":"Sélectionnez des contacts","contact form placeholder":"Nom","contact button label":"Ajouter au carnet d'adresse","contact create success":"%{contact} a été ajouté(e) à vos contacts","contact create error":"L'ajout à votre carnet d'adresses a échoué : {error}","message contact creation title":"Ajouter un contact","message contact creation":"Voulez vous ajouter %{contact} à votre carnet d'adresse ?","gmail security tile":"Sécurité Gmail","gmail security body":"Gmail considère les connexions par nom d'utilisateur et mot de passe\ncomme non sécurisées. Veuillez cliquer sur le lien ci-dessous, assurez-vous\nd'être connecté avec le compte %{login} et activez l'accès\npour les applications moins sécurisées.","gmail security link":"Activer l'accès pour les applications moins sécurisées","plugin name Gallery":"Galerie de pièces jointes","plugin name medium-editor":"Éditeur Medium","plugin name MiniSlate":"Éditeur MiniSlate","plugin name Sample JS":"Exemple","plugin name Keyboard shortcuts":"Raccourcis clavier","plugin name VCard":"Affichage de VCard","plugin modal close":"Fermer","calendar unknown format":"Ce message contient une invitation à un évènement\ndans un format actuellement non pris en charge.","tooltip reply":"Répondre","tooltip reply all":"Répondre à tous","tooltip forward":"Transférer","tooltip remove message":"Supprimer","tooltip open attachments":"Ouvrir la liste des pièces jointes","tooltip open attachment":"Ouvrir la pièce jointe","tooltip download attachment":"Télécharger la pièce jointe","tooltip previous conversation":"Aller à la conversation précédente","tooltip next conversation":"Aller à la conversation suivante","tooltip filter only unread":"Montrer seulement les messages non lus","tooltip filter only important":"Montrer seulement les messages importants","tooltip filter only attachment":"Montrer seulement les messages avec pièce jointe","tooltip account parameters":"Paramètres du compte","tooltip delete selection":"Supprimer les messages sélectionnés","tooltip filter":"Filtrer","tooltip display filters":"Afficher les filtres","tooltip expunge mailbox":"Vider la boite","tooltip add contact":"Ajouter à vos contacts","tooltip show contact":"Voir les détails du contact","filters unseen":"non-lus","filters flagged":"favoris","filters attach":"pièces jointes","filters search placeholder":"rechercher…","daterangepicker placeholder":"par date","daterangepicker presets yesterday":"hier","daterangepicker presets last week":"semaine dernière","daterangepicker presets last month":"mois dernier","daterangepicker clear":"effacer"}}),require.register("mixins/participant_mixin",function(e,t,n){var r,o,i,s,a,l;l=React.DOM,a=l.span,i=l.a,s=l.i,o=t("../stores/contact_store"),r=t("../components/contact_label"),n.exports={formatUsers:function(e){var t,n,o,i;if(null!=e){if(_.isArray(e)){for(t=[],o=0,i=e.length;i>o;o++)n=e[o],t.push(r({contact:n,tooltip:!0})),n!==_.last(e)&&t.push(", ");return t}return r({contact:e,tooltip:!0})}}}}),require.register("mixins/router_mixin",function(e,t,n){var r;r=window.router,n.exports={buildUrl:function(e){return r.buildUrl.call(r,e)},buildClosePanelUrl:function(e){return r.buildClosePanelUrl.call(r,e)},redirect:function(e){var t;return t="string"==typeof e?e:this.buildUrl(e),r.navigate(t,!0)}}}),require.register("mixins/should_update_mixin",function(e,t,n){var r,o={}.hasOwnProperty;r=function(e,t,n){var r,i;if(e===t)return!0;for(r in e)if(o.call(e,r)&&(i=e[r],t[r]!==i))return n&&console.log("DIFF ON "+r),!1;for(r in t)if(o.call(t,r)&&null!=t[r]&&null==e[r])return n&&console.log("LOST "+r),!1;return!0},n.exports={ImmutableEquality:{shouldComponentUpdate:function(e,t){return r(this.props,e)&&r(this.state,t)}},UnderscoreEqualitySlow:{shouldComponentUpdate:function(e,t){var n,r;return r=_.isEqual(t,this.state),n=_.isEqual(e,this.props),!(r&&n)}},Logging:{shouldComponentUpdate:function(e,t){return!r(e,this.props,!0)||!r(t,this.state,!0)}}}}),require.register("mixins/store_watch_mixin",function(e,t,n){var r;n.exports=r=function(e){return{componentDidMount:function(){return e.forEach(function(e){return function(t){return t.on("change",e._setStateFromStores)}}(this))},componentWillUnmount:function(){return e.forEach(function(e){return function(t){return t.removeListener("change",e._setStateFromStores)}}(this))},getInitialState:function(){return this.getStateFromStores()},_setStateFromStores:function(){return this.isMounted()?this.setState(this.getStateFromStores()):void 0}}}}),require.register("mixins/tooltip_refresher_mixin",function(e,t,n){var r;n.exports=r={componentDidMount:function(){return AriaTips.bind()},componentDidUpdate:function(){}}}),require.register("prosemirror/collab/index",function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=t("../edit"),s=t("./rebase");e.rebaseSteps=s.rebaseSteps,i.defineOption("collab",!1,function(e,t){e.mod.collab&&(e.mod.collab.detach(),e.mod.collab=null),t&&(e.mod.collab=new a(e,t))});var a=function(){function e(t,n){var o=this;r(this,e),this.pm=t,this.options=n,this.version=n.version||0,this.versionDoc=t.doc,this.unconfirmedSteps=[],this.unconfirmedMaps=[],t.on("transform",this.onTransform=function(e){for(var t=0;t<e.steps.length;t++)o.unconfirmedSteps.push(e.steps[t]),o.unconfirmedMaps.push(e.maps[t]);o.signal("mustSend")}),t.on("beforeSetDoc",this.onSetDoc=function(){throw new Error("setDoc is not supported on a collaborative editor")}),t.history.allowCollapsing=!1}return o(e,[{key:"detach",value:function(){this.pm.off("transform",this.onTransform),this.pm.off("beforeSetDoc",this.onSetDoc),this.pm.history.allowCollapsing=!0}},{key:"hasSendableSteps",value:function(){return this.unconfirmedSteps.length>0}},{key:"sendableSteps",value:function(){return{version:this.version,doc:this.pm.doc,steps:this.unconfirmedSteps.slice()}}},{key:"confirmSteps",value:function(e){this.unconfirmedSteps.splice(0,e.steps.length),this.unconfirmedMaps.splice(0,e.steps.length),this.version+=e.steps.length,this.versionDoc=e.doc}},{key:"receive",value:function(e){var t=this.versionDoc,n=e.map(function(e){var n=e.apply(t);return t=n.doc,n.map});this.version+=e.length,this.versionDoc=t;var r=s.rebaseSteps(t,n,this.unconfirmedSteps,this.unconfirmedMaps);return this.unconfirmedSteps=r.transform.steps.slice(),this.unconfirmedMaps=r.transform.maps.slice(),this.pm.updateDoc(r.doc,r.mapping),this.pm.history.rebased(n,r.transform,r.positions),n}}]),e}();i.eventMixin(a)}),require.register("prosemirror/collab/rebase",function(e,t,n){"use strict";function r(e,t,n,r){for(var i=new o.Remapping([],t.slice()),s=new o.Transform(e),a=[],l=0;l<n.length;l++){var c=o.mapStep(n[l],i),u=c&&s.step(c),p=i.addToFront(r[l].invert());u?(i.addToBack(u.map,p),a.push(s.steps.length-1)):a.push(-1)}return{doc:s.doc,transform:s,mapping:i,positions:a}}Object.defineProperty(e,"__esModule",{value:!0}),e.rebaseSteps=r;var o=t("../transform")}),require.register("prosemirror/dom/index",function(e,t,n){"use strict";function r(e,t){var n=document.createElement(e);if(t)for(var r in t)"style"==r?n.style.cssText=t[r]:null!=t[r]&&n.setAttribute(r,t[r]);for(var i=arguments.length,s=Array(i>2?i-2:0),a=2;i>a;a++)s[a-2]=arguments[a];for(var l=0;l<s.length;l++)o(s[l],n);return n}function o(e,t){if("string"==typeof e&&(e=document.createTextNode(e)),Array.isArray(e))for(var n=0;n<e.length;n++)o(e[n],t);else t.appendChild(e)}function i(e){p?p(e):setTimeout(e,10)}function s(e){return new RegExp("(^|\\s)"+e+"(?:$|\\s)\\s*")}function a(e,t){var n=e.className,r=s(t).exec(n);if(r){var o=n.slice(r.index+r[0].length);e.className=n.slice(0,r.index)+(o?r[1]+o:"")}}function l(e,t){var n=e.className;s(t).test(n)||(e.className+=(n?" ":"")+t)}function c(e,t){return 1!=t.nodeType&&(t=t.parentNode),t&&e.contains(t)}function u(e){var t=document.createElement("style");t.textContent=e,document.head.insertBefore(t,document.head.firstChild)}Object.defineProperty(e,"__esModule",{value:!0}),e.elt=r,e.requestAnimationFrame=i,e.rmClass=a,e.addClass=l,e.contains=c,e.insertCSS=u;var p=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,d=/MSIE \d/.test(navigator.userAgent),h=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),f={mac:/Mac/.test(navigator.platform),ie_upto10:d,ie_11up:h,ie:d||h,gecko:/gecko\/\d/i.test(navigator.userAgent)};e.browser=f}),require.register("prosemirror/edit/capturekeys",function(e,t,n){"use strict";function r(){}function o(e){if(e.selection.node){var t=i.findSelectionNear(e.doc,e.selection.from,1,!0);t&&i.setDOMSelectionToPos(e,t.head)}return!1}Object.defineProperty(e,"__esModule",{value:!0});var i=t("./selection"),s=t("../dom"),a=t("./keys"),l={Esc:r,Enter:r,"Mod-Enter":r,"Shift-Enter":r,Backspace:r,Delete:r,"Mod-B":r,"Mod-I":r,"Mod-Backspace":r,"Mod-Delete":r,"Shift-Backspace":r,"Shift-Delete":r,"Shift-Mod-Backspace":r,"Shift-Mod-Delete":r,"Mod-Z":r,"Mod-Y":r,"Shift-Mod-Z":r,"Ctrl-D":r,"Ctrl-H":r,"Ctrl-Alt-Backspace":r,"Alt-D":r,"Alt-Delete":r,"Alt-Backspace":r,"Mod-A":o};["Left","Right","Up","Down","Home","End","PageUp","PageDown"].forEach(function(e){l[e]=l["Shift-"+e]=l["Mod-"+e]=l["Shift-Mod-"+e]=l["Alt-"+e]=l["Shift-Alt-"+e]=o}),["Left","Mod-Left","Right","Mod-Right","Up","Down"].forEach(function(e){return delete l[e]}),s.browser.mac&&(l["Ctrl-F"]=l["Ctrl-B"]=l["Ctrl-P"]=l["Ctrl-N"]=l["Alt-F"]=l["Alt-B"]=l["Ctrl-A"]=l["Ctrl-E"]=l["Ctrl-V"]=l.goPageUp=o);var c=new a.Keymap(l);e.captureKeys=c}),require.register("prosemirror/edit/char",function(e,t,n){"use strict";function r(e){return/\w/.test(e)||i(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||s.test(e))}function o(e){return/\s/.test(e)?"space":r(e)?"word":"other"}function i(e){return e.charCodeAt(0)>=768&&a.test(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.isWordChar=r,e.charCategory=o,e.isExtendingChar=i;var s=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,a=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/}),require.register("prosemirror/edit/commands",function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){q[e]=t instanceof H?t:new H(e,t)}function a(e,t){j[e]=t}function l(e){var t=e.options.commandParamHandler;return t&&j[t]?j[t]:void 0}function c(e){function t(e){var t=function(t){var r=e[t],o=r.commands;o&&o.forEach(function(e){var t=e.name,o=e.create;n[t]=new H(t,o(r))})};for(var r in e)t(r)}var n=Object.create(null);for(var r in q)n[r]=q[r];return t(e.nodes),t(e.styles),n}function u(e){function t(e,r){if(Array.isArray(r))for(var o=0;o<r.length;o++)t(e,r[o]);else if(r){var i=/^(.+?)(?:\((\d+)\))?$/.exec(r),s=A(i,3),a=(s[0],s[1]),l=s[2],c=void 0===l?50:l;P["default"](n[a]||(n[a]=[]),{command:e,rank:c},function(e,t){return e.rank-t.rank})}}var n={};for(var r in e.commands){var o=e.commands[r];t(r,o.info.key),t(r,O.browser.mac?o.info.macKey:o.info.pcKey)}for(var i in n)n[i]=n[i].map(function(e){return e.command});return new F.Keymap(n)}function p(e,t){var n=e.selection;return n.empty?R.containsStyle(e.activeStyles(),t):R.rangeHasStyle(e.doc,n.from,n.to,t)}function d(e,t){var n=e.selection,r=n.from,o=n.to,i=n.empty;if(i)return!R.containsStyle(e.activeStyles(),t)&&e.doc.path(r.path).type.canContainStyle(t);var s=!1;return e.doc.nodesBetween(r,o,function(e){return s||e.isTextblock&&!e.type.canContainStyle(t)?!1:void(e.isInline&&!R.containsStyle(e.styles,t)&&(s=!0))}),s}function h(e,t){var n=e.selection,r=n.from,o=n.to,i=!1;return e.doc.nodesBetween(r,o,function(e){return e.isTextblock?(e.type.canContainStyle(t)&&(i=!0),!1):void 0}),i}function f(e,t,n,r){n||(n=t);var o=t.charAt(0).toUpperCase()+t.slice(1);e.attachCommand("set"+o,function(e){return{label:"Set "+n,run:function(t){t.setStyle(e,!0)},select:function(t){return d(t,e)},icon:{from:t}}}),e.attachCommand("unset"+o,function(e){return{label:"Remove "+n,run:function(t){t.setStyle(e,!1)},select:function(t){return p(t,e)},icon:{from:t}}}),e.attachCommand(t,function(e){var t={label:"Toggle "+n,run:function(t){t.setStyle(e,null)},active:function(t){return p(t,e)},select:function(t){return h(t,e)}};for(var o in r)t[o]=r[o];return t})}function m(e,t,n){if("char"!=n&&"word"!=n)throw new Error("Unknown motion unit: "+n);for(var r=e.childBefore(t),o=r.index,i=r.innerOffset,s=null,a=0;o>=0;o--,i=null){var l=e.child(o),c=l.offset;if(!l.isText)return s?t:t-1;if("char"==n)for(var u=null==i?c:i;u>0;u--){if(!L.isExtendingChar(l.text.charAt(u-1)))return t-1;t--}else if("word"==n)for(var u=null==i?c:i;u>0;u--){var p=L.charCategory(l.text.charAt(u-1));if(null==s||1==a&&"space"==s)s=p;else if(s!=p)return t;t--,a++}}return t}function g(e,t){var n=e.doc.path(t.path),r=n.child(t.offset-1),i=n.child(t.offset);if(!r.type.canContainChildren(i)||e.tr.join(t).apply(B)===!1){var s=void 0;if(i.isTextblock&&(s=r.type.findConnection(i.type))){var a=e.tr,l=t.move(1);if(a.step("ancestor",t,l,null,{types:[r.type].concat(o(s)),attrs:[r.attrs].concat(o(s.map(function(){return null})))}),a.join(l),a.join(t),a.apply(B)!==!1)return}var c=U.findSelectionFrom(e.doc,t,1);return e.tr.lift(c.from,c.to).apply(B)}}function v(e,t,n){if("char"!=n&&"word"!=n)throw new Error("Unknown motion unit: "+n);for(var r=e.childAfter(t),o=r.index,i=r.innerOffset,s=null,a=0;o<e.length;o++,i=0){var l=e.child(o),c=l.offset;if(!l.isText)return s?t:t+1;if("char"==n)for(var u=i;c>u;u++){if(!L.isExtendingChar(l.text.charAt(u+1)))return t+1;t++}else if("word"==n)for(var u=i;c>u;u++){var p=L.charCategory(l.text.charAt(u));if(null==s||1==a&&"space"==s)s=p;else if(s!=p)return t;t++,a++}}return t}function y(e){var t=e.selection,n=t.node,r=t.from;return n?N.joinableBlocks(e.doc,r)?r:null:N.joinPoint(e.doc,r,-1)}function b(e){var t=e.selection,n=t.node,r=t.to;return n?N.joinableBlocks(e.doc,r)?r:null:N.joinPoint(e.doc,r,1)}function S(e,t,n,r){return R.Pos.samePath(t.path,n.path)&&t.path.length>=2&&0==t.path[t.path.length-1]&&r.canContain(e.path(t.path.slice(0,t.path.length-1)))}function k(e,t,n,r,o){e.attachCommand("wrap"+t,function(e){var t={label:"Wrap in "+n,run:function(t){var n=t.selection,o=n.from,i=n.to,s=n.head,a=!1;if(r&&s&&S(t.doc,o,i,e)){if(0==o.path[o.path.length-2])return!1;a=!0}var l=t.tr.wrap(o,i,e);return a&&l.join(o.shorten(o.depth-2)),l.apply(B)},select:function(t){var n=t.selection,o=n.from,i=n.to,s=n.head;return r&&s&&S(t.doc,o,i,e)&&0==o.path[o.path.length-2]?!1:N.canWrap(t.doc,o,i,e);
}};for(var i in o)t[i]=o[i];return t})}function w(e,t,n,r,o){r||(r={}),e.attachCommand(t,function(e){return{label:"Change to "+n,run:function(t){var n=t.selection,o=n.from,i=n.to;return t.tr.setBlockType(o,i,e,r).apply(B)},select:function(t){var n=t.selection,o=n.from,i=n.to,s=n.node;return s?s.isTextblock&&!R.compareMarkup(e,s.type,r,s.attrs):!N.alreadyHasBlockType(t.doc,o,i,e,r)},key:o}})}function E(e){var t=e.schema.cached.textblockTypes;if(t)return t;var n=[];for(var r in e.schema.nodes){var o=e.schema.nodes[r];if(o.textblockTypes)for(var i=0;i<o.textblockTypes.length;i++){var s=o.textblockTypes[i];P["default"](n,{label:s.label,value:{type:o,attrs:s.attrs},rank:s.rank},function(e,t){return e.rank-t.rank})}}return e.schema.cached.textblockTypes=n}function _(e){var t=e.selection,n=t.from,r=t.to,o=t.node;if(!o||o.isInline){if(!R.Pos.samePath(n.path,r.path))return null;o=e.doc.path(n.path)}else if(!o.isTextblock)return null;for(var i=E(e),s=0;s<i.length;s++){var a=i[s],l=a.value;if(R.compareMarkup(l.type,o.type,l.attrs,o.attrs))return a}}function x(e){var t=e.selection,n=0;if(t.node)return!!t.from.depth&&t.from.shorten();for(;n<t.head.depth&&n<t.anchor.depth&&t.head.path[n]==t.anchor.path[n];n++);return 0==n?!1:t.head.shorten(n-1)}function C(e,t){var n=e.selection,r=n.from,o=n.to,i=n.node,s=t>0?o:r;return U.findSelectionFrom(e.doc,i&&i.isBlock?s:s.shorten(null,t>0?1:0),t)}function T(e,t){var n=e.selection,r=n.empty,o=n.node,i=n.from,s=n.to;if(!r&&!o)return!1;if(o&&o.isInline)return e.setSelection(t>0?s:i),!0;var a=void 0;if(!o&&(a=e.doc.path(i.path))&&(t>0?i.offset<a.maxOffset:i.offset)){var l=t>0?a.childAfter(i.offset):a.childBefore(i.offset),c=l.node,u=l.innerOffset;return c&&c.type.selectable&&(t>0?!u:u==c.offset)?(e.setNodeSelection(0>t?i.move(-1):i),!0):!1}var p=C(e,t);return p&&(p instanceof U.NodeSelection||o)?(e.setSelection(p),!0):!1}function M(e,t){var n=e.selection,r=n.empty,o=n.node,i=n.from,s=n.to;if(!r&&!o)return!1;var a=!0;if((!o||o.isInline)&&(a=U.verticalMotionLeavesTextblock(e,t>0?s:i,t)),a){var l=C(e,t);if(l&&l instanceof U.NodeSelection)return e.setSelection(l),o||(e.sel.lastNonNodePos=i),!0}if(!o)return!1;if(o.isInline)return U.setDOMSelectionToPos(e,i),!1;var c=e.sel.lastNonNodePos,u=U.findSelectionFrom(e.doc,0>t?i:s,t);return c&&u&&R.Pos.samePath(c.path,u.from.path)?(U.setDOMSelectionToPos(e,c),!1):(e.setSelection(u),!0)}Object.defineProperty(e,"__esModule",{value:!0});var A=function(){function e(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(l){o=!0,i=l}finally{try{!r&&a["return"]&&a["return"]()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),D=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();e.defineCommand=s,e.defineParamHandler=a,e.initCommands=c,e.defaultKeymap=u;var R=t("../model"),N=t("../transform"),O=t("../dom"),I=t("../util/sortedinsert"),P=r(I),L=t("./char"),F=t("./keys"),U=t("./selection"),q=Object.create(null),j=Object.create(null);R.NodeType.attachCommand=R.StyleType.attachCommand=function(e,t){this.register("commands",{name:e,create:t})};var H=function(){function e(t,n){i(this,e),this.name=t,this.label=n.label||t,this.run=n.run,this.params=n.params||[],this.select=n.select||function(){return!0},this.active=n.active||function(){return!1},this.info=n,this.display=n.display||"icon"}return D(e,[{key:"exec",value:function(e,t){var n=this;if(!this.params.length)return this.run(e);if(t)return this.run.apply(this,[e].concat(o(t)));var r=l(e);return r?void r(e,this,function(t){t&&n.run.apply(n,[e].concat(o(t)))}):!1}}]),e}();e.Command=H;var B={scrollIntoView:!0};R.HardBreak.attachCommand("insertHardBreak",function(e){return{label:"Insert hard break",run:function(t){var n=t.selection,r=n.node,o=n.from;return r&&r.isBlock?!1:t.doc.path(o.path).type.isCode?t.tr.typeText("\n").apply(B):t.tr.replaceSelection(e.create()).apply(B)},key:["Mod-Enter","Shift-Enter"]}}),f(R.StrongStyle,"strong",null,{menuGroup:"inline",menuRank:20,icon:{width:805,height:1024,path:"M317 869q42 18 80 18 214 0 214-191 0-65-23-102-15-25-35-42t-38-26-46-14-48-6-54-1q-41 0-57 5 0 30-0 90t-0 90q0 4-0 38t-0 55 2 47 6 38zM309 442q24 4 62 4 46 0 81-7t62-25 42-51 14-81q0-40-16-70t-45-46-61-24-70-8q-28 0-74 7 0 28 2 86t2 86q0 15-0 45t-0 45q0 26 0 39zM0 950l1-53q8-2 48-9t60-15q4-6 7-15t4-19 3-18 1-21 0-19v-37q0-561-12-585-2-4-12-8t-25-6-28-4-27-2-17-1l-2-47q56-1 194-6t213-5q13 0 39 0t38 0q40 0 78 7t73 24 61 40 42 59 16 78q0 29-9 54t-22 41-36 32-41 25-48 22q88 20 146 76t58 141q0 57-20 102t-53 74-78 48-93 27-100 8q-25 0-75-1t-75-1q-60 0-175 6t-132 6z"},key:"Mod-B"}),f(R.EmStyle,"em","emphasis",{menuGroup:"inline",menuRank:21,icon:{width:585,height:1024,path:"M0 949l9-48q3-1 46-12t63-21q16-20 23-57 0-4 35-165t65-310 29-169v-14q-13-7-31-10t-39-4-33-3l10-58q18 1 68 3t85 4 68 1q27 0 56-1t69-4 56-3q-2 22-10 50-17 5-58 16t-62 19q-4 10-8 24t-5 22-4 26-3 24q-15 84-50 239t-44 203q-1 5-7 33t-11 51-9 47-3 32l0 10q9 2 105 17-1 25-9 56-6 0-18 0t-18 0q-16 0-49-5t-49-5q-78-1-117-1-29 0-81 5t-69 6z"},key:"Mod-I"}),f(R.CodeStyle,"code",null,{menuGroup:"inline",menuRank:22,icon:{width:896,height:1024,path:"M608 192l-96 96 224 224-224 224 96 96 288-320-288-320zM288 192l-288 320 288 320 96-96-224-224 224-224-96-96z"},key:"Mod-`"}),R.LinkStyle.attachCommand("unlink",function(e){return{label:"Unlink",run:function(t){t.setStyle(e,!1)},select:function(t){return p(t,e)},active:function(){return!0},menuGroup:"inline",menuRank:30,icon:{from:"link"}}}),R.LinkStyle.attachCommand("link",function(e){return{label:"Add link",run:function(t,n,r){t.setStyle(e,!0,{href:n,title:r})},params:[{name:"Target",type:"text"},{name:"Title",type:"text","default":""}],select:function(t){return h(t,e)&&!p(t,e)},menuGroup:"inline",menuRank:30,icon:{width:951,height:1024,path:"M832 694q0-22-16-38l-118-118q-16-16-38-16-24 0-41 18 1 1 10 10t12 12 8 10 7 14 2 15q0 22-16 38t-38 16q-8 0-15-2t-14-7-10-8-12-12-10-10q-18 17-18 41 0 22 16 38l117 118q15 15 38 15 22 0 38-14l84-83q16-16 16-38zM430 292q0-22-16-38l-117-118q-16-16-38-16-22 0-38 15l-84 83q-16 16-16 38 0 22 16 38l118 118q15 15 38 15 24 0 41-17-1-1-10-10t-12-12-8-10-7-14-2-15q0-22 16-38t38-16q8 0 15 2t14 7 10 8 12 12 10 10q18-17 18-41zM941 694q0 68-48 116l-84 83q-47 47-116 47-69 0-116-48l-117-118q-47-47-47-116 0-70 50-119l-50-50q-49 50-118 50-68 0-116-48l-118-118q-48-48-48-116t48-116l84-83q47-47 116-47 69 0 116 48l117 118q47 47 47 116 0 70-50 119l50 50q49-50 118-50 68 0 116 48l118 118q48 48 48 116z"}}}),R.Image.attachCommand("insertImage",function(e){return{label:"Insert image",run:function(t,n,r,o){return t.tr.replaceSelection(e.create({src:n,title:o,alt:r})).apply(B)},params:[{name:"Image URL",type:"text"},{name:"Description / alternative text",type:"text","default":""},{name:"Title",type:"text","default":""}],select:function(t){return t.doc.path(t.selection.from.path).type.canContainType(e)},menuGroup:"inline",menuRank:40,icon:{width:1097,height:1024,path:"M365 329q0 45-32 77t-77 32-77-32-32-77 32-77 77-32 77 32 32 77zM950 548v256h-804v-109l182-182 91 91 292-292zM1005 146h-914q-7 0-12 5t-5 12v694q0 7 5 12t12 5h914q7 0 12-5t5-12v-694q0-7-5-12t-12-5zM1097 164v694q0 37-26 64t-64 26h-914q-37 0-64-26t-26-64v-694q0-37 26-64t64-26h914q37 0 64 26t26 64z"},prefillParams:function(t){var n=t.selection.node;return n&&n.type==e?[n.attrs.src,n.attrs.alt,n.attrs.title]:void 0}}}),s("deleteSelection",{label:"Delete the selection",run:function(e){return e.tr.replaceSelection().apply(B)},key:["Backspace(10)","Delete(10)","Mod-Backspace(10)","Mod-Delete(10)"],macKey:["Ctrl-H(10)","Alt-Backspace(10)","Ctrl-D(10)","Ctrl-Alt-Backspace(10)","Alt-Delete(10)","Alt-D(10)"]}),s("joinBackward",{label:"Join with the block above",run:function(e){var t=e.selection,n=t.head,r=t.empty;if(!r||n.offset>0)return!1;for(var o=void 0,i=void 0,s=n.path.length-1;!o&&s>=0;s--)n.path[s]>0&&(i=n.shorten(s),o=e.doc.path(i.path).child(i.offset-1));return o?null==o.type.contains?e.tr["delete"](i.move(-1),i).apply(B):g(e,i):e.tr.lift(n).apply(B)},key:["Backspace(30)","Mod-Backspace(30)"]}),s("deleteCharBefore",{label:"Delete a character before the cursor",run:function(e){var t=e.selection,n=t.head,r=t.empty;if(!r||0==n.offset)return!1;var o=m(e.doc.path(n.path),n.offset,"char");return e.tr["delete"](new R.Pos(n.path,o),n).apply(B)},key:"Backspace(60)",macKey:"Ctrl-H(40)"}),s("deleteWordBefore",{label:"Delete the word before the cursor",run:function(e){var t=e.selection,n=t.head,r=t.empty;if(!r||0==n.offset)return!1;var o=m(e.doc.path(n.path),n.offset,"word");return e.tr["delete"](new R.Pos(n.path,o),n).apply(B)},key:"Mod-Backspace(40)",macKey:"Alt-Backspace(40)"}),s("joinForward",{label:"Join with the block below",run:function(e){var t=e.selection,n=t.head,r=t.empty;if(!r||n.offset<e.doc.path(n.path).maxOffset)return!1;for(var o=void 0,i=void 0,s=n.path.length-1;!o&&s>=0;s--){i=n.shorten(s,1);var a=e.doc.path(i.path);i.offset<a.length&&(o=a.child(i.offset))}return o?null==o.type.contains?e.tr["delete"](i,i.move(1)).apply(B):g(e,i):!1},key:["Delete(30)","Mod-Delete(30)"]}),s("deleteCharAfter",{label:"Delete a character after the cursor",run:function(e){var t=e.selection,n=t.head,r=t.empty;if(!r||n.offset==e.doc.path(n.path).maxOffset)return!1;var o=v(e.doc.path(n.path),n.offset,"char");return e.tr["delete"](n,new R.Pos(n.path,o)).apply(B)},key:"Delete(60)",macKey:"Ctrl-D(60)"}),s("deleteWordAfter",{label:"Delete a character after the cursor",run:function(e){var t=e.selection,n=t.head,r=t.empty;if(!r||n.offset==e.doc.path(n.path).maxOffset)return!1;var o=v(e.doc.path(n.path),n.offset,"word");return e.tr["delete"](n,new R.Pos(n.path,o)).apply(B)},key:"Mod-Delete(40)",macKey:["Ctrl-Alt-Backspace(40)","Alt-Delete(40)","Alt-D(40)"]}),s("joinUp",{label:"Join with above block",run:function(e){var t=e.selection.node,n=y(e);return n?(e.tr.join(n).apply(),void(t&&e.setNodeSelection(n.move(-1)))):!1},select:function(e){return y(e)},menuGroup:"block",menuRank:80,icon:{width:800,height:900,path:"M0 75h800v125h-800z M0 825h800v-125h-800z M250 400h100v-100h100v100h100v100h-100v100h-100v-100h-100z"},key:"Alt-Up"}),s("joinDown",{label:"Join with below block",run:function(e){var t=e.selection.node,n=b(e);return n?(e.tr.join(n).apply(),void(t&&e.setNodeSelection(n.move(-1)))):!1},select:function(e){return b(e)},key:"Alt-Down"}),s("lift",{label:"Lift out of enclosing block",run:function(e){var t=e.selection,n=t.from,r=t.to;return e.tr.lift(n,r).apply(B)},select:function(e){var t=e.selection,n=t.from,r=t.to;return N.canLift(e.doc,n,r)},menuGroup:"block",menuRank:75,icon:{width:1024,height:1024,path:"M219 310v329q0 7-5 12t-12 5q-8 0-13-5l-164-164q-5-5-5-13t5-13l164-164q5-5 13-5 7 0 12 5t5 12zM1024 749v109q0 7-5 12t-12 5h-987q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h987q7 0 12 5t5 12zM1024 530v109q0 7-5 12t-12 5h-621q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h621q7 0 12 5t5 12zM1024 310v109q0 7-5 12t-12 5h-621q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h621q7 0 12 5t5 12zM1024 91v109q0 7-5 12t-12 5h-987q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h987q7 0 12 5t5 12z"},key:"Alt-Left"}),k(R.BulletList,"BulletList","bullet list",!0,{menuGroup:"block",menuRank:40,icon:{width:768,height:896,path:"M0 512h128v-128h-128v128zM0 256h128v-128h-128v128zM0 768h128v-128h-128v128zM256 512h512v-128h-512v128zM256 256h512v-128h-512v128zM256 768h512v-128h-512v128z"},key:["Alt-Right '*'","Alt-Right '-'"]}),k(R.OrderedList,"OrderedList","ordered list",!0,{menuGroup:"block",menuRank:41,icon:{width:768,height:896,path:"M320 512h448v-128h-448v128zM320 768h448v-128h-448v128zM320 128v128h448v-128h-448zM79 384h78v-256h-36l-85 23v50l43-2v185zM189 590c0-36-12-78-96-78-33 0-64 6-83 16l1 66c21-10 42-15 67-15s32 11 32 28c0 26-30 58-110 112v50h192v-67l-91 2c49-30 87-66 87-113l1-1z"},key:"Alt-Right '1'"}),k(R.BlockQuote,"BlockQuote","block quote",!1,{menuGroup:"block",menuRank:45,icon:{width:640,height:896,path:"M0 448v256h256v-256h-128c0 0 0-128 128-128v-128c0 0-256 0-256 256zM640 320v-128c0 0-256 0-256 256v256h256v-256h-128c0 0 0-128 128-128z"},key:["Alt-Right '>'","Alt-Right '\"'"]}),s("newlineInCode",{label:"Insert newline",run:function(e){var t=e.selection,n=t.from,r=t.to,o=t.node,i=void 0;return!o&&R.Pos.samePath(n.path,r.path)&&(i=e.doc.path(n.path)).type.isCode&&r.offset<i.maxOffset?e.tr.typeText("\n").apply(B):!1},key:"Enter(10)"}),s("createParagraphNear",{label:"Create a paragraph near the selected leaf block",run:function(e){var t=e.selection,n=t.from,r=t.to,o=t.node;if(!o||!o.isBlock||o.type.contains)return!1;var i=n.offset?r:n;e.tr.insert(i,e.schema.defaultTextblockType().create()).apply(B),e.setSelection(new R.Pos(i.toPath(),0))},key:"Enter(20)"}),s("liftEmptyBlock",{label:"Move current block up",run:function(e){var t=e.selection,n=t.head,r=t.empty;return!r||n.offset>0?!1:n.path[n.path.length-1]>0&&e.tr.split(n.shorten()).apply()!==!1?void 0:e.tr.lift(n).apply(B)},key:"Enter(30)"}),s("splitBlock",{label:"Split the current block",run:function(e){var t=e.selection,n=t.from,r=t.to,o=t.node,i=e.doc.path(r.path);if(o&&o.isBlock)return n.offset?e.tr.split(n).apply(B):!1;var s=r.offset==i.maxOffset?e.schema.defaultTextblockType():null;return e.tr["delete"](n,r).split(n,1,s).apply(B)},key:"Enter(60)"}),R.ListItem.attachCommand("splitListItem",function(e){return{label:"Split the current list item",run:function(t){var n=t.selection,r=n.from,o=n.to,i=n.node,s=n.empty;if(i&&i.isBlock||r.path.length<2||!R.Pos.samePath(r.path,o.path)||s&&0==r.offset)return!1;var a=r.shorten(),l=t.doc.path(a.path);if(l.type!=e)return!1;var c=o.offset==l.child(a.offset).maxOffset?t.schema.defaultTextblockType():null;return t.tr["delete"](r,o).split(r,2,c).apply(B)},key:"Enter(50)"}}),w(R.Heading,"makeH1","heading 1",{level:1},"Mod-H '1'"),w(R.Heading,"makeH2","heading 2",{level:2},"Mod-H '2'"),w(R.Heading,"makeH3","heading 3",{level:3},"Mod-H '3'"),w(R.Heading,"makeH4","heading 4",{level:4},"Mod-H '4'"),w(R.Heading,"makeH5","heading 5",{level:5},"Mod-H '5'"),w(R.Heading,"makeH6","heading 6",{level:6},"Mod-H '6'"),w(R.Paragraph,"makeParagraph","paragraph",null,"Mod-P"),w(R.CodeBlock,"makeCodeBlock","code block",null,"Mod-\\"),R.HorizontalRule.attachCommand("insertHorizontalRule",function(e){return{label:"Insert horizontal rule",run:function(t){return t.tr.replaceSelection(e.create()).apply(B)},key:"Mod-Space"}}),s("undo",{label:"Undo last change",run:function(e){return e.scrollIntoView(),e.history.undo()},select:function(e){return e.history.canUndo()},menuGroup:"history",menuRank:10,icon:{width:1024,height:1024,path:"M761 1024c113-206 132-520-313-509v253l-384-384 384-384v248c534-13 594 472 313 775z"},key:"Mod-Z"}),s("redo",{label:"Redo last undone change",run:function(e){return e.scrollIntoView(),e.history.redo()},select:function(e){return e.history.canRedo()},menuGroup:"history",menuRank:20,icon:{width:1024,height:1024,path:"M576 248v-248l384 384-384 384v-253c-446-10-427 303-313 509-280-303-221-789 313-775z"},key:["Mod-Y","Shift-Mod-Z"]}),s("textblockType",{label:"Change block type",run:function(e,t){var n=e.selection,r=n.from,o=n.to;return e.tr.setBlockType(r,o,t.type,t.attrs).apply()},select:function(e){var t=e.selection.node;return!t||t.isTextblock},params:[{name:"Type",type:"select",options:E,"default":_,defaultLabel:"Type..."}],display:"select",menuGroup:"block",menuRank:10}),R.Paragraph.prototype.textblockTypes=[{label:"Normal",rank:10}],R.CodeBlock.prototype.textblockTypes=[{label:"Code",rank:20}],R.Heading.prototype.textblockTypes=[1,2,3,4,5,6].map(function(e){return{label:"Head "+e,attrs:{level:e},rank:30+e}}),s("selectParentBlock",{label:"Select parent node",run:function(e){var t=x(e);return t?void e.setNodeSelection(t):!1},select:function(e){return x(e)},menuGroup:"block",menuRank:90,icon:{text:"⬚",style:"font-weight: bold; vertical-align: 20%"},key:"Esc"}),s("selectBlockLeft",{label:"Move the selection onto or out of the block to the left",run:function(e){var t=T(e,-1);return t&&e.scrollIntoView(),t},key:["Left","Mod-Left"]}),s("selectBlockRight",{label:"Move the selection onto or out of the block to the right",run:function(e){var t=T(e,1);return t&&e.scrollIntoView(),t},key:["Right","Mod-Right"]}),s("selectBlockUp",{label:"Move the selection onto or out of the block above",run:function(e){var t=M(e,-1);return t!==!1&&e.scrollIntoView(),t},key:"Up"}),s("selectBlockDown",{label:"Move the selection onto or out of the block below",run:function(e){var t=M(e,1);return t!==!1&&e.scrollIntoView(),t},key:"Down"})}),require.register("prosemirror/edit/css",function(e,t,n){"use strict";var r=t("../dom");r.insertCSS('\n\n.ProseMirror {\n  border: 1px solid silver;\n  position: relative;\n}\n\n.ProseMirror-content {\n  padding: 4px 8px 4px 14px;\n  white-space: pre-wrap;\n  line-height: 1.2;\n}\n\n.ProseMirror-drop-target {\n  position: absolute;\n  width: 1px;\n  background: #666;\n  display: none;\n}\n\n.ProseMirror-content ul.tight p, .ProseMirror-content ol.tight p {\n  margin: 0;\n}\n\n.ProseMirror-content ul, .ProseMirror-content ol {\n  padding-left: 30px;\n  cursor: default;\n}\n\n.ProseMirror-content blockquote {\n  padding-left: 1em;\n  border-left: 3px solid #eee;\n  margin-left: 0; margin-right: 0;\n}\n\n.ProseMirror-content pre {\n  white-space: pre-wrap;\n}\n\n.ProseMirror-selectednode {\n  outline: 2px solid #8cf;\n}\n\n.ProseMirror-content p:first-child,\n.ProseMirror-content h1:first-child,\n.ProseMirror-content h2:first-child,\n.ProseMirror-content h3:first-child,\n.ProseMirror-content h4:first-child,\n.ProseMirror-content h5:first-child,\n.ProseMirror-content h6:first-child {\n  margin-top: .3em;\n}\n\n/* Add space around the hr to make clicking it easier */\n\n.ProseMirror-content hr {\n  position: relative;\n  height: 6px;\n  border: none;\n}\n\n.ProseMirror-content hr:after {\n  content: "";\n  position: absolute;\n  left: 10px;\n  right: 10px;\n  top: 2px;\n  border-top: 2px solid silver;\n}\n\n.ProseMirror-content img {\n  cursor: default;\n}\n\n/* Make sure li selections wrap around markers */\n\n.ProseMirror-content li {\n  position: relative;\n  pointer-events: none; /* Don\'t do weird stuff with marker clicks */\n}\n.ProseMirror-content li > * {\n  pointer-events: auto;\n}\n\nli.ProseMirror-selectednode {\n  outline: none;\n}\n\nli.ProseMirror-selectednode:after {\n  content: "";\n  position: absolute;\n  left: -32px;\n  right: -2px; top: -2px; bottom: -2px;\n  border: 2px solid #8cf;\n  pointer-events: none;\n}\n\n')}),require.register("prosemirror/edit/domchange",function(e,t,n){"use strict";function r(e,t,n){for(var r=n||0;r<t.path.length;r++){var o=t.path[n];if(o<e.length-1)return!1;e=e.child(o)}return t.offset==e.maxOffset}function o(e,t){if(e.offset>0)return!1;for(var n=t||0;n<e.path.length;n++)if(e.path[t]>0)return!1;return!0}function i(e){for(var t=e.content,n=e.doc,i=e.selection,s=i.from,a=i.to,l=0;;l++){var c=n.child(a.path[l]),u=o(s,l+1),p=r(c,a,l+1);if(u||p||s.path[l]!=a.path[l]||c.isTextblock){var d=l==s.depth?s.offset:s.path[l];u&&d>0&&d--;var h=l==a.depth?a.offset:a.path[l]+1;p&&h<n.length-1&&h++;var f=m.fromDOM(e.schema,t,{topNode:n.copy(),from:d,to:t.childNodes.length-(n.length-h)});f=f.copy(n.slice(0,d).concat(f.children).concat(n.slice(h)));for(var g=l-1;g>=0;g--){var y=e.doc.path(s.path.slice(0,g));f=y.splice(s.path[g],s.path[g]+1,[f])}return f}n=c,t=v.findByPath(t,s.path[l],!1)}}function s(e){var t=i(e),n=f.findDiffStart(e.doc,t);if(n){var r=l(e.doc,t,n);return e.markRangeDirty(f.siblingRange(e.doc,n.a,r.a)),e.tr.replace(n.a,r.a,t,n.b,r.b).apply(),!0}return!1}function a(e,t,n){var r=g.samePathDepth(e,t),o=r==e.depth,i=r==t.depth,s=(i?t.offset:t.path[r])-(o?e.offset:e.path[r]),a=o?n.move(s):n.shorten(r,s);return i?a:a.extend(new f.Pos(t.path.slice(r),t.offset))}function l(e,t,n){var r=f.findDiffEnd(e,t);return r?r.a.cmp(n.a)<0?{a:n.a,b:a(r.a,n.a,r.b)}:r.b.cmp(n.b)<0?{a:a(r.b,n.b,r.a),b:n.b}:r:r}function c(e){var t=getSelection().getRangeAt(0),n=t.startContainer,r=t.endContainer;if(n==r&&3==n.nodeType){var o=n.nodeValue,i=t.startOffset,s=t.endOffset;return e&&s>=e.length&&o.slice(s-e.length,s)==e&&(i=s-e.length),{inside:n,lead:i,trail:o.length-s}}for(var a=null,l=null,c=n.childNodes[t.startOffset-1]||d(n);c.lastChild;)c=c.lastChild;if(c&&3==c.nodeType){var o=c.nodeValue;a=o.length,e&&o.slice(o.length-e.length)==e&&(a-=e.length)}for(var u=r.childNodes[t.endOffset]||p(r);u.firstChild;)u=u.firstChild;return u&&3==u.nodeType&&(l=u.nodeValue.length),{before:c,sizeBefore:a,after:u,sizeAfter:l}}function u(e,t){if(e.inside){var n=e.inside.nodeValue;return n.slice(e.lead,n.length-e.trail)}var r=e.before,o=e.after,i="";if(!r)return t;3==r.nodeType&&(i=r.nodeValue.slice(e.sizeBefore));var s=h(r,o);if(null==s)return t;if(i+=s,o&&3==o.nodeType){var a=o.nodeValue;i+=a.slice(0,a.length-e.sizeAfter)}return i}function p(e){for(;;){var t=e.nextSibling;if(t){for(;t.firstChild;)t=t.firstChild;return t}if(!(e=e.parentElement))return null}}function d(e){for(;;){var t=e.previousSibling;if(t){for(;t.lastChild;)t=t.lastChild;return t}if(!(e=e.parentElement))return null}}function h(e,t){for(var n="",r=p(e);;){if(r==t)return n;if(!r)return null;3==r.nodeType&&(n+=r.nodeValue),r=r.firstChild||p(r)}}Object.defineProperty(e,"__esModule",{value:!0}),e.applyDOMChange=s,e.textContext=c,e.textInContext=u;var f=t("../model"),m=t("../parse/dom"),g=t("../transform/tree"),v=t("./selection")}),require.register("prosemirror/edit/draw",function(e,t,n){"use strict";function r(e,t){return{onRender:function(e,t,n){return e.isInline||null==n||t.setAttribute("pm-path",n),p.hasOwnProperty(e.type.name)&&(t.contentEditable=!1),t},renderInlineFlat:function(n,r,i){t.advanceTo(new l.Pos(e,i));for(var s=new l.Pos(e,i+n.offset),a=t.nextChangeBefore(s),c=r,p=void 0,d=0;d<n.styles.length;d++)c=c.firstChild;1!=r.nodeType&&(r=u.elt("span",null,r),a||(p=r)),p||!a&&!t.current.length||(p=c==r?r=u.elt("span",null,c):c.parentNode.appendChild(u.elt("span",null,c))),r.setAttribute("pm-span",i+"-"+s.offset),n.isText||r.setAttribute("pm-span-atom","true");for(var h=0;a;){var f=a-i,m=o(p,f);t.current.length&&(m.className=t.current.join(" ")),m.setAttribute("pm-span-offset",h),h+=f,i+=f,t.advanceTo(new l.Pos(e,i)),(a=t.nextChangeBefore(s))||p.setAttribute("pm-span-offset",h)}return t.current.length&&(p.className=t.current.join(" ")),r},document:document,path:e}}function o(e,t){var n=e.firstChild,r=n.nodeValue,o=e.parentNode.insertBefore(u.elt("span",null,r.slice(0,t)),e);return n.nodeValue=r.slice(t),o}function i(e,t){e.content.textContent="",e.content.appendChild(c.toDOM(t,r([],e.ranges.activeRangeTracker())))}function s(e,t,n){for(var r=0;n>r;r++){var o=t;t=t.nextSibling,e.removeChild(o)}return t}function a(e,t,n,o){function i(e,n,o){for(var p=[],d=[],h=[],f=0,m=0;f<o.length&&m<n.width;f++){var g=o.child(f),v=t.get(g);p.push(v);var y=v?-1:n.children.indexOf(g,m);y>-1&&(h[f]=y,d[y]=f,m=y+1)}if(n.isTextblock){var b=0==n.length||n.lastChild.type==n.type.schema.nodes.hard_break,S=e.lastChild,k=S&&1==S.nodeType&&S.hasAttribute("pm-force-br");b&&!k?e.appendChild(u.elt("br",{"pm-force-br":"true"})):!b&&k&&e.removeChild(S)}for(var w=e.firstChild,E=0,_=n.isTextblock,f=0,x=0;f<n.length;f++){var C=n.child(f);_||l.push(f);var T=d[f],M=!0;null!=T?(w=s(e,w,T-E),E=T):!_&&E<o.length&&null==h[E]&&2!=p[E]&&C.sameMarkup(o.child(E))?i(w,C,o.child(E)):(e.insertBefore(c.renderNodeToDOM(C,r(l,a),_?x:f),w),M=!1),M&&(_?w.setAttribute("pm-span",x+"-"+(x+C.offset)):w.setAttribute("pm-path",f),w=w.nextSibling,E++),_?x+=C.offset:l.pop()}s(e,w,o.length-E)}var a=e.ranges.activeRangeTracker(),l=[];i(e.content,n,o)}Object.defineProperty(e,"__esModule",{value:!0}),e.draw=i,e.redraw=a;var l=t("../model"),c=t("../serialize/dom"),u=t("../dom"),p={html_block:!0,html_tag:!0,horizontal_rule:!0}}),require.register("prosemirror/edit/event",function(e,t,n){"use strict";function r(e){var t=e.prototype;for(var n in o)o.hasOwnProperty(n)&&(t[n]=o[n])}Object.defineProperty(e,"__esModule",{value:!0}),e.eventMixin=r;var o={on:function(e,t){var n=this._handlers||(this._handlers={}),r=n[e]||(n[e]=[]);r.push(t)},off:function(e,t){var n=this._handlers&&this._handlers[e];if(n)for(var r=0;r<n.length;++r)if(n[r]==t){n.splice(r,1);break}},signal:function(e){for(var t=this._handlers&&this._handlers[e],n=arguments.length,r=Array(n>1?n-1:0),o=1;n>o;o++)r[o-1]=arguments[o];if(t)for(var i=0;i<t.length;++i)t[i].apply(t,r)},signalHandleable:function(e){var t=this._handlers&&this._handlers[e];if(t){for(var n=arguments.length,r=Array(n>1?n-1:0),o=1;n>o;o++)r[o-1]=arguments[o];for(var i=0;i<t.length;++i){var s=t[i].apply(t,r);if(s!==!1)return s}}return!1},hasHandler:function(e){var t=this._handlers&&this._handlers[e];return t&&t.length>0}}}),require.register("prosemirror/edit/history",function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){return"replace"==e.name&&e.from.offset<e.to.offset&&s.Pos.samePath(e.from.path,e.to.path)&&0==e.param.nodes.length}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=t("../model"),a=t("../transform"),l=function v(e,t,n){r(this,v),this.step=e,this.version=t,this.id=n},c=function(){function e(t){r(this,e),this.branch=t,this.remap=new a.Remapping,this.version=t.version,this.mirrorBuffer=Object.create(null)}return i(e,[{key:"moveToVersion",value:function(e){for(;this.version>e;)this.addNextMap()}},{key:"addNextMap",value:function(){var e=this.branch.mirror[this.version],t=this.branch.maps.length-(this.branch.version-this.version)-1,n=this.remap.addToFront(this.branch.maps[t],this.mirrorBuffer[this.version]);return--this.version,null!=e&&(this.mirrorBuffer[e]=n),n}},{key:"movePastStep",value:function(e){var t=this.addNextMap();e&&this.remap.addToBack(e.map,t)}}]),e}(),u=100,p=150,d=function(){function e(t,n,o){r(this,e),this.branch=n,this.callback=o,this.remap=new c(n),this.doc=t,this.events=[],this.maps=[],this.version=this.startVersion=n.version,this.i=n.events.length,this.timeout=null,this.aborted=!1}return i(e,[{key:"work",value:function(){var e=this;if(!this.aborted)for(var t=Date.now()+u;;){if(0==this.i)return this.finish();for(var n=this.branch.events[--this.i],r=[],i=n.length-1;i>=0;i--){var s=n[i],c=s.step,d=s.version,h=s.id;this.remap.moveToVersion(d);var f=a.mapStep(c,this.remap.remap);if(f&&o(c)){for(var m=0,g=c.from;i>0;){var v=n[i-1];if(v.version!=d-1||!o(v.step)||g.cmp(v.step.to))break;m+=v.step.to.offset-v.step.from.offset,g=v.step.from,d--,i--,this.remap.addNextMap()}if(m>0){var y=f.from.move(-m);f=new a.Step("replace",y,f.to,y,{nodes:[],openLeft:0,openRight:0})}}var b=f&&f.apply(this.doc);b&&(this.doc=b.doc,this.maps.push(b.map.invert()),r.push(new l(f,this.version,h)),this.version--),this.remap.movePastStep(b)}if(r.length&&(r.reverse(),this.events.push(r)),Date.now()>t)return void(this.timeout=window.setTimeout(function(){return e.work()},p))}}},{key:"finish",value:function(){this.aborted||(this.events.reverse(),this.maps.reverse(),this.callback(this.maps.concat(this.branch.maps.slice(this.branch.maps.length-(this.branch.version-this.startVersion))),this.events))}},{key:"abort",value:function(){this.aborted=!0,window.clearTimeout(this.timeout)}}]),e}(),h=150,f=function(){function e(t){r(this,e),this.maxDepth=t,this.version=0,this.nextStepID=1,this.maps=[],this.mirror=Object.create(null),this.events=[],this.stepsSinceCompress=0,this.compressing=null,this.compressTimeout=null}return i(e,[{key:"clear",value:function(e){(e||!this.empty())&&(this.maps.length=this.events.length=this.stepsSinceCompress=0,this.mirror=Object.create(null),this.abortCompression())}},{key:"newEvent",value:function(){for(this.abortCompression(),this.events.push([]);this.events.length>this.maxDepth;)this.events.shift()}},{key:"addMap",value:function(e){return this.empty()?void 0:(this.maps.push(e),this.version++,this.stepsSinceCompress++,!0)}},{key:"empty",value:function(){return 0==this.events.length}},{key:"addStep",value:function(e,t,n){this.addMap(t),null==n&&(n=this.nextStepID++),this.events[this.events.length-1].push(new l(e,this.version,n))}},{key:"addTransform",value:function(e,t){this.abortCompression();for(var n=0;n<e.steps.length;n++){var r=e.steps[n].invert(e.docs[n],e.maps[n]);this.addStep(r,e.maps[n],t&&t[n])}}},{key:"popEvent",value:function(e,t){this.abortCompression();var n=this.events.pop();if(!n)return null;for(var r=new c(this),o=t,i=new a.Transform(e),s=[],l=n.length-1;l>=0;l--){var u=n[l],p=u.step;if(o&&u.version==r.version)this.version--,delete this.mirror[this.version],this.maps.pop(),i.step(p),s.push(u.id),--r.version;else{o=!1,r.moveToVersion(u.version),p=a.mapStep(p,r.remap);var d=p&&i.step(p);d&&(s.push(u.id),this.addMap(d.map)&&(this.mirror[this.version]=u.version)),l>0&&r.movePastStep(d)}}return this.empty()&&this.clear(!0),{transform:i,ids:s}}},{key:"getVersion",value:function(){return{id:this.nextStepID,version:this.version}}},{key:"findVersion",value:function(e){for(var t=this.events.length-1;t>=0;t--)for(var n=this.events[t],r=n.length-1;r>=0;r--){var o=n[r];if(o.id==e.id)return{event:t,step:r};if(o.id<e.id)return{event:t,step:r+1}}}},{key:"rebased",value:function(e,t,n){if(!this.empty()){this.abortCompression();var r=this.version-n.length;e:for(var o=this.events.length-1;o>=0;o--)for(var i=this.events[o],s=i.length-1;s>=0;s--){var a=i[s];if(a.version<=r)break e;var c=n[a.version-r-1];if(-1==c)i.splice(s--,1);else{var u=t.steps[c].invert(t.docs[c],t.maps[c]);i[s]=new l(u,r+e.length+c+1,a.id)}}this.maps.length>n.length?this.maps=this.maps.slice(0,this.maps.length-n.length).concat(e).concat(t.maps):this.maps=t.maps.slice(),this.version=r+e.length+t.maps.length,this.stepsSinceCompress+=e.length+t.steps.length-n.length}}},{key:"abortCompression",value:function(){this.compressing&&(this.compressing.abort(),this.compressing=null)}},{key:"needsCompression",value:function(){return this.stepsSinceCompress>h&&!this.compressing}},{key:"startCompression",value:function(e){var t=this;this.compressing=new d(e,this,function(e,n){t.maps=e,t.events=n,t.mirror=Object.create(null),t.compressing=null,t.stepsSinceCompress=0}),this.compressing.work()}}]),e}(),m=750,g=function(){function e(t){var n=this;r(this,e),this.pm=t,this.done=new f(t.options.historyDepth),this.undone=new f(t.options.historyDepth),this.lastAddedAt=0,this.ignoreTransform=!1,this.allowCollapsing=!0,t.on("transform",function(e,t){return n.recordTransform(e,t)})}return i(e,[{key:"recordTransform",value:function(e,t){if(!this.ignoreTransform){if(0==t.addToHistory)for(var n=0;n<e.maps.length;n++){var r=e.maps[n];this.done.addMap(r),this.undone.addMap(r)}else{this.undone.clear();var o=Date.now();o>this.lastAddedAt+this.pm.options.historyEventDelay&&this.done.newEvent(),this.done.addTransform(e),this.lastAddedAt=o}this.maybeScheduleCompression()}}},{key:"undo",value:function(){return this.shift(this.done,this.undone)}},{key:"redo",value:function(){return this.shift(this.undone,this.done)}},{key:"canUndo",value:function(){return this.done.events.length>0}},{key:"canRedo",value:function(){return this.undone.events.length>0}},{key:"shift",value:function(e,t){var n=e.popEvent(this.pm.doc,this.allowCollapsing);if(!n)return!1;var r=n.transform,o=n.ids;return this.ignoreTransform=!0,this.pm.apply(r),this.ignoreTransform=!1,r.steps.length?(t&&(t.newEvent(),t.addTransform(r,o)),this.lastAddedAt=0,!0):this.shift(e,t)}},{key:"getVersion",value:function(){return this.done.getVersion()}
},{key:"backToVersion",value:function(e){var t=this.done.findVersion(e);if(!t)return!1;var n=this.done.events[t.event],r=this.done.events.slice(t.event+1).reduce(function(e,t){return e.concat(t)},n.slice(t.step));this.done.events.length=t.event+((n.length=t.step)?1:0),this.done.events.push(r),this.shift(this.done)}},{key:"rebased",value:function(e,t,n){this.done.rebased(e,t,n),this.undone.rebased(e,t,n),this.maybeScheduleCompression()}},{key:"maybeScheduleCompression",value:function(){this.maybeScheduleCompressionForBranch(this.done),this.maybeScheduleCompressionForBranch(this.undone)}},{key:"maybeScheduleCompressionForBranch",value:function(e){var t=this;window.clearTimeout(e.compressTimeout),e.needsCompression()&&(e.compressTimeout=window.setTimeout(function(){e.needsCompression()&&e.startCompression(t.pm.doc)},m))}}]),e}();e.History=g}),require.register("prosemirror/edit/index",function(e,t,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t("./main");Object.defineProperty(e,"ProseMirror",{enumerable:!0,get:function(){return r.ProseMirror}});var o=t("./options");Object.defineProperty(e,"defineOption",{enumerable:!0,get:function(){return o.defineOption}});var i=t("./selection");Object.defineProperty(e,"Range",{enumerable:!0,get:function(){return i.Range}});var s=t("./event");Object.defineProperty(e,"eventMixin",{enumerable:!0,get:function(){return s.eventMixin}});var a=t("./keys");Object.defineProperty(e,"Keymap",{enumerable:!0,get:function(){return a.Keymap}});var l=t("./range");Object.defineProperty(e,"MarkedRange",{enumerable:!0,get:function(){return l.MarkedRange}});var c=t("./commands");Object.defineProperty(e,"defineCommand",{enumerable:!0,get:function(){return c.defineCommand}}),Object.defineProperty(e,"defineParamHandler",{enumerable:!0,get:function(){return c.defineParamHandler}}),Object.defineProperty(e,"Command",{enumerable:!0,get:function(){return c.Command}})}),require.register("prosemirror/edit/input",function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t,n){var r=e.input.keySeq;if(r){if(m.isModifierKey(t))return!0;clearTimeout(b),b=setTimeout(function(){e.input.keySeq==r&&(e.input.keySeq=null)},50),t=r+" "+t}for(var o=function a(t){var n=!1;if(Array.isArray(t))for(var r=0;n===!1&&r<t.length;r++)n=a(t[r]);else n="string"==typeof t?e.execCommand(t):t(e);return n!==!1},i=void 0,s=0;!i&&s<e.input.keymaps.length;s++)i=m.lookupKey(t,e.input.keymaps[s].map,o,e);return i||(i=m.lookupKey(t,e.options.keymap,o,e)||m.lookupKey(t,g.captureKeys,o,e)),"multi"==i&&(e.input.keySeq=t),("handled"==i||"multi"==i)&&n.preventDefault(),r&&!i&&/\'$/.test(t)?(n.preventDefault(),!0):!!i}function i(e,t,n){if(t.empty&&!n)return!1;var r=e.input.storedStyles||c.spanStylesAt(e.doc,t.from),o=e.tr;o.replaceWith(t.from,t.to,e.schema.text(n,r)).apply(),e.scrollIntoView(),e.signal("textInput",n)}function s(e,t){var n=y.selectableNodeAbove(e,t.target,{left:t.clientX,top:t.clientY},!0);if(!n)return e.sel.pollForUpdate();var r=e.selection,o=r.node,i=r.from;if(o&&n.depth>=i.depth&&0==n.shorten(i.depth).cmp(i)){if(0==i.depth)return e.sel.pollForUpdate();n=i.shorten()}e.setNodeSelection(n),e.focus(),t.preventDefault()}function a(e){var t=e.input.composing,n=v.textInContext(t.context,t.endData),r=y.rangeFromDOMLoose(e);e.ensureOperation(),e.input.composing=null,n!=t.data&&i(e,t.range,n),r&&!r.eq(e.sel.range)&&e.setSelection(r)}Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();e.dispatchKey=o;var c=t("../model"),u=t("../parse/dom"),p=t("../dom"),d=t("../serialize/dom"),h=t("../serialize/text"),f=t("../parse"),m=t("./keys"),g=t("./capturekeys"),v=t("./domchange"),y=t("./selection"),b=null,S={},k=function(){function e(t){var n=this;r(this,e),this.pm=t,this.keySeq=null,this.composing=null,this.shiftKey=this.updatingComposition=!1,this.skipInput=0,this.draggingFrom=!1,this.keymaps=[],this.storedStyles=null,this.dropTarget=t.wrapper.appendChild(p.elt("div",{"class":"ProseMirror-drop-target"}));var o=function(e){var n=S[e];t.content.addEventListener(e,function(e){return n(t,e)})};for(var i in S)o(i);t.on("selectionChange",function(){return n.storedStyles=null})}return l(e,[{key:"maybeAbortComposition",value:function(){if(this.composing&&!this.updatingComposition){if(this.composing.finished)a(this.pm);else{this.composing=null,this.skipInput++;var e=getSelection();if(e.rangeCount){var t=e.getRangeAt(0);e.removeAllRanges(),e.addRange(t)}}return!0}}}]),e}();e.Input=k,S.keydown=function(e,t){if(16==t.keyCode&&(e.input.shiftKey=!0),!e.input.composing){var n=m.keyName(t);n&&o(e,n,t)||e.sel.pollForUpdate()}},S.keyup=function(e,t){16==t.keyCode&&(e.input.shiftKey=!1)},S.keypress=function(e,t){if(!(e.input.composing||!t.charCode||t.ctrlKey&&!t.altKey||p.browser.mac&&t.metaKey)){var n=String.fromCharCode(t.charCode);if(!o(e,"'"+n+"'",t)){var r=e.selection;r.node&&null==r.node.contains&&(e.tr["delete"](r.from,r.to).apply(),r=e.selection),i(e,r,n),t.preventDefault()}}};var w=0;S.mousedown=function(e,t){if(t.ctrlKey)return s(e,t);e.sel.pollForUpdate();var n=Date.now(),r=500>n-w;if(w=n,!e.input.shiftKey&&!r){var o=t.clientX,i=t.clientY,a=function(){removeEventListener("mouseup",l),removeEventListener("mousemove",c)},l=function(){a();var n=y.selectableNodeAbove(e,t.target,{left:t.clientX,top:t.clientY});n&&(e.setNodeSelection(n),e.focus())},c=function(e){(Math.abs(o-e.clientX)>4||Math.abs(i-e.clientY)>4)&&a()};addEventListener("mouseup",l),addEventListener("mousemove",c)}},S.touchdown=function(e){e.sel.pollForUpdate()},S.mousemove=function(e,t){(t.which||t.button)&&e.sel.pollForUpdate()};var E=function x(e,t){r(this,x),this.finished=!1,this.context=v.textContext(t),this.data=t,this.endData=null;var n=e.selection;if(t){var o=n.head.path,i=e.doc.path(o).textContent,s=i.indexOf(t,n.head.offset-t.length);s>-1&&s<=n.head.offset+t.length&&(n=new y.TextSelection(new c.Pos(o,s),new c.Pos(o,s+t.length)))}this.range=n};S.compositionstart=function(e,t){if(!e.input.maybeAbortComposition()){e.flush(),e.input.composing=new E(e,t.data);var n=e.selection.head.shorten();e.markRangeDirty({from:n,to:n.move(1)})}},S.compositionupdate=function(e,t){var n=e.input.composing;n&&n.data!=t.data&&(n.data=t.data,e.input.updatingComposition=!0,i(e,n.range,n.data),e.input.updatingComposition=!1,n.range=new y.TextSelection(n.range.from,n.range.from.move(n.data.length)))},S.compositionend=function(e,t){var n=e.input.composing;n&&(e.input.composing.finished=!0,e.input.composing.endData=t.data,setTimeout(function(){e.input.composing==n&&a(e)},20))},S.input=function(e){return e.input.skipInput?--e.input.skipInput:e.input.composing?void(e.input.composing.finished&&a(e)):(v.applyDOMChange(e),void e.scrollIntoView())};var _=null;S.copy=S.cut=function(e,t){var n=e.selection,r=n.from,o=n.to,i=n.empty;if(!i){var s=e.selectedDoc;_={doc:e.doc,from:r,to:o,html:d.toHTML(s),text:h.toText(s)},t.clipboardData&&(t.preventDefault(),t.clipboardData.clearData(),t.clipboardData.setData("text/html",_.html),t.clipboardData.setData("text/plain",_.text),"cut"!=t.type||i||e.tr["delete"](r,o).apply())}},S.paste=function(e,t){if(t.clipboardData){var n=e.selection,r=t.clipboardData.getData("text/plain"),o=t.clipboardData.getData("text/html");if(o||r){t.preventDefault();var i=void 0,s=void 0,a=void 0;if(e.input.shiftKey&&r)!function(){var t=r.split(/[\r\n]+/),o=c.spanStylesAt(e.doc,n.from);i=e.schema.node("doc",null,t.map(function(t){return e.schema.node("paragraph",null,[e.schema.text(t,o)])}))}();else if(!_||_.html!=o&&_.text!=r)i=o?u.fromHTML(e.schema,o):f.convertFrom(e.schema,r,f.knownSource("markdown")?"markdown":"text");else{var l=_;i=l.doc,s=l.from,a=l.to}e.tr.replace(n.from,n.to,i,s||y.findSelectionAtStart(i).from,a||y.findSelectionAtEnd(i).to).apply(),e.scrollIntoView()}}},S.dragstart=function(e,t){if(t.dataTransfer){var n=e.selectedDoc;t.dataTransfer.setData("text/html",d.toHTML(n)),t.dataTransfer.setData("text/plain",h.toText(n)),e.input.draggingFrom=!0}},S.dragend=function(e){return window.setTimeout(function(){return e.input.dragginFrom=!1},50)},S.dragover=S.dragenter=function(e,t){t.preventDefault();var n=e.posAtCoords({left:t.clientX,top:t.clientY});if(n){var r=y.coordsAtPos(e,n),o=e.wrapper.getBoundingClientRect();r.top-=o.top,r.right-=o.left,r.bottom-=o.top,r.left-=o.left;var i=e.input.dropTarget;i.style.display="block",i.style.left=r.left-1+"px",i.style.top=r.top+"px",i.style.height=r.bottom-r.top+"px"}},S.dragleave=function(e){return e.input.dropTarget.style.display=""},S.drop=function(e,t){if(e.input.dropTarget.style.display="",t.dataTransfer){var n=void 0,r=void 0,o=void 0;if((n=t.dataTransfer.getData("text/html"))?o=u.fromHTML(e.schema,n,{document:document}):(r=t.dataTransfer.getData("text/plain"))&&(o=f.convertFrom(e.schema,r,f.knownSource("markdown")?"markdown":"text")),o){t.preventDefault();var i=e.posAtCoords({left:t.clientX,top:t.clientY});if(!i)return;var s=e.tr;e.input.draggingFrom&&!t.ctrlKey&&(s.deleteSelection(),i=s.map(i).pos),s.replace(i,i,o,y.findSelectionAtStart(o).from,y.findSelectionAtEnd(o).to).apply(),e.setSelection(i,s.map(i).pos),e.focus()}}},S.focus=function(e){p.addClass(e.wrapper,"ProseMirror-focused"),e.signal("focus")},S.blur=function(e){p.rmClass(e.wrapper,"ProseMirror-focused"),e.signal("blur")}}),require.register("prosemirror/edit/keys",function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){var n=u[e.keyCode],r=n;return null==r||e.altGraphKey?!1:(e.altKey&&"Alt"!=n&&(r="Alt-"+r),e.ctrlKey&&"Ctrl"!=n&&(r="Ctrl-"+r),e.metaKey&&"Cmd"!=n&&(r="Cmd-"+r),!t&&e.shiftKey&&"Shift"!=n&&(r="Shift-"+r),r)}function i(e){var t="string"==typeof e?e:u[e.keyCode];return"Ctrl"==t||"Alt"==t||"Shift"==t||"Mod"==t}function s(e){for(var t=e.split(/-(?!'?$)/),n=t[t.length-1],r=void 0,o=void 0,i=void 0,s=void 0,a=0;a<t.length-1;a++){var l=t[a];if(/^(cmd|meta|m)$/i.test(l))s=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))o=!0;else if(/^s(hift)$/i.test(l))i=!0;else{if(!/^mod$/i.test(l))throw new Error("Unrecognized modifier name: "+l);c?s=!0:o=!0}}return r&&(n="Alt-"+n),o&&(n="Ctrl-"+n),s&&(n="Cmd-"+n),i&&(n="Shift-"+n),n}function a(e,t,n,r){var o=!0;e:for(;o;){var i=e,s=t,l=n,c=r;o=!1;var u=s.options.call?s.options.call(i,c):s.bindings[i];if(u===!1)return"nothing";if("..."===u)return"multi";if(null!=u&&l(u))return"handled";var p=s.options.fallthrough;if(p){if(!Array.isArray(p)){e=i,t=p,n=l,r=c,o=!0,u=p=void 0;continue e}for(var d=0;d<p.length;d++){var h=a(i,p[d],l,c);if(h)return h}}}}Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();e.keyName=o,e.isModifierKey=i,e.normalizeKeyName=s,e.lookupKey=a;var c="undefined"!=typeof navigator?/Mac/.test(navigator.platform):!1,u={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"};e.names=u;for(var p=0;10>p;p++)u[p+48]=u[p+96]=String(p);for(var p=65;90>=p;p++)u[p]=String.fromCharCode(p);for(var p=1;12>=p;p++)u[p+111]=u[p+63235]="F"+p;var d=function(){function e(t,n){if(r(this,e),this.options=n||{},this.bindings=Object.create(null),t)for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&this.addBinding(o,t[o])}return l(e,[{key:"addBinding",value:function(e,t){for(var n=e.split(" ").map(s),r=0;r<n.length;r++){var o=n.slice(0,r+1).join(" "),i=r==n.length-1?t:"...",a=this.bindings[o];if(a){if(a!=i)throw new Error("Inconsistent bindings for "+o)}else this.bindings[o]=i}}},{key:"removeBinding",value:function(e){for(var t=e.split(" ").map(s),n=t.length-1;n>=0;n--){var r=t.slice(0,n).join(" "),o=this.bindings[r];if("..."==o&&!this.unusedMulti(r))break;o&&delete this.bindings[r]}}},{key:"unusedMulti",value:function(e){for(var t in this.bindings)if(t.length>e&&0==t.indexOf(e)&&" "==t.charAt(e.length))return!1;return!0}}]),e}();e.Keymap=d}),require.register("prosemirror/edit/main",function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s=function(e,t,n){for(var r=!0;r;){var o=e,i=t,s=n;r=!1,null===o&&(o=Function.prototype);var a=Object.getOwnPropertyDescriptor(o,i);if(void 0!==a){if("value"in a)return a.value;var l=a.get;return void 0===l?void 0:l.call(s)}var c=Object.getPrototypeOf(o);if(null===c)return void 0;e=c,t=i,n=s,r=!0,a=c=void 0}},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t("./css");var l=t("../model"),c=t("../transform"),u=t("../util/sortedinsert"),p=r(u),d=t("../util/map"),h=t("./options"),f=t("./selection"),m=t("../dom"),g=t("./draw"),v=t("./input"),y=t("./history"),b=t("./event"),S=t("../serialize/text");t("../parse/text");var k=t("../parse"),w=t("../serialize"),E=t("./commands"),_=t("./range"),x=t("./keys"),C=function(){function e(t){i(this,e),t=this.options=h.parseOptions(t),this.schema=t.schema,null==t.doc&&(t.doc=this.schema.node("doc",null,[this.schema.node("paragraph")])),this.content=m.elt("div",{"class":"ProseMirror-content"}),this.wrapper=m.elt("div",{"class":"ProseMirror"},this.content),this.wrapper.ProseMirror=this,t.place&&t.place.appendChild?t.place.appendChild(this.wrapper):t.place&&t.place(this.wrapper),this.setDocInner(t.docFormat?k.convertFrom(this.schema,t.doc,t.docFormat,{document:document}):t.doc),g.draw(this,this.doc),this.content.contentEditable=!0,t.label&&this.content.setAttribute("aria-label",t.label),this.mod=Object.create(null),this.operation=null,this.dirtyNodes=new d.Map,this.flushScheduled=!1,this.sel=new f.SelectionState(this),this.accurateSelection=!1,this.input=new v.Input(this),this.commands=E.initCommands(this.schema),this.commandKeys=Object.create(null),h.initOptions(this)}return a(e,[{key:"apply",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?T:arguments[1];if(e.doc==this.doc)return!1;if(e.docs[0]!=this.doc&&l.findDiffStart(e.docs[0],this.doc))throw new Error("Applying a transform that does not start with the current document");return this.updateDoc(e.doc,e,t.selection),this.signal("transform",e,t),t.scrollIntoView&&this.scrollIntoView(),e}},{key:"setContent",value:function(e,t){t&&(e=k.convertFrom(this.schema,e,t)),this.setDoc(e)}},{key:"getContent",value:function(e){return e?w.convertTo(this.doc,e):this.doc}},{key:"setDocInner",value:function(e){if(e.type!=this.schema.nodes.doc)throw new Error("Trying to set a document with a different schema");this.doc=e,this.ranges=new _.RangeStore(this),this.history=new y.History(this)}},{key:"setDoc",value:function(e,t){t||(t=f.findSelectionAtStart(e)),this.signal("beforeSetDoc",e,t),this.ensureOperation(),this.setDocInner(e),this.sel.set(t,!0),this.signal("setDoc",e,t)}},{key:"updateDoc",value:function(e,t,n){this.ensureOperation(),this.input.maybeAbortComposition(),this.ranges.transform(t),this.doc=e,this.sel.setAndSignal(n||this.sel.range.map(e,t)),this.signal("change")}},{key:"checkPos",value:function(e,t){if(!this.doc.isValidPos(e,t))throw new Error("Position "+e+" is not valid in current document")}},{key:"setSelection",value:function(e,t){var n=e;n instanceof f.Selection||(n=new f.TextSelection(e,t)),n instanceof f.TextSelection?(this.checkPos(n.head,!0),this.checkPos(n.anchor,!0)):(this.checkPos(n.from,!1),this.checkPos(n.to,!1)),this.ensureOperation(),this.input.maybeAbortComposition(),n.eq(this.sel.range)||this.sel.setAndSignal(n)}},{key:"setNodeSelection",value:function(e){this.checkPos(e,!1);var t=this.doc.path(e.path);if(e.offset>=t.maxOffset)throw new Error("Trying to set a node selection at the end of a node");var n=t.isTextblock?t.childAfter(e.offset).node:t.child(e.offset);this.input.maybeAbortComposition(),this.sel.setAndSignal(new f.NodeSelection(e,e.move(1),n))}},{key:"ensureOperation",value:function(){return this.operation||this.startOperation()}},{key:"startOperation",value:function(){var e=this;return this.sel.beforeStartOp(),this.operation=new M(this),this.flushScheduled||(m.requestAnimationFrame(function(){e.flushScheduled=!1,e.flush()}),this.flushScheduled=!0),this.operation}},{key:"flush",value:function(){if(document.body.contains(this.wrapper)&&this.operation){this.signal("flushing");var e=this.operation;if(e){this.operation=null,this.accurateSelection=!0;var t=e.doc!=this.doc||this.dirtyNodes.size,n=!1;this.input.composing||!t&&!e.composingAtStart||(g.redraw(this,this.dirtyNodes,this.doc,e.doc),this.dirtyNodes.clear(),n=!0),!n&&e.sel.eq(this.sel.range)||this.input.composing||this.sel.toDOM(e.focus),e.scrollIntoView!==!1&&f.scrollIntoView(this,e.scrollIntoView),t&&this.signal("draw"),this.signal("flush"),this.signal("flushed"),this.accurateSelection=!1}}}},{key:"setOption",value:function(e,t){h.setOption(this,e,t)}},{key:"getOption",value:function(e){return this.options[e]}},{key:"addKeymap",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?50:arguments[1];p["default"](this.input.keymaps,{map:e,rank:t},function(e,t){return e.rank-t.rank})}},{key:"removeKeymap",value:function(e){for(var t=this.input.keymaps,n=0;n<t.length;++n)if(t[n].map==e||t[n].map.options.name==e)return t.splice(n,1),!0}},{key:"markRange",value:function(e,t,n){this.checkPos(e),this.checkPos(t);var r=new _.MarkedRange(e,t,n);return this.ranges.addRange(r),r}},{key:"removeRange",value:function(e){this.ranges.removeRange(e)}},{key:"setStyle",value:function(e,t,n){var r=this.selection;if(r.empty){var o=this.activeStyles();if(null==t&&(t=!l.containsStyle(o,e)),t&&!this.doc.path(r.head.path).type.canContainStyle(e))return;this.input.storedStyles=t?e.create(n).addToSet(o):l.removeStyle(o,e),this.signal("activeStyleChange")}else(null!=t?t:!l.rangeHasStyle(this.doc,r.from,r.to,e))?this.apply(this.tr.addStyle(r.from,r.to,e.create(n))):this.apply(this.tr.removeStyle(r.from,r.to,e))}},{key:"activeStyles",value:function(){return this.input.storedStyles||l.spanStylesAt(this.doc,this.selection.head)}},{key:"focus",value:function(){this.operation?this.operation.focus=!0:this.sel.toDOM(!0)}},{key:"hasFocus",value:function(){return this.sel.range instanceof f.NodeSelection?document.activeElement==this.content:f.hasFocus(this)}},{key:"posAtCoords",value:function(e){return f.posAtCoords(this,e)}},{key:"coordsAtPos",value:function(e){return this.checkPos(e),f.coordsAtPos(this,e)}},{key:"scrollIntoView",value:function(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0];e&&this.checkPos(e),this.ensureOperation(),this.operation.scrollIntoView=e}},{key:"execCommand",value:function(e,t){var n=this.commands[e];return!(!n||n.exec(this,t)===!1)}},{key:"keyForCommand",value:function(e){var t=this.commandKeys[e];if(void 0!==t)return t;var n=this.commands[e];if(!n)return this.commandKeys[e]=null;var r=n.info.key||(m.browser.mac?n.info.macKey:n.info.pcKey);if(r){r=x.normalizeKeyName(Array.isArray(r)?r[0]:r);var o=this.options.keymap.bindings[r];if(Array.isArray(o)?o.indexOf(e)>-1:o==e)return this.commandKeys[e]=r}for(var i in this.options.keymap.bindings){var s=this.options.keymap.bindings[i];if(Array.isArray(s)?s.indexOf(e)>-1:s==e)return this.commandKeys[e]=i}return this.commandKeys[e]=null}},{key:"markRangeDirty",value:function(e){this.ensureOperation();for(var t=this.dirtyNodes,n=e.from,r=e.to,o=0,i=this.doc;;o++){var s=o==n.depth,a=o==r.depth;if(s||a||n.path[o]!=r.path[o]){var l=s?n.offset:n.path[o],c=a?r.offset:r.path[o]+1;if(i.isTextblock)for(var u=0,p=0;c>u;p++){var d=i.child(p);u+=d.offset,u>l&&t.set(d,2)}else for(var p=l;c>p;p++)t.set(i.child(p),2);break}var d=i.child(n.path[o]);t.has(d)||t.set(d,1),i=d}}},{key:"selection",get:function(){return this.accurateSelection||this.ensureOperation(),this.sel.range}},{key:"selectedDoc",get:function(){var e=this.selection;return l.sliceBetween(this.doc,e.from,e.to)}},{key:"selectedText",get:function(){return S.toText(this.selectedDoc)}},{key:"tr",get:function(){return new A(this)}}]),e}();e.ProseMirror=C;var T={};b.eventMixin(C);var M=function D(e){i(this,D),this.doc=e.doc,this.sel=e.sel.range,this.scrollIntoView=!1,this.focus=!1,this.composingAtStart=!!e.input.composing},A=function(e){function t(e){i(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e.doc),this.pm=e}return o(t,e),a(t,[{key:"apply",value:function(e){return this.pm.apply(this,e)}},{key:"replaceSelection",value:function(e,t){var n=this.selection,r=n.empty,o=n.from,i=n.to,s=n.node,a=void 0;if(e&&e.isInline&&t!==!1){var c=r?this.pm.input.storedStyles:l.spanStylesAt(this.doc,o);e=e.type.create(e.attrs,e.text,c)}if(s&&s.isTextblock&&e&&e.isInline)o=new l.Pos(o.toPath(),0),i=new l.Pos(o.path,s.maxOffset);else if(s)for(;o.depth&&0==o.offset&&(a=this.doc.path(o.path))&&o.offset==a.maxOffset-1&&!a.type.canBeEmpty&&(!e||!a.type.canContain(e));)o=o.shorten(),i=i.shorten(null,1);else if(e&&e.isBlock&&this.doc.path(o.path.slice(0,o.depth-1)).type.canContain(e)){this["delete"](o,i);var u=this.doc.path(o.path);return o.offset&&o.offset!=u.maxOffset&&this.split(o),this.insert(o.shorten(null,o.offset?1:0),e)}return e?this.replaceWith(o,i,e):this["delete"](o,i)}},{key:"deleteSelection",value:function(){return this.replaceSelection()}},{key:"typeText",value:function(e){return this.replaceSelection(this.pm.schema.text(e),!0)}},{key:"selection",get:function(){return this.steps.length?this.pm.selection.map(this):this.pm.selection}}]),t}(c.Transform)}),require.register("prosemirror/edit/options",function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t,n,r){p[e]=new u(t,n,r)}function i(e){var t=Object.create(null),n=e?[e].concat(e.use||[]):[];e:for(var r in p){for(var o=0;o<n.length;o++)if(r in n[o]){t[r]=n[o][r];continue e}t[r]=p[r].defaultValue}return t}function s(e){for(var t in p){var n=p[t];n.update&&n.updateOnInit&&n.update(e,e.options[t],null,!0)}}function a(e,t,n){var r=p[t];if(r.update===!1)throw new Error("Option '"+t+"' can not be changed");var o=e.options[t];e.options[t]=n,r.update&&r.update(e,n,o,!1)}Object.defineProperty(e,"__esModule",{value:!0}),e.defineOption=o,e.parseOptions=i,e.initOptions=s,e.setOption=a;var l=t("../model"),c=t("./commands"),u=function d(e,t,n){r(this,d),this.defaultValue=e,this.update=t,this.updateOnInit=n!==!1},p={__proto__:null,schema:new u(l.defaultSchema,!1,!1),doc:new u(null,function(e,t){e.setDoc(t)},!1),docFormat:new u(null),place:new u(null),keymap:new u(null,function(e,t){t||(e.options.keymap=c.defaultKeymap(e))}),historyDepth:new u(50),historyEventDelay:new u(500),commandParamHandler:new u("default"),label:new u(null)}}),require.register("prosemirror/edit/range",function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=t("./event"),s=function(){function e(t,n,o){r(this,e),this.options=o||{},this.from=t,this.to=n}return o(e,[{key:"clear",value:function(){this.signal("removed",this.from),this.from=this.to=null}}]),e}();e.MarkedRange=s,i.eventMixin(s);var a=function(){function e(){r(this,e),this.sorted=[]}return o(e,[{key:"find",value:function(e){for(var t=0,n=this.sorted.length;;){if(t+10>n){for(var r=t;n>r;r++)if(this.sorted[r].at.cmp(e)>=0)return r;return n}var o=t+n>>1;this.sorted[o].at.cmp(e)>0?n=o:t=o}}},{key:"insert",value:function(e){this.sorted.splice(this.find(e.at),0,e)}},{key:"remove",value:function(e,t){for(var n=this.find(e),r=0;;r++){var o=n-r-1,i=n+r;if(o>=0&&this.sorted[o].range==t)return void this.sorted.splice(o,1);if(i<this.sorted.length&&this.sorted[i].range==t)return void this.sorted.splice(i,1)}}},{key:"resort",value:function(){for(var e=0;e<this.sorted.length;e++)for(var t=this.sorted[e],n=t.at="open"==t.type?t.range.from:t.range.to,r=e;r>0&&this.sorted[r-1].at.cmp(n)>0;)this.sorted[r]=this.sorted[r-1],this.sorted[--r]=t}}]),e}(),l=function(){function e(t){r(this,e),this.pm=t,this.ranges=[],this.sorted=new a}return o(e,[{key:"addRange",value:function(e){this.ranges.push(e),this.sorted.insert({type:"open",at:e.from,range:e}),this.sorted.insert({type:"close",at:e.to,range:e}),this.pm.markRangeDirty(e)}},{key:"removeRange",value:function(e){var t=this.ranges.indexOf(e);t>-1&&(this.ranges.splice(t,1),this.sorted.remove(e.from,e),this.sorted.remove(e.to,e),this.pm.markRangeDirty(e),e.clear())}},{key:"transform",value:function(e){for(var t=0;t<this.ranges.length;t++){var n=this.ranges[t];n.from=e.map(n.from,n.options.inclusiveLeft?-1:1).pos,n.to=e.map(n.to,n.options.inclusiveRight?1:-1).pos;var r=n.from.cmp(n.to);n.options.clearWhenEmpty!==!1&&r>=0?(this.removeRange(n),t--):r>0&&(n.to=n.from)}this.sorted.resort()}},{key:"activeRangeTracker",value:function(){return new c(this.sorted.sorted)}}]),e}();e.RangeStore=l;var c=function(){function e(t){r(this,e),this.sorted=t,this.pos=0,this.current=[]}return o(e,[{key:"advanceTo",value:function(e){for(var t=void 0;this.pos<this.sorted.length&&(t=this.sorted[this.pos]).at.cmp(e)<=0;){var n=t.range.options.className;n&&("open"==t.type?this.current.push(n):this.current.splice(this.current.indexOf(n),1),this.pos++)}}},{key:"nextChangeBefore",value:function(e){for(;;){if(this.pos==this.sorted.length)return null;var t=this.sorted[this.pos];if(t.range.options.className)return t.at.cmp(e)>=0?null:t.at.offset;this.pos++}}}]),e}()}),require.register("prosemirror/edit/selection",function(e,t,n){"use strict";function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e){e.classList.remove("ProseMirror-selectednode")}function s(e,t){t.classList.add("ProseMirror-selectednode")}function a(){return{left:0,right:window.innerWidth,top:0,bottom:window.innerHeight}}function l(e){for(var t=[];;){var n=e.getAttribute("pm-path");if(!n)return t;t.unshift(+n),e=e.parentNode}}function c(e,t,n,r){if(!r&&e.operation&&e.doc!=e.operation.doc)throw new Error("Fetching a position from an outdated DOM structure");for(var o=0,i=void 0;;){if(3==t.nodeType)o+=n;else{if(t.hasAttribute("pm-path")||t==e.content)break;(i=t.getAttribute("pm-span-offset"))&&(o+=+i)}var s=t.parentNode;n=Array.prototype.indexOf.call(s.childNodes,t)+(3!=t.nodeType&&n==t.childNodes.length?1:0),t=s}for(var a=0,c=n-1;c>=0;c--){var u=t.childNodes[c];if(3==u.nodeType)r&&(o+=u.nodeValue.length);else{if(i=u.getAttribute("pm-span")){a=f(i).to;break}if(i=u.getAttribute("pm-path")){a=+i+1,o=0;break}r&&(o+=u.textContent.length)}}return new F.Pos(l(t),a+o)}function u(e,t,n){return null==n&&(n=Array.prototype.indexOf.call(t.parentNode.childNodes,t),t=t.parentNode),c(e,t,n)}function p(e){if(!y(e))return null;var t=getSelection();return new B(c(e,t.anchorNode,t.anchorOffset,!0),c(e,t.focusNode,t.focusOffset,!0))}function d(e,t,n){for(var r=n?e.lastChild:e.firstChild;r;r=n?r.previousSibling:r.nextSibling)if(1==r.nodeType){var o=r.getAttribute("pm-path");if(o){if(+o==t)return r}else{var i=d(r,t);if(i)return i}}}function h(e,t){for(var n=e,r=0;r<t.length;r++)if(n=d(n,t[r]),!n)throw new Error("Failed to resolve path "+t.join("/"));return n}function f(e){var t=/^(\d+)-(\d+)$/.exec(e),n=I(t,3),r=(n[0],n[1]),o=n[2];return{from:+r,to:+o}}function m(e,t,n){function r(e){for(var o=e.firstChild,i=0,s=void 0;o;o=o.nextSibling,i++)if(1==o.nodeType)if(s=o.getAttribute("pm-span")){var a=f(s),l=a.from,c=a.to;if(n?l==t:c>=t)return{node:o,offset:i,innerOffset:t-l}}else if(s=o.getAttribute("pm-path")){var u=t-+s;if(0==u||n&&1==u)return{node:o,offset:i,innerOffset:u}}else{var p=r(o);if(p)return p}}return r(e)}function g(e,t){for(;;){var n=e.firstChild;if(!n)return{node:e,offset:t};if(1!=n.nodeType)return{node:n,offset:t};if(n.hasAttribute("pm-span-offset")){for(var r=0;;){var o=n.nextSibling,i=void 0;if(!o||(i=+o.getAttribute("pm-span-offset"))>=t)break;n=o,r=i}t-=r}e=n}}function v(e,t){var n=h(e,t.path),r=m(n,t.offset),o=void 0;return r?r.node.hasAttribute("pm-span-atom")||!(o=g(r.node,r.innerOffset))?{node:r.node.parentNode,offset:r.offset+(r.innerOffset?1:0)}:o:{node:n,offset:0}}function y(e){var t=window.getSelection();return t.rangeCount&&U.contains(e.content,t.anchorNode)}function b(e,t){var n=document.elementFromPoint(t.left,t.top+1);if(!U.contains(e.content,n))return null;var r=void 0;return 1==n.childNodes.length&&3==n.firstChild.nodeType?(n=n.firstChild,r=_(n,t)):r=x(n,t),u(e,n,r)}function S(e,t,n){var r=document.createRange();return r.setEnd(e,n),r.setStart(e,t),r.getBoundingClientRect()}function k(e,t){var n=v(e.content,t),r=n.node,o=n.offset,i=void 0,s=void 0;if(3==r.nodeType)o<r.nodeValue.length&&(s=S(r,o,o+1),i="left"),s&&s.left!=s.right||!o||(s=S(r,o-1,o),i="right");else if(r.firstChild){if(o<r.childNodes.length){var a=r.childNodes[o];s=3==a.nodeType?S(a,0,a.nodeValue.length):a.getBoundingClientRect(),i="left"}if((!s||s.left==s.right)&&o){var a=r.childNodes[o-1];s=3==a.nodeType?S(a,0,a.nodeValue.length):a.getBoundingClientRect(),i="right"}}else s=r.getBoundingClientRect(),i="left";var l=s[i];return{top:s.top,bottom:s.bottom,left:l,right:l}}function w(e,t){t||(t=e.sel.range.head||e.sel.range.from);for(var n=k(e,t),r=e.content;;r=r.parentNode){var o=r==document.body,i=o?a():r.getBoundingClientRect(),s=0,l=0;if(n.top<i.top?l=-(i.top-n.top+V):n.bottom>i.bottom&&(l=n.bottom-i.bottom+V),n.left<i.left?s=-(i.left-n.left+V):n.right>i.right&&(s=n.right-i.right+V),s||l?o&&window.scrollBy(s,l):(l&&(r.scrollTop+=l),s&&(r.scrollLeft+=s)),o)break}}function E(e,t,n){for(var r=e.top,o=e.left,i=1e8,s=1e8,a=0,l=0;l<t.length;l++){var c=t[l];if(c&&c.top!=c.bottom){var u=o<c.left?c.left-o:o>c.right?o-c.right:0;if(!(u>s)){s>u&&(s=u,i=1e8);var p=r<c.top?c.top-r:r>c.bottom?r-c.bottom:0;i>p&&(i=p,a=o<(c.left+c.right)/2?l:l+1)}}}return n&&(s||i)?null:a}function _(e,t,n){for(var r=e.nodeValue.length,o=document.createRange(),i=[],s=0;r>s;s++)o.setEnd(e,s+1),o.setStart(e,s),i.push(o.getBoundingClientRect());return E(t,i,n)}function x(e,t){for(var n=[],r=e.firstChild;r;r=r.nextSibling)r.getBoundingClientRect?n.push(r.getBoundingClientRect()):n.push(null);
return E(t,n)}function C(e,t,n,r,o){var i=e.path(t);if(i.isTextblock)return new B(new F.Pos(t,n));for(var s=n+(r>0?0:-1);r>0?s<i.maxOffset:s>=0;s+=r){var a=i.child(s);if(!o&&null==a.type.contains&&a.type.selectable)return new H(new F.Pos(t,s),new F.Pos(t,s+1),a);t.push(s);var l=C(e,t,0>r?a.maxOffset:0,r,o);if(l)return l;t.pop()}}function T(e,t,n,r){for(var o=t.path.slice(),i=t.offset;;){var s=C(e,o,i,n,r);if(s)return s;if(!o.length)break;i=o.pop()+(n>0?1:0)}}function M(e,t,n,r){void 0===n&&(n=1);var o=T(e,t,n,r)||T(e,t,-n,r);if(!o)throw new Error("Searching for selection in invalid document "+e);return o}function A(e,t,n){return void 0===t&&(t=[]),C(e,t.slice(),0,1,n)}function D(e,t,n){return void 0===t&&(t=[]),C(e,t.slice(),e.maxOffset,-1,n)}function R(e,t,n,r){for(;t&&t!=e.content;t=t.parentNode){if(t.hasAttribute("pm-path")){var o=l(t),i=e.doc.path(o);if(i.type.clicked){var s=i.type.clicked(i,o,t,n);if(s)return s}return(r||null==i.type.contains)&&i.type.selectable?F.Pos.from(o):null}if(t.hasAttribute("pm-span-atom")){var o=l(t.parentNode),a=e.doc.path(o),c=f(t.getAttribute("pm-span")),i=a.childAfter(c.from).node;return i.type.selectable?new F.Pos(o,c.from):null}}}function N(e,t,n){for(var r=h(e.content,t.path),o=k(e,t),i=r.firstChild;i;i=i.nextSibling)for(var s=i.getClientRects(),a=0;a<s.length;a++){var l=s[a];if(0>n?l.bottom<o.top:l.top>o.bottom)return!1}return!0}function O(e,t){var n=v(e.content,t),r=n.node,o=n.offset,i=document.createRange();i.setEnd(r,o),i.setStart(r,o);var s=getSelection();s.removeAllRanges(),s.addRange(i)}Object.defineProperty(e,"__esModule",{value:!0});var I=function(){function e(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(l){o=!0,i=l}finally{try{!r&&a["return"]&&a["return"]()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),P=function(e,t,n){for(var r=!0;r;){var o=e,i=t,s=n;r=!1,null===o&&(o=Function.prototype);var a=Object.getOwnPropertyDescriptor(o,i);if(void 0!==a){if("value"in a)return a.value;var l=a.get;return void 0===l?void 0:l.call(s)}var c=Object.getPrototypeOf(o);if(null===c)return void 0;e=c,t=i,n=s,r=!0,a=c=void 0}},L=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();e.posFromDOM=u,e.rangeFromDOMLoose=p,e.findByPath=d,e.resolvePath=h,e.hasFocus=y,e.posAtCoords=b,e.coordsAtPos=k,e.scrollIntoView=w,e.findSelectionFrom=T,e.findSelectionNear=M,e.findSelectionAtStart=A,e.findSelectionAtEnd=D,e.selectableNodeAbove=R,e.verticalMotionLeavesTextblock=N,e.setDOMSelectionToPos=O;var F=t("../model"),U=t("../dom"),q=function(){function e(t){var n=this;o(this,e),this.pm=t,this.range=A(t.doc),this.lastNonNodePos=null,this.pollState=null,this.pollTimeout=null,this.lastAnchorNode=this.lastHeadNode=this.lastAnchorOffset=this.lastHeadOffset=null,this.lastNode=null,t.content.addEventListener("focus",function(){return n.receivedFocus()})}return L(e,[{key:"setAndSignal",value:function(e,t){this.set(e,t),this.pm.signal("selectionChange")}},{key:"set",value:function(e,t){this.range=e,e.node||(this.lastNonNodePos=null),t!==!1&&(this.lastAnchorNode=null)}},{key:"setNodeAndSignal",value:function(e){this.setNode(e),this.pm.signal("selectionChange")}},{key:"pollForUpdate",value:function(){var e=this;if(!this.pm.input.composing){clearTimeout(this.pollTimeout),this.pollState="update";var t=0,n=function r(){e.pm.input.composing||(e.pm.operation?e.pollTimeout=setTimeout(r,20):e.readUpdate()||1!=++t?(e.pollState=null,e.pollToSync()):e.pollTimeout=setTimeout(r,50))};this.pollTimeout=setTimeout(n,20)}}},{key:"domChanged",value:function(){var e=getSelection();return e.anchorNode!=this.lastAnchorNode||e.anchorOffset!=this.lastAnchorOffset||e.focusNode!=this.lastHeadNode||e.focusOffset!=this.lastHeadOffset}},{key:"storeDOMState",value:function(){var e=getSelection();this.lastAnchorNode=e.anchorNode,this.lastAnchorOffset=e.anchorOffset,this.lastHeadNode=e.focusNode,this.lastHeadOffset=e.focusOffset}},{key:"readUpdate",value:function(){if(this.pm.input.composing||!y(this.pm)||!this.domChanged())return!1;var e=getSelection(),t=this.pm.doc,n=c(this.pm,e.anchorNode,e.anchorOffset),r=c(this.pm,e.focusNode,e.focusOffset),o=M(t,r,this.range.head&&this.range.head.cmp(r)<0?-1:1);return o instanceof B&&t.path(n.path).isTextblock&&(o=new B(n,o.head)),this.setAndSignal(o),o instanceof H||o.head.cmp(r)||o.anchor.cmp(n)?this.toDOM():(this.clearNode(),this.storeDOMState()),!0}},{key:"pollToSync",value:function(){var e=this;if(!this.pollState){this.pollState="sync";var t=function n(){document.activeElement!=e.pm.content?e.pollState=null:(e.pm.operation||e.pm.input.composing||e.syncDOM(),e.pollTimeout=setTimeout(n,200))};this.pollTimeout=setTimeout(t,200)}}},{key:"syncDOM",value:function(){!this.pm.input.composing&&y(this.pm)&&this.domChanged()&&this.toDOM()}},{key:"toDOM",value:function(e){this.range instanceof H?this.nodeToDOM(e):this.rangeToDOM(e)}},{key:"nodeToDOM",value:function(e){window.getSelection().removeAllRanges(),e&&this.pm.content.focus();var t=this.range.from,n=this.range.node,r=void 0;r=n.isInline?m(h(this.pm.content,t.path),t.offset,!0).node:h(this.pm.content,t.toPath()),r!=this.lastNode&&(this.clearNode(),s(n,r),this.lastNode=r)}},{key:"clearNode",value:function(){return this.lastNode?(i(this.lastNode),this.lastNode=null,!0):void 0}},{key:"rangeToDOM",value:function(e){var t=window.getSelection();if(!this.clearNode()&&!y(this.pm)){if(!e)return;U.browser.gecko&&this.pm.content.focus()}if(this.domChanged()){var n=document.createRange(),r=this.pm.content,o=v(r,this.range.anchor),i=v(r,this.range.head);if(t.extend)n.setEnd(o.node,o.offset),n.collapse(!1);else{if(this.range.anchor.cmp(this.range.head)>0){var s=o;o=i,i=s}n.setEnd(i.node,i.offset),n.setStart(o.node,o.offset)}t.removeAllRanges(),t.addRange(n),t.extend&&t.extend(i.node,i.offset),this.storeDOMState()}}},{key:"receivedFocus",value:function(){this.pollState||this.pollToSync()}},{key:"beforeStartOp",value:function(){"update"==this.pollState&&this.readUpdate()?(clearTimeout(this.pollTimeout),this.pollState=null,this.pollToSync()):this.syncDOM()}}]),e}();e.SelectionState=q;var j=function z(){o(this,z)};e.Selection=j;var H=function(e){function t(e,n,r){o(this,t),P(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.from=e,this.to=n,this.node=r}return r(t,e),L(t,[{key:"eq",value:function(e){return e instanceof t&&!this.from.cmp(e.from)}},{key:"map",value:function(e,n){var r=n.map(this.from,1).pos,o=n.map(this.to,-1).pos;if(F.Pos.samePath(r.path,o.path)&&r.offset==o.offset-1){var i=e.path(r.path),s=i.isTextblock?i.childAfter(r.offset).node:i.child(r.offset);if(s.type.selectable)return new t(r,o,s)}return M(e,r)}},{key:"empty",get:function(){return!1}}]),t}(j);e.NodeSelection=H;var B=function(e){function t(e,n){o(this,t),P(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.anchor=e,this.head=n||e}return r(t,e),L(t,[{key:"eq",value:function(e){return e instanceof t&&!e.head.cmp(this.head)&&!e.anchor.cmp(this.anchor)}},{key:"map",value:function(e,n){var r=n.map(this.head).pos;if(!e.path(r.path).isTextblock)return M(e,r);var o=n.map(this.anchor).pos;return new t(e.path(o.path).isTextblock?o:r,r)}},{key:"inverted",get:function(){return this.anchor.cmp(this.head)>0}},{key:"from",get:function(){return this.inverted?this.head:this.anchor}},{key:"to",get:function(){return this.inverted?this.anchor:this.head}},{key:"empty",get:function(){return 0==this.anchor.cmp(this.head)}}]),t}(j);e.TextSelection=B;var V=5}),require.register("prosemirror/inputrules/autoinput",function(e,t,n){"use strict";function r(e,t,n){var r=arguments.length<=3||void 0===arguments[3]?null:arguments[3],o=arguments.length<=4||void 0===arguments[4]?null:arguments[4],s=t.shorten(),a=s.offset>0&&e.doc.path(s.path).child(s.offset-1),l=a&&a.type.name==n&&(!o||o(a)),c=e.tr.wrap(t,t,n,r),u=c.map(t).pos;c["delete"](new i.Pos(u.path,0),u),l&&c.join(s),c.apply()}function o(e,t,n,r){e.tr.setBlockType(t,t,n,r)["delete"](new i.Pos(t.path,0),t).apply()}Object.defineProperty(e,"__esModule",{value:!0});var i=t("../model"),s=t("../edit"),a=t("./inputrules");s.defineOption("autoInput",!1,function(e,t,n){t&&!n?a.addInputRules(e,l):!t&&n&&a.removeInputRules(e,l)});var l=[new a.Rule("-",/--$/,"—"),new a.Rule('"',/\s(")$/,"“"),new a.Rule('"',/"$/,"”"),new a.Rule("'",/\s(')$/,"‘"),new a.Rule("'",/'$/,"’"),new a.Rule(" ",/^\s*> $/,function(e,t,n){r(e,n,"blockquote")}),new a.Rule(" ",/^(\d+)\. $/,function(e,t,n){var o=+t[1];r(e,n,"ordered_list",{order:o||null,tight:!0},function(e){return e.length+(e.attrs.order||1)==o})}),new a.Rule(" ",/^\s*([-+*]) $/,function(e,t,n){var o=t[1];r(e,n,"bullet_list",{bullet:o,tight:!0},function(e){return e.attrs.bullet==o})}),new a.Rule("`",/^```$/,function(e,t,n){o(e,n,"code_block",{params:""})}),new a.Rule(" ",/^(#{1,6}) $/,function(e,t,n){o(e,n,"heading",{level:t[1].length})})];e.rules=l}),require.register("prosemirror/inputrules/inputrules",function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){e.mod.interpretInput||(e.mod.interpretInput=new p(e)),e.mod.interpretInput.addRules(t)}function i(e,t){var n=e.mod.interpretInput;n&&(n.removeRules(t),0==n.rules.length&&(n.unregister(),e.mod.interpretInput=null))}function s(e,t){for(var n=e.path(t.path),r=n.type.isCode,o="",i=0,s=0;i<t.offset;){var a=n.child(s++),l=a.offset;if(o+=i+l>t.offset?a.text.slice(0,t.offset-i):a.text,i+l>=t.offset){a.styles.some(function(e){return e.type.isCode})&&(r=!0);break}i+=l}return{textBefore:o,isCode:r}}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();e.addInputRules=o,e.removeInputRules=i;var l=t("../model"),c=t("../edit"),u=function d(e,t,n){r(this,d),this.lastChar=e,this.match=t,this.handler=n};e.Rule=u;var p=function(){function e(t){var n=this;r(this,e),this.pm=t,this.rules=[],this.cancelVersion=null,t.on("selectionChange",this.onSelChange=function(){return n.cancelVersion=null}),t.on("textInput",this.onTextInput=this.onTextInput.bind(this)),t.addKeymap(new c.Keymap({Backspace:function(e){return n.backspace(e)}},{name:"inputRules"}),20)}return a(e,[{key:"unregister",value:function(){this.pm.off("selectionChange",this.onSelChange),this.pm.off("textInput",this.onTextInput),this.pm.removeKeymap("inputRules")}},{key:"addRules",value:function(e){this.rules=this.rules.concat(e)}},{key:"removeRules",value:function(e){for(var t=0;t<e.length;t++){var n=this.rules.indexOf(e[t]);n>-1&&this.rules.splice(n,1)}}},{key:"onTextInput",value:function(e){var t=this.pm.selection.head;if(t)for(var n=void 0,r=void 0,o=e[e.length-1],i=0;i<this.rules.length;i++){var a=this.rules[i],c=void 0;if(!a.lastChar||a.lastChar==o){if(null==n){var u=s(this.pm.doc,t);if(n=u.textBefore,r=u.isCode)return}if(c=a.match.exec(n)){var p=this.pm.history.getVersion();if("string"==typeof a.handler){var d=t.offset-(c[1]||c[0]).length,h=new l.Pos(t.path,d),f=l.spanStylesAt(this.pm.doc,t);this.pm.tr["delete"](h,t).insert(h,this.pm.schema.text(a.handler,f)).apply()}else a.handler(this.pm,c,t);return void(this.cancelVersion=p)}}}}},{key:"backspace",value:function(){return this.cancelVersion?(this.pm.history.backToVersion(this.cancelVersion),void(this.cancelVersion=null)):!1}}]),e}()}),require.register("prosemirror/menu/icons",function(e,t,n){"use strict";function r(e,t){var n=document.createElement("div");if(n.className="ProseMirror-icon",t.path){a[e]||o(e,t);var r=n.appendChild(document.createElementNS(l,"svg"));r.style.width=t.width/t.height+"em";var i=r.appendChild(document.createElementNS(l,"use"));i.setAttributeNS(c,"href","#pm-icon-"+e)}else n.textContent=t.text,t.css&&(n.style.cssText=t.css);return n}function o(e,t){s||(s=document.createElementNS(l,"svg"),s.style.display="none",document.body.insertBefore(s,document.body.firstChild));var n=document.createElementNS(l,"symbol");n.id="pm-icon-"+e,n.setAttribute("viewBox","0 0 "+t.width+" "+t.height);var r=n.appendChild(document.createElementNS(l,"path"));r.setAttribute("d",t.path),s.appendChild(n),a[e]=!0}Object.defineProperty(e,"__esModule",{value:!0}),e.getIcon=r;var i=t("../dom"),s=null,a=Object.create(null),l="http://www.w3.org/2000/svg",c="http://www.w3.org/1999/xlink";i.insertCSS("\n.ProseMirror-icon {\n  display: inline-block;\n  line-height: .8;\n  vertical-align: middle;\n  padding: 2px 8px;\n  cursor: pointer;\n}\n\n.ProseMirror-icon-active {\n  background: #666;\n  border-radius: 4px;\n}\n\n.ProseMirror-icon svg {\n  fill: currentColor;\n  height: 1em;\n}\n")}),require.register("prosemirror/menu/menu",function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){var n=e.keyForCommand(t.name);return n?t.label+" ("+n+")":t.label}function s(e,t){var n=a(t.pm,e);e.active(t.pm)&&(n.className+=" ProseMirror-icon-active");var r=b.elt("span",{"class":"ProseMirror-menuicon",title:i(t.pm,e)},n);return r.addEventListener("mousedown",function(n){n.preventDefault(),n.stopPropagation(),e.params.length?1==e.params.length&&"select"==e.params[0].type?c(t.pm,e,r):t.enter(f(e)):(e.exec(t.pm),t.reset())}),r}function a(e,t){for(;;){var n=t.info.icon;if(!n)break;if(!n.from)return E.getIcon(t.name,n);if(t=e.commands[n.from],!t)break}return b.elt("span",null,"?")}function l(e,t){var n=e.params[0],r=n["default"]?n["default"].call?n["default"](t.pm):n["default"]:null,o=b.elt("div",{"class":"ProseMirror-select ProseMirror-select-command-"+e.name,title:e.label},r?r.display?r.display(r):r.label:n.defaultLabel||"Select...");return o.addEventListener("mousedown",function(n){n.preventDefault(),n.stopPropagation(),c(t.pm,e,o)}),o}function c(e,t,n){function r(){c||(c=!0,document.body.removeEventListener("mousedown",r),document.body.removeEventListener("keydown",r),e.wrapper.removeChild(s))}var o=t.params[0],i=o.options.call?o.options(e):o.options,s=b.elt("div",{"class":"ProseMirror-select-menu"},i.map(function(n){var o=b.elt("div",null,n.display?n.display(n):n.label);return o.addEventListener("mousedown",function(o){o.preventDefault(),t.exec(e,[n.value]),r()}),o})),a=n.getBoundingClientRect(),l=e.wrapper.getBoundingClientRect();s.style.left=a.left-l.left-2+"px",s.style.top=a.top-l.top-2+"px";var c=!1;document.body.addEventListener("mousedown",r),document.body.addEventListener("keydown",r),e.wrapper.appendChild(s)}function u(e,t){if("icon"==e.display)return s(e,t);if("select"==e.display)return l(e,t);if(e.display)return e.display(t);throw new Error("Command "+e.name+" can not be shown in a menu")}function p(e,t){var n=t.info.prefillParams&&t.info.prefillParams(e),r=t.params.map(function(t,r){var o=void 0,i="field_"+r,s=n?n[r]:t["default"]||"";if("text"==t.type)o=b.elt("input",{name:i,type:"text",placeholder:t.name,value:s,autocomplete:"off"});else{if("select"!=t.type)throw new Error("Unsupported parameter type: "+t.type);o=b.elt("select",{name:i},(t.options.call?t.options(e):t.options).map(function(e){return b.elt("option",{value:e.value,selected:e==s},e.label)}))}return b.elt("div",null,o)});return b.elt("form",null,r)}function d(e,t,n){var r=!1,o=t.params.map(function(t,o){var i=n.elements["field_"+o].value;return i?i:null!=t["default"]?t["default"].call?t["default"](e):t["default"]:void(r=!0)});return r?null:o}function h(e,t,n){var r=p(e,t),o=!1,i=function(e){o||(o=!0,n(e))},s=function(){i(d(e,t,r))};return r.addEventListener("submit",function(e){e.preventDefault(),s()}),r.addEventListener("keydown",function(e){27==e.keyCode?i(null):13!=e.keyCode||e.ctrlKey||e.metaKey||e.shiftKey||(e.preventDefault(),s())}),setTimeout(function(){var e=r.querySelector("input, textarea");e&&e.focus()},20),r}function f(e){return{display:function(t){return h(t.pm,e,function(n){t.pm.focus(),n?(e.exec(t.pm,n),t.reset()):t.leave()})}}}function m(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];return n.map(function(t){var n=[];for(var r in e.commands){var o=e.commands[r];o.info.menuGroup&&o.info.menuGroup==t&&w["default"](n,o,function(e,t){return(e.info.menuRank||50)-(t.info.menuRank||50)})}return n})}function g(e,t,n){var r=new y.Tooltip(e,"center");r.open(h(e,t,function(t){e.focus(),r.close(),n(t)}))}Object.defineProperty(e,"__esModule",{value:!0});var v=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();e.showSelectMenu=c,e.readParams=f,e.commandGroups=m;var y=t("./tooltip"),b=t("../dom"),S=t("../edit"),k=t("../util/sortedinsert"),w=r(k),E=t("./icons"),_=function(){function e(t,n){o(this,e),this.display=n,this.stack=[],this.pm=t}return v(e,[{key:"show",value:function(e,t){this.stack.length=0,this.enter(e,t)}},{key:"reset",value:function(){this.stack.length=0,this.display.reset()}},{key:"enter",value:function(e,t){var n=this,r=[],o=function s(e){if(Array.isArray(e)){for(var t=0;t<e.length;t++)s(e[t]);r.push(C)}else(!e.select||e.select(n.pm))&&r.push(e)};o(e);for(var i=0;i<r.length;i++)r[i]!=C||0!=i&&i!=r.length-1&&r[i+1]!=C||r.splice(i--,1);return r.length?(this.stack.push(r),void this.draw(t)):this.display.clear()}},{key:"draw",value:function(e){var t=this,n=this.stack[this.stack.length-1],r=b.elt("div",{"class":"ProseMirror-menu"},n.map(function(e){return u(e,t)}));this.stack.length>1?this.display.enter(r,function(){return t.leave()},e):this.display.show(r,e)}},{key:"leave",value:function(){this.stack.pop(),this.stack.length?this.draw():this.display.reset()}},{key:"active",get:function(){return this.stack.length>1}}]),e}();e.Menu=_;var x=function(){function e(t,n){o(this,e),this.tooltip=t,this.resetFunc=n}return v(e,[{key:"clear",value:function(){this.tooltip.close()}},{key:"reset",value:function(){this.resetFunc?this.resetFunc():this.clear()}},{key:"show",value:function(e,t){this.tooltip.open(e,t)}},{key:"enter",value:function(e,t,n){var r=b.elt("div",{"class":"ProseMirror-tooltip-back",title:"Back"});r.addEventListener("mousedown",function(e){e.preventDefault(),e.stopPropagation(),t()}),this.show(b.elt("div",{"class":"ProseMirror-tooltip-back-wrapper"},e,r),n)}}]),e}();e.TooltipDisplay=x;var C={display:function(){return b.elt("div",{"class":"ProseMirror-menuseparator"})}};S.defineParamHandler("default",g),S.defineParamHandler("tooltip",g),b.insertCSS('\n\n.ProseMirror-menu {\n  margin: 0 -4px;\n  line-height: 1;\n  white-space: pre;\n}\n.ProseMirror-tooltip .ProseMirror-menu {\n  width: -webkit-fit-content;\n  width: fit-content;\n}\n\n.ProseMirror-tooltip-back-wrapper {\n  padding-left: 12px;\n}\n.ProseMirror-tooltip-back {\n  position: absolute;\n  top: 5px; left: 5px;\n  cursor: pointer;\n}\n.ProseMirror-tooltip-back:after {\n  content: "«";\n}\n\n.ProseMirror-menuicon {\n  margin: 0 7px;\n}\n\n.ProseMirror-menuseparator {\n  display: inline-block;\n}\n.ProseMirror-menuseparator:after {\n  content: "︙";\n  opacity: 0.5;\n  padding: 0 4px;\n  vertical-align: baseline;\n}\n\n.ProseMirror-select, .ProseMirror-select-menu {\n  border: 1px solid #777;\n  border-radius: 3px;\n  font-size: 90%;\n}\n\n.ProseMirror-select {\n  padding: 1px 12px 1px 4px;\n  display: inline-block;\n  vertical-align: middle;\n  position: relative;\n  cursor: pointer;\n  margin: 0 8px;\n}\n\n.ProseMirror-select-command-textblockType {\n  min-width: 3.2em;\n}\n\n.ProseMirror-select:after {\n  content: "▿";\n  color: #777;\n  position: absolute;\n  right: 4px;\n}\n\n.ProseMirror-select-menu {\n  position: absolute;\n  background: #444;\n  color: white;\n  padding: 2px 2px;\n  z-index: 15;\n}\n.ProseMirror-select-menu div {\n  cursor: pointer;\n  padding: 0 1em 0 2px;\n}\n.ProseMirror-select-menu div:hover {\n  background: #777;\n}\n\n')}),require.register("prosemirror/menu/menubar",function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){for(var t=e.parentNode;t;t=t.parentNode)if(t.scrollHeight>t.clientHeight)return t}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=t("../edit"),a=t("../dom"),l=t("./update"),c=t("./menu");s.defineOption("menuBar",!1,function(e,t){e.mod.menuBar&&e.mod.menuBar.detach(),e.mod.menuBar=t?new p(e,t):null});var u=function(){function e(t,n){r(this,e),this.container=t,this.resetFunc=n}return i(e,[{key:"clear",value:function(){this.container.textContent=""}},{key:"reset",value:function(){this.resetFunc()}},{key:"show",value:function(e){this.clear(),this.container.appendChild(e)}},{key:"enter",value:function(e,t){var n=this.container.firstChild;n&&(n.style.position="absolute",n.style.opacity="0.5");var r=a.elt("div",{"class":"ProseMirror-menubar-back"});r.addEventListener("mousedown",function(e){e.preventDefault(),e.stopPropagation(),t()});var o=a.elt("div",{"class":"ProseMirror-menubar-sliding"},r,e);this.container.appendChild(o),o.getBoundingClientRect(),o.style.left="0",o.addEventListener("transitionend",function(){n&&n.parentNode&&n.parentNode.removeChild(n)})}}]),e}(),p=function(){function e(t,n){var o=this;r(this,e),this.pm=t,this.menuElt=a.elt("div",{"class":"ProseMirror-menubar-inner"}),this.wrapper=a.elt("div",{"class":"ProseMirror-menubar"},a.elt("div",{"class":"ProseMirror-menu",style:"visibility: hiffdden; z-index: 100"},a.elt("span",{"class":"ProseMirror-menuicon"},a.elt("div",{"class":"ProseMirror-icon"},"x"))),this.menuElt),t.wrapper.insertBefore(this.wrapper,t.wrapper.firstChild),this.update=new l.MenuUpdate(t,"selectionChange change activeStyleChange",function(){return o.prepareUpdate()}),this.menu=new c.Menu(t,new u(this.menuElt,function(){return o.resetMenu()})),this.menuItems=n&&n.items||c.commandGroups(t,"inline","block","history"),this.update.force(),this.floating=!1,n&&n["float"]&&(this.updateFloat(),this.scrollFunc=function(){document.body.contains(o.pm.wrapper)?o.updateFloat():window.removeEventListener("scroll",o.scrollFunc)},window.addEventListener("scroll",this.scrollFunc))}return i(e,[{key:"detach",value:function(){this.update.detach(),this.wrapper.parentNode.removeChild(this.wrapper),this.scrollFunc&&window.removeEventListener("scroll",this.scrollFunc)}},{key:"prepareUpdate",value:function(){var e=this,t=this.prepareScrollCursor();return function(){e.menu.active||e.resetMenu(),t&&t()}}},{key:"resetMenu",value:function(){this.menu.show(this.menuItems)}},{key:"updateFloat",value:function(){var e=this.pm.wrapper.getBoundingClientRect();if(this.floating)if(e.top>=0||e.bottom<this.menuElt.offsetHeight+10)this.floating=!1,this.menuElt.style.position=this.menuElt.style.left=this.menuElt.style.width="",this.menuElt.style.display="";else{var t=(this.pm.wrapper.offsetWidth-this.pm.wrapper.clientWidth)/2;this.menuElt.style.left=e.left+t+"px",this.menuElt.style.display=e.top>window.innerHeight?"none":""}else if(e.top<0&&e.bottom>=this.menuElt.offsetHeight+10){this.floating=!0;var n=this.menuElt.getBoundingClientRect();this.menuElt.style.left=n.left+"px",this.menuElt.style.width=n.width+"px",this.menuElt.style.position="fixed"}}},{key:"prepareScrollCursor",value:function(){var e=this;if(!this.floating)return null;var t=this.pm.selection.head;if(!t)return null;var n=this.pm.coordsAtPos(t),r=this.menuElt.getBoundingClientRect();if(n.top<r.bottom&&n.bottom>r.top){var i=function(){var t=o(e.pm.wrapper);return t?{v:function(){return t.scrollTop-=r.bottom-n.top}}:void 0}();if("object"==typeof i)return i.v}}}]),e}();a.insertCSS('\n.ProseMirror-menubar {\n  position: relative;\n  margin-bottom: 3px;\n  border-top-left-radius: inherit;\n  border-top-right-radius: inherit;\n}\n\n.ProseMirror-menubar-inner {\n  color: #666;\n  padding: 1px 6px;\n  top: 0; left: 0; right: 0;\n  position: absolute;\n  border-bottom: 1px solid silver;\n  background: white;\n  z-index: 10;\n  -moz-box-sizing: border-box;\n  box-sizing: border-box;\n  overflow: hidden;\n  border-top-left-radius: inherit;\n  border-top-right-radius: inherit;\n}\n\n.ProseMirror-menubar .ProseMirror-icon-active {\n  background: #eee;\n}\n\n.ProseMirror-menubar input[type="text"],\n.ProseMirror-menubar textarea {\n  background: #eee;\n  color: black;\n  border: none;\n  outline: none;\n  width: 100%;\n  box-sizing: -moz-border-box;\n  box-sizing: border-box;\n}\n\n.ProseMirror-menubar input[type="text"] {\n  padding: 0 4px;\n}\n\n.ProseMirror-menubar form {\n  position: relative;\n  padding: 2px 4px;\n}\n\n.ProseMirror-menubar .ProseMirror-blocktype {\n  border: 1px solid #ccc;\n  min-width: 4em;\n}\n.ProseMirror-menubar .ProseMirror-blocktype:after {\n  color: #ccc;\n}\n\n.ProseMirror-menubar-sliding {\n  -webkit-transition: left 0.2s ease-out;\n  -moz-transition: left 0.2s ease-out;\n  transition: left 0.2s ease-out;\n  position: relative;\n  left: 100%;\n  width: 100%;\n  box-sizing: -moz-border-box;\n  box-sizing: border-box;\n  padding-left: 16px;\n  background: white;\n}\n\n.ProseMirror-menubar-back {\n  position: absolute;\n  height: 100%;\n  margin-top: -1px;\n  padding-bottom: 2px;\n  width: 10px;\n  left: 0;\n  border-right: 1px solid silver;\n  cursor: pointer;\n}\n.ProseMirror-menubar-back:after {\n  content: "«";\n}\n\n')}),require.register("prosemirror/menu/tooltip",function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=t("../dom"),s="ProseMirror-tooltip",a=function(){function e(t,n){var o=this;r(this,e),this.pm=t,this.dir=n||"above",this.pointer=t.wrapper.appendChild(i.elt("div",{"class":s+"-pointer-"+this.dir+" "+s+"-pointer"})),this.pointerWidth=this.pointerHeight=null,this.dom=t.wrapper.appendChild(i.elt("div",{"class":s})),this.dom.addEventListener("transitionend",function(){"0"==o.dom.style.opacity&&(o.dom.style.display=o.pointer.style.display="")}),this.isOpen=!1,this.lastLeft=this.lastRight=null}return o(e,[{key:"detach",value:function(){this.dom.parentNode.removeChild(this.dom),this.pointer.parentNode.removeChild(this.pointer)}},{key:"getSize",value:function(e){var t=this.pm.wrapper.appendChild(i.elt("div",{"class":s,style:"display: block; position: absolute"},e)),n={width:t.offsetWidth,height:t.offsetHeight};return t.parentNode.removeChild(t),n}},{key:"open",value:function(e,t){for(var n=this.lastLeft=t?t.left:this.lastLeft,r=this.lastTop=t?t.top:this.lastTop,o=this.getSize(e),i=this.pm.wrapper.getBoundingClientRect(),s=this.dom.firstChild,a=void 0;s;s=a)a=s.nextSibling,s!=this.pointer&&this.dom.removeChild(s);this.dom.appendChild(e),this.dom.style.display=this.pointer.style.display="block",null==this.pointerWidth&&(this.pointerWidth=this.pointer.offsetWidth-1,this.pointerHeight=this.pointer.offsetHeight-1),this.dom.style.width=o.width+"px",this.dom.style.height=o.height+"px";var l=5;if("above"==this.dir||"below"==this.dir){var c=Math.max(0,Math.min(n-o.width/2,window.innerWidth-o.width));if(this.dom.style.left=c-i.left+"px",this.pointer.style.left=n-i.left-this.pointerWidth/2+"px","above"==this.dir){var u=r-i.top-l-this.pointerHeight-o.height;this.dom.style.top=u+"px",this.pointer.style.top=u+o.height+"px"}else{var u=r-i.top+l;this.pointer.style.top=u+"px",this.dom.style.top=u+this.pointerHeight+"px"}}else if("left"==this.dir||"right"==this.dir)if(this.dom.style.top=r-i.top-o.height/2+"px",this.pointer.style.top=r-this.pointerHeight/2-i.top+"px","left"==this.dir){var p=n-i.left-l-this.pointerWidth;this.dom.style.left=p-o.width+"px",this.pointer.style.left=p+"px"}else{var p=n-i.left+l;this.dom.style.left=p+this.pointerWidth+"px",this.pointer.style.left=p+"px"}else if("center"==this.dir){var d=Math.max(i.top,0),h=Math.min(i.bottom,window.innerHeight),f=(h-d-o.height)/2;this.dom.style.left=(i.width-o.width)/2+"px",this.dom.style.top=d-i.top+f+"px"}getComputedStyle(this.dom).opacity,getComputedStyle(this.pointer).opacity,this.dom.style.opacity=this.pointer.style.opacity=1,this.isOpen=!0}},{key:"close",value:function(){this.isOpen&&(this.isOpen=!1,this.dom.style.opacity=this.pointer.style.opacity=0)}}]),e}();e.Tooltip=a,i.insertCSS('\n\n.ProseMirror-tooltip {\n  position: absolute;\n  display: none;\n  box-sizing: border-box;\n  -moz-box-sizing: border- box;\n  overflow: hidden;\n\n  -webkit-transition: width 0.4s ease-out, height 0.4s ease-out, left 0.4s ease-out, top 0.4s ease-out, opacity 0.2s;\n  -moz-transition: width 0.4s ease-out, height 0.4s ease-out, left 0.4s ease-out, top 0.4s ease-out, opacity 0.2s;\n  transition: width 0.4s ease-out, height 0.4s ease-out, left 0.4s ease-out, top 0.4s ease-out, opacity 0.2s;\n  opacity: 0;\n\n  border-radius: 5px;\n  padding: 3px 7px;\n  margin: 0;\n  background: #444;\n  border-color: #777;\n  color: white;\n\n  z-index: 5;\n}\n\n.ProseMirror-tooltip-pointer {\n  content: "";\n  position: absolute;\n  display: none;\n  width: 0; height: 0;\n\n  -webkit-transition: left 0.4s ease-out, top 0.4s ease-out, opacity 0.2s;\n  -moz-transition: left 0.4s ease-out, top 0.4s ease-out, opacity 0.2s;\n  transition: left 0.4s ease-out, top 0.4s ease-out, opacity 0.2s;\n  opacity: 0;\n\n  z-index: 5;\n}\n\n.ProseMirror-tooltip-pointer-above {\n  border-left: 6px solid transparent;\n  border-right: 6px solid transparent;\n  border-top: 6px solid #444;\n}\n\n.ProseMirror-tooltip-pointer-below {\n  border-left: 6px solid transparent;\n  border-right: 6px solid transparent;\n  border-bottom: 6px solid #444;\n}\n\n.ProseMirror-tooltip-pointer-right {\n  border-top: 6px solid transparent;\n  border-bottom: 6px solid transparent;\n  border-right: 6px solid #444;\n}\n\n.ProseMirror-tooltip-pointer-left {\n  border-top: 6px solid transparent;\n  border-bottom: 6px solid transparent;\n  border-left: 6px solid #444;\n}\n\n.ProseMirror-tooltip input[type="text"],\n.ProseMirror-tooltip textarea {\n  background: #666;\n  color: white;\n  border: none;\n  outline: none;\n}\n\n.ProseMirror-tooltip input[type="text"] {\n  padding: 0 4px;\n}\n\n')}),require.register("prosemirror/menu/tooltipmenu",function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(){for(var e=window.getSelection().getRangeAt(0).getClientRects(),t=e[0],n=t.left,r=t.right,o=t.top,i=1;n==r&&e.length>i;){var s=e[i++];n=s.left,r=s.right,o=s.top}for(;i<e.length;i++)e[i].top<e[0].bottom-1&&(i==e.length-1||Math.abs(e[i+1].left-e[i].left)>1)&&(n=Math.min(n,e[i].left),r=Math.max(r,e[i].right),o=Math.min(o,e[i].top));return{top:o,left:(n+r)/2}}function i(e){var t=e.content.querySelector(".ProseMirror-selectednode");if(!t)return{left:0,top:0};var n=t.getBoundingClientRect();return{left:Math.min((n.left+n.right)/2,n.left+20),top:n.top}}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=t("../edit"),l=t("../model"),c=t("../dom"),u=t("./update"),p=t("./tooltip"),d=t("./menu"),h="ProseMirror-tooltipmenu";
a.defineOption("tooltipMenu",!1,function(e,t){e.mod.tooltipMenu&&e.mod.tooltipMenu.detach(),e.mod.tooltipMenu=t?new f(e,t):null});var f=function(){function e(t,n){var o=this;r(this,e),this.pm=t,this.inlineItems=n&&n.inlineItems||d.commandGroups(t,"inline"),this.blockItems=n&&n.blockItems||d.commandGroups(t,"block"),this.showLinks=n?n.showLinks!==!1:!0,this.emptyBlockMenu=n&&n.emptyBlockMenu,this.update=new u.MenuUpdate(t,"change selectionChange blur",function(){return o.prepareUpdate()}),this.tooltip=new p.Tooltip(t,"above"),this.menu=new d.Menu(t,new d.TooltipDisplay(this.tooltip,function(){return o.update.force()}))}return s(e,[{key:"detach",value:function(){this.update.detach(),this.tooltip.detach()}},{key:"prepareUpdate",value:function(){var e=this;if(this.menu.active)return null;var t=this.pm.selection,n=t.empty,r=t.node,s=t.head,a=void 0;if(!this.pm.hasFocus())return function(){return e.tooltip.close()};if(r&&r.isBlock){var l=function(){var t=i(e.pm);return{v:function(){return e.menu.show(e.blockItems,t)}}}();if("object"==typeof l)return l.v}else if(n)if(this.emptyBlockMenu&&0==this.pm.doc.path(s.path).length){var c=function(){var t=e.pm.coordsAtPos(s);return{v:function(){return e.menu.show(e.blockItems,t)}}}();if("object"==typeof c)return c.v}else{if(!this.showLinks||!(a=this.linkUnderCursor()))return function(){return e.tooltip.close()};var u=function(){var t=e.pm.coordsAtPos(s);return{v:function(){return e.showLink(a,t)}}}();if("object"==typeof u)return u.v}else{var p=function(){var t=r?i(e.pm):o();return{v:function(){return e.menu.show(e.inlineItems,t)}}}();if("object"==typeof p)return p.v}}},{key:"linkUnderCursor",value:function(){var e=this.pm.selection.head;if(!e)return null;var t=l.spanStylesAt(this.pm.doc,e);return t.reduce(function(e,t){return e||"link"==t.type.name&&t},null)}},{key:"showLink",value:function(e,t){var n=c.elt("div",{"class":h+"-linktext"},c.elt("a",{href:e.attrs.href,title:e.attrs.title},e.attrs.href));this.tooltip.open(n,t)}}]),e}();c.insertCSS("\n\n.ProseMirror-tooltipmenu-linktext a {\n  color: white;\n  text-decoration: none;\n  padding: 0 5px;\n}\n\n.ProseMirror-tooltipmenu-linktext a:hover {\n  text-decoration: underline;\n}\n\n")}),require.register("prosemirror/menu/update",function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=200,s=200,a=function(){function e(t,n,o){var i=this;r(this,e),this.pm=t,this.prepare=o,this.mustUpdate=!1,this.updateInfo=null,this.timeout=null,this.lastFlush=0,this.events=n.split(" "),this.onEvent=this.onEvent.bind(this),this.force=this.force.bind(this),this.events.forEach(function(e){return t.on(e,i.onEvent)}),t.on("flush",this.onFlush=this.onFlush.bind(this)),t.on("flushed",this.onFlushed=this.onFlushed.bind(this))}return o(e,[{key:"detach",value:function(){var e=this;clearTimeout(this.timeout),this.events.forEach(function(t){return e.pm.off(t,e.onEvent)}),this.pm.off("flush",this.onFlush),this.pm.off("flushed",this.onFlushed)}},{key:"onFlush",value:function(){var e=Date.now();this.mustUpdate&&e-this.lastFlush>=i&&(this.lastFlush=e,clearTimeout(this.timeout),this.mustUpdate=!1,this.update=this.prepare())}},{key:"onFlushed",value:function(){this.update&&(this.update(),this.update=null)}},{key:"onEvent",value:function(){this.mustUpdate=!0,clearTimeout(this.timeout),this.timeout=setTimeout(this.force,s)}},{key:"force",value:function(){this.mustUpdate=!1,this.updateInfo=null,this.lastFlush=Date.now(),clearTimeout(this.timeout);var e=this.prepare();e&&e()}}]),e}();e.MenuUpdate=a}),require.register("prosemirror/model/defaultschema",function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(e,t,n){for(var r=!0;r;){var o=e,i=t,s=n;r=!1,null===o&&(o=Function.prototype);var a=Object.getOwnPropertyDescriptor(o,i);if(void 0!==a){if("value"in a)return a.value;var l=a.get;return void 0===l?void 0:l.call(s)}var c=Object.getPrototypeOf(o);if(null===c)return void 0;e=c,t=i,n=s,r=!0,a=c=void 0}},a=t("./schema"),l=function(e){function t(){r(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return o(t,e),i(t,null,[{key:"kind",get:function(){return"."}}]),t}(a.Block);e.Doc=l;var c=function(e){function t(){r(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return o(t,e),t}(a.Block);e.BlockQuote=c;var u=function(e){function t(){r(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return o(t,e),i(t,null,[{key:"contains",get:function(){return"list_item"}}]),t}(a.Block);e.OrderedList=u,u.attributes={order:new a.Attribute({"default":"1"})};var p=function(e){function t(){r(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return o(t,e),i(t,null,[{key:"contains",get:function(){return"list_item"}}]),t}(a.Block);e.BulletList=p;var d=function(e){function t(){r(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return o(t,e),i(t,null,[{key:"kind",get:function(){return"."}}]),t}(a.Block);e.ListItem=d;var h=function(e){function t(){r(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return o(t,e),i(t,null,[{key:"contains",get:function(){return null}}]),t}(a.Block);e.HorizontalRule=h;var f=function(e){function t(){r(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return o(t,e),t}(a.Textblock);e.Heading=f,f.attributes={level:new a.Attribute({"default":"1"})};var m=function(e){function t(){r(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return o(t,e),i(t,[{key:"containsStyles",get:function(){return!1}},{key:"isCode",get:function(){return!0}}],[{key:"contains",get:function(){return"text"}}]),t}(a.Textblock);e.CodeBlock=m;var g=function(e){function t(){r(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return o(t,e),i(t,[{key:"defaultTextblock",get:function(){return!0}}]),t}(a.Textblock);e.Paragraph=g;var v=function(e){function t(){r(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return o(t,e),t}(a.Inline);e.Image=v,v.attributes={src:new a.Attribute,alt:new a.Attribute({"default":""}),title:new a.Attribute({"default":""})};var y=function(e){function t(){r(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return o(t,e),i(t,[{key:"selectable",get:function(){return!1}}]),t}(a.Inline);e.HardBreak=y;var b=function(e){function t(){r(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return o(t,e),i(t,null,[{key:"rank",get:function(){return 51}}]),t}(a.StyleType);e.EmStyle=b;var S=function(e){function t(){r(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return o(t,e),i(t,null,[{key:"rank",get:function(){return 52}}]),t}(a.StyleType);e.StrongStyle=S;var k=function(e){function t(){r(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return o(t,e),i(t,null,[{key:"rank",get:function(){return 53}}]),t}(a.StyleType);e.LinkStyle=k,k.attributes={href:new a.Attribute,title:new a.Attribute({"default":""})};var w=function(e){function t(){r(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return o(t,e),i(t,[{key:"isCode",get:function(){return!0}}],[{key:"rank",get:function(){return 101}}]),t}(a.StyleType);e.CodeStyle=w;var E=new a.SchemaSpec({doc:l,blockquote:c,ordered_list:u,bullet_list:p,list_item:d,horizontal_rule:h,paragraph:g,heading:f,code_block:m,text:a.Text,image:v,hard_break:y},{em:b,strong:S,link:k,code:w}),_=new a.Schema(E);e.defaultSchema=_}),require.register("prosemirror/model/diff",function(e,t,n){"use strict";function r(e,t){for(var n=arguments.length<=2||void 0===arguments[2]?[]:arguments[2],o=arguments.length<=3||void 0===arguments[3]?[]:arguments[3],a=0,l=0;;l++){if(l==e.length||l==t.length){if(e.length==t.length)return null;break}var c=e.child(l),u=t.child(l);if(c!=u){if(!c.sameMarkup(u))break;if(e.isTextblock){if(!s.sameStyles(c.styles,u.styles))break;if(c.isText&&c.text!=u.text){for(var p=0;c.text[p]==u.text[p];p++)a++;break}a+=c.offset}else{var d=r(c,u,n.concat(l),o.concat(l));if(d)return d;a++}}else a+=e.isTextblock?c.offset:1}return{a:new i.Pos(n,a),b:new i.Pos(o,a)}}function o(e,t){for(var n=arguments.length<=2||void 0===arguments[2]?[]:arguments[2],r=arguments.length<=3||void 0===arguments[3]?[]:arguments[3],a=e.length,l=t.length,c=0;;a--,l--){if(0==a||0==l){if(a==l)return null;break}var u=e.child(a-1),p=t.child(l-1);if(u!=p){if(!u.sameMarkup(p))break;if(e.isTextblock){if(!s.sameStyles(u.styles,p.styles))break;if(u.isText&&u.text!=p.text){for(var d=0,h=Math.min(u.text.length,p.text.length);h>d&&u.text[u.text.length-d-1]==p.text[p.text.length-d-1];)d++,c++;break}c+=u.offset}else{var f=o(u,p,n.concat(a-1),r.concat(l-1));if(f)return f;c++}}else c+=e.isTextblock?u.offset:1}return{a:new i.Pos(n,e.maxOffset-c),b:new i.Pos(r,t.maxOffset-c)}}Object.defineProperty(e,"__esModule",{value:!0}),e.findDiffStart=r,e.findDiffEnd=o;var i=t("./pos"),s=t("./style")}),require.register("prosemirror/model/index",function(e,t,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t("./node");Object.defineProperty(e,"compareMarkup",{enumerable:!0,get:function(){return r.compareMarkup}});var o=t("./style");Object.defineProperty(e,"removeStyle",{enumerable:!0,get:function(){return o.removeStyle}}),Object.defineProperty(e,"sameStyles",{enumerable:!0,get:function(){return o.sameStyles}}),Object.defineProperty(e,"containsStyle",{enumerable:!0,get:function(){return o.containsStyle}}),Object.defineProperty(e,"spanStylesAt",{enumerable:!0,get:function(){return o.spanStylesAt}}),Object.defineProperty(e,"rangeHasStyle",{enumerable:!0,get:function(){return o.rangeHasStyle}});var i=t("./schema");Object.defineProperty(e,"SchemaSpec",{enumerable:!0,get:function(){return i.SchemaSpec}}),Object.defineProperty(e,"Schema",{enumerable:!0,get:function(){return i.Schema}}),Object.defineProperty(e,"SchemaError",{enumerable:!0,get:function(){return i.SchemaError}}),Object.defineProperty(e,"NodeType",{enumerable:!0,get:function(){return i.NodeType}}),Object.defineProperty(e,"Block",{enumerable:!0,get:function(){return i.Block}}),Object.defineProperty(e,"Textblock",{enumerable:!0,get:function(){return i.Textblock}}),Object.defineProperty(e,"Inline",{enumerable:!0,get:function(){return i.Inline}}),Object.defineProperty(e,"Text",{enumerable:!0,get:function(){return i.Text}}),Object.defineProperty(e,"StyleType",{enumerable:!0,get:function(){return i.StyleType}}),Object.defineProperty(e,"Attribute",{enumerable:!0,get:function(){return i.Attribute}});var s=t("./defaultschema");Object.defineProperty(e,"defaultSchema",{enumerable:!0,get:function(){return s.defaultSchema}}),Object.defineProperty(e,"Doc",{enumerable:!0,get:function(){return s.Doc}}),Object.defineProperty(e,"BlockQuote",{enumerable:!0,get:function(){return s.BlockQuote}}),Object.defineProperty(e,"OrderedList",{enumerable:!0,get:function(){return s.OrderedList}}),Object.defineProperty(e,"BulletList",{enumerable:!0,get:function(){return s.BulletList}}),Object.defineProperty(e,"ListItem",{enumerable:!0,get:function(){return s.ListItem}}),Object.defineProperty(e,"HorizontalRule",{enumerable:!0,get:function(){return s.HorizontalRule}}),Object.defineProperty(e,"Paragraph",{enumerable:!0,get:function(){return s.Paragraph}}),Object.defineProperty(e,"Heading",{enumerable:!0,get:function(){return s.Heading}}),Object.defineProperty(e,"CodeBlock",{enumerable:!0,get:function(){return s.CodeBlock}}),Object.defineProperty(e,"Image",{enumerable:!0,get:function(){return s.Image}}),Object.defineProperty(e,"HardBreak",{enumerable:!0,get:function(){return s.HardBreak}}),Object.defineProperty(e,"CodeStyle",{enumerable:!0,get:function(){return s.CodeStyle}}),Object.defineProperty(e,"EmStyle",{enumerable:!0,get:function(){return s.EmStyle}}),Object.defineProperty(e,"StrongStyle",{enumerable:!0,get:function(){return s.StrongStyle}}),Object.defineProperty(e,"LinkStyle",{enumerable:!0,get:function(){return s.LinkStyle}});var a=t("./pos");Object.defineProperty(e,"Pos",{enumerable:!0,get:function(){return a.Pos}});var l=t("./slice");Object.defineProperty(e,"sliceBefore",{enumerable:!0,get:function(){return l.sliceBefore}}),Object.defineProperty(e,"sliceAfter",{enumerable:!0,get:function(){return l.sliceAfter}}),Object.defineProperty(e,"sliceBetween",{enumerable:!0,get:function(){return l.sliceBetween}}),Object.defineProperty(e,"childrenBefore",{enumerable:!0,get:function(){return l.childrenBefore}}),Object.defineProperty(e,"childrenAfter",{enumerable:!0,get:function(){return l.childrenAfter}}),Object.defineProperty(e,"childrenBetween",{enumerable:!0,get:function(){return l.childrenBetween}}),Object.defineProperty(e,"siblingRange",{enumerable:!0,get:function(){return l.siblingRange}});var c=t("./diff");Object.defineProperty(e,"findDiffStart",{enumerable:!0,get:function(){return c.findDiffStart}}),Object.defineProperty(e,"findDiffEnd",{enumerable:!0,get:function(){return c.findDiffEnd}})}),require.register("prosemirror/model/node",function(e,t,n){"use strict";function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e){if(e)for(var t in e)return!1;return!0}function s(e,t,n,r){if(e!=t)return!1;if(i(n))return i(r);if(i(r))return!1;for(var o in n)if(r[o]!==n[o])return!1;return!0}Object.defineProperty(e,"__esModule",{value:!0});var a=function(e,t,n){for(var r=!0;r;){var o=e,i=t,s=n;r=!1,null===o&&(o=Function.prototype);var a=Object.getOwnPropertyDescriptor(o,i);if(void 0!==a){if("value"in a)return a.value;var l=a.get;return void 0===l?void 0:l.call(s)}var c=Object.getPrototypeOf(o);if(null===c)return void 0;e=c,t=i,n=s,r=!0,a=c=void 0}},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();e.compareMarkup=s;var c=t("./style"),u=[],p=function(){function e(t,n){o(this,e),this.type=t,this.attrs=n}return l(e,[{key:"sameMarkup",value:function(e){return s(this.type,e.type,this.attrs,e.attrs)}},{key:"child",value:function(e){throw new Error("Trying to index non-block node "+this)}},{key:"toJSON",value:function(){var e={type:this.type.name};for(var t in this.attrs)return e.attrs=this.attrs,e;return e}},{key:"length",get:function(){return 0}},{key:"isBlock",get:function(){return!1}},{key:"isTextblock",get:function(){return!1}},{key:"isInline",get:function(){return!1}},{key:"isText",get:function(){return!1}}]),e}();e.Node=p;var d=function(e){function t(e,n,r,i){if(o(this,t),i)throw new Error("Constructing a block node with styles");a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,n),this.content=r||u}return r(t,e),l(t,[{key:"toString",value:function(){return this.type.name+"("+this.content.join(", ")+")"}},{key:"copy",value:function(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0];return new this.constructor(this.type,this.attrs,e)}},{key:"slice",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?this.length:arguments[1];return this.content.slice(e,t)}},{key:"splice",value:function(e,t,n){return new this.constructor(this.type,this.attrs,this.content.slice(0,e).concat(n).concat(this.content.slice(t)))}},{key:"replace",value:function(e,t){var n=this.content.slice();return n[e]=t,this.copy(n)}},{key:"replaceDeep",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?0:arguments[2];if(n==e.length)return t;var r=e[n];return this.replace(r,this.child(r).replaceDeep(e,t,n+1))}},{key:"append",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?0:arguments[1],n=arguments.length<=2||void 0===arguments[2]?0:arguments[2];if(!e.length)return this;if(!this.length)return this.copy(e);var r=this.length-1,o=this.content.slice(0,r),i=this.content[r],s=e[0];t>0&&n>0&&i.sameMarkup(s)?o.push(i.append(s.content,t-1,n-1)):o.push(i.close(t-1,"end"),s.close(n-1,"start"));for(var a=1;a<e.length;a++)o.push(e[a]);return this.copy(o)}},{key:"close",value:function(e,t){if(0==e&&0==this.length&&!this.type.canBeEmpty)return this.copy(this.type.defaultContent());if(0>e)return this;var n="start"==t?0:this.maxOffset-1,r=this.child(n),o=r.close(e-1,t);return o==r?this:this.replace(n,o)}},{key:"child",value:function(e){if(0>e||e>=this.length)throw new Error("Index "+e+" out of range in "+this);return this.content[e]}},{key:"path",value:function(e){for(var t=0,n=this;t<e.length;n=n.content[e[t]],t++);return n}},{key:"isValidPos",value:function(e,t){for(var n=0,r=this;;n++){if(n==e.path.length)return t&&!r.isTextblock?!1:e.offset<=r.maxOffset;var o=e.path[n];if(o>=r.length||r.isTextblock)return!1;r=r.child(o)}}},{key:"pathNodes",value:function(e){for(var t=[],n=0,r=this;t.push(r),n!=e.length;n++)r=r.child(e[n]);return t}},{key:"toJSON",value:function(){var e=a(Object.getPrototypeOf(t.prototype),"toJSON",this).call(this);return e.content=this.content.map(function(e){return e.toJSON()}),e}},{key:"nodesBetween",value:function(e,t,n){var r=arguments.length<=3||void 0===arguments[3]?[]:arguments[3],o=arguments.length<=4||void 0===arguments[4]?null:arguments[4];if(n(this,r,e,t,o)!==!1){var i=void 0,s=t&&t.depth>r.length,a=s?t.path[r.length]:t?t.offset:this.length;if(e)if(e.depth==r.length)i=e.offset;else{i=e.path[r.length]+1;var l=null;s&&a==i-1&&(l=t,s=!1),this.enterNode(i-1,e,l,r,n)}else i=0;for(var c=i;a>c;c++)this.enterNode(c,null,null,r,n);s&&this.enterNode(a,null,t,r,n)}}},{key:"enterNode",value:function(e,t,n,r,o){r.push(e),this.child(e).nodesBetween(t,n,o,r,this),r.pop()}},{key:"inlineNodesBetween",value:function(e,t,n){this.nodesBetween(e,t,function(e,t,r,o,i,s){e.isInline&&n(e,r?r.offset:s,o?o.offset:s+e.offset,t,i)})}},{key:"maxOffset",get:function(){return this.length}},{key:"textContent",get:function(){for(var e="",t=0;t<this.length;t++)e+=this.child(t).textContent;return e}},{key:"firstChild",get:function(){return this.content[0]||null}},{key:"lastChild",get:function(){return this.content[this.length-1]||null}},{key:"length",get:function(){return this.content.length}},{key:"children",get:function(){return this.content}},{key:"isBlock",get:function(){return!0}}]),t}(p);e.BlockNode=d;var h=function(e){function t(e,n,r){o(this,t),a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,n,r);for(var i=0,s=0;s<this.content.length;s++)i+=this.content[s].offset;this._maxOffset=i}return r(t,e),l(t,[{key:"slice",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?this.maxOffset:arguments[1],n=[];if(e==t)return n;for(var r=0,o=0;;r++){var i=this.child(r),s=i.offset,a=o+s;if(o+s>e&&n.push(o>=e&&t>=a?i:i.slice(Math.max(0,e-o),Math.min(s,t-o))),a>=t)return n;o=a}}},{key:"append",value:function(e){if(!e.length)return this;if(!this.length)return this.copy(e);var t=this.content.concat(e),n=this.length-1,r=void 0;return(r=t[n].maybeMerge(t[n+1]))&&t.splice(n,2,r),this.copy(t)}},{key:"close",value:function(){return this}},{key:"nodesBetween",value:function(e,t,n,r,o){if(n(this,r,e,t,o)!==!1){var i=e?e.offset:0,s=t?t.offset:this.maxOffset;if(i!=s)for(var a=0,l=0;l<this.length;l++){var c=this.child(l),u=a+c.offset;if(u>=i&&n(c,r,i>a?e:null,u>s?t:null,this,a),u>=s)break;a=u}}}},{key:"childBefore",value:function(e){if(0==e)return{node:null,index:0,innerOffset:0};for(var t=0;t<this.length;t++){var n=this.child(t);if(e-=n.offset,0>=e)return{node:n,index:t,innerOffset:e+n.offset}}}},{key:"childAfter",value:function(e){for(var t=0;t<this.length;t++){var n=this.child(t),r=n.offset;if(r>e)return{node:n,index:t,innerOffset:e};e-=r}return{node:null,index:0,innerOffset:0}}},{key:"isTextblock",get:function(){return!0}},{key:"maxOffset",get:function(){return this._maxOffset}}]),t}(d);e.TextblockNode=h;var f=function(e){function t(e,n,r,i){if(o(this,t),r)throw new Error("Can't create a span node with content");a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,n),this.styles=i||u}return r(t,e),l(t,[{key:"styled",value:function(e){return new this.constructor(this.type,this.attrs,this.text,e)}},{key:"maybeMerge",value:function(e){return null}},{key:"toJSON",value:function(){var e=a(Object.getPrototypeOf(t.prototype),"toJSON",this).call(this);return this.styles.length&&(e.styles=this.styles.map(function(e){return e.toJSON()})),e}},{key:"toString",value:function(){return this.type.name}},{key:"offset",get:function(){return 1}},{key:"textContent",get:function(){return""}},{key:"isInline",get:function(){return!0}}]),t}(p);e.InlineNode=f;var m=function(e){function t(e,n,r,i){if(o(this,t),"string"!=typeof r||!r)throw new Error("Text node content must be a non-empty string");a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,n,null,i),this.text=r}return r(t,e),l(t,[{key:"maybeMerge",value:function(e){return e.type==this.type&&c.sameStyles(this.styles,e.styles)?new t(this.type,this.attrs,this.text+e.text,this.styles):void 0}},{key:"slice",value:function(e){var n=arguments.length<=1||void 0===arguments[1]?this.offset:arguments[1];return new t(this.type,this.attrs,this.text.slice(e,n),this.styles)}},{key:"toString",value:function(){for(var e=JSON.stringify(this.text),t=0;t<this.styles.length;t++)e=this.styles[t].type.name+"("+e+")";return e}},{key:"toJSON",value:function(){var e=a(Object.getPrototypeOf(t.prototype),"toJSON",this).call(this);return e.text=this.text,e}},{key:"offset",get:function(){return this.text.length}},{key:"textContent",get:function(){return this.text}},{key:"isText",get:function(){return!0}}]),t}(f);e.TextNode=m}),require.register("prosemirror/model/pos",function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t,n){r(this,e),this.path=t,this.offset=n}return o(e,[{key:"toString",value:function(){return this.path.join("/")+":"+this.offset}},{key:"cmp",value:function(t){return t==this?0:e.cmp(this.path,this.offset,t.path,t.offset)}},{key:"shorten",value:function(){var t=arguments.length<=0||void 0===arguments[0]?null:arguments[0],n=arguments.length<=1||void 0===arguments[1]?0:arguments[1];return t>=this.depth?this:e.shorten(this.path,t,n)}},{key:"move",value:function(t){return new e(this.path,this.offset+t)}},{key:"toPath",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0];return this.path.concat(this.offset+e)}},{key:"extend",value:function(t){for(var n=this.path.slice(),r=this.offset,o=0;o<t.path.length;o++)n.push(t.path[o]+r),r=0;return new e(n,t.offset+r)}},{key:"toJSON",value:function(){return this}},{key:"depth",get:function(){return this.path.length}}],[{key:"cmp",value:function(e,t,n,r){for(var o=e.length,i=n.length,s=0,a=Math.min(o,i);a>s;s++){var l=e[s]-n[s];if(0!=l)return l}return o>i?r<=e[s]?1:-1:i>o?t<=n[s]?-1:1:t-r}},{key:"samePath",value:function(e,t){if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}},{key:"shorten",value:function(t){var n=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=arguments.length<=2||void 0===arguments[2]?0:arguments[2];return null==n&&(n=t.length-1),new e(t.slice(0,n),t[n]+r)}},{key:"from",value:function(t){var n=arguments.length<=1||void 0===arguments[1]?0:arguments[1];if(!t.length)throw new Error("Can't create a pos from an empty array");return new e(t.slice(0,t.length-1),t[t.length-1]+n)}},{key:"fromJSON",value:function(t){return new e(t.path,t.offset)}}]),e}();e.Pos=i}),require.register("prosemirror/model/schema",function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t,n,r){function o(e,t){if(e in n.kinds){if(n.kinds[e]==t)return;v.raise("Inconsistent superkinds for kind "+e+": "+t+" and "+n.kinds[e])}n.subKind(e,t)&&v.raise("Conflicting kind hierarchy through "+e+" and "+t),n.kinds[e]=t}for(var i=e;;i=Object.getPrototypeOf(i)){var s=null!=r&&i==e?r:i.kind;if(null!=s){var a=/^(.*?)(\.)?$/.exec(s),l=p(a,3),c=(l[0],l[1]),u=l[2];if(c&&(o(t,c),t=c),u)return void o(t,null)}}}function s(e,t){var n=Object.create(null);for(var r in e)n[r]=t?t(e[r]):e[r];return n}function a(e){return e instanceof Function?{type:e}:e}function l(e,t){var n=s(e);for(var r in t){var o=a(t[r]);if(null==o)delete n[r];else if(o.type)n[r]=o;else{var i=n[r]=s(n[r]);for(var l in o)i[l]=o[l]}}return n}function c(e){var t=Object.create(null);for(var n in e){var r=e[n];if(null==r["default"])return null;t[n]=r["default"]}return t}function u(e,t,n,r){var o=Object.create(null);for(var i in e){var s=t&&t[i];if(null==s){var a=e[i];null!=a["default"]?s=a["default"]:a.compute?s=a.compute(n,r):v.raise("No value supplied for attribute "+i)}o[i]=s}return o}Object.defineProperty(e,"__esModule",{value:!0});var p=function(){function e(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(l){o=!0,i=l}finally{try{!r&&a["return"]&&a["return"]()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),d=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),h=function(e,t,n){for(var r=!0;r;){var o=e,i=t,s=n;r=!1,null===o&&(o=Function.prototype);var a=Object.getOwnPropertyDescriptor(o,i);if(void 0!==a){if("value"in a)return a.value;var l=a.get;return void 0===l?void 0:l.call(s)}var c=Object.getPrototypeOf(o);if(null===c)return void 0;e=c,t=i,n=s,r=!0,a=c=void 0}},f=t("./node"),m=t("./style"),g=t("../util/error"),v=function(e){function t(){r(this,t),h(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return o(t,e),t}(g.ProseMirrorError);e.SchemaError=v;var y=function(){function e(t,n,o,i){r(this,e),this.name=t,this.contains=n,this.attrs=o,this.schema=i,this.defaultAttrs=null}return d(e,[{key:"canContain",value:function(e){return this.canContainType(e.type)}},{key:"canContainType",value:function(e){return this.schema.subKind(e.name,this.contains)}},{key:"canContainChildren",value:function(e,t){if(!t&&!this.schema.subKind(e.type.contains,this.contains))return!1;for(var n=0;n<e.length;n++)if(!this.canContain(e.child(n)))return!1;return!0}},{key:"findConnection",value:function(e){if(this.canContainType(e))return[];for(var t=Object.create(null),n=[{from:this,via:[]}];n.length;){var r=n.shift();for(var o in this.schema.nodes){var i=this.schema.nodeType(o);if(!(i.contains in t)&&r.from.canContainType(i)){var s=r.via.concat(i);if(i.canContainType(e))return s;n.push({from:i,via:s}),t[i.contains]=!0}}}}},{key:"buildAttrs",value:function(e,t){return!e&&this.defaultAttrs?this.defaultAttrs:u(this.attrs,e,this,t)}},{key:"create",value:function(e,t,n){return new this.instance(this,this.buildAttrs(e,t),t,n)}},{key:"createAutoFill",value:function(e,t,n){return t&&0!=t.length||this.canBeEmpty||(t=this.defaultContent()),this.create(e,t,n)}},{key:"locked",get:function(){return!1}},{key:"isTextblock",get:function(){return!1}},{key:"selectable",get:function(){return!0}},{key:"canBeEmpty",get:function(){return!0}}],[{key:"compile",value:function(e,t){var n=Object.create(null);for(var r in e){var o=e[r],s=o.type||v.raise("Missing node type for "+r);i(s,r,t,o.kind);var a="contains"in o?o.contains:s.contains;n[r]=new s(r,a,o.attributes||s.attributes,t)}for(var l in n){var a=n[l].contains;!a||a in t.kinds||v.raise("Node type "+l+" is specified to contain non-existing kind "+a)}n.doc||v.raise("Every schema needs a 'doc' type"),n.text||v.raise("Every schema needs a 'text' type");for(var u in e)e[u].defaultAttrs=c(e[u].attrs);return n}},{key:"register",value:function(e,t){(this.prototype[e]||(this.prototype[e]=[])).push(t)}},{key:"kind",get:function(){return"."}}]),e}();e.NodeType=y,y.attributes={};var b=function(e){function t(){r(this,t),h(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return o(t,e),d(t,[{key:"defaultContent",value:function(){var e=this.schema.defaultTextblockType().create(),t=this.findConnection(e.type);t||v.raise("Can't create default content for "+this.name);for(var n=t.length-1;n>=0;n--)e=t[n].create(null,[e]);return[e]}},{key:"instance",get:function(){return f.BlockNode}},{key:"isBlock",get:function(){return!0}},{key:"canBeEmpty",get:function(){return null==this.contains}}],[{key:"contains",get:function(){return"block"}},{key:"kind",get:function(){return"block."}}]),t}(y);e.Block=b;var S=function(e){function t(){r(this,t),h(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return o(t,e),d(t,[{key:"canContain",value:function(e){var n=this;return h(Object.getPrototypeOf(t.prototype),"canContain",this).call(this,e)&&e.styles.every(function(e){return n.canContainStyle(e)})}},{key:"canContainStyle",value:function(e){var t=this.containsStyles;if(t===!0)return!0;if(t)for(var n=0;n<t.length;n++)if(t[n]==e.name)return!0;return!1}},{key:"instance",get:function(){return f.TextblockNode}},{key:"containsStyles",get:function(){return!0}},{key:"isTextblock",get:function(){return!0}},{key:"canBeEmpty",get:function(){return!0}}],[{key:"contains",get:function(){return"inline"}}]),t}(b);e.Textblock=S;var k=function(e){function t(){r(this,t),h(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return o(t,e),d(t,[{key:"instance",get:function(){return f.InlineNode}}],[{key:"contains",get:function(){return null}},{key:"kind",get:function(){return"inline."}}]),t}(y);e.Inline=k;var w=function(e){function t(){r(this,t),h(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return o(t,e),
d(t,[{key:"instance",get:function(){return f.TextNode}},{key:"selectable",get:function(){return!1}}]),t}(k);e.Text=w;var E=function T(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];r(this,T),this["default"]=e["default"],this.compute=e.compute};e.Attribute=E;var _=function(){function e(t,n,o,i){r(this,e),this.name=t,this.attrs=n,this.rank=o,this.schema=i;var s=c(this.attrs);this.instance=s&&new m.StyleMarker(this,s)}return d(e,[{key:"create",value:function(e){return!e&&this.instance?this.instance:new m.StyleMarker(this,u(this.attrs,e,this))}}],[{key:"getOrder",value:function(e){var t=[];for(var n in e)t.push({name:n,rank:e[n].type.rank});t.sort(function(e,t){return e.rank-t.rank});for(var r=Object.create(null),o=0;o<t.length;o++)r[t[o].name]=o;return r}},{key:"compile",value:function(e,t){var n=this.getOrder(e),r=Object.create(null);for(var o in e){var i=e[o],s=i.attributes||i.type.attributes;r[o]=new i.type(o,s,n[o],t)}return r}},{key:"register",value:function(e,t){(this.prototype[e]||(this.prototype[e]=[])).push(t)}},{key:"rank",get:function(){return 50}}]),e}();e.StyleType=_,_.attributes={};var x=function(){function e(t,n){r(this,e),this.nodes=t?s(t,a):Object.create(null),this.styles=n?s(n,a):Object.create(null)}return d(e,[{key:"updateNodes",value:function(t){return new e(l(this.nodes,t),this.styles)}},{key:"addAttribute",value:function(t,n,r){var o=s(this.nodes);for(var i in o)if("string"==typeof t?t==i:"function"==typeof t?t(i,o[i]):t?t==o[i]:!0){var a=o[i]=s(o[i]);a.attributes||(a.attributes=s(a.type.attributes)),a.attributes[n]=r}return new e(o,this.styles)}},{key:"updateStyles",value:function(t){return new e(this.nodes,l(this.styles,t))}}]),e}();e.SchemaSpec=x;var C=function(){function e(t,n){r(this,e),t instanceof x||(t=new x(t,n)),this.spec=t,this.kinds=Object.create(null),this.nodes=y.compile(t.nodes,this),this.styles=_.compile(t.styles,this),this.cached=Object.create(null),this.node=this.node.bind(this),this.text=this.text.bind(this),this.nodeFromJSON=this.nodeFromJSON.bind(this),this.styleFromJSON=this.styleFromJSON.bind(this)}return d(e,[{key:"node",value:function(e,t,n,r){return"string"==typeof e?e=this.nodeType(e):e instanceof y?e.schema!=this&&v.raise("Node type from different schema used ("+e.name+")"):v.raise("Invalid node type: "+e),e.create(t,n,r)}},{key:"text",value:function(e,t){return this.nodes.text.create(null,e,t)}},{key:"defaultTextblockType",value:function(){var e=this.cached.defaultTextblockType;if(void 0!==e)return e;for(var t in this.nodes)if(this.nodes[t].defaultTextblock)return this.cached.defaultTextblockType=this.nodes[t];return this.cached.defaultTextblockType=null}},{key:"style",value:function(e,t){var n=this.styles[e]||v.raise("No style named "+e);return n.create(t)}},{key:"nodeFromJSON",value:function(e){var t=this.nodeType(e.type);return t.create(e.attrs,e.text||e.content&&e.content.map(this.nodeFromJSON),e.styles&&e.styles.map(this.styleFromJSON))}},{key:"styleFromJSON",value:function(e){return"string"==typeof e?this.style(e):this.style(e._,e)}},{key:"nodeType",value:function(e){return this.nodes[e]||v.raise("Unknown node type: "+e)}},{key:"subKind",value:function(e,t){for(;;){if(e==t)return!0;if(e=this.kinds[e],!e)return!1}}}]),e}();e.Schema=C}),require.register("prosemirror/model/slice",function(e,t,n){"use strict";function r(e,t){var n=arguments.length<=2||void 0===arguments[2]?0:arguments[2];if(n==t.depth)return e.slice(0,t.offset);var r=t.path[n];return e.slice(0,r).concat(o(e.child(r),t,n+1))}function o(e,t){var n=arguments.length<=2||void 0===arguments[2]?0:arguments[2];return e.copy(r(e,t,n))}function i(e,t){var n=arguments.length<=2||void 0===arguments[2]?0:arguments[2];if(n==t.depth)return e.slice(t.offset);var r=t.path[n],o=e.slice(r+1);return o.unshift(s(e.child(r),t,n+1)),o}function s(e,t){var n=arguments.length<=2||void 0===arguments[2]?0:arguments[2];return e.copy(i(e,t,n))}function a(e,t,n){var r=arguments.length<=3||void 0===arguments[3]?0:arguments[3],i=r==t.depth,a=r==n.depth;if(i&&a)return e.slice(t.offset,n.offset);if(!i&&!a&&t.path[r]==n.path[r])return[l(e.child(t.path[r]),t,n,!1,r+1)];var c=[],u=void 0;i?u=t.offset:(u=t.path[r]+1,c.push(s(e.child(u-1),t,r+1)));for(var p=a?n.offset:n.path[r],d=e.slice(u,p),h=0;h<d.length;h++)c.push(d[h]);return a||c.push(o(e.child(p),n,r+1)),c}function l(e,t,n){var r=arguments.length<=3||void 0===arguments[3]?!0:arguments[3],o=arguments.length<=4||void 0===arguments[4]?0:arguments[4];if(o<t.depth&&o<n.depth&&t.path[o]==n.path[o]){var i=l(e.child(t.path[o]),t,n,r,o+1);if(!r)return e.copy([i]);if("doc"!=e.type.name)return i;for(var s=e.type.findConnection(i.type),c=s.length-1;c>=0;c--)i=e.type.schema.node(s[c],null,[i]);return e.copy([i])}return e.copy(a(e,t,n,o))}function c(e,t,n){for(var r=0,o=e;;r++){if(o.isTextblock){var i=t.path.slice(0,r-1),s=t.path[r-1];return{from:new u.Pos(i,s),to:new u.Pos(i,s+1)}}var a=r==t.path.length,l=r==n.path.length,c=a?t.offset:t.path[r],p=l?n.offset:n.path[r];if(a||l||c!=p){var i=t.path.slice(0,r);return{from:new u.Pos(i,c),to:new u.Pos(i,p+(l?0:1))}}o=o.child(c)}}Object.defineProperty(e,"__esModule",{value:!0}),e.childrenBefore=r,e.sliceBefore=o,e.childrenAfter=i,e.sliceAfter=s,e.childrenBetween=a,e.sliceBetween=l,e.siblingRange=c;var u=t("./pos")}),require.register("prosemirror/model/style",function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<e.length;n++)if(e[n].type==t)return[].concat(r(e.slice(0,n)),r(e.slice(n+1)));return e}function s(e,t){if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(!e[n].eq(t[n]))return!1;return!0}function a(e,t){for(var n=0;n<e.length;n++)if(e[n].type==t)return e[n];return!1}function l(e,t){var n=e.path(t.path);if(!n.isTextblock)return d;var r=n.childBefore(t.offset).node||n.firstChild;return r?r.styles:d}function c(e,t,n,r){var o=!1;return e.inlineNodesBetween(t,n,function(e){a(e.styles,r)&&(o=!0)}),o}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();e.removeStyle=i,e.sameStyles=s,e.containsStyle=a,e.spanStylesAt=l,e.rangeHasStyle=c;var p=function(){function e(t,n){o(this,e),this.type=t,this.attrs=n}return u(e,[{key:"toJSON",value:function(){if(this.type.instance)return this.type.name;var e={_:this.type.name};for(var t in this.attrs)e[t]=this.attrs[t];return e}},{key:"addToSet",value:function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.type==this.type)return this.eq(n)?e:[].concat(r(e.slice(0,t)),[this],r(e.slice(t+1)));if(n.type.rank>this.type.rank)return[].concat(r(e.slice(0,t)),[this],r(e.slice(t)))}return e.concat(this)}},{key:"removeFromSet",value:function(e){for(var t=0;t<e.length;t++)if(this.eq(e[t]))return[].concat(r(e.slice(0,t)),r(e.slice(t+1)));return e}},{key:"isInSet",value:function(e){for(var t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}},{key:"eq",value:function(e){if(this.type!=e.type)return!1;for(var t in this.attrs)if(e.attrs[t]!=this.attrs[t])return!1;return!0}}]),e}();e.StyleMarker=p;var d=[]}),require.register("prosemirror/parse/dom",function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t,n){n||(n={});var r=new f(e,n.topNode||e.node("doc")),o=n.from?t.childNodes[n.from]:t.firstChild,i=null!=n.to&&t.childNodes[n.to]||null;r.addAll(o,i,!0);for(var s=void 0;r.stack.length;)s=r.leave();return s}function i(e,t,n){var r=(n&&n.document||window.document).createElement("div");return r.innerHTML=t,o(e,r,n)}function s(e){return e.cached.parseDOMNodes||(e.cached.parseDOMNodes=a(e))}function a(e){function t(e){var t=e.parseDOM;t&&t.forEach(function(t){var r=t.tag||"_";(n[r]||(n[r]=[])).push({type:e,rank:null==t.rank?50:t.rank,parse:t.parse})})}var n=Object.create(null);n._=[];for(var r in e.nodes)t(e.nodes[r]);for(var o in e.styles)t(e.styles[o]);for(var i in n)n[i].sort(function(e,t){return e.rank-t.rank});return n}function l(e,t,n,r){t.enterFrom(e,n,r),t.addAll(e.firstChild,null,!0),t.leave()}function c(e,t,n){var r=t.styles;t.styles=(n.instance||n).addToSet(r),t.addAll(e.firstChild,null),t.styles=r}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();e.fromDOM=o,e.fromHTML=i;var p=t("../model"),d=t("./index");d.defineSource("dom",o),d.defineSource("html",i);var h={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},f=function(){function e(t,n){r(this,e),this.schema=t,this.stack=[],this.styles=[],this.closing=!1,this.enter(n.type,n.attrs),this.nodeInfo=s(t)}return u(e,[{key:"parseAttrs",value:function(e,t,n){for(var r in t.attrs){var o=t.attrs[r];if(o.parseDOM&&(!n||!Object.prototype.hasOwnProperty.call(n,r))){var i=o.parseDOM(e,this.options,o,t);null!=i&&(n||(n={}),n[r]=i)}}return n}},{key:"addDOM",value:function(e){if(3==e.nodeType){var t=e.nodeValue,n=this.top,r=void 0;(/\S/.test(t)||n.type.isTextblock)&&(t=t.replace(/\s+/g," "),/^\s/.test(t)&&(r=n.content[n.content.length-1])&&"text"==r.type.name&&/\s$/.test(r.text)&&(t=t.slice(1)),t&&this.insert(this.schema.text(t,this.styles)))}else if(1!=e.nodeType);else if(!this.parseNodeType(e)){this.addAll(e.firstChild,null);var o=e.nodeName.toLowerCase();h.hasOwnProperty(o)&&this.top.type==this.schema.defaultTextblockType()&&(this.closing=!0)}}},{key:"tryParsers",value:function(e,t){if(e)for(var n=0;n<e.length;n++){var r=e[n];if(r.parse(t,this,r.type,null,this.options)!==!1)return!0}}},{key:"parseNodeType",value:function(e){return this.tryParsers(this.nodeInfo[e.nodeName.toLowerCase()],e)||this.tryParsers(this.nodeInfo._,e)}},{key:"addAll",value:function(e,t,n){for(var r=n&&this.stack.slice(),o=e;o!=t;o=o.nextSibling)this.addDOM(o),n&&h.hasOwnProperty(o.nodeName.toLowerCase())&&this.sync(r)}},{key:"doClose",value:function(){if(this.closing&&!(this.stack.length<2)){var e=this.leave();this.enter(e.type,e.attrs),this.closing=!1}}},{key:"insert",value:function(e){if(this.top.type.canContain(e))this.doClose();else for(var t=this.stack.length-1;t>=0;t--){var n=this.stack[t].type.findConnection(e.type);if(n){if(t==this.stack.length-1)this.doClose();else for(;this.stack.length>t+1;)this.leave();for(var r=0;r<n.length;r++)this.enter(n[r]);this.styles.length&&(this.styles=[]);break}}return this.top.content.push(e),e}},{key:"insertFrom",value:function(e,t,n,r,o){return this.insert(t.createAutoFill(this.parseAttrs(e,t,n),r,o))}},{key:"enter",value:function(e,t){this.styles.length&&(this.styles=[]),this.stack.push({type:e,attrs:t,content:[]})}},{key:"enterFrom",value:function(e,t,n){this.enter(t,this.parseAttrs(e,t,n))}},{key:"leave",value:function(){var e=this.stack.pop(),t=e.type.createAutoFill(e.attrs,e.content);return this.stack.length&&this.insert(t),t}},{key:"sync",value:function(e){for(;this.stack.length>e.length;)this.leave();for(;;){var t=this.stack.length-1,n=this.stack[t],r=e[t];if(p.compareMarkup(n.type,r.type,n.attrs,r.attrs))break;this.leave()}for(;e.length>this.stack.length;){var o=e[this.stack.length];this.enter(o.type,o.attrs)}this.styles.length&&(this.styles=[]),this.closing=!1}},{key:"top",get:function(){return this.stack[this.stack.length-1]}}]),e}();p.Paragraph.register("parseDOM",{tag:"p",parse:l}),p.BlockQuote.register("parseDOM",{tag:"blockquote",parse:l});for(var m=function(e){p.Heading.register("parseDOM",{tag:"h"+e,parse:function(t,n,r){return l(t,n,r,{level:e})}})},g=1;6>=g;g++)m(g);p.HorizontalRule.register("parseDOM",{tag:"hr",parse:l}),p.CodeBlock.register("parseDOM",{tag:"pre",parse:function(e,t,n){var r=e.firstChild&&/^code$/i.test(e.firstChild.nodeName)&&e.firstChild.getAttribute("class");if(r&&/fence/.test(r)){for(var o=[],i=/(?:^|\s)lang-(\S+)/g,s=void 0;s=i.test(r);)o.push(s[1]);r=o.join(" ")}else r=null;var a=e.textContent;t.insertFrom(e,n,{params:r},a?[t.schema.text(a)]:[])}}),p.BulletList.register("parseDOM",{tag:"ul",parse:l}),p.OrderedList.register("parseDOM",{tag:"ol",parse:function(e,t,n){var r={order:e.getAttribute("start")||1};l(e,t,n,r)}}),p.ListItem.register("parseDOM",{tag:"li",parse:l}),p.HardBreak.register("parseDOM",{tag:"br",parse:function(e,t,n){e.hasAttribute("pm-force-br")||t.insertFrom(e,n,null,null,t.styles)}}),p.Image.register("parseDOM",{tag:"img",parse:function(e,t,n){t.insertFrom(e,n,{src:e.getAttribute("src"),title:e.getAttribute("title")||null,alt:e.getAttribute("alt")||null})}}),p.LinkStyle.register("parseDOM",{tag:"a",parse:function(e,t,n){var r=e.getAttribute("href");return r?void c(e,t,n.create({href:r,title:e.getAttribute("title")})):!1}}),p.EmStyle.register("parseDOM",{tag:"i",parse:c}),p.EmStyle.register("parseDOM",{tag:"em",parse:c}),p.StrongStyle.register("parseDOM",{tag:"b",parse:c}),p.StrongStyle.register("parseDOM",{tag:"strong",parse:c}),p.CodeStyle.register("parseDOM",{tag:"code",parse:c})}),require.register("prosemirror/parse/index",function(e,t,n){"use strict";function r(e,t,n,r){var o=s[n];if(!o)throw new Error("Source format "+n+" not defined");return o(e,t,r)}function o(e){return!!s[e]}function i(e,t){s[e]=t}Object.defineProperty(e,"__esModule",{value:!0}),e.convertFrom=r,e.knownSource=o,e.defineSource=i;var s=Object.create(null);i("json",function(e,t){return e.nodeFromJSON(t)})}),require.register("prosemirror/parse/markdown",function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){var n=h["default"]("commonmark").parse(t,{}),r=new g(e,n),o=void 0;r.parseTokens(n);do o=r.closeNode();while(r.stack.length);return o}function s(e){return e.cached.markdownTokens||(e.cached.markdownTokens=l(e))}function a(e,t,n){if("block"==n.type)e[n.token+"_open"]=function(e,r){var o="function"==typeof n.attrs?n.attrs(e,r):n.attrs;e.openNode(t,o)},e[n.token+"_close"]=function(e){return e.closeNode()};else if("inline"==n.type)e[n.token+"_open"]=function(e,r){var o=n.attrs instanceof Function?n.attrs(e,r):n.attrs;e.openInline(t.create(o))},e[n.token+"_close"]=function(e){return e.closeInline(t)};else{if(!n.parse)throw new Error("Unrecognized markdown parsing spec: "+n);e[n.token]=n.parse.bind(t)}}function l(e){function t(e){var t=e.parseMarkdown;t&&t.forEach(function(t){return a(n,e,t)})}var n=Object.create(null);n.text=function(e,t){return e.addText(t.content)},n.inline=function(e,t){return e.parseTokens(t.children)},n.softbreak=function(e){return e.addText("\n")};for(var r in e.nodes)t(e.nodes[r]);for(var o in e.styles)t(e.styles[o]);return n}function c(e){return"\n"==e.charAt(e.length-1)?e.slice(0,e.length-1):e}function u(e,t){e.openNode(this),e.addText(c(t.content)),e.closeNode()}Object.defineProperty(e,"__esModule",{value:!0});var p=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();e.fromMarkdown=i;var d=t("markdown-it"),h=r(d),f=t("../model"),m=t("./index");m.defineSource("markdown",i);var g=function(){function e(t,n){o(this,e),this.schema=t,this.stack=[{type:t.nodes.doc,content:[]}],this.tokens=n,this.styles=[],this.tokenTypes=s(t)}return p(e,[{key:"top",value:function(){return this.stack[this.stack.length-1]}},{key:"push",value:function(e){this.stack.length&&this.top().content.push(e)}},{key:"addText",value:function(e){var t=this.top().content,n=t[t.length-1],r=this.schema.text(e,this.styles),o=void 0;n&&(o=n.maybeMerge(r))?t[t.length-1]=o:t.push(r)}},{key:"openInline",value:function(e){this.styles=e.addToSet(this.styles)}},{key:"closeInline",value:function(e){this.styles=f.removeStyle(this.styles,e)}},{key:"parseTokens",value:function(e){for(var t=0;t<e.length;t++){var n=e[t];this.tokenTypes[n.type](this,n)}}},{key:"addInline",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1],n=arguments.length<=2||void 0===arguments[2]?null:arguments[2],r=e.create(n,t,this.styles);return this.push(r),r}},{key:"addNode",value:function(e,t,n){var r=e.createAutoFill(t,n);return this.push(r),r}},{key:"openNode",value:function(e,t){this.stack.push({type:e,attrs:t,content:[]})}},{key:"closeNode",value:function(){this.styles.length&&(this.styles=[]);var e=this.stack.pop();return this.addNode(e.type,e.attrs,e.content)}},{key:"getAttr",value:function(e,t){if(e.attrs)for(var n=0;n<e.attrs.length;n++)if(e.attrs[n][0]==t)return e.attrs[n][1]}}]),e}();f.BlockQuote.register("parseMarkdown",{type:"block",token:"blockquote"}),f.Paragraph.register("parseMarkdown",{type:"block",token:"paragraph"}),f.ListItem.register("parseMarkdown",{type:"block",token:"list_item"}),f.BulletList.register("parseMarkdown",{type:"block",token:"bullet_list"}),f.OrderedList.register("parseMarkdown",{type:"block",token:"ordered_list",attrs:function(e,t){return{order:Number(e.getAttr(t,"order")||1)}}}),f.Heading.register("parseMarkdown",{type:"block",token:"heading",attrs:function(e,t){return{level:t.tag.slice(1)}}}),f.CodeBlock.register("parseMarkdown",{token:"code_block",parse:u}),f.CodeBlock.register("parseMarkdown",{token:"fence",parse:u}),f.HorizontalRule.register("parseMarkdown",{token:"hr",parse:function(e,t){e.addNode(this,{markup:t.markup})}}),f.Image.register("parseMarkdown",{token:"image",parse:function(e,t){e.addInline(this,null,{src:e.getAttr(t,"src"),title:e.getAttr(t,"title")||null,alt:t.children[0]&&t.children[0].content||null})}}),f.HardBreak.register("parseMarkdown",{token:"hardbreak",parse:function(e){e.addInline(this)}}),f.EmStyle.register("parseMarkdown",{type:"inline",token:"em"}),f.StrongStyle.register("parseMarkdown",{type:"inline",token:"strong"}),f.LinkStyle.register("parseMarkdown",{type:"inline",token:"link",attrs:function(e,t){return{href:e.getAttr(t,"href"),title:e.getAttr(t,"title")||null}}}),f.CodeStyle.register("parseMarkdown",{token:"code_inline",parse:function(e,t){e.openInline(this.create()),e.addText(t.content),e.closeInline(this)}})}),require.register("prosemirror/parse/text",function(e,t,n){"use strict";function r(e,t){for(var n=t.trim().split(/\n{2,}/),r=[],o=0;o<n.length;o++){for(var i=[],s=n[o].split("\n"),a=0;a<s.length;a++)a&&i.push(e.node("hard_break")),s[a]&&i.push(e.text(s[a]));r.push(e.node("paragraph",null,i))}return r.length||r.push(e.node("paragraph")),e.node("doc",null,r)}Object.defineProperty(e,"__esModule",{value:!0}),e.fromText=r;var o=t("./index");o.defineSource("text",r)}),require.register("prosemirror/serialize/dom",function(e,t,n){"use strict";function r(e,t){var n=b.createElement(e);if(t)for(var r in t)"style"==r?n.style.cssText=t[r]:t[r]&&n.setAttribute(r,t[r]);for(var o=arguments.length,i=Array(o>2?o-2:0),s=2;o>s;s++)i[s-2]=arguments[s];for(var a=0;a<i.length;a++)n.appendChild("string"==typeof i[a]?b.createTextNode(i[a]):i[a]);return n}function o(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return b=t.document||window.document,c(e.children,t)}function i(e,t){var n=(t&&t.document||window.document).createElement("div");return n.appendChild(o(e,t)),n.innerHTML}function s(e,t,n){var r=u(e,t,n);return t.renderInlineFlat&&e.isInline&&(r=f(e,r,t),r=t.renderInlineFlat(e,r,n)||r),r}function a(e,t,n){var o=r(n||e.type.name);return e.isTextblock?t.renderInlineFlat?m(e,o,t):d(e.children,o,t):p(e.children,o,t),o}function l(e){return function(t,n){return a(t,n,e)}}function c(e,t){var n=b.createDocumentFragment();return p(e,n,t),n}function u(e,t,n){var r=e.type.serializeDOM(e,t);for(var o in e.type.attrs){var i=e.type.attrs[o];i.serializeDOM&&i.serializeDOM(r,e.attrs[o],t,e)}return t.onRender&&e.isBlock&&(r=t.onRender(e,r,n)||r),r}function p(e,t,n){for(var r=0;r<e.length;r++)n.path&&n.path.push(r),t.appendChild(u(e[r],n,r)),n.path&&n.path.pop()}function d(e,t,n){for(var r=t,o=[],i=0;i<e.length;i++){for(var s=e[i],a=s.styles,l=0;l<Math.min(o.length,a.length)&&a[l].eq(o[l]);++l);for(;l<o.length;)o.pop(),r=r.parentNode;for(;o.length<a.length;){var c=a[o.length];o.push(c),r=r.appendChild(h(c,n))}r.appendChild(u(s,n,i))}}function h(e,t){var n=e.type.serializeDOM(e,t);for(var r in e.type.attrs){var o=e.type.attrs[r];o.serializeDOM&&o.serializeDOM(n,e.attrs[r],t)}return n}function f(e,t,n){for(var r=e.styles,o=r.length-1;o>=0;o--){var i=h(r[o],n);i.appendChild(t),t=i}return t}function m(e,t,n){for(var o=0,i=0;i<e.length;i++){var s=e.child(i),a=f(s,u(s,n,i),n);a=n.renderInlineFlat(s,a,o)||a,t.appendChild(a),o+=s.offset}e.type.isCode||e.length&&"BR"!=t.lastChild.nodeName?"false"==t.lastChild.contentEditable&&t.appendChild(b.createTextNode("")):t.appendChild(r("br")).setAttribute("pm-force-br","true")}function g(e,t){e.prototype.serializeDOM=t}Object.defineProperty(e,"__esModule",{value:!0}),e.toDOM=o,e.toHTML=i,e.renderNodeToDOM=s;var v=t("../model"),y=t("./index"),b=null;y.defineTarget("dom",o),y.defineTarget("html",i),g(v.BlockQuote,l("blockquote")),v.BlockQuote.prototype.clicked=function(e,t,n,r){var o=n.firstChild.getBoundingClientRect();return r.left<o.left-2?v.Pos.from(t):void 0},g(v.BulletList,l("ul")),g(v.OrderedList,function(e,t){var n=a(e,t,"ol");return e.attrs.order>1&&n.setAttribute("start",e.attrs.order),n}),v.OrderedList.prototype.clicked=v.BulletList.prototype.clicked=function(e,t,n,r){for(var o=0;o<n.childNodes.length;o++){var i=n.childNodes[o];if(i.hasAttribute("pm-path")){var s=i.getBoundingClientRect();if(r.left>s.left-2)return null;if(s.top<=r.top&&s.bottom>=r.top)return new v.Pos(t,o)}}},g(v.ListItem,l("li")),g(v.HorizontalRule,function(){return r("hr")}),g(v.Paragraph,l("p")),g(v.Heading,function(e,t){return a(e,t,"h"+e.attrs.level)}),g(v.CodeBlock,function(e,t){var n=a(e,t,"code");return null!=e.attrs.params&&(n.className="fence "+e.attrs.params.replace(/(^|\s+)/g,"$&lang-")),r("pre",null,n)}),g(v.Text,function(e){return b.createTextNode(e.text)}),g(v.Image,function(e){return r("img",{src:e.attrs.src,alt:e.attrs.alt,title:e.attrs.title,contentEditable:!1})}),g(v.HardBreak,function(){return r("br")}),g(v.EmStyle,function(){return r("em")}),g(v.StrongStyle,function(){return r("strong")}),g(v.CodeStyle,function(){return r("code")}),g(v.LinkStyle,function(e){return r("a",{href:e.attrs.href,title:e.attrs.title})})}),require.register("prosemirror/serialize/index",function(e,t,n){"use strict";function r(e,t,n){var r=s[t];if(!r)throw new Error("Target format "+t+" not defined");return r(e,n)}function o(e){return!!s[e]}function i(e,t){s[e]=t}Object.defineProperty(e,"__esModule",{value:!0}),e.convertTo=r,e.knownTarget=o,e.defineTarget=i;var s=Object.create(null);i("json",function(e){return e.toJSON()})}),require.register("prosemirror/serialize/markdown",function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){var t=new f;return t.renderNodes(e.children),t.out}function i(e,t){return e=e.replace(/[`*\\~+\[\]]/g,"\\$&"),t&&(e=e.replace(/^[:#-]/,"\\$&")),e}function s(e){var t=-1==e.indexOf('"')?'""':-1==e.indexOf("'")?"''":"()";return t[0]+e+t[1]}function a(e,t){for(var n="",r=0;t>r;r++)n+=e;return n}function l(e,t){e.prototype.serializeMarkdown=t}function c(e,t){var n=t?e.type.openMarkdownStyle:e.type.closeMarkdownStyle;return"string"==typeof n?n:n(e)}function u(e,t,n){e.prototype.openMarkdownStyle=t,e.prototype.closeMarkdownStyle=n}Object.defineProperty(e,"__esModule",{value:!0});var p=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();e.toMarkdown=o;var d=t("../model"),h=t("./index");h.defineTarget("markdown",o);var f=function(){function e(){r(this,e),this.delim=this.out="",this.closed=!1,this.inTightList=!1}return p(e,[{key:"closeBlock",value:function(e){this.closed=e}},{key:"flushClose",value:function(e){if(this.closed){if(this.atBlank()||(this.out+="\n"),null==e&&(e=2),e>1){var t=this.delim,n=/\s+$/.exec(t);n&&(t=t.slice(0,t.length-n[0].length));for(var r=1;e>r;r++)this.out+=t+"\n"}this.closed=!1}}},{key:"wrapBlock",value:function(e,t,n,r){var o=this.delim;this.write(t||e),this.delim+=e,r(),this.delim=o,this.closeBlock(n)}},{key:"atBlank",value:function(){return/(^|\n)$/.test(this.out)}},{key:"write",value:function(e){this.flushClose(),this.delim&&this.atBlank()&&(this.out+=this.delim),e&&(this.out+=e)}},{key:"text",value:function(e,t){for(var n=e.split("\n"),r=0;r<n.length;r++){var o=this.atBlank()||this.closed;this.write(),this.out+=t!==!1?i(n[r],o):n[r],r!=n.length-1&&(this.out+="\n")}}},{key:"ensureNewLine",value:function(){this.atBlank()||(this.out+="\n")}},{key:"render",value:function(e){e.type.serializeMarkdown(this,e)}},{key:"renderNodes",value:function(e){for(var t=0;t<e.length;t++)this.render(e[t])}},{key:"renderInline",value:function(e){for(var t=[],n=0;n<=e.length;n++){var r=e[n],o=r?r.styles.slice():[];!t.length||"code"!=t[t.length-1].type||o.length&&"code"==o[o.length-1].type||(this.text("`",!1),t.pop());for(var i=0;i<t.length;i++){for(var s=t[i],a=!1,l=0;l<o.length;l++)if(o[l].eq(t[i])){o.splice(l,1),a=!0;break}a||(this.text(c(s,!1),!1),t.splice(i--,1))}for(var i=0;i<o.length;i++){var s=o[i];t.push(s),this.text(c(s,!0),!1)}r&&this.render(r)}}},{key:"renderList",value:function(e,t,n){var r=this;this.closed&&this.closed.type==e.type?this.flushClose(3):this.inTightList&&this.flushClose(1);var o=this.inTightList;this.inTightList=e.attrs.tight;for(var i=function(o){o&&e.attrs.tight&&r.flushClose(1);var i=e.child(o);r.wrapBlock(t,n(o),e,function(){return r.render(i)})},s=0;s<e.length;s++)i(s);this.inTightList=o}}]),e}();l(d.BlockQuote,function(e,t){e.wrapBlock("> ",null,t,function(){return e.renderNodes(t.children)})}),l(d.CodeBlock,function(e,t){null==t.attrs.params?e.wrapBlock("    ",null,t,function(){return e.text(t.textContent,!1)}):(e.write("```"+t.attrs.params+"\n"),e.text(t.textContent,!1),e.ensureNewLine(),e.write("```"),e.closeBlock(t))}),l(d.Heading,function(e,t){e.write(a("#",t.attrs.level)+" "),e.renderInline(t.children),e.closeBlock(t)}),l(d.HorizontalRule,function(e,t){e.write(t.attrs.markup||"---"),e.closeBlock(t)}),l(d.BulletList,function(e,t){e.renderList(t,"  ",function(){return(t.attrs.bullet||"*")+" "})}),l(d.OrderedList,function(e,t){var n=Number(t.attrs.order||1),r=String(n+t.length-1).length,o=a(" ",r+2);e.renderList(t,o,function(e){var t=String(n+e);return a(" ",r-t.length)+t+". "})}),l(d.ListItem,function(e,t){return e.renderNodes(t.children)}),l(d.Paragraph,function(e,t){e.renderInline(t.children),e.closeBlock(t)}),l(d.Image,function(e,t){e.write("!["+i(t.attrs.alt||"")+"]("+i(t.attrs.src)+(t.attrs.title?" "+s(t.attrs.title):"")+")")}),l(d.HardBreak,function(e){return e.write("\\\n")}),l(d.Text,function(e,t){return e.text(t.text)}),u(d.EmStyle,"*","*"),u(d.StrongStyle,"**","**"),u(d.LinkStyle,"[",function(e){return"]("+i(e.attrs.href)+(e.attrs.title?" "+s(e.attrs.title):"")+")"}),u(d.CodeStyle,"`","`")}),require.register("prosemirror/serialize/text",function(e,t,n){"use strict";function r(e){return e.type.serializeText(e).trim()}Object.defineProperty(e,"__esModule",{value:!0}),e.toText=r;var o=t("../model"),i=t("./index");o.Block.prototype.serializeText=function(e){for(var t="",n=0;n<e.length;n++){var r=e.child(n);t+=r.type.serializeText(r)}return t},o.Textblock.prototype.serializeText=function(e){var t=o.Block.prototype.serializeText(e);return t&&t+"\n\n"},o.Inline.prototype.serializeText=function(){return""},o.HardBreak.prototype.serializeText=function(){return"\n"},o.Text.prototype.serializeText=function(e){return e.text},i.defineTarget("text",r)}),require.register("prosemirror/transform/ancestor",function(e,t,n){"use strict";function r(e,t){for(var n=[e.path(t.from.path)],r=!1;;){for(var o=-1,i=function(e,r){n.every(function(t){return e.type.canContainChildren(t)})&&(o=r),e=e.child(t.from.path[r]),s=e},s=e,a=0;a<t.from.path.length;a++)i(s,a);if(o>-1)return{path:t.from.path.slice(0,o),unwrap:r};if(r||!n[0].isBlock)return null;n=n[0].slice(t.from.offset,t.to.offset),r=!0}}function o(e,t,n){var o=a.siblingRange(e,t,n||t),i=r(e,o);return i?{found:i,range:o}:void 0}function i(e,t,n,r){var o=a.siblingRange(e,t,n||t);if(o.from.offset==o.to.offset)return null;var i=e.path(o.from.path),s=i.type.findConnection(r),l=r.findConnection(i.child(o.from.offset).type);return s&&l?{range:o,around:s,inside:l}:void 0}function s(e,t,n,r,o){var i=!1;return o||(o={}),e.nodesBetween(t,n||t,function(e){return e.isTextblock?(a.compareMarkup(e.type,r,e.attrs,o)||(i=!0),!1):void 0}),i}Object.defineProperty(e,"__esModule",{value:!0}),e.canLift=o,e.canWrap=i,e.alreadyHasBlockType=s;var a=t("../model"),l=t("./transform"),c=t("./step"),u=t("./tree"),p=t("./map");c.defineStep("ancestor",{apply:function(e,t){var n=t.from,r=t.to;if(!u.isFlatRange(n,r))return null;for(var o=n.path,i=n.offset,s=r.offset,c=t.param,d=c.depth,h=void 0===d?0:d,f=c.types,m=void 0===f?[]:f,g=c.attrs,v=void 0===g?[]:g,y=e.path(n.path),b=0;h>b;b++){if(i>0||s<e.path(o).maxOffset||0==o.length)return null;i=o[o.length-1],s=i+1,o=o.slice(0,o.length-1)}if(0==h&&0==m.length)return null;var S=e.path(o),k=S.length,w=void 0;if(S.type.locked)return null;if(m.length){var E=function(){var e=m[m.length-1],t=y.slice(n.offset,r.offset);if(!S.type.canContainType(m[0])||!t.every(function(t){return e.canContain(t)})||!y.length&&!e.canBeEmpty||e.locked)return{v:null};for(var o=null,a=m.length-1;a>=0;a--)o=m[a].create(v[a],o?[o]:t);w=S.splice(i,s,[o])}();if("object"==typeof E)return E.v}else{if(!S.type.canContainChildren(y,!0)||!y.length&&0==i&&s==S.length&&!S.type.canBeEmpty)return null;w=S.splice(i,s,y.children)}for(var _=e.replaceDeep(o,w),x=o.slice(),b=0;b<m.length;b++)x.push(b?0:i);var C=new a.Pos(x,m.length?0:i),T=null,M=m.length?1:r.offset-n.offset;if(h!=m.length||h>1||m.length>1){var A=new a.Pos(o,i),D=new a.Pos(o,s),R=new a.Pos(o,i+M),N=new a.Pos(x,C.offset+(r.offset-n.offset));T=[new p.ReplacedRange(A,n,A,C),new p.ReplacedRange(r,D,N,R,D,R)]}var O=[new p.MovedRange(n,r.offset-n.offset,C)];return s-i!=M&&O.push(new p.MovedRange(new a.Pos(o,s),k-s,new a.Pos(o,i+M))),new l.TransformResult(_,new p.PosMap(O,T))},invert:function(e,t,n){var r=[],o=[];if(e.param.depth)for(var i=0;i<e.param.depth;i++){var s=t.path(e.from.path.slice(0,e.from.path.length-i));r.unshift(s.type),o.unshift(s.attrs)}var a=n.map(e.from).pos,l=e.from.cmp(e.to)?n.map(e.to,-1).pos:a;return new c.Step("ancestor",a,l,null,{depth:e.param.types?e.param.types.length:0,types:r,attrs:o})},paramToJSON:function(e){return{depth:e.depth,types:e.types&&e.types.map(function(e){return e.name}),attrs:e.attrs}},paramFromJSON:function(e,t){return{depth:t.depth,wrappers:t.types&&t.types.map(function(t){return e.nodeType(t)}),attrs:t.attrs}}}),l.Transform.prototype.lift=function(e){var t=arguments.length<=1||void 0===arguments[1]?e:arguments[1];return function(){var n=o(this.doc,e,t);if(!n)return this;for(var r=n.found,i=n.range,s=i.from.path.length-r.path.length,l=r.unwrap&&this.doc.path(i.from.path),c=0,u=i.to;;c++){if(u.offset<this.doc.path(u.path).length){this.split(u,s);break}if(c==s-1)break;u=u.shorten(null,1)}for(var c=0,u=i.from;;c++){if(u.offset>0){this.split(u,s-c);for(var p=i.from.path.length-s,d=u.path.slice(0,p).concat(u.path[p]+1);d.length<i.from.path.length;)d.push(0);
i={from:new a.Pos(d,0),to:new a.Pos(d,i.to.offset-i.from.offset)};break}if(c==s-1)break;u=u.shorten()}if(r.unwrap){for(var h=i.to.offset-1;h>i.from.offset;h--)this.join(new a.Pos(i.from.path,h));for(var f=0,h=i.from.offset;h<i.to.offset;h++)f+=l.child(h).length;var d=i.from.path.concat(i.from.offset);i={from:new a.Pos(d,0),to:new a.Pos(d,f)},++s}return this.step("ancestor",i.from,i.to,null,{depth:s}),this}.apply(this,arguments)},l.Transform.prototype.wrap=function(e,t,n,r){var o=i(this.doc,e,t,n);if(!o)return this;var s=o.range,l=o.around,c=o.inside,u=l.concat(n).concat(c),p=l.map(function(){return null}).concat(r).concat(c.map(function(){return null}));if(this.step("ancestor",s.from,s.to,null,{types:u,attrs:p}),c.length){for(var d=s.from.path.slice(),h=0;h<l.length+c.length+1;h++)d.push(h?0:s.from.offset);for(var h=s.to.offset-1-s.from.offset;h>0;h--)this.split(new a.Pos(d,h),c.length)}return this},l.Transform.prototype.setBlockType=function(e,t,n,r){var o=this;return this.doc.nodesBetween(e,t||e,function(e,t){return e.isTextblock&&!a.compareMarkup(n,e.type,r,e.attrs)?(t=t.slice(),o.clearMarkup(new a.Pos(t,0),new a.Pos(t,e.maxOffset),n),o.step("ancestor",new a.Pos(t,0),new a.Pos(t,o.doc.path(t).maxOffset),null,{depth:1,types:[n],attrs:[r]}),!1):void 0}),this},l.Transform.prototype.setNodeType=function(e,t,n){var r=this.doc.path(e.path).child(e.offset),o=e.toPath();return this.step("ancestor",new a.Pos(o,0),new a.Pos(o,r.maxOffset),null,{depth:1,types:[t],attrs:[n]}),this}}),require.register("prosemirror/transform/index",function(e,t,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),t("./style"),t("./split"),t("./replace");var r=t("./transform");Object.defineProperty(e,"TransformResult",{enumerable:!0,get:function(){return r.TransformResult}}),Object.defineProperty(e,"Transform",{enumerable:!0,get:function(){return r.Transform}});var o=t("./step");Object.defineProperty(e,"Step",{enumerable:!0,get:function(){return o.Step}});var i=t("./ancestor");Object.defineProperty(e,"canLift",{enumerable:!0,get:function(){return i.canLift}}),Object.defineProperty(e,"canWrap",{enumerable:!0,get:function(){return i.canWrap}}),Object.defineProperty(e,"alreadyHasBlockType",{enumerable:!0,get:function(){return i.alreadyHasBlockType}});var s=t("./join");Object.defineProperty(e,"joinPoint",{enumerable:!0,get:function(){return s.joinPoint}}),Object.defineProperty(e,"joinableBlocks",{enumerable:!0,get:function(){return s.joinableBlocks}});var a=t("./map");Object.defineProperty(e,"PosMap",{enumerable:!0,get:function(){return a.PosMap}}),Object.defineProperty(e,"MapResult",{enumerable:!0,get:function(){return a.MapResult}}),Object.defineProperty(e,"mapStep",{enumerable:!0,get:function(){return a.mapStep}}),Object.defineProperty(e,"Remapping",{enumerable:!0,get:function(){return a.Remapping}})}),require.register("prosemirror/transform/join",function(e,t,n){"use strict";function r(e,t){if(0==t.offset)return!1;var n=e.path(t.path);if(n.isTextblock||t.offset==n.length)return!1;var r=n.child(t.offset-1).type;return!r.isTextblock&&r.contains&&r==n.child(t.offset).type}function o(e,t){for(var n=arguments.length<=2||void 0===arguments[2]?-1:arguments[2];;){if(r(e,t))return t;if(0==t.depth)return null;t=t.shorten(null,0>n?0:1)}}Object.defineProperty(e,"__esModule",{value:!0}),e.joinableBlocks=r,e.joinPoint=o;var i=t("../model"),s=t("./transform"),a=t("./step"),l=t("./map");a.defineStep("join",{apply:function(e,t){var n=e.path(t.from.path),r=e.path(t.to.path);if(t.from.offset<n.maxOffset||t.to.offset>0||!n.type.canContainChildren(r,!0))return null;var o=t.from.path,a=t.to.path,c=o.length-1,u=o[c]+1;if(o.length!=a.length||0==o.length||u!=a[c])return null;for(var p=0;c>p;p++)if(o[p]!=a[p])return null;var d=o.slice(0,c),h=e.path(d),f=h.length;if(h.type.locked)return null;var m=n.append(r.children),g=e.replaceDeep(d,h.splice(u-1,u+1,[m])),v=new l.PosMap([new l.MovedRange(t.to,r.maxOffset,t.from),new l.MovedRange(new i.Pos(d,u+1),f-u-1,new i.Pos(d,u))],[new l.ReplacedRange(t.from,t.to,t.from,t.from,t.to.shorten())]);return new s.TransformResult(g,v)},invert:function(e,t){return new a.Step("split",null,null,e.from,t.path(e.to.path).copy())}}),s.Transform.prototype.join=function(e){var t=this.doc.path(e.path);return 0==e.offset||e.offset==t.length||t.isTextblock?this:(this.step("join",new i.Pos(e.path.concat(e.offset-1),t.child(e.offset-1).maxOffset),new i.Pos(e.path.concat(e.offset),0)),this)}}),require.register("prosemirror/transform/map",function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(t.path.length>e.path.length){for(var n=[t.path[e.path.length]-e.offset],r=e.path.length+1;r<t.path.length;r++)n.push(t.path[r]);return new c.Pos(n,t.offset)}return new c.Pos([],t.offset-e.offset)}function i(e,t,n,r){void 0===n&&(n=1);for(var i=0;i<e.replaced.length;i++){var s=e.replaced[i],a=r?s.after:s.before,l=void 0,u=void 0;if((l=t.cmp(a.from))>=0&&(u=t.cmp(a.to))<=0){var p=r?s.before:s.after;return new m(0>n?p.from:p.to,!(!l||!u),{rangeID:i,offset:o(a.ref,t)})}}for(var i=0;i<e.moved.length;i++){var s=e.moved[i],d=r?s.dest:s.start;if(t.cmp(d)>=0&&c.Pos.cmp(t.path,t.offset,d.path,d.offset+s.size)<=0){var h=r?s.start:s.dest,f=d.depth;if(t.depth>f){var g=h.offset+(t.path[f]-d.offset);return new m(new c.Pos(h.path.concat(g).concat(t.path.slice(f+1)),t.offset))}return new m(new c.Pos(h.path,h.offset+(t.offset-d.offset)))}}return new m(t)}function s(e,t){return e.cmp(t)>0?e:t}function a(e,t){var n=!0,r=null,o=null,i=null;if(e.from){var a=t.map(e.from,1);r=a.pos,a.deleted||(n=!1)}if(e.to)if(0==e.to.cmp(e.from))o=r;else{var a=t.map(e.to,-1);o=s(a.pos,r),a.deleted||(n=!1)}if(e.pos)if(r&&0==e.pos.cmp(e.from))i=r;else if(o&&0==e.pos.cmp(e.to))i=o;else{var a=t.map(e.pos,1);i=a.pos,a.deleted||(n=!1)}return n?void 0:new u.Step(e.name,r,o,i,e.param)}Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();e.mapStep=a;var c=t("../model"),u=t("./step"),p=function(){function e(t,n){var o=arguments.length<=2||void 0===arguments[2]?null:arguments[2];r(this,e),this.start=t,this.size=n,this.dest=o}return l(e,[{key:"toString",value:function(){return"[moved "+this.start+"+"+this.size+" to "+this.dest+"]"}},{key:"end",get:function(){return new c.Pos(this.start.path,this.start.offset+this.size)}}]),e}();e.MovedRange=p;var d=function S(e,t,n){r(this,S),this.from=e,this.to=t,this.ref=n},h=function(){function e(t,n,o,i){var s=arguments.length<=4||void 0===arguments[4]?t:arguments[4],a=arguments.length<=5||void 0===arguments[5]?o:arguments[5];return function(){r(this,e),this.before=new d(t,n,s),this.after=new d(o,i,a)}.apply(this,arguments)}return l(e,[{key:"toString",value:function(){return"[replaced "+this.before.from+"-"+this.before.to+" with "+this.after.from+"-"+this.after.to+"]"}}]),e}();e.ReplacedRange=h;var f=[],m=function k(e){var t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],n=arguments.length<=2||void 0===arguments[2]?null:arguments[2];r(this,k),this.pos=e,this.deleted=t,this.recover=n};e.MapResult=m;var g=function(){function e(t,n){r(this,e),this.moved=t||f,this.replaced=n||f}return l(e,[{key:"recover",value:function(e){return this.replaced[e.rangeID].after.ref.extend(e.offset)}},{key:"map",value:function(e,t){return i(this,e,t,!1)}},{key:"invert",value:function(){return new v(this)}},{key:"toString",value:function(){return this.moved.concat(this.replaced).join(" ")}}]),e}();e.PosMap=g;var v=function(){function e(t){r(this,e),this.inner=t}return l(e,[{key:"recover",value:function(e){return this.inner.replaced[e.rangeID].before.ref.extend(e.offset)}},{key:"map",value:function(e,t){return i(this.inner,e,t,!0)}},{key:"invert",value:function(){return this.inner}},{key:"toString",value:function(){return"-"+this.inner}}]),e}(),y=new g;e.nullMap=y;var b=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],n=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],o=arguments.length<=2||void 0===arguments[2]?Object.create(null):arguments[2];r(this,e),this.head=t,this.tail=n,this.mirror=o}return l(e,[{key:"addToFront",value:function(e,t){this.head.push(e);var n=-this.head.length;return null!=t&&(this.mirror[n]=t),n}},{key:"addToBack",value:function(e,t){this.tail.push(e);var n=this.tail.length-1;return null!=t&&(this.mirror[t]=n),n}},{key:"get",value:function(e){return 0>e?this.head[-e-1]:this.tail[e]}},{key:"map",value:function t(e,n){for(var r=!1,o=-this.head.length;o<this.tail.length;o++){var t=this.get(o),i=t.map(e,n);if(i.recover){var s=this.mirror[o];if(null!=s){o=s,e=this.get(s).recover(i.recover);continue}}i.deleted&&(r=!0),e=i.pos}return new m(e,r)}}]),e}();e.Remapping=b}),require.register("prosemirror/transform/replace",function(e,t,n){"use strict";function r(e,t,n,r){for(var o=[],i=t.path.slice(0,r),s=r;;s++){var a=s==t.depth?0:1,c=s==t.depth?t.offset:t.path[s],u=e.maxOffset-c,d=n.maxOffset-u,h=t.shorten(s,a),f=new l.Pos(i,d+a);if(h.cmp(f)&&o.push(new p.MovedRange(h,u-a,f)),!a)return o;e=e.child(c),n=n.child(d),i=i.concat(d)}}function o(e,t,n,i,s){var a=arguments.length<=5||void 0===arguments[5]?0:arguments[5];if(a!=i.length){var c=i[a],u=o(e.child(c),t,n,i,s,a+1);return u?{doc:e.replace(c,u.doc),moved:u.moved}:null}var p=function(){var o=l.sliceBefore(e,t,a),i=l.sliceAfter(e,n,a),c=void 0;return s.nodes.every(function(e){return o.type.canContain(e)})?(c=s.nodes.length?o.append(s.nodes,t.depth-a,s.openLeft).append(i.children,s.openRight,n.depth-a):o.append(i.children,t.depth-a,n.depth-a),c.length||c.type.canBeEmpty||(c=c.copy(c.type.defaultContent())),{v:{doc:c,moved:r(e,n,c,a)}}):{v:null}}();return"object"==typeof p?p.v:void 0}function i(e,t){for(var n=e[t]=e[t].splice(0,1,[]),r=t-1;r>=0;r--)n=e[r]=e[r].replace(0,n)}function s(e,t,n,r){for(var o=l.sliceBetween(t,n,r,!1),s=[],a=o,c=0;c<=n.path.length;c++,a=a.firstChild)s.push(a);var u=d.samePathDepth(n,r),p=e.length-1,h=s.length-1,f=null,m=s[h];for(m.isTextblock&&m.length&&e[p].isTextblock&&(f=e[p--].copy(m.children),--h,i(s,h));;){for(var a=s[h],g=a.type,v=null,y=u>=h,c=p;c>=0;c--){var b=e[c];if(y?b.type.canContainChildren(a):b.type==g){v=c;break}}if(null!=v)if(f)for(;p>=v;)f=e[p].copy(p==v?[f].concat(a.children):[f]),p--;else f=e[v].copy(a.children),p=v-1;if(null!=v||0==a.length){if(y)break;h&&i(s,h-1)}h--}var S={nodes:f?f.children:[],openLeft:n.depth-h,openRight:r.depth-h};return{repl:S,depth:p+1}}function a(e,t,n,r){for(var o=d.samePathDepth(n,r),i=r.shorten(null,1);i.path.length>o&&1==t.path(i.path).length;)i=i.shorten(null,1);e.split(i,i.path.length-o);for(var s=r,a=new l.Pos(s.path,t.path(s.path).maxOffset),c=t.path(s.path.slice(0,o)),u=c.pathNodes(n.path.slice(o)),p=c.pathNodes(s.path.slice(o));u.length&&p.length&&u[0].sameMarkup(p[0]);)u.shift(),p.shift();(p.length||u.length)&&e.step("ancestor",s,a,null,{depth:p.length,types:u.map(function(e){return e.type}),attrs:u.map(function(e){return e.attrs})});for(var h=o;h<n.path.length;h++)e.join(n.shorten(h,1))}Object.defineProperty(e,"__esModule",{value:!0}),e.replace=o;var l=t("../model"),c=t("./transform"),u=t("./step"),p=t("./map"),d=t("./tree"),h={nodes:[],openLeft:0,openRight:0};u.defineStep("replace",{apply:function(e,t){var n=t.pos,r=n.path;if(t.from.depth<r.length||t.to.depth<r.length)return null;for(var i=0;i<r.length;i++)if(t.from.path[i]!=r[i]||t.to.path[i]!=r[i])return null;var s=o(e,t.from,t.to,n.path,t.param||h);if(!s)return null;var a=s.doc,l=s.moved,u=l.length?l[l.length-1].dest:t.to,d=new p.ReplacedRange(t.from,t.to,t.from,u,n,n);return new c.TransformResult(a,new p.PosMap(l,[d]))},invert:function(e,t,n){var r=e.pos.depth;return new u.Step("replace",e.from,n.map(e.to).pos,e.from.shorten(r),{nodes:l.childrenBetween(t.path(e.pos.path),e.from,e.to,r),openLeft:e.from.depth-r,openRight:e.to.depth-r})},paramToJSON:function(e){return e&&{nodes:e.nodes&&e.nodes.map(function(e){return e.toJSON()}),openLeft:e.openLeft,openRight:e.openRight}},paramFromJSON:function(e,t){return t&&{nodes:t.nodes&&t.nodes.map(e.nodeFromJSON),openLeft:t.openLeft,openRight:t.openRight}}}),c.Transform.prototype["delete"]=function(e,t){return e.cmp(t)&&this.replace(e,t),this},c.Transform.prototype.replace=function(e,t,n,r,o){var i=void 0,c=void 0,u=this.doc,p=d.samePathDepth(e,t);if(n){var f=s(u.pathNodes(e.path),n,r,o);for(i=f.repl,c=f.depth;c>p;)i.nodes.length&&(i={nodes:[u.path(e.path.slice(0,c)).copy(i.nodes)],openLeft:i.openLeft+1,openRight:i.openRight+1}),c--}else i=h,c=p;var m=e.shorten(c),g=u,v=t;if(i.nodes.length||d.replaceHasEffect(u,e,t)){var y=this.step("replace",e,t,m,i);g=y.doc,v=y.map.map(t).pos}if(!u.path(t.path).isTextblock)return this;if(!(i.nodes.length?n.path(o.path).isTextblock:u.path(e.path).isTextblock))return this;var b=u.path(m.path).pathNodes(t.path.slice(c)).slice(1),S=void 0;if(i.nodes.length){var k=i.nodes;S=[];for(var w=0;w<i.openRight;w++){var E=k[k.length-1];S.push(E),k=E.children}}else S=u.path(m.path).pathNodes(e.path.slice(c)).slice(1);if(S.length&&(b.length!=S.length||!b.every(function(e,t){return e.sameMarkup(S[t])}))){for(var _=v.shorten(m.depth),x=_.path,C=_.offset,T=void 0,M=g.path(x),w=0;;w++){if(w==S.length){T=new l.Pos(x,C);break}x.push(C-1),M=M.child(C-1),C=M.maxOffset}a(this,g,T,v)}return this},c.Transform.prototype.replaceWith=function(e,t,n){return Array.isArray(n)||(n=[n]),l.Pos.samePath(e.path,t.path)?(this.step("replace",e,t,e,{nodes:n,openLeft:0,openRight:0}),this):this},c.Transform.prototype.insert=function(e,t){return this.replaceWith(e,e,t)},c.Transform.prototype.insertInline=function(e,t){Array.isArray(t)||(t=[t]);var n=l.spanStylesAt(this.doc,e);return t=t.map(function(e){return e.styled(n)}),this.insert(e,t)},c.Transform.prototype.insertText=function(e,t){return this.insertInline(e,this.doc.type.schema.text(t))}}),require.register("prosemirror/transform/split",function(e,t,n){"use strict";var r=t("../model"),o=t("./transform"),i=t("./step"),s=t("./map");i.defineStep("split",{apply:function(e,t){var n=t.pos;if(0==n.depth)return null;var i=n.shorten(),a=i.path,l=i.offset,c=e.path(a),u=c.child(l),p=u.maxOffset,d=t.param||u,h=d.type,f=d.attrs,m=n.offset;if(0==m&&!u.type.canBeEmpty||u.type.locked||m==u.maxOffset&&!h.canBeEmpty)return null;var g=c.splice(l,l+1,[u.copy(u.slice(0,m)),h.create(f,u.slice(m))]),v=e.replaceDeep(a,g),y=new r.Pos(a.concat(l+1),0),b=new s.PosMap([new s.MovedRange(n,p-n.offset,y),new s.MovedRange(new r.Pos(a,l+1),g.length-2-l,new r.Pos(a,l+2))],[new s.ReplacedRange(n,n,n,y,n,n.shorten(null,1))]);return new o.TransformResult(v,b)},invert:function(e,t,n){return new i.Step("join",e.pos,n.map(e.pos).pos)},paramToJSON:function(e){return e&&{type:e.type.name,attrs:e.attrs}},paramFromJSON:function(e,t){return t&&{type:e.nodeType(t.type),attrs:t.attrs}}}),o.Transform.prototype.split=function(e,t,n,r){if(void 0===t&&(t=1),0==t)return this;for(var o=0;;o++){if(this.step("split",null,null,e,n&&{type:n,attrs:r}),o==t-1)return this;n=null,e=e.shorten(null,1)}},o.Transform.prototype.splitIfNeeded=function(e){for(var t=arguments.length<=1||void 0===arguments[1]?1:arguments[1],n=0;t>n;n++){var r=e.shorten(e.depth-n);r.offset&&r.offset<this.doc.path(r.path).maxOffset&&this.step("split",null,null,r)}return this}}),require.register("prosemirror/transform/step",function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){l[e]=t}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();e.defineStep=o;var s=t("../model"),a=function(){function e(t,n,o,i){var s=arguments.length<=4||void 0===arguments[4]?null:arguments[4];if(r(this,e),!(t in l))throw new Error("Unknown step type: "+t);this.name=t,this.from=n,this.to=o,this.pos=i,this.param=s}return i(e,[{key:"apply",value:function(e){return l[this.name].apply(e,this)}},{key:"invert",value:function(e,t){return l[this.name].invert(this,e,t)}},{key:"toJSON",value:function(){var e=l[this.name];return{name:this.name,from:this.from,to:this.to,pos:this.pos,param:e.paramToJSON?e.paramToJSON(this.param):this.param}}}],[{key:"fromJSON",value:function(t,n){var r=l[n.name];return new e(n.name,n.from&&s.Pos.fromJSON(n.from),n.to&&s.Pos.fromJSON(n.to),n.pos&&s.Pos.fromJSON(n.pos),r.paramFromJSON?r.paramFromJSON(t,n.param):n.param)}}]),e}();e.Step=a;var l=Object.create(null)}),require.register("prosemirror/transform/style",function(e,t,n){"use strict";var r=t("../model"),o=t("./transform"),i=t("./step"),s=t("./tree");i.defineStep("addStyle",{apply:function(e,t){return new o.TransformResult(s.copyStructure(e,t.from,t.to,function(e,n,r){return e.type.canContainStyle(t.param)?s.copyInline(e,n,r,function(e){return e.styled(t.param.addToSet(e.styles))}):e}))},invert:function(e,t,n){return new i.Step("removeStyle",e.from,n.map(e.to).pos,null,e.param)},paramToJSON:function(e){return e.toJSON()},paramFromJSON:function(e,t){return e.styleFromJSON(t)}}),o.Transform.prototype.addStyle=function(e,t,n){var o=this,s=[],a=[],l=null,c=null;return this.doc.inlineNodesBetween(e,t,function(e,t,o,u,p){if(n.isInSet(e.styles)||!p.type.canContainStyle(n.type))c=l=null;else{u=u.slice();var d=r.containsStyle(e.styles,n.type);d?l&&l.param.eq(d)?l.to=new r.Pos(u,o):(l=new i.Step("removeStyle",new r.Pos(u,t),new r.Pos(u,o),null,d),s.push(l)):l&&(l=null),c?c.to=new r.Pos(u,o):(c=new i.Step("addStyle",new r.Pos(u,t),new r.Pos(u,o),null,n),a.push(c))}}),s.forEach(function(e){return o.step(e)}),a.forEach(function(e){return o.step(e)}),this},i.defineStep("removeStyle",{apply:function(e,t){return new o.TransformResult(s.copyStructure(e,t.from,t.to,function(e,n,r){return s.copyInline(e,n,r,function(e){return e.styled(t.param.removeFromSet(e.styles))})}))},invert:function(e,t,n){return new i.Step("addStyle",e.from,n.map(e.to).pos,null,e.param)},paramToJSON:function(e){return e.toJSON()},paramFromJSON:function(e,t){return e.styleFromJSON(t)}}),o.Transform.prototype.removeStyle=function(e,t){var n=this,o=arguments.length<=2||void 0===arguments[2]?null:arguments[2],i=[],s=0;return this.doc.inlineNodesBetween(e,t,function(e,t,n,a){s++;var l=null;if(o instanceof r.StyleType){var c=r.containsStyle(e.styles,o);c&&(l=[c])}else o?o.isInSet(e.styles)&&(l=[o]):l=e.styles;if(l&&l.length){a=a.slice();for(var u=0;u<l.length;u++){for(var p=l[u],c=void 0,d=0;d<i.length;d++){var h=i[d];h.step==s-1&&p.eq(i[d].style)&&(c=h)}c?(c.to=new r.Pos(a,n),c.step=s):i.push({style:p,from:new r.Pos(a,t),to:new r.Pos(a,n),step:s})}}}),i.forEach(function(e){return n.step("removeStyle",e.from,e.to,null,e.style)}),this},o.Transform.prototype.clearMarkup=function(e,t,n){var o=this,s=[];this.doc.inlineNodesBetween(e,t,function(e,t,a,l){if(n?!n.canContainType(e.type):!e.isText){l=l.slice();var c=new r.Pos(l,t);return void s.push(new i.Step("replace",c,new r.Pos(l,a),c))}for(var u=0;u<e.styles.length;u++){var p=e.styles[u];n&&n.canContainStyle(p.type)||(l=l.slice(),o.step("removeStyle",new r.Pos(l,t),new r.Pos(l,a),null,p))}});for(var a=s.length-1;a>=0;a--)this.step(s[a]);return this}}),require.register("prosemirror/transform/transform",function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=t("./step"),s=t("./map"),a=function c(e){var t=arguments.length<=1||void 0===arguments[1]?s.nullMap:arguments[1];r(this,c),this.doc=e,this.map=t};e.TransformResult=a;var l=function(){function e(t){r(this,e),this.docs=[t],this.steps=[],this.maps=[]}return o(e,[{key:"step",value:function(e,t,n,r,o){"string"==typeof e&&(e=new i.Step(e,t,n,r,o));var s=e.apply(this.doc);return s&&(this.steps.push(e),this.maps.push(s.map),this.docs.push(s.doc)),s}},{key:"map",value:function(e,t){for(var n=!1,r=0;r<this.maps.length;r++){var o=this.maps[r].map(e,t);e=o.pos,o.deleted&&(n=!0)}return new s.MapResult(e,n)}},{key:"doc",get:function(){return this.docs[this.docs.length-1]}},{key:"before",get:function(){return this.docs[0]}}]),e}();e.Transform=l}),require.register("prosemirror/transform/tree",function(e,t,n){"use strict";function r(e,t,n,o){var i=arguments.length<=4||void 0===arguments[4]?0:arguments[4];if(e.isTextblock)return o(e,t,n);if(!e.length)return e;var s=t?t.path[i]:0,a=n?n.path[i]:e.length-1,l=e.slice(0,s);if(s==a)l.push(r(e.child(s),t,n,o,i+1));else{l.push(r(e.child(s),t,null,o,i+1));for(var c=s+1;a>c;c++)l.push(r(e.child(c),null,null,o,i+1));l.push(r(e.child(a),null,n,o,i+1))}for(var c=a+1;c<e.length;c++)l.push(e.child(c));return e.copy(l)}function o(e,t,n,r){for(var o=t?t.offset:0,i=n?n.offset:e.maxOffset,s=e.slice(0,o).concat(e.slice(o,i).map(r)).concat(e.slice(i)),a=s.length-2;a>=0;a--){var l=s[a].maybeMerge(s[a+1]);l&&s.splice(a,2,l)}return e.copy(s)}function i(e,t){if(e.path.length!=t.path.length)return!1;for(var n=0;n<e.path.length;n++)if(e.path[n]!=t.path[n])return!1;return e.offset<=t.offset}function s(e,t,n){if(!n||0==t||t==e.length)return!1;var r=e.child(t-1),o=e.child(t);return r.sameMarkup(o)}function a(e,t,n){for(var r=0,o=e;;r++){var i=r==t.depth,a=r==n.depth;if(i||a||t.path[r]!=n.path[r]){var l=void 0,c=void 0;if(i)l=t.offset;else{l=t.path[r]+1;for(var u=r+1,p=o.child(l-1);u<=t.path.length;u++)if(u==t.path.length){if(t.offset<p.maxOffset)return!0}else{if(t.path[u]+1<p.maxOffset)return!0;p=p.child(t.path[u])}}if(a)c=n.offset;else{c=n.path[r];for(var u=r+1;u<=n.path.length;u++)if((u==n.path.length?n.offset:n.path[u])>0)return!0}return l!=c?!0:s(o,l,Math.min(t.depth,n.depth)-r)}o=o.child(t.path[r])}}function l(e,t){for(var n=0;;n++)if(n==e.path.length||n==t.path.length||e.path[n]!=t.path[n])return n}Object.defineProperty(e,"__esModule",{value:!0}),e.copyStructure=r,e.copyInline=o,e.isFlatRange=i,e.replaceHasEffect=a,e.samePathDepth=l}),require.register("prosemirror/util/error",function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e){var t=/^function (\w+)/.exec(e.toString());return t&&t[1]}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(e,t,n){for(var r=!0;r;){var o=e,i=t,s=n;r=!1,null===o&&(o=Function.prototype);var a=Object.getOwnPropertyDescriptor(o,i);if(void 0!==a){if("value"in a)return a.value;var l=a.get;return void 0===l?void 0:l.call(s)}var c=Object.getPrototypeOf(o);if(null===c)return void 0;e=c,t=i,n=s,r=!0,a=c=void 0}},l=function(e){function t(e){r(this,t),a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.message!=e&&(this.message=e,Error.captureStackTrace?Error.captureStackTrace(this,this.name):this.stack=new Error(e).stack)}return o(t,e),s(t,[{key:"name",get:function(){return this.constructor.name||i(this.constructor)||"ProseMirrorError"}}],[{key:"raise",value:function(e){throw new this(e)}}]),t}(Error);e.ProseMirrorError=l}),require.register("prosemirror/util/map",function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=window.Map||function(){function e(){r(this,e),this.content=[]}return o(e,[{key:"set",value:function(e,t){var n=this.find(e);n>-1?this.content[n+1]=t:this.content.push(e,t)}},{key:"get",value:function(e){var t=this.find(e);return-1==t?void 0:this.content[t+1]}},{key:"has",value:function(e){return this.find(e)>-1}},{key:"find",value:function(e){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===e)return t}},{key:"clear",value:function(){this.content.length=0}},{key:"size",get:function(){return this.content.length/2}}]),e}();e.Map=i}),require.register("prosemirror/util/sortedinsert",function(e,t,n){"use strict";function r(e,t,n){for(var r=0;r<e.length&&!(n(e[r],t)>0);r++);e.splice(r,0,t)}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=r,n.exports=e["default"]}),require.register("router",function(e,t,n){var r,o,i,s,a={}.hasOwnProperty,l=function(e,t){function n(){this.constructor=e}for(var r in t)a.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};i=t("./libs/panel_router"),r=t("./stores/account_store"),o=t("./stores/message_store"),n.exports=s=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return l(t,e),t.prototype.patterns={"account.config":{pattern:"account/:accountID/config/:tab",fluxAction:"showConfigAccount"},"account.new":{pattern:"account/new",fluxAction:"showCreateAccount"},"account.mailbox.messages":{pattern:"account/:accountID/mailbox/:mailboxID/sort/:sort/:type/:flag/before/:before/after/:after",fluxAction:"showMessageList"},search:{pattern:"account/:accountID/search/:search",fluxAction:"showSearchResult"},message:{pattern:"message/:messageID",fluxAction:"showMessage"},conversation:{pattern:"conversation/:conversationID/:messageID/",fluxAction:"showConversation"},compose:{pattern:"compose",fluxAction:"showComposeNewMessage"},"compose.reply":{pattern:"reply/:messageID",fluxAction:"showComposeMessage"},"compose.reply-all":{pattern:"reply-all/:messageID",fluxAction:"showComposeMessage"},"compose.forward":{pattern:"forward/:messageID",fluxAction:"showComposeMessage"},edit:{pattern:"edit/:messageID",fluxAction:"showComposeMessage"},"default":{pattern:"",fluxAction:""}},t.prototype.routes={"":"default"},t.prototype._getDefaultParameters=function(e,t){var n,o,i,s,a,l,c;switch(e){case"account.mailbox.messages":o=null!=(l=r.getDefault())?l.get("id"):void 0,a=null!=t.accountID?r.getDefaultMailbox(t.accountID):r.getDefaultMailbox(o),i=null!=a?a.get("id"):void 0,s={},s.accountID=o,s.mailboxID=i,s.pageAfter="-",s.sort="-date",s.after="-",s.before="-",s.type="nofilter",s.flag="-";break;case"account.config":n=null!=(c=r.getDefault())?c.get("id"):void 0,s={accountID:n,tab:"account"};break;case"search":s={accountID:"all",search:"-"};break;default:s=null}return s},t}(i)}),require.register("stores/account_store",function(e,n,r){var o,i,s,a,l,c,u,p={}.hasOwnProperty,d=function(e,t){function n(){this.constructor=e}for(var r in t)p.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},h=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};c=n("../libs/flux/store/store"),s=n("../constants/app_constants").ActionTypes,i=n("../utils/translators/account_translator"),u=n("../libs/cached_transform"),l=["id","accountID","label","tree","weight"],a=["lastSync","nbTotal","nbUnread","nbRecent"],o=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}var r,o,c,p,f,m,g,v,y,b,S,k,w,E,_,x,C,T;return d(n,e),c=Immutable.Map(),o=Immutable.Sequence(window.accounts).sort(function(e,t){return e.label>t.label?1:e.label<t.label?-1:0}).mapKeys(function(e,t){return t.id}).map(function(e){return c.set(e.id,e.totalUnread),i.toImmutable(e)}).toOrderedMap(),b=Immutable.Map(),_=null,x=null,k=!1,S=!1,C=Immutable.Map(),v={},w=null,g=null,E=function(){var e,t,n;return(e=null!=_?_.get("id"):void 0)&&(_=o.get(e),t=null!=x?x.get("id"):void 0)?x=null!=_&&null!=(n=_.get("mailboxes"))?n.get(t):void 0:void 0},m=function(){return C=Immutable.Map()},p=function(e,t){return C=C.set(e,t)},f=function(e){var t;return(null!=(t=e.mailboxes)?t.length:void 0)>0?void 0:T({name:"AccountConfigError",field:"nomailboxes",causeFields:["nomailboxes"]})},T=function(e){var n,r,o,i,s,a;if("AccountConfigError"===e.name){for(n={message:t("config error "+e.field),originalError:e.originalError,originalErrorStack:e.originalErrorStack},r={},a=e.causeFields,i=0,s=a.length;s>i;i++)o=a[i],r[o]=n;return C=Immutable.Map(r)}return C=Immutable.Map({unknown:e})},r=function(e,t,n){var r,i,s,c,u;if(r=o.get(e),!r)return!0;c=r.get("mailboxes"),s=c.get(t)||Immutable.Map(),u=b.get(t)||Immutable.Map(),s.get("weight")&&(n.weight=s.get("weight"));for(i in l)s.get(i)!==n[i]&&(s=s.set(i,n[i]));for(i in a)u.get(i)!==n[i]&&(u=u.set(i,n[i]));return u!==b.get(t)&&b.set(t,u),s!==c.get(t)&&(c=c.set(t,s),r=r.set("mailboxes",c),o=o.set(e,r)),E()},y=function(e,t){var n,r;return n=e.get("weight"),r=t.get("weight"),r>n?1:n>r?-1:e.get("label"<t.get("label"))?1:e.get("label">t.get("label"))?-1:0},n.prototype._applyMailboxDiff=function(e,t){var n,r,o,i,s,a;for(n in t)o=t[n],o.nbTotal+o.nbUnread&&(r=b.get(n)||Immutable.Map(),b.set(n,r.merge({nbTotal:r.get("nbTotal")+o.nbTotal,nbUnread:r.get("nbUnread")+o.nbUnread})));return i=(null!=(a=t[e])?a.nbUnread:void 0)||0,i&&(s=c.get(e)+i,c=c.set(e,s)),clearTimeout(g),g=setTimeout(function(e){return function(){return e.emit("change")}}(this),1)},n.prototype._setCurrentAccount=function(e){return _=e},n.prototype._setCurrentMailbox=function(e){return x=e},n.prototype._onAccountUpdated=function(e){var t;return t=i.toImmutable(e),o=o.set(t.get("id"),t),this._setCurrentAccount(t)},n.prototype.__bindHandlers=function(e){return e(s.ADD_ACCOUNT_REQUEST,function(e){var t;return t=e.inputValues,k=!0,this.emit("change")}),e(s.ADD_ACCOUNT_SUCCESS,function(e){var t;return t=e.account,k=!1,f(t),this._onAccountUpdated(t),this.emit("change")}),e(s.ADD_ACCOUNT_FAILURE,function(e){var t;return t=e.error,k=!1,T(t),this.emit("change")}),e(s.CHECK_ACCOUNT_REQUEST,function(){return S=!0,this.emit("change")}),e(s.CHECK_ACCOUNT_SUCCESS,function(){return S=!1,this.emit("change")}),e(s.CHECK_ACCOUNT_FAILURE,function(e){var t;return t=e.error,S=!1,T(t),this.emit("change")}),e(s.SELECT_ACCOUNT,function(e){var t,n;return null!=e.accountID?this._setCurrentAccount(o.get(e.accountID)||null):this._setCurrentAccount(null),null!=e.mailboxID?(t=(null!=_&&null!=(n=_.get("mailboxes"))?n.get(e.mailboxID):void 0)||null,this._setCurrentMailbox(t)):(m(),this._setCurrentMailbox(null)),this.emit("change")}),e(s.EDIT_ACCOUNT_REQUEST,function(e){var t;return t=e.inputValues,k=!0,this.emit("change")}),e(s.EDIT_ACCOUNT_SUCCESS,function(e){var t;return t=e.rawAccount,k=!1,m(),f(t),this._onAccountUpdated(t),this.emit("change")}),e(s.EDIT_ACCOUNT_FAILURE,function(e){var t;return t=e.error,k=!1,T(t),this.emit("change")}),e(s.MAILBOX_CREATE,function(e){return this._onAccountUpdated(e),this.emit("change")}),e(s.MAILBOX_UPDATE,function(e){return this._onAccountUpdated(e),this.emit("change")}),e(s.MAILBOX_DELETE,function(e){return this._onAccountUpdated(e),this.emit("change")}),e(s.REMOVE_ACCOUNT,function(e){return o=o["delete"](e),this._setCurrentAccount(this.getDefault()),this.emit("change")}),e(s.RECEIVE_MAILBOX_UPDATE,function(e){return r(e.accountID,e.id,e),this.emit("change")}),e(s.RECEIVE_REFRESH_NOTIF,function(e){return c.set(e.accountID,e.totalUnread),
this.emit("change")}),e(s.REFRESH_REQUEST,function(e){var t;return t=e.mailboxID,null==v[t]&&(v[t]=0),v[t]++,this.emit("change")}),e(s.REFRESH_FAILURE,function(e){var t,n;return n=e.mailboxID,t=e.error,v[n]--,w=t,this.emit("change")}),e(s.REFRESH_SUCCESS,function(e){var t,n;return t=e.mailboxID,n=e.updated,v[t]--,null!=n&&r(n.accountID,n.id,n),this.emit("change")})},n.prototype.getAll=function(){return o},n.prototype.getAllMailboxes=function(){return u(n,"all-mailboxes",o,function(){return o.flatMap(function(e){return e.get("mailboxes")})})},n.prototype.getMailboxCounters=function(){return b},n.prototype.getByID=function(e){return o.get(e)},n.prototype.getByLabel=function(e){return o.find(function(t){return t.get("label")===e})},n.prototype.getDefault=function(){return o.first()||null},n.prototype.getDefaultMailbox=function(e){var t,n,r,i,s;return(t=o.get(e)||this.getDefault())?(s=t.get("mailboxes"),i=s.filter(function(e){return"inbox"===e.get("label").toLowerCase()}),0!==i.count()?i.first():(r=t.get("favorites"),n=null!=r?r[0]:void 0,n?s.get(n):s.first())):null},n.prototype.hasConversationEnabled=function(e){return e!==(null!=_?_.get("trashMailbox"):void 0)&&e!==(null!=_?_.get("draftMailbox"):void 0)&&e!==(null!=_?_.get("junkMailbox"):void 0)},n.prototype.getSelected=function(){return _},n.prototype.getSelectedOrDefault=function(){return this.getSelected()||this.getDefault()},n.prototype.getSelectedMailboxes=function(e){var t;return null==_?Immutable.OrderedMap.empty():(t=_.get("mailboxes"),e&&(t=t.sort(y)),t)},n.prototype.selectedIsDifferentThan=function(e,t){var n;return n=(null!=_?_.get("id"):void 0)!==e||(null!=x?x.get("id"):void 0)!==t},n.prototype.getSelectedMailbox=function(e){var t;return t=this.getSelectedMailboxes(),null!=e?t.get(e):null!=x?x:t.first()},n.prototype.getSelectedFavorites=function(e){var t,n,r;return n=this.getSelectedMailboxes(),t=null!=_?_.get("favorites"):void 0,r=null!=t?n.filter(function(e,n){return h.call(t,n)>=0}).toOrderedMap():n.toOrderedMap(),e&&(r=r.sort(y)),r},n.prototype.getErrors=function(){return C},n.prototype.getRawErrors=function(){return C.get("unknown")},n.prototype.getAlertErrorMessage=function(){var e;return e=C.first(),"AccountConfigError"===e.name?t("config error "+e.field):e.message||e.name||e},n.prototype.getRefreshLastError=function(){var e;return e=w,"AccountConfigError"===e.name?t("config error "+e.field):e.message||e.name||e},n.prototype.isWaiting=function(){return k},n.prototype.isChecking=function(){return S},n.prototype.isMailboxRefreshing=function(e){return v[e]>0},n.prototype.getMailboxRefresh=function(e){return v[e]>0?.9:0},n.prototype.getMailbox=function(e,t){var n;n=null;for(n in e.get("mailboxIds"))h.call(t.favorites,n)>=0&&(n=n);return null==n&&Object.keys(e.get("mailboxIds")).length>=0?Object.keys(e.get("mailboxIds"))[0]:n},n.prototype.makeEmptyAccount=function(){var e;return e={},e.label="",e.login="",e.password="",e.imapServer="",e.imapLogin="",e.smtpServer="",e.label="",e.id=null,e.smtpPort=465,e.smtpSSL=!0,e.smtpTLS=!1,e.smtpMethod="PLAIN",e.imapPort=993,e.imapSSL=!0,e.imapTLS=!1,e.accountType="IMAP",e.favoriteMailboxes=null,Immutable.Map(e)},n}(c),r.exports=new o}),require.register("stores/contact_store",function(e,t,n){var r,o,i,s={}.hasOwnProperty,a=function(e,t){function n(){this.constructor=e}for(var r in t)s.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};i=t("../libs/flux/store/store"),r=t("../constants/app_constants").ActionTypes,o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}var n,o,i,s;return a(t,e),i="",n=Immutable.OrderedMap.empty(),s=Immutable.OrderedMap.empty(),o=function(e){var t;return s=Immutable.OrderedMap.empty(),null!=e?(Array.isArray(e)||(e=[e]),t=function(t){return e.forEach(function(e){var n,r;return n=[],e.datapoints.forEach(function(t){return"email"===t.name&&n.push(t.value),"avatar"===t.name?e.avatar=t.value:void 0}),delete e.docType,(null!=(r=e._attachments)?r.picture:void 0)&&(e.avatar="contacts/"+e.id+"/picture.jpg"),n.forEach(function(n){var r;return e.address=n,r=Immutable.Map(e),t.set(n,r)})})},s=s.withMutations(t),n=n.withMutations(t)):void 0},o(window.contacts),t.prototype.__bindHandlers=function(e){return e(r.RECEIVE_RAW_CONTACT_RESULTS,function(e){return function(t){return o(t),e.emit("change")}}(this)),e(r.CONTACT_LOCAL_SEARCH,function(e){return function(t){var r;return t=t.toLowerCase(),r=new RegExp(t,"i"),s=n.filter(function(e){var t,n;return n=e.toObject(),t="",["address","fn"].forEach(function(e){return"string"==typeof n[e]?t+=n[e]:void 0}),r.test(t)}).toOrderedMap(),e.emit("change")}}(this))},t.prototype.getResults=function(){return s},t.prototype.getQuery=function(){return i},t.prototype.getByAddress=function(e){return n.get(e)},t.prototype.getAvatar=function(e){var t;return null!=(t=n.get(e))?t.get("avatar"):void 0},t.prototype.isExist=function(e){return null!=this.getByAddress(e)},t}(i),n.exports=new o}),require.register("stores/layout_store",function(e,n,r){var o,i,s,a,l,c,u,p,d,h,f={}.hasOwnProperty,m=function(e,t){function n(){this.constructor=e}for(var r in t)f.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};p=n("../libs/flux/store/store"),h=n("../constants/app_constants"),i=h.ActionTypes,a=h.Dispositions,s=n("../app_dispatcher"),o=n("./account_store"),u=null,d=function(){return null==u&&(u=n("../actions/message_action_creator")),u},l=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}var r,l,c,u,p,h,f,g,v;return m(n,e),r=a.COL,f=60,h=!1,v=Immutable.OrderedMap(),g=!0,c=!1,u=!1,l=window.innerWidth>1280,p=null,n.prototype.__bindHandlers=function(e){var n,a;return e(i.SET_DISPOSITION,function(e){return r=e,this.emit("change")}),e(i.TOGGLE_LIST_MODE,function(){return u=!u,this.emit("change")}),e(i.RESIZE_PREVIEW_PANE,function(e){return e?(f+=e,20>f&&(f=20),f>80&&(f=80)):f=50,this.emit("change")}),e(i.MINIMIZE_PREVIEW_PANE,function(){return h=!1,this.emit("change")}),e(i.MAXIMIZE_PREVIEW_PANE,function(){return h=!0,this.emit("change")}),e(i.DISPLAY_MODAL,function(e){return p=e,this.emit("change")}),e(i.HIDE_MODAL,function(e){return p=null,this.emit("change")}),e(i.REFRESH,function(){return this.emit("change")}),e(i.CLEAR_TOASTS,function(){return v=Immutable.OrderedMap(),this.emit("change")}),e(i.RECEIVE_TASK_UPDATE,function(e){return function(t){return e._showNotification(t)}}(this)),e(i.RECEIVE_TASK_DELETE,function(e){return this._removeNotification(e)}),e(i.TOASTS_SHOW,function(){return g=!0,this.emit("change")}),e(i.TOASTS_HIDE,function(){return g=!1,this.emit("change")}),e(i.INTENT_AVAILABLE,function(e){return c=e,this.emit("change")}),e(i.DRAWER_SHOW,function(){return l!==!0?(l=!0,this.emit("change")):void 0}),e(i.DRAWER_HIDE,function(){return l!==!1?(l=!1,this.emit("change")):void 0}),e(i.DRAWER_TOGGLE,function(){return l=!l,this.emit("change")}),n=function(e,n,r,o){var i,s,a;if(s=null!=e?e.subject:void 0,e.messageID&&e.isDraft)a="draft";else if(e.messageID)a="message";else if(e.conversationID)a="conversation";else if(e.conversationIDs)a="conversations",i=e.conversationIDs.length;else{if(!e.messageIDs)throw new Error("Wrong Usage : unrecognized target");a="messages",i=e.messageIDs.length}return t(""+a+" "+r,{error:o,subject:s||"",smart_count:i})},a=function(e){return{label:t("action undo"),onClick:function(){return d().undo(e)}}},e(i.MESSAGE_TRASH_SUCCESS,function(e){var t,r,o;return r=e.target,t=e.ref,o=e.updated,this._showNotification({message:n(r,t,"delete ok"),actions:[a(t)],autoclose:!0})}),e(i.MESSAGE_TRASH_FAILURE,function(e){var t,r,o;return o=e.target,r=e.ref,t=e.error,this._showNotification({message:n(o,r,"delete ko",t),errors:[t],autoclose:!0})}),e(i.MESSAGE_MOVE_SUCCESS,function(e){var t,r,o;return r=e.target,t=e.ref,o=e.updated,r.silent?void 0:this._showNotification({message:n(r,t,"move ok"),actions:[a(t)],autoclose:!0})}),e(i.MESSAGE_MOVE_FAILURE,function(e){var t,r,o;return o=e.target,r=e.ref,t=e.error,this._showNotification({message:n(o,r,"move ko",t),errors:[t],autoclose:!0})}),e(i.MESSAGE_FLAGS_FAILURE,function(e){var t,r,o;return o=e.target,r=e.ref,t=e.error,this._showNotification({message:n(o,r,"flag ko",t),errors:[t],autoclose:!0})}),e(i.MESSAGE_RECOVER_FAILURE,function(e){var t,n,r;return r=e.target,n=e.ref,t=e.error,this._showNotification({message:"lost server connection",errors:[t],autoclose:!0})}),e(i.MESSAGE_FETCH_FAILURE,function(e){var t;return t=e.error,this._showNotification({message:"message fetch failure",errors:[t],autoclose:!0})}),e(i.ADD_ACCOUNT_FAILURE,function(e){var t;return t=e.error,s.waitFor([o.dispatchToken]),this._showNotification({message:o.getAlertErrorMessage(),errors:o.getRawErrors(),autoclose:!0})}),e(i.ADD_ACCOUNT_SUCCESS,function(){return this._showNotification({message:t("account creation ok"),autoclose:!0})}),e(i.EDIT_ACCOUNT_FAILURE,function(e){var t;return t=e.error,s.waitFor([o.dispatchToken]),this._showNotification({message:o.getAlertErrorMessage(),errors:o.getRawErrors(),autoclose:!0})}),e(i.EDIT_ACCOUNT_SUCCESS,function(){return this._showNotification({message:t("account updated"),autoclose:!0})}),e(i.CHECK_ACCOUNT_FAILURE,function(e){var t;return t=e.error,s.waitFor([o.dispatchToken]),this._showNotification({message:o.getAlertErrorMessage(),errors:o.getRawErrors(),autoclose:!0})}),e(i.CHECK_ACCOUNT_SUCCESS,function(){return this._showNotification({message:t("account checked"),autoclose:!0})}),e(i.REFRESH_FAILURE,function(e){var t;return t=e.error,s.waitFor([o.dispatchToken]),this._showNotification({message:o.getRefreshLastError(),errors:[t],autoclose:!0})})},n.prototype._removeNotification=function(e){return v=v.remove(e),this.emit("change")},n.prototype._showNotification=function(e){var t;return t=e.id||+Date.now(),null==e.finished&&(e.finished=!0),v=v.set(t,Immutable.Map(e)),e.autoclose&&setTimeout(this._removeNotification.bind(this,t),5e3),this.emit("change")},n.prototype.getDisposition=function(){return r},n.prototype.getListModeCompact=function(){return u},n.prototype.getPreviewSize=function(){return f},n.prototype.isPreviewFullscreen=function(){return h},n.prototype.getModal=function(){return p},n.prototype.getToasts=function(){return v},n.prototype.isShown=function(){return g},n.prototype.intentAvailable=function(){return c},n.prototype.isDrawerExpanded=function(){return l},n}(p),r.exports=c=new l}),require.register("stores/message_store",function(e,t,n){var r,o,i,s,a,l,c,u,p,d,h,f,m,g,v,y={}.hasOwnProperty,b=function(e,t){function n(){this.constructor=e}for(var r in t)y.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},S=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};d=t("../libs/flux/store/store"),s=t("./contact_store"),i=t("../app_dispatcher"),r=t("./account_store"),p=t("../utils/socketio_utils"),g=t("../constants/app_constants"),o=g.ActionTypes,c=g.MessageFlags,l=g.MessageFilter,a=g.FlagsConstants,v=t("../utils/misc"),f=v.reverseDateSort,h=v.getSortFunction,u=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}var n,s,a,u,d,g,v,y,k,w,E,x,C,T,M,A,D,R,N,O,I,P,L,F,U,q,j,H,B,V,z,G,W,K;return b(t,e),U=Immutable.OrderedMap(),z="date",G=1,D="-",R="nofilter",A="-",M="-",T=0,B=0,j=null,H=!1,C=Immutable.Sequence(),k=Immutable.Map(),w=null,x=null,E=null,P={},I={},K={},y=function(e){return P[e.ref]=e,e.messages.forEach(function(t){var n,r;return n=t.get("id"),r=null!=I[n]?I[n]:I[n]=[],r.push(e)}),w=null},V=function(e){var t;return t=P[e],delete P[e],t.messages.forEach(function(e){var n,r;return n=e.get("id"),r=I[n],I[n]=_.without(r,t)}),w=null,t},W=function(e,t){var n,r,o,i,s,a,l,c,p,d;switch(t.type){case"trash":p=t.trashBoxID,u(e)?e=null:(a={},a[p]=-1,e=e.set("mailboxIDs",a));break;case"move":s=e.get("mailboxIDs"),o=t.from,c=t.to,a={};for(i in s)d=s[i],a[i]=d;delete a[o],null==a[c]&&(a[c]=-1),e=e.set("mailboxIDs",a);break;case"flag":r=e.get("flags"),n=t.flag,l=t.op,"batchAddFlag"===l&&S.call(r,n)<0?e=e.set("flags",r.concat([n])):"batchRemoveFlag"===l&&S.call(r,n)>=0&&(e=e.set("flags",_.without(r,n)))}return e},q=function(){return U.map(function(e){var t,n,r,o,i;for(t=e.get("id"),i=I[t]||[],r=0,o=i.length;o>r;r++)n=i[r],e=W(e,n);return e}).filter(function(e){return null!==e})},N=function(e){var t,n,r,o,i;return null!=e.inReplyTo?null:(o=e.messageIDs||[e.messageID],r=m.getCurrentID()||"not-null",t=e.conversationIDs||[e.conversationID],n=m.getCurrentConversationID()||"not-null",(S.call(o,r)>=0||S.call(t,n)>=0)&&(i=m.getNextOrPrevious(!0),null!=i)?setTimeout(function(){return window.cozyMails.messageSetCurrent(i)},1):void 0)},O=function(e){if(e.messageID)return[U.get(e.messageID)];if(e.messageIDs)return e.messageIDs.map(function(e){return U.get(e)});if(e.conversationID)return U.filter(function(t){return t.get("conversationID")===e.conversationID}).toArray();if(e.conversationIDs)return U.filter(function(t){var n;return n=t.get("conversationID"),S.call(e.conversationIDs,n)>=0}).toArray();throw new Error("Wrong Usage : unrecognized target AS.getMixed")},u=function(e,t){var n,r;return n=e.get("mailboxIDs"),n[t]||(r=c.DRAFT,S.call(e.get("flags"),r)>=0)},a=function(e){return function(t){return e in t.get("mailboxIDs")}},g=function(e){return function(t){return!(e in t.get("mailboxIDs"))}},d=function(e){return function(t){return e!==t.get("accountID")}},s=function(){var e,t;return e=[],t=function(t){var n;return n=t.get("conversationID"),n&&S.call(e,n)>=0?!1:(e.push(n),!0)}},n=function(e,t){var n,r,o,i,s,a,l,u,p,d,h,f,m;return e?(o=!1,f=c.SEEN,h=S.call(e.get("flags"),f)>=0,m=c.SEEN,s=S.call(t.get("flags"),m)>=0,n=t.get("accountID"),l=Object.keys(e.get("mailboxIDs")),a=Object.keys(t.get("mailboxIDs")),u={},r=_.difference(a,l),r.forEach(function(e){return o=!0,u[e]={nbTotal:1,nbUnread:s?0:1}}),p=_.difference(l,a),p.forEach(function(e){return o=!0,u[e]={nbTotal:-1,nbUnread:h?-1:0}}),d=_.intersection(l,a),i=h&&!s?1:!h&&s?-1:0,0!==i&&(o=!0),u[n]={nbUnread:i},d.forEach(function(e){return u[e]={nbTotal:0,nbUnread:i}}),o?u:!1):{}},v=function(e){var t,o,i,s;return i=U.get(e.id),s=null!=i?i.get("updated"):void 0,null!=e.updated&&null!=s&&s>e.updated||e._deleted||(null==e.attachments&&(e.attachments=[]),null==e.date&&(e.date=(new Date).toISOString()),null==e.createdAt&&(e.createdAt=e.date),null==e.flags&&(e.flags=[]),e.hasAttachments=e.attachments.length>0,e.attachments=e.attachments.map(function(e){return Immutable.Map(e)}),e.attachments=Immutable.Vector.from(e.attachments),delete e.docType,e.updated=Date.now(),o=Immutable.Map(e),o.prettyPrint=function(){return""+e.id+' "'+e.from[0].name+'" "'+e.subject+'"'},U=U.set(e.id,o),e.id===x&&(E=e.conversationID),null!=e.accountID&&(t=n(i,o),t&&r._applyMailboxDiff(e.accountID,t))),w=null},t.prototype.__bindHandlers=function(e){return e(o.RECEIVE_RAW_MESSAGE,function(e){return v(e),this.emit("change")}),e(o.RECEIVE_RAW_MESSAGE_REALTIME,function(e){return v(e),this.emit("change")}),e(o.RECEIVE_RAW_MESSAGES,function(e){var t,n,r;for(n=0,r=e.length;r>n;n++)t=e[n],null!=t&&v(t);return this.emit("change")}),e(o.REMOVE_ACCOUNT,function(e){return i.waitFor([r.dispatchToken]),U=U.filter(d(e)).toOrderedMap(),this.emit("change")}),e(o.MESSAGE_TRASH_REQUEST,function(e){var t,n,o,i,s,a,l,c,u,p,d;for(a=e.target,s=e.ref,i=O(a),a.subject=null!=(p=i[0])?p.get("subject"):void 0,a.accountID=i[0].get("accountID"),t=r.getByID(null!=(d=i[0])?d.get("accountID"):void 0),l=null!=t&&"function"==typeof t.get?t.get("trashMailbox"):void 0,y({type:"trash",trashBoxID:l,messages:i,ref:s}),N(a),c=0,u=i.length;u>c;c++)o=i[c],n=o.get("conversationID"),k=k.update(n,function(e){return e-1});return this.emit("change")}),e(o.MESSAGE_TRASH_SUCCESS,function(e){var t,n,r,o,i,s;for(r=e.target,o=e.updated,n=e.ref,K[n]=V(n),i=0,s=o.length;s>i;i++)t=o[i],t._deleted?U=U.remove(t.id):v(t);return this.emit("change")}),e(o.MESSAGE_TRASH_FAILURE,function(e){var t,n,r,o,i,s,a;for(i=e.target,o=e.ref,V(o),r=O(i),s=0,a=r.length;a>s;s++)n=r[s],t=n.get("conversationID"),k=k.update(t,function(e){return e+1});return this.emit("change")}),e(o.MESSAGE_FLAGS_REQUEST,function(e){var t,n,r,o,i,s;return i=e.target,r=e.op,t=e.flag,o=e.ref,n=O(i),i.subject=null!=(s=n[0])?s.get("subject"):void 0,i.accountID=n[0].get("accountID"),y({type:"flag",op:r,flag:t,messages:n,ref:o}),this.emit("change")}),e(o.MESSAGE_FLAGS_SUCCESS,function(e){var t,n,r,o,i,s;for(r=e.target,o=e.updated,n=e.ref,V(n),i=0,s=o.length;s>i;i++)t=o[i],v(t);return this.emit("change")}),e(o.MESSAGE_FLAGS_FAILURE,function(e){var t,n;return n=e.target,t=e.ref,V(t),this.emit("change")}),e(o.MESSAGE_MOVE_REQUEST,function(e){var t,n,r,o,i,s;return o=e.target,t=e.from,i=e.to,r=e.ref,n=O(o),o.subject=null!=(s=n[0])?s.get("subject"):void 0,o.accountID=n[0].get("accountID"),y({type:"move",from:t,to:i,messages:n,ref:r}),N(o),this.emit("change")}),e(o.MESSAGE_MOVE_SUCCESS,function(e){var t,n,r,o,i,s;for(r=e.target,o=e.updated,n=e.ref,K[n]=V(n),i=0,s=o.length;s>i;i++)t=o[i],v(t);return this.emit("change")}),e(o.MESSAGE_MOVE_FAILURE,function(e){var t,n;return n=e.target,t=e.ref,V(t),this.emit("change")}),e(o.MESSAGE_UNDO_TIMEOUT,function(e){var t;return t=e.ref,delete K[t]}),e(o.MESSAGE_FETCH_REQUEST,function(e){var t;return t=e.mailboxID,T++,this.emit("change")}),e(o.MESSAGE_FETCH_FAILURE,function(){return T--,this.emit("change")}),e(o.MESSAGE_FETCH_SUCCESS,function(e){var t,n,r,o,i,s,a,l,c,u,d,h,f;if(t=e.fetchResult,T--,null!=(null!=(u=t.links)?u.next:void 0)?j=decodeURIComponent(t.links.next):null!=t.links&&(H=!0),r=t.conversationLengths){for(d=t.messages,i=0,a=d.length;a>i;i++)o=d[i],null==r[c=o.conversationID]&&(r[c]=0);k=k.merge(r)}for(h=t.messages,s=0,l=h.length;l>s;s++)o=h[s],null!=o&&v(o);return n=null!=(f=U.last())?f.get("date"):void 0,n&&p.changeRealtimeScope(t.mailboxID,n),this.emit("change")}),e(o.CONVERSATION_FETCH_SUCCESS,function(e){var t,n,r,o;for(n=e.updated,r=0,o=n.length;o>r;r++)t=n[r],v(t);return this.emit("change")}),e(o.MESSAGE_SEND,function(e){return v(e),this.emit("change")}),e(o.QUERY_PARAMETER_CHANGED,function(e){var t,n,r,o,i;return i=e.type,r=e.flag,o=e.sort,n=e.before,t=e.after,(i!==D||R!==r||A!==n||M!==t||G+z!==o)&&(B++,G=o.substr(0,1),z=o.substr(1),D=i,R=r,A=n,M=t,H=!1,j=null,("from"===D||"dest"===D||"from"===i||"dest"===i)&&(U=U.clear(),w=null)),this.emit("change")}),e(o.MESSAGE_CURRENT,function(e){return this.setCurrentID(e.messageID,e.conv),this.emit("change")}),e(o.SELECT_ACCOUNT,function(e){return this.setCurrentID(null),G="+",z="date",D="nofilter",R="-",A="-",M="-",H=!1,j=null}),e(o.RECEIVE_MESSAGE_DELETE,function(e){return U=U.remove(e),w=null,this.emit("change")}),e(o.MAILBOX_EXPUNGE,function(e){return U=U.filter(g(e)),w=null,this.emit("change")}),e(o.SEARCH_SUCCESS,function(e){var t,n,r,o,i;for(n=e.searchResults,i=n.rows,r=0,o=i.length;o>r;r++)t=i[r],null!=t&&v(t);return this.emit("change")})},t.prototype.getByID=function(e){return U.get(e)||null},t.prototype.getMessageHash=function(e){var t,n,o,i,s,a;return a=e.get("id"),n=e.get("accountID"),s=r.getSelectedMailbox().get("id"),null==s&&(s=r.getMailbox(e,t)),t=r.getSelected().get("id"),o=e.get("conversationID"),i="#account/"+n+"/",i+="mailbox/"+s+"/",i+="conversation/"+o+"/"+a+"/"},s=function(){var e,t;return e=[],t=function(t){var n;return n=t.get("conversationID"),n&&S.call(e,n)>=0?!1:(e.push(n),!0)}},L=function(e){var t,n;switch(R){case l.FLAGGED:return t=c.FLAGGED,S.call(e.get("flags"),t)>=0;case l.ATTACH:return e.get("attachments").length>0;case l.UNSEEN:return n=c.SEEN,S.call(e.get("flags"),n)<0;default:return!0}},F=function(e){var t;return A<(t=e.get(D))&&M>t},t.prototype.getMessagesToDisplay=function(e,t){var n,r;return n=[],r=q(),r=r.filter(a(e)),"flag"===D&&(r=r.filter(L)),"date"===D&&(r=r.filter(F)),t&&(r=r.filter(s())),r=r.sort(h(z,G)),C=r.toOrderedMap()},t.prototype.getCurrentID=function(){return x},t.prototype.setCurrentID=function(e,t){var n,r;return null!=t&&(n=null!=(r=this.getByID(e))?r.get("conversationID"):void 0),x=e,E=n,w=null},t.prototype.getCurrentConversationID=function(){return E},t.prototype.getPreviousMessage=function(e){var t,n,r,o,i;return null!=e&&e?null==w?null:(r=w.findIndex(function(e){return x===e.get("id")}),0>r?null:r===w.length-1?(o=Object.keys(C.toJS()),r=o.indexOf(w.last().get("id")),1>r?null:(n=C.get(o[r-1]),t=null!=n?n.get("conversationID"):void 0,null==t?null:i=U.filter(function(e){return e.get("conversationID")===t}).sort(f).first())):w.get(r+1)):(o=Object.keys(C.toJS()),r=o.indexOf(x),-1===r?null:C.get(o[r-1]))},t.prototype.getNextMessage=function(e){var t,n;return null!=e&&e?null==w?null:(t=w.findIndex(function(e){return x===e.get("id")}),0>t?null:0===t?(n=Object.keys(C.toJS()),t=n.indexOf(w.last().get("id")),-1===t||t===n.length-1?null:C.get(n[t+1])):w.get(t-1)):x?(n=Object.keys(C.toJS()),t=n.indexOf(x),-1===t||t===n.length-1?null:C.get(n[t+1])):null!=C?C.first():void 0},t.prototype.getNextOrPrevious=function(e){return this.getNextMessage(e)||this.getPreviousMessage(e)},t.prototype.getCurrentConversation=function(){var e;return e=this.getCurrentConversationID(),e?this.getConversation(e):null},t.prototype.getConversation=function(e){return w?w:w=q().filter(function(t){return t.get("conversationID")===e}).sort(f).toVector()},t.prototype.getMixed=function(e){return O(e)},t.prototype.getConversationsLength=function(){return k},t.prototype.isFetching=function(){return T>0},t.prototype.isUndoable=function(e){return null!=K[e]},t.prototype.getUndoableRequest=function(e){return K[e]},t.prototype.getQueryParams=function(){return{sort:""+G+z,type:D,filter:R,before:A,after:M,hasNextPage:!H}},t.prototype.getNextUrl=function(){var e,t,n;return H?null:j?j:(e=r.getSelectedMailbox().get("id"),t="from"===D||"dest"===D?encodeURIComponent("+"+D):encodeURIComponent(""+G+z),n="mailbox/"+e+"/?sort="+t,"flag"===D&&"-"!==R&&(n+="&flag="+R),"-"!==A&&(n+="&before="+encodeURIComponent(A)),"-"!==M&&(n+="&after="+encodeURIComponent(M)),n)},t}(d),n.exports=m=new u}),require.register("stores/refreshes_store",function(e,n,r){var o,i,s,a,l={}.hasOwnProperty,c=function(e,t){function n(){this.constructor=e}for(var r in t)l.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};s=n("../libs/flux/store/store"),o=n("../constants/app_constants").ActionTypes,a=function(e){return Immutable.Sequence(e).mapKeys(function(e,t){return t.objectID}).map(function(e){return Immutable.fromJS(e)}).toOrderedMap()},i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}var r;return c(n,e),r=a(window.refreshes||[]),n.prototype.__bindHandlers=function(e){return e(o.RECEIVE_REFRESH_STATUS,function(e){return r=a(e)}),e(o.RECEIVE_REFRESH_UPDATE,function(e){var t;return e=Immutable.Map(e),t=e.get("objectID"),r=r.set(t,e).toOrderedMap(),this.emit("change")}),e(o.RECEIVE_REFRESH_DELETE,function(e){return r=r.filter(function(t){return t.get("id")!==e}).toOrderedMap(),this.emit("change")}),e(o.RECEIVE_REFRESH_NOTIF,function(e){return window.cozyMails.notify(t("notif new title"),{body:e.message})})},n.prototype.getRefreshing=function(){return r},n}(s),r.exports=new i}),require.register("stores/search_store",function(e,t,n){var r,o,i,s,a,l,c={}.hasOwnProperty,u=function(e,t){function n(){this.constructor=e}for(var r in t)c.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};a=t("../libs/flux/store/store"),o=t("./message_store"),r=t("../constants/app_constants").ActionTypes,i=10,s=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}var n,s,a,l,c,p,d,h;return u(t,e),h=0,s="",p=0,c=!1,a="all",d=Immutable.Set().clear(),l=Immutable.Map(),n=function(){return s="",d=d.clear(),l=Immutable.Map(),p=0,c=!1},n(),t.prototype.__bindHandlers=function(e){return e(r.QUERY_PARAMETER_CHANGED,function(){return n(),this.emit("change")}),e(r.SEARCH_PARAMETER_CHANGED,function(e){var t,r;return r=e.search,t=e.accountID,(r!==s||t!==a)&&n(),s=r,a=t,this.emit("change")}),e(r.SEARCH_REQUEST,function(e){return h++,p++,this.emit("change")}),e(r.SEARCH_FAILURE,function(e){var t;return t=e.error,h--,p--,d=d.clear(),this.emit("change")}),e(r.SEARCH_SUCCESS,function(e){var t,n,r;return r=e.searchResults,h--,t=r.accounts,n=r.rows.map(function(e){return e._id}),c=n.length===i,d=d.union(n),l=l.merge(t),this.emit("change")})},t.prototype.getCurrentSearch=function(){return s},t.prototype.getCurrentSearchKey=function(){return encodeURIComponent(s)},t.prototype.getCurrentSearchAccountID=function(){return a},t.prototype.getCurrentSearchResults=function(){return d.mapEntries(function(e){var t;return t=e[0],[t,o.getByID(t)]}).filter(function(e){return null!==e}).toOrderedMap()},t.prototype.hasMoreSearch=function(){return c},t.prototype.getNextSearchUrl=function(){var e;return e="search?search="+this.getCurrentSearchKey(),e+="&pageSize="+i,p&&(e+="&page="+p),"all"!==a&&(e+="&accountID="+a),e},t}(a),n.exports=l=new s}),require.register("stores/settings_store",function(e,t,n){var r,o,i,s={}.hasOwnProperty,a=function(e,t){function n(){this.constructor=e}for(var r in t)s.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};i=t("../libs/flux/store/store"),r=t("../constants/app_constants").ActionTypes,o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}var n;return a(t,e),n=Immutable.Map(window.settings),t.prototype.__bindHandlers=function(e){return e(r.SETTINGS_UPDATED,function(e){return n=Immutable.Map(e),this.emit("change")})},t.prototype.get=function(e){return null==e&&(e=null),null!=e?n.get(e):n},t}(i),n.exports=new o}),require.register("utils/activity_utils",function(e,t,n){var r,o;o=t("../utils/xhr_utils"),r=function(e){var t;return t={},o.activityCreate(e,function(e,n){return e?t.onerror.call(e):t.onsuccess.call(n)}),t},n.exports=r}),require.register("utils/api_utils",function(e,n,r){var o,i,s,a,l,c,u=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},p={}.hasOwnProperty;o=n("../stores/account_store"),a=n("../stores/message_store"),l=n("../stores/settings_store"),i=n("../actions/layout_action_creator"),s=n("../actions/message_action_creator"),c=function(){var e,t,n;return e=["account.mailbox.messages","account.mailbox.messages.filter","account.mailbox.messages.date"],t=null!=(n=router.current.firstPanel)?n.action:void 0,u.call(e,t)>=0},r.exports={debugLogs:[],getCurrentAccount:function(){var e;return null!=(e=o.getSelected())?e.toJS():void 0},getCurrentMailbox:function(){var e;return null!=(e=o.getSelectedMailbox())?e.toJS():void 0},getCurrentMessage:function(){var e,t;return t=a.getCurrentID(),e=a.getByID(t),null!=e?e.toJS():void 0},getMessage:function(e){var t;return t=a.getByID(e),null!=t?t.toJS():void 0},getCurrentConversation:function(){var e,t;return e=a.getCurrentConversationID(),null!=e&&null!=(t=a.getConversation(e))?t.toJS():void 0},getCurrentActions:function(){var e;return e=[],Object.keys(router.current).forEach(function(t){return null!=router.current[t]?e.push(router.current[t].action):void 0}),e},messageNew:function(){return router.navigate("compose/",{trigger:!0})},setLocale:function(e){var t,r,o;window.moment.locale(e),r={};try{r=n("../locales/"+e)}catch(i){t=i,console.log(t),r=n("../locales/en")}return o=new Polyglot,o.extend(r),window.t=o.t.bind(o)},getAccountByLabel:function(e){return o.getByLabel(e)},getSetting:function(e){return l.get().toJS()[e]},setSetting:function(e,t){var r,o,i,s,a;if(o=n("../app_dispatcher"),r=n("../constants/app_constants").ActionTypes,s=l.get().toJS(),"object"==typeof e)for(i in e)p.call(e,i)&&(a=e[i],s[i]=a);else s[e]=t;return o.handleViewAction({type:r.SETTINGS_UPDATED,value:s})},messageNavigate:function(e,t){var n,r;if(c()&&(n=t&&l.get("displayConversation")&&l.get("displayPreview"),r="prev"===e?a.getPreviousMessage(n):a.getNextMessage(n),null!=r))return this.messageSetCurrent(r)},messageSetCurrent:function(e){return s.setCurrent(e.get("id"),!0),l.get("displayPreview")?this.messageDisplay(e):void 0},messageDisplay:function(e,t){var n,r,o,i,s;return null==e&&(e=a.getByID(a.getCurrentID())),null==e||t===!1&&null==window.router.current.secondPanel?void 0:(r=e.get("conversationID"),l.get("displayConversation")&&null!=r?(n="conversation",o={messageID:e.get("id"),conversationID:r}):(n="message",o={messageID:e.get("id")}),s={direction:"second",action:n,parameters:o},i=window.router.buildUrl(s),window.router.navigate(i,{trigger:!0}))},messageClose:function(){var e,t;return t=window.location.href,e=t.replace(/\/message\/[^\/]*\//gi,""),e=e.replace(/\/conversation\/[^\/]*\/[^\/]*\//gi,""),window.location.href=e},messageDeleteCurrent:function(){var e,n,r,o,u,p;if(c()&&(o=a.getCurrentID(),null!=o))return p=l.get(),r=p.get("displayConversation"),e=p.get("messageConfirmDelete"),e&&(n=r?t("list delete conv confirm",{smart_count:1}):t("list delete confirm",{smart_count:1})),e?(u={title:t("app confirm delete"),subtitle:n,closeLabel:t("app cancel"),actionLabel:t("app confirm"),action:function(){return s["delete"]({messageID:o}),i.hideModal()}},i.displayModal(u)):s["delete"]({messageID:o})},messageUndo:function(){return s.undo()},customEvent:function(e,t){var n;return n=new CustomEvent(e,{detail:t}),window.dispatchEvent(n)},simulateUpdate:function(){var e;return e=n("../app_dispatcher"),window.setInterval(function(){var t,n,r;return t={accountID:null!=(n=o.getDefault())?n.get("id"):void 0,id:null!=(r=o.getDefaultMailbox())?r.get("id"):void 0,label:"INBOX",path:"INBOX",tree:["INBOX"],delimiter:".",uidvalidity:Date.now(),attribs:[],docType:"Mailbox",lastSync:(new Date).toISOString(),nbTotal:467,nbUnread:0,nbRecent:5,weight:1e3,depth:0},e.handleServerAction({type:"RECEIVE_MAILBOX_UPDATE",value:t})},5e3)},notify:function(e,t){return null!=window.Notification&&l.get("desktopNotifications")?new Notification(e,t):(null==t&&(t={body:e}),window.setTimeout(function(){return i.notify(""+e+" - "+t.body)},0))},log:function(e){var t;return t=e.stack.split("\n")[0].split("@")[1].split(/:\d/)[0].split("/").slice(0,-2).join("/"),window.onerror(e.name,t,e.lineNumber,e.colNumber,e)},dump:function(){var e;return(e=function(t){var n,r,o,i,s,a;r={children:{},state:{},props:{}},i=t.state;for(n in i)o=i[n],"object"==typeof o?r.state[n]=_.clone(o):r.state[n]=o;s=t.props;for(n in s)o=s[n],"object"==typeof o?r.props[n]=_.clone(o):r.props[n]=o;a=t.refs;for(n in a)o=a[n],r.children[n]=e(t.refs[n]);return r})(window.rootComponent)},logInfo:function(e){var t,n;return t={data:{type:"debug",message:e}},n=new XMLHttpRequest,n.open("POST","activity",!0),n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.send(JSON.stringify(t)),console.log(e)},logAction:function(e,t){var n,r,o;return"development"===window.app_env?(n=function(e){var t,n,r;return t=_.clone(e),n=function(e){var t;return null!=e?(t=_.clone(e),delete t.headers,delete t.html,delete t.text,delete t.attachments,t):void 0},Array.isArray(t.value)?t.value=t.value.map(n):(t.value=n(t.value),Array.isArray(null!=(r=t.value)?r.messages:void 0)&&(t.value.messages=t.value.messages.map(n))),t},r=(new Error).stack||"",r=r.split("\n").filter(function(e){return/app.js/.test(e.split("@"))}).map(function(e){return e.split("@")[0]}),o={date:(new Date).toISOString(),stack:r.splice(2)},null!=e&&(o.action=n(e)),null!=t&&(o.message=t),window.cozyMails.debugLogs.unshift(o),window.cozyMails.debugLogs=window.cozyMails.debugLogs.slice(0,100)):void 0},displayLogs:function(){var e;return e={title:t("modal please contribute"),subtitle:t("modal please report"),allowCopy:!0,closeLabel:t("app alert close"),content:React.DOM.pre({style:{"max-height":"300px","word-wrap":"normal"}},JSON.stringify(window.cozyMails.debugLogs,null,4))},i.displayModal(e)},clearLogs:function(){return window.cozyMails.debugLogs=[]}}}),require.register("utils/colorhash",function(e,t,n){var r,o;o=function(e,t,n){
return 0>n&&(n+=1),n>1&&(n-=1),1/6>n?e+6*(t-e)*n:.5>n?t:2/3>n?e+(t-e)*(2/3-n)*6:e},r=function(e,t,n){var r,i,s,a,l,c;return 0===t?c=s=r=n:(l=.5>n?n*(1+t):n+t-n*t,a=2*n-l,c=o(a,l,e+1/3),s=o(a,l,e),r=o(a,l,e-1/3)),i=(1<<24)+(255*c<<16)+(255*s<<8)+parseInt(255*r),"#"+i.toString(16).slice(1)},n.exports=function(e){var t,n,o,i,s,a,l,c;for(o=0,i=l=0,c=e.length-1;c>=0?c>=l:l>=c;i=c>=0?++l:--l)o=e.charCodeAt(i)+(o<<5)-o;return n=o%100/100,a=o%1e3/1e3,s=.5+.2*(o%2)/2,t=r(n,a,s)}}),require.register("utils/discovery_to_fields",function(e,t,n){var r;n.exports=r=function(e){var t,n,r,o;for(t={},r=0,o=e.length;o>r;r++)n=e[r],"imap"===n.type&&null==t.imapServer&&(t.imapServer=n.hostname,t.imapPort=n.port,"SSL"===n.socketType?(t.imapSSL=!0,t.imapTLS=!1):"STARTTLS"===n.socketType?(t.imapSSL=!1,t.imapTLS=!0):"plain"===n.socketType&&(t.imapSSL=!1,t.imapTLS=!1)),"smtp"===n.type&&null==t.smtpServer&&(t.smtpServer=n.hostname,t.smtpPort=n.port,"SSL"===n.socketType?(t.smtpSSL=!0,t.smtpTLS=!1):"STARTTLS"===n.socketType?(t.smtpSSL=!1,t.smtpTLS=!0):"plain"===n.socketType&&(t.smtpSSL=!1,t.smtpTLS=!1));if(null==t.imapServer&&(t.imapServer="",t.imapPort="993"),null==t.smtpServer&&(t.smtpServer="",t.smtpPort="465"),!t.imapSSL)switch(t.imapPort){case"993":t.imapSSL=!0,t.imapTLS=!1;break;default:t.imapSSL=!1,t.imapTLS=!1}if(!t.smtpSSL)switch(t.smtpPort){case"465":t.smtpSSL=!0,t.smtpTLS=!1;break;case"587":t.smtpSSL=!1,t.smtpTLS=!0;break;default:t.smtpSSL=!1,t.smtpTLS=!1}return t.isGmail="imap.googlemail.com"===t.imapServer,t}}),require.register("utils/dom_utils",function(e,t,n){var r;n.exports=r={isVisible:function(e){var t,n,r;return n=e.getBoundingClientRect(),t=window.innerHeight||document.documentElement.clientHeight,r=window.innerWidth||document.documentElement.clientWidth,0===t||0===r?!1:n.bottom<=t+0&&n.top>=0}}}),require.register("utils/file_utils",function(e,t,n){var r;n.exports=r={dataURItoBlob:function(e){var t,n,r,o,i;for(t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):window.unescape(e.split(",")[1]),r={mime:e.split(",")[0].split(":")[1].split(";")[0],blob:new Uint8Array(t.length)},n=o=0,i=t.length;i>=0?i>=o:o>=i;n=i>=0?++o:--o)r.blob[n]=t.charCodeAt(n);return r},fileToDataURI:function(e,t){var n;return n=new FileReader,n.readAsDataURL(e),n.onload=function(){return t(n.result)}}}}),require.register("utils/intent_manager",function(e,t,n){var r,o;o=3e3,n.exports=r=function(){function e(){this.talker=new Talker(window.parent,"*")}return e.prototype.send=function(e,t,n){return this.talker.timeout=n?n:o,this.talker.send("nameSpace",t)},e}()}),require.register("utils/message_utils",function(e,n,r){var o,i,s,a,l,c,u;u=React.DOM.span,i=n("../constants/app_constants").ComposeActions,s=n("../stores/contact_store"),c=n("../stores/search_store"),l="margin-left: 0.8ex; padding-left: 1ex; border-left: 3px solid #34A6FF;",o="<style>\npre {background: transparent; border: 0}\n</style>",r.exports=a={displayAddress:function(e,t){return null==t&&(t=!1),t?null!=e.name&&""!==e.name?'"'+e.name+'" <'+e.address+">":""+e.address:null!=e.name&&""!==e.name?e.name:e.address.split("@")[0]},displayAddresses:function(e,t){var n,r,o,i;if(null==t&&(t=!1),null==e)return"";for(r=[],o=0,i=e.length;i>o&&(n=e[o],null!=n);o++)r.push(a.displayAddress(n,t));return r.join(", ")},highlightSearch:function(e){var t,n;return t=new RegExp(c.getCurrentSearch(),"gi"),n=e.match(t),n?e.split(t).reduce(function(e,t,r){return t.length&&e.push(t),n[r]&&e.push(u({className:"hlt-search"},n[r])),e},[]):[e]},parseAddress:function(e){var t,n,r;return e=e.trim(),t=(r=e.match(/"{0,1}(.*)"{0,1} <(.*)>/))?{name:r[1],address:r[2]}:{address:e.replace(/^\s*/,"")},n=/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/,t.isValid=t.address.match(n),t},getReplyToAddress:function(e){var t,n;return n=e.get("replyTo"),t=e.get("from"),null!=n&&0!==n.length?n:t},addSignature:function(e,t){var n;return e.text+="\n\n-- \n"+t,n=t.replace(/\n/g,"<br>"),e.html+='<p><br></p><p id="signature">-- \n<br>'+n+"</p>\n<p><br></p>"},makeReplyMessage:function(e,t,n,r,o){var s,a,l,c,u,p,d,h,f;if(u={composeInHTML:r,attachments:Immutable.Vector.empty()},t){if(u.accountID=t.get("accountID"),u.conversationID=t.get("conversationID"),s=this.formatReplyDate(t.get("createdAt")),h=this.displayAddresses(t.get("from")),f=t.get("text"),l=t.get("html"),null==f&&(f=""),null!=f&&null==l&&r)try{l=markdown.toHTML(f)}catch(m){a=m,console.error("Error converting message to Markdown: "+a),l="<div class='text'>"+f+"</div>"}null==l||null!=f||r||(f=toMarkdown(l)),u.inReplyTo=[t.get("id")],u.references=t.get("references")||[],u.references=u.references.concat(u.inReplyTo)}switch(c=null!=o&&o.length>0?!0:!1,d={message:u,inReplyTo:t,dateHuman:s,sender:h,text:f,html:l,signature:o,isSignature:c},n){case i.REPLY:this.setMessageAsReply(d);break;case i.REPLY_ALL:this.setMessageAsReplyAll(d);break;case i.FORWARD:this.setMessageAsForward(d);break;case null:this.setMessageAsDefault(d)}return p=function(t){return t.address!==e},u.to=u.to.filter(p),u.cc=u.cc.filter(p),u},setMessageAsReply:function(e){var n,r,i,s,a,c,u,p,d,h;return a=e.message,i=e.inReplyTo,n=e.dateHuman,u=e.sender,h=e.text,r=e.html,d=e.signature,s=e.isSignature,c={date:n,sender:u},p=t("compose reply separator",c),a.to=this.getReplyToAddress(i),a.cc=[],a.bcc=[],a.subject=this.getReplySubject(i),a.text=p+this.generateReplyText(h)+"\n",a.html=""+o+"\n<p><br></p>",s&&this.addSignature(a,d),a.html+="<p>"+p+'<span class="originalToggle"> … </span></p>\n<blockquote style="'+l+'">'+r+"</blockquote>"},setMessageAsReplyAll:function(e){var n,r,i,s,a,c,u,p,d,h,f;return a=e.message,i=e.inReplyTo,n=e.dateHuman,u=e.sender,h=e.text,r=e.html,d=e.signature,s=e.isSignature,c={date:n,sender:u},p=t("compose reply separator",c),a.to=this.getReplyToAddress(i),f=a.to.map(function(e){return e.address}),a.cc=[].concat(i.get("from"),i.get("to"),i.get("cc")).filter(function(e){return null!=e&&-1===f.indexOf(e.address)}),a.bcc=[],a.subject=this.getReplySubject(i),a.text=p+this.generateReplyText(h)+"\n",a.html=""+o+"\n<p><br></p>",s&&this.addSignature(a,d),a.html+="<p>"+p+'<span class="originalToggle"> … </span></p>\n<blockquote style="'+l+'">'+r+"</blockquote>\n<p><br></p>"},setMessageAsForward:function(e){var n,r,i,s,a,l,c,u,p,d,h,f,m,g,v,y;return u=e.message,l=e.inReplyTo,r=e.dateHuman,p=e.sender,v=e.text,s=e.html,g=e.signature,c=e.isSignature,n=l.get("to").map(function(e){return e.address}).join(", "),h=this.getReplyToAddress(l),f="",d=h.length>0?(f=h[0].name,d=h[0].address):void 0,i=f.length>0?""+f+" &lt;"+d+"&gt;":d,m="\n----- "+t("compose forward header")+" ------\n"+t("compose forward subject")+" "+l.get("subject")+"\n"+t("compose forward date")+" "+r+"\n"+t("compose forward from")+" "+i+"\n"+t("compose forward to")+" "+n+"\n",y=m.replace("&lt;","<").replace("&gt;",">"),y=y.replace("<pre>","").replace("</pre>",""),a=m.replace(/(\n)+/g,"<br>"),this.setMessageAsDefault(e),u.subject=""+t("compose forward prefix")+l.get("subject"),u.text=y+v,u.html=""+o,c&&this.addSignature(u,g),u.html+="\n<p>"+a+"</p><p><br></p>"+s,u.attachments=l.get("attachments"),u},setMessageAsDefault:function(e){var t,n,r,i,s,a,l,c;return s=e.message,r=e.inReplyTo,t=e.dateHuman,a=e.sender,c=e.text,n=e.html,l=e.signature,i=e.isSignature,s.to=[],s.cc=[],s.bcc=[],s.subject="",s.text="",s.html=""+o+"\n<p><br></p>",i&&this.addSignature(s,l),s},generateReplyText:function(e){var t;return e=e.split("\n"),t=[],e.forEach(function(e){return t.push("> "+e)}),t.join("\n")},getAttachmentType:function(e){var t;if(!e)return null;switch(t=e.split("/"),t[0]){case"audio":case"image":case"text":case"video":return t[0];case"application":switch(t[1]){case"vnd.ms-excel":case"vnd.oasis.opendocument.spreadsheet":case"vnd.openxmlformats-officedocument.spreadsheetml.sheet":return"spreadsheet";case"msword":case"vnd.ms-word":case"vnd.oasis.opendocument.text":case"vnd.openxmlformats-officedocument.wordprocessingml.document":return"word";case"vns.ms-powerpoint":case"vnd.oasis.opendocument.presentation":case"vnd.openxmlformats-officedocument.presentationml.presentation":return"presentation";case"pdf":return t[1];case"gzip":case"zip":return"archive"}}},formatReplyDate:function(e){return null==e&&(e=moment()),e=moment(e),e.format("lll")},formatDate:function(e,t){var n,r;return null==e?null:(r=moment(),e=moment(e),n=e.isBefore(r,"year")?"DD/MM/YYYY":e.isBefore(r,"day")?null!=t&&t?"L":"MMM DD":"HH:mm",e.format(n))},getAvatar:function(e){return null!=e.get("from")[0]?s.getAvatar(e.get("from")[0].address):null},getPreview:function(e){var t,n;return n=e.get("text"),null==n&&(t=e.get("html"),n=null!=t?toMarkdown(t)(pr("")):""),n.substr(0,1024)},cleanReplyText:function(e){var t,n;try{t=e.replace(/<(style>)[^\1]*\1/gim,""),t=toMarkdown(t)}catch(r){null!=e&&(t=e.replace(/<(style>)[^\1]*\1/gim,""),t=e.replace(/<[^>]*>/gi,""))}return n=document.createElement("div"),n.innerHTML=t,t=n.textContent,t=t.replace(/>[ \t]+/gi,"> "),t=t.replace(/(> \n)+/g,"> \n")},wrapReplyHtml:function(e){return e=e.replace(/<p>/g,'<p style="margin: 0">'),'<style type="text/css">\nblockquote {\n    margin: 0.8ex;\n    padding-left: 1ex;\n    border-left: 3px solid #34A6FF;\n}\np {margin: 0;}\npre {background: transparent; border: 0}\n</style>\n'+e},getReplySubject:function(e){var n,r;return r=e.get("subject")||"",n=t("compose reply prefix"),0!==r.indexOf(n)&&(r=""+n+r),r},tooltip:function(e,n,r,o){var i,a,l,c;return null==o&&(o={}),c=null,a=function(e){return e.preventDefault(),e.stopPropagation(),r(n)},i=function(i){var c,u,p,d,h,f,m,g,v;if(!e.dataset.tooltip)return e.dataset.tooltip=!0,d=s.getByAddress(n.address),p=null!=d?d.get("avatar"):void 0,c="",h="",null!=d?(h=null!=p?"<img class='avatar' src="+p+">":"<div class='no-avatar'>?</div>",h='<div class="tooltip-avatar">\n  <a href="/#apps/contacts/contact/'+d.get("id")+'" target="blank">\n    '+h+"\n  </a>\n</div>"):null!=r&&(c='<p class="tooltip-toolbar">\n  <button class="btn btn-cozy btn-add" type="button">\n  '+t("contact button label")+"\n  </button>\n</p>"),g='<div class="tooltip" role="tooltip">\n    <div class="tooltip-arrow"></div>\n    <div class="tooltip-content">\n        '+h+"\n        <div>\n        "+n.name+"\n        "+(n.name?"<br>":"")+"\n        &lt;"+n.address+"&gt;\n        </div>\n        "+c+"\n    </div>\n</div>'",o={title:n.address,template:g,trigger:"manual",placement:"auto top",container:o.container||e.parentNode},jQuery(e).tooltip(o).tooltip("show"),v=jQuery(e).data("bs.tooltip").tip()[0],parseInt(v.style.left,10)<0&&(v.style.left=0),m=v.getBoundingClientRect(),f=document.createElement("div"),f.classList.add("tooltip-mask"),f.style.top=m.top-8+"px",f.style.left=m.left-8+"px",f.style.height=m.height+32+"px",f.style.width=m.width+16+"px",document.body.appendChild(f),f.addEventListener("mouseout",function(e){var t,n;return m.left<(t=e.pageX)&&t<m.right&&m.top<(n=e.pageY)&&n<m.bottom?void 0:(f.parentNode.removeChild(f),l())}),null!=r&&(u=v.querySelector(".btn-add"),null!=u)?u.addEventListener("click",a):void 0},l=function(){var t;return t=e.querySelector(".btn-add"),null!=t&&t.removeEventListener("click",a),delete e.dataset.tooltip,jQuery(e).tooltip("destroy")},e.addEventListener("mouseover",function(){return c=setTimeout(function(){return i()},o.delay||1e3)}),e.addEventListener("mouseout",function(){return clearTimeout(c)}),o.showOnClick?e.addEventListener("click",function(e){return e.stopPropagation(),i()}):void 0}}}),require.register("utils/misc",function(e,t,n){e.getSortFunction=function(e,t){var n;return n=function(n,r){var o,i;return o=n.get(e),i=r.get(e),o>i?-1*t:i>o?1*t:0}},e.reverseDateSort=e.getSortFunction("date",-1)}),require.register("utils/plugin_utils",function(e,n,r){var o,i={}.hasOwnProperty;o={modal:function(e){var n;return n=document.createElement("div"),n.classList.add("modal"),n.classList.add("fade"),n.innerHTML='<div class="modal-dialog">\n    <div class="modal-content">\n        <div class="modal-header">\n            <button type="button" class="close" data-dismiss="modal"\n                    aria-label="Close">\n                <span aria-hidden="true">&times;</span>\n            </button>\n            <h4 class="modal-title"></h4>\n        </div>\n        <div class="modal-body"> </div>\n        <div class="modal-footer">\n            <button type="button" class="btn btn-default"\n                    data-dismiss="modal">'+t("plugin modal close")+"\n            </button>\n        </div>\n    </div>\n</div>",null!=e.title&&(n.querySelector(".modal-title").innerHTML=e.title),null!=e.body&&("string"==typeof e.body?n.querySelector(".modal-body").innerHTML=e.body:n.querySelector(".modal-body").appendChild(e.body)),"small"===e.size&&n.querySelector(".modal-dialog").classList.add("modal-sm"),"large"===e.size&&n.querySelector(".modal-dialog").classList.add("modal-lg"),e.show!==!1&&(document.body.appendChild(n),window.jQuery(n).modal("show")),n}},r.exports={init:function(){var e,t,n;return null==window.plugins&&(window.plugins={}),window.plugins.helpers=o,Object.keys(window.plugins).forEach(function(e){return function(t){var n,r;return r=window.plugins[t],null!=r.url?(n=function(){return e.activate(t)},e.loadJS(r.url,n)):r.active?e.activate(t):void 0}}(this)),"undefined"!=typeof MutationObserver&&null!==MutationObserver?(e={attributes:!1,childList:!0,characterData:!1,subtree:!0},n=function(e){var t,n,r,o,s,a;for(n=function(e,t){var n,r,o,s,a;if(e.nodeType===Node.ELEMENT_NODE){s=window.plugins,a=[];for(o in s)i.call(s,o)&&(r=s[o],r.active?("add"===t&&(n=r.onAdd),"delete"===t&&(n=r.onDelete),null!=n&&n.condition.bind(r)(e)?a.push(n.action.bind(r)(e)):a.push(void 0)):a.push(void 0));return a}},t=function(e){var t,r,o,i,s,a,l;for(r=Array.prototype.slice.call(e.addedNodes),o=0,s=r.length;s>o;o++)t=r[o],n(t,"add");for(r=Array.prototype.slice.call(e.removedNodes),l=[],i=0,a=r.length;a>i;i++)t=r[i],l.push(n(t,"del"));return l},a=[],o=0,s=e.length;s>o;o++)r=e[o],a.push(t(r));return a},t=new MutationObserver(n),t.observe(document,e)):setInterval(function(){var e,t,n,r;n=window.plugins,r=[];for(t in n)i.call(n,t)&&(e=n[t],e.active?(null!=e.onAdd&&e.onAdd.condition.bind(e)(document.body)&&e.onAdd.action.bind(e)(document.body),null!=e.onDelete&&e.onDelete.condition.bind(e)(document.body)?r.push(e.onDelete.action.bind(e)(document.body)):r.push(void 0)):r.push(void 0));return r},200)},activate:function(e){var t,n,r,o,s,a,l,c,u;try{if(o=window.plugins[e],l=o.type,o.active=!0,null!=o.listeners){c=o.listeners;for(n in c)i.call(c,n)&&(r=c[n],window.addEventListener(n,r.bind(o)))}if(o.onActivate&&o.onActivate(),null!=l){u=window.plugins;for(a in u)i.call(u,a)&&(s=u[a],a!==e&&s.type===l&&s.active&&this.deactivate(a))}return n=new CustomEvent("plugin",{detail:{action:"activate",name:e}}),window.dispatchEvent(n)}catch(p){return t=p,console.log("Unable to activate plugin "+e+": "+t)}},deactivate:function(e){var t,n,r,o,s;try{if(o=window.plugins[e],o.active=!1,null!=o.listeners){s=o.listeners;for(n in s)i.call(s,n)&&(r=s[n],window.removeEventListener(n,r))}return o.onDeactivate&&o.onDeactivate(),n=new CustomEvent("plugin",{detail:{action:"deactivate",name:e}}),window.dispatchEvent(n)}catch(a){return t=a,console.log("Unable to deactivate plugin "+e+": "+t)}},merge:function(e){var t,n,r,o,s;for(r in e)i.call(e,r)&&(n=e[r],t=window.plugins[r],null!=t?t.active=n.active:null!=n.url?window.plugins[r]=n:delete e[r]);o=window.plugins,s=[];for(r in o)i.call(o,r)&&(n=o[r],null==e[r]?s.push(e[r]={name:n.name,active:n.active}):s.push(void 0));return s},loadJS:function(e,t){var n;return n=document.createElement("script"),n.type="text/javascript",n.async=!0,n.src=e,null!=t&&n.addEventListener("load",t),document.body.appendChild(n)},load:function(e){var t,n,r;if(!/:\/\//.test(e))try{throw new Error}catch(o){n=o,t=n.stack.split("\n")[0].split("@")[1].split(/:\d/)[0].split("/").slice(0,-2).join("/"),e=t+"/"+e+"/"}return r=new XMLHttpRequest,r.open("GET",e,!0),r.onload=function(){var e,t;return t=new DOMParser,e=t.parseFromString(r.response,"text/html"),e&&(Array.prototype.forEach.call(e.querySelectorAll("style"),function(e){var t;return t=document.createElement("style"),document.body.appendChild(t),Array.prototype.forEach.call(e.sheet.cssRules,function(e,n){return t.sheet.insertRule(e.cssText,n)})}),Array.prototype.forEach.call(e.querySelectorAll("script"),function(e){var t;return t=document.createElement("script"),t.textContent=e.textContent,document.body.appendChild(t)})),r.send()}}}}),require.register("utils/socketio_utils",function(e,t,n){var r,o,i,s,a,l,c,u;o=t("../app_dispatcher"),r=t("../constants/app_constants").ActionTypes,u=window.location.origin,s=""+window.location.pathname+"socket.io",c=io.connect(u,{path:s,reconnectionDelayMax:6e4,reconectionDelay:2e3,reconnectionAttempts:3}),i=function(e){return function(t){return o.handleServerAction({type:e,value:t})}},a={},l=function(){return c.emit("change_scope",a)},c.on("message.create",i(r.RECEIVE_RAW_MESSAGE_REALTIME)),c.on("message.update",i(r.RECEIVE_RAW_MESSAGE)),c.on("message.delete",i(r.RECEIVE_MESSAGE_DELETE)),c.on("mailbox.update",i(r.RECEIVE_MAILBOX_UPDATE)),c.on("connect",function(){return l()}),c.on("reconnect",function(){return l()}),c.on("refresh.notify",i(r.RECEIVE_REFRESH_NOTIF)),e.changeRealtimeScope=function(e,t){return a={mailboxID:e,before:t},l()}}),require.register("utils/translators/account_translator",function(e,t,n){var r,o,i=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};o=t("../../constants/app_constants").MailboxFlags,n.exports=r={toImmutable:function(e){var t,n,r,s;return t={},r=900,s=400,null==e.mailboxes&&(e.mailboxes=[]),(null==e.draftMailbox||null==e.sentMailbox||null==e.trashMailbox)&&e.mailboxes.forEach(function(t){var n,r,s;return null==e.draftMailbox&&(n=o.DRAFT,i.call(t.attribs,n)>=0)&&(e.draftMailbox=t.id),null==e.sentMailbox&&(r=o.SENT,i.call(t.attribs,r)>=0)&&(e.sentMailbox=t.id),null==e.trashMailbox&&(s=o.TRASH,i.call(t.attribs,s)>=0)?e.trashMailbox=t.id:void 0}),(null==e.draftMailbox||null==e.sentMailbox||null==e.trashMailbox)&&e.mailboxes.forEach(function(t){return null==e.draftMailbox&&/draft/i.test(t.label)&&(e.draftMailbox=t.id),null==e.sentMailbox&&/sent/i.test(t.label)&&(e.sentMailbox=t.id),null==e.trashMailbox&&/trash/i.test(t.label)?e.trashMailbox=t.id:void 0}),n=Immutable.Sequence(e.mailboxes).mapKeys(function(e,t){return t.id}).map(function(e){var n;return e.depth=e.tree.length-1,0===e.depth?(n=e.label.toLowerCase(),"inbox"===n?e.weight=1e3:e.attribs.length>0||/draft/.test(n)||/sent/.test(n)||/trash/.test(n)?(e.weight=r,r-=5):(e.weight=s,s-=5),t[e.depth]=e.weight):(e.weight=t[e.depth-1]-.1,t[e.depth]=e.weight),Immutable.Map(e)}).toOrderedMap(),delete e.totalUnread,e.mailboxes=n,Immutable.Map(e)}}}),require.register("utils/xhr_utils",function(e,t,n){var r,o,i,s,a=[].slice;s=superagent,r=t("./translators/account_translator"),o=t("../stores/settings_store"),i=function(){var e,t,n,r,o,i;return r=arguments[0],e=arguments[1],t=3<=arguments.length?a.call(arguments,2):[],r.ok?e(null,r.body):(n=(null!=(o=r.body)?o.error:void 0)===!0?r.body:(null!=(i=r.body)?i.error:void 0)?r.body.error:r.body?r.body:new Error("error in "+t[0]),console.log.apply(console,["Error in"].concat(a.call(t),[n])),e(n))},n.exports={changeSettings:function(e,t){return s.put("settings").set("Accept","application/json").send(e).end(function(n){return i(n,t,"changeSettings",e)})},fetchMessage:function(e,t){return s.get("message/"+e).set("Accept","application/json").end(function(n){return i(n,t,"fetchMessage",e)})},fetchConversation:function(e,t){return s.get("messages/batchFetch?conversationID="+e).set("Accept","application/json").end(function(n){return n.ok&&(n.body.conversationLengths={},n.body.conversationLengths[e]=n.body.length),i(n,t,"fetchConversation",e)})},fetchMessagesByFolder:function(e,t){return s.get(e).set("Accept","application/json").end(function(n){return i(n,t,"fetchMessagesByFolder",e)})},mailboxCreate:function(e,t){return s.post("mailbox").send(e).set("Accept","application/json").end(function(n){return i(n,t,"mailboxCreate",e)})},mailboxUpdate:function(e,t){return s.put("mailbox/"+e.mailboxID).send(e).set("Accept","application/json").end(function(n){return i(n,t,"mailboxUpdate",e)})},mailboxDelete:function(e,t){return s.del("mailbox/"+e.mailboxID).set("Accept","application/json").end(function(n){return i(n,t,"mailboxDelete",e)})},mailboxExpunge:function(e,t){return s.del("mailbox/"+e.mailboxID+"/expunge").set("Accept","application/json").end(function(n){return i(n,t,"mailboxExpunge",e)})},messageSend:function(e,t){var n,r,o,a;a=s.post("message").set("Accept","application/json"),r={},e.attachments=e.attachments.map(function(e){return r[e.get("generatedFileName")]=e.get("rawFileObject"),e.remove("rawFileObject")}).toJS(),a.field("body",JSON.stringify(e));for(o in r)n=r[o],null!=n&&a.attach(o,n);return a.end(function(n){return i(n,t,"messageSend",e)})},batchFetch:function(e,t){var n;return n=_.extend({},e),s.put("messages/batchFetch").send(e).end(function(e){return i(e,t,"batchFetch")})},batchAddFlag:function(e,t,n){var r;return r=_.extend({flag:t},e),s.put("messages/batchAddFlag").send(r).end(function(e){return i(e,n,"batchAddFlag")})},batchRemoveFlag:function(e,t,n){var r;return r=_.extend({flag:t},e),s.put("messages/batchRemoveFlag").send(r).end(function(e){return i(e,n,"batchRemoveFlag")})},batchDelete:function(e,t){var n;return n=_.extend({},e),s.put("messages/batchTrash").send(e).end(function(e){return i(e,t,"batchDelete")})},batchMove:function(e,t,n,r){var o;return o=_.extend({from:t,to:n},e),s.put("messages/batchMove").send(o).end(function(e){return i(e,r,"batchMove")})},createAccount:function(e,t){return s.post("account").send(e).set("Accept","application/json").end(function(n){return i(n,t,"createAccount",e)})},editAccount:function(e,t){var n;return n=e.toJS(),s.put("account/"+n.id).send(n).set("Accept","application/json").end(function(n){return i(n,t,"editAccount",e)})},checkAccount:function(e,t){return s.put("accountUtil/check").send(e).set("Accept","application/json").end(function(e){return i(e,t,"checkAccount")})},removeAccount:function(e,t){return s.del("account/"+e).set("Accept","application/json").end(function(e){return i(e,t,"removeAccount")})},accountDiscover:function(e,t){return s.get("provider/"+e).set("Accept","application/json").end(function(e){return i(e,t,"accountDiscover")})},search:function(e,t){return s.get(e).set("Accept","application/json").end(function(e){return i(e,t,"search")})},refresh:function(e,t){var n;return n=e?"refresh?all=true":"refresh",s.get(n).end(function(e){return i(e,t,"refresh")})},refreshMailbox:function(e,t){return s.get("refresh/"+e).end(function(e){return i(e,t,"refreshMailbox")})},activityCreate:function(e,t){return s.post("activity").send(e).set("Accept","application/json").end(function(n){return i(n,t,"activityCreate",e)})}}});